---
layout: post
title: Vulnerability Scanning.
subtitle: VUlnerability Scanning Basics.
tags: [pen]
---
El *Vulnerability Discovery* es una parte integral de una evaluación de seguridad. Aunque se puede hacer de forma manual nosotros cubriremos sobre todo herramientas de escaneo de vulnerabilidades automatizadas. 

<br />

### 1. Introducción al escaneo de vulnerabilidades.

**Cómo funciona un escanner de vulnerabilidades**

Aunque la implementación varia, la mayoría de los escaneres de vulnerabilidades funcionan de la siguiente manera:

- Detecta si un objetivo está levantado y ejecutándose.
- Realiza un escaneo de puertos (ya sea completo o parcial, dependiendo de la configuración).
- Identificación del sistema operativo empleando tecnicas de *fingerprint*.
- Identificación de servicios en ejecución en la máquina remota (banner grabbing, service behaviour identification, etc).
- Vulnerability discovery a través de 'signature-matching', esto es, comprobar si de una lista de vulnerabilidades (version vulneranle, credenciales por defecto, etc) existe alguna dentro del servicio.

Observemos que básicamente consiste en un reflejo/imitación de lo que un usuario hace cuando busca vulnerabilidades de forma manual. 

Es frecuente, por otra parte, que los escaneres de vulnerabilidades produzcan falsos positivos (identificar una vulnerabilidad cuando no existe) y falsos negativos (pasar por alto una vulnerabilidad existente) por lo que cada vulnerabilidad que se encuentre por el escanner debe ser validada manualmente.

<br />

### 2. Escaneo de vulnerabilidades con Nessus.

Nessus es un de los escaneres de vulnerabilidades de código abierto más populares que hay. Cuenta con una versión "Essential" que permite a un usuario escanear 16 IPs. Sin embargo en estas notas no nos extenderemos mucho más debido a que en el examen del OSCP no está permitido el uso de esta herramienta.

<br />

### 3. Escaneo de vulnerabilidades con Nmap.

Como alternativa a Nessus, también podemos utilizar Nmap Scripting Engine (NSE) para realizar análisis de vulnerabilidades automatizados. Si bien NSE no es un escáner de vulnerabilidades completo, tiene una biblioteca respetable de scripts que se pueden usar para detectar y validar vulnerabilidades. Los scripts NSE están escritos en Lua y varían en funcionalidad desde fuerza bruta y autenticación hasta detección y explotación de vulnerabilidades. A estos efectos nos centraremos en los scripts de las categorías "vuln" y "exploit", ya que el primero detecta una vulnerabilidad y el segundo intenta explotarla.

Sin embargo, existe una superposición entre estas categorías y algunos scripts "vuln" pueden ejecutar vulnerabilidades simplificadas. Por esta razón, los scripts también se clasifican como "seguros" o "intrusivos" y debemos tener mucho cuidado al ejecutar estos últimos porque pueden bloquear un servicio remoto o eliminar el objetivo.

Nunca ejecute scripts NSE a ciegas. Tómese el tiempo para inspeccionarlos para comprender lo que hacen antes de ejecutarlos y pruébelos en sus propios objetivos siempre que sea posible.

En Kali, los scripts NSE se pueden encontrar en el directorio /usr/share/nmap/scripts/. Al abrir cualquiera de los archivos \*.nse en un editor de texto, se muestra la fuente de cada script en un formato simple legible por humanos. Tómese el tiempo para revisar algunos de los scripts de NSE para familiarizarse con el formato y los tipos de comprobaciones que realizan estos scripts.

Esta carpeta también contiene un archivo script.db que sirve como índice para todos los scripts. También clasifica cada uno de los scripts de Nmap. Podríamos, por ejemplo, usar el archivo para buscar secuencias de comandos en las categorías " vuln " y "explotación", como se muestra en el Listado 4:

```
kali@kali:~$ cd /usr/share/nmap/scripts/

kali@kali:/usr/share/nmap/scripts$ head -n 5 script.db 
Entry { filename = "acarsd-info.nse", categories = { "discovery", "safe", } }
Entry { filename = "address-info.nse", categories = { "default", "safe", } }
Entry { filename = "afp-brute.nse", categories = { "brute", "intrusive", } }
Entry { filename = "afp-ls.nse", categories = { "discovery", "safe", } }
Entry { filename = "afp-path-vuln.nse", categories = { "exploit", "intrusive", "vuln",

kali@kali:/usr/share/nmap/scripts$ cat script.db  | grep '"vuln"\|"exploit"'
Entry { filename = "afp-path-vuln.nse", categories = { "exploit", "intrusive", "vuln",
Entry { filename = "clamav-exec.nse", categories = { "exploit", "vuln", } }
Entry { filename = "distcc-cve2004-2687.nse", categories = { "exploit", "intrusive", "
Entry { filename = "ftp-proftpd-backdoor.nse", categories = { "exploit", "intrusive", 
Entry { filename = "ftp-vsftpd-backdoor.nse", categories = { "exploit", "intrusive", "
...
```

Intentemos usar el NSE para detectar una vulnerabilidad. Para este ejemplo, usaremos --script vuln para ejecutar todos los scripts en la categoría "vuln" contra un objetivo en los laboratorios de PWK:

```
kali@kali:~$ sudo nmap --script vuln 10.11.1.10
[sudo] password for kali: 
Starting Nmap 7.70 ( https://nmap.org )
Pre-scan script results:
| broadcast-avahi-dos: 
|   Discovered hosts:
|     224.0.0.251
|   After NULL UDP avahi packet DoS (CVE-2011-1002).
|_  Hosts are all up (not vulnerable).
Nmap scan report for 10.11.1.10
Host is up (0.099s latency).
Not shown: 999 filtered ports
PORT   STATE SERVICE
80/tcp open  http
| http-cookie-flags: 
|   /CFIDE/administrator/enter.cfm: 
|     CFID: 
|       httponly flag not set
|     CFTOKEN: 
|       httponly flag not set
|   /CFIDE/administrator/entman/index.cfm: 
|     CFID: 
|       httponly flag not set
|     CFTOKEN: 
|       httponly flag not set
|   /CFIDE/administrator/archives/index.cfm: 
|     CFID: 
|       httponly flag not set
|     CFTOKEN: 
|_      httponly flag not set
|_http-csrf: Couldn't find any CSRF vulnerabilities.
|_http-dombased-xss: Couldn't find any DOM based XSS.
| http-enum: 
|   /CFIDE/administrator/enter.cfm: ColdFusion Admin Console
|   /CFIDE/administrator/entman/index.cfm: ColdFusion Admin Console
|   /cfide/install.cfm: ColdFusion Admin Console
|   /CFIDE/administrator/archives/index.cfm: ColdFusion Admin Console
|   /CFIDE/wizards/common/_logintowizard.cfm: ColdFusion Admin Console
|_  /CFIDE/componentutils/login.cfm: ColdFusion Admin Console
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.
| http-vuln-cve2010-2861: 
|   VULNERABLE:
|   Adobe ColdFusion Directory Traversal Vulnerability
|     State: VULNERABLE (Exploitable)
|     IDs:  CVE:CVE-2010-2861  OSVDB:67047
|       Multiple directory traversal vulnerabilities in the administrator console
|       in Adobe ColdFusion 9.0.1 and earlier allow remote attackers to read arbitrary
|       files via the locale parameter
|     Disclosure date: 2010-08-10
|     Extra information:
|       
|     ColdFusion8
|       HMAC: 749CD10DC95AF1713642CC5A1046857830C05E0B
|       Salt: 1560458235684
|       Hash: AAFDC23870ECBCD3D557B6423A8982134E17927E
|   
|     References:
|       http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2010-2861
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-2861
|       http://www.blackhatacademy.org/security101/Cold_Fusion_Hacking
|       http://osvdb.org/67047
|_      http://www.nessus.org/plugins/index.php?view=single&id=48340
MAC Address: 00:50:56:93:38:CA (VMware)
```

Vemos que el script http-vuln-cve2010-2861.nse detectó con éxito una vulnerabilidad de Adobe Coldfusion en nuestro objetivo. Esto es bastante interesante y vale la pena seguir investigando.

Si bien Nmap no es un escáner de vulnerabilidades en el sentido tradicional, puede ser muy útil para tareas similares. Podemos usar Nmap durante una prueba de penetración para verificar los resultados del escáner de vulnerabilidades, para que sirva como copia de seguridad de un escáner especialmente diseñado y para ayudar a reducir los falsos positivos.

