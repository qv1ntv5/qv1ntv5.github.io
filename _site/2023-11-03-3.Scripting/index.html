<!DOCTYPE html>
<html lang="en">
<!-- Beautiful Jekyll 5.0.0 | Copyright Dean Attali 2020 -->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

  

  <title>Scripting</title>

  
  <meta name="author" content="Qv1nTv5">
  

  <meta name="description" content="Scripting Basics.">

  

  

  
  <link rel="alternate" type="application/rss+xml" title="Home" href="http://localhost:4000/feed.xml">
  

  

  

  

  


  
    
      
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


    
      
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">


    
  

  
    
      <link rel="stylesheet" href="/assets/css/bootstrap-social.css">
    
      <link rel="stylesheet" href="/assets/css/beautifuljekyll.css">
    
  

  

  
  
  

  

  
  <meta property="og:site_name" content="Home">
  <meta property="og:title" content="Scripting">
  <meta property="og:description" content="Scripting Basics.">

  

  
  <meta property="og:type" content="article">
  <meta property="og:article:author" content="Qv1nTv5">
  <meta property="og:article:published_time" content="2023-11-03T00:00:00-04:00">
  <meta property="og:url" content="http://localhost:4000/2023-11-03-3.Scripting/">
  <link rel="canonical" href="http://localhost:4000/2023-11-03-3.Scripting/">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:site" content="@Qvintvs1">
  <meta name="twitter:creator" content="@Qvintvs1">

  <meta property="twitter:title" content="Scripting">
  <meta property="twitter:description" content="Scripting Basics.">

  

  


  

  

</head>


<body>

  


  <nav class="navbar navbar-expand-xl navbar-light fixed-top navbar-custom top-nav-regular"><a class="navbar-brand" href="http://localhost:4000/">Home</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="main-navbar">
    <ul class="navbar-nav ml-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Program</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/Cpage">C</a>
                  <a class="dropdown-item" href="/DHARMApage">Dharma</a>
            </div>
          </li>
        
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Pentest</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/BURPSUITEpage">Burp</a>
                  <a class="dropdown-item" href="/THMpage">Thm</a>
                  <a class="dropdown-item" href="/HackTheBoxpage">Htb</a>
                  <a class="dropdown-item" href="/PEN200page">BasicPentesting</a>
                  <a class="dropdown-item" href="/REDTEAMBASICSpage">RedTeam</a>
                  <a class="dropdown-item" href="/BLUETEAMBASICSpage">Blueteam</a>
                  <a class="dropdown-item" href="/REDESpage">Net</a>
                  <a class="dropdown-item" href="/2022-11-17-GitBasics">Git</a>
            </div>
          </li>
        
        <li class="nav-item">
          <a class="nav-link" id="nav-search-link" href="#" title="Search">
            <span id="nav-search-icon" class="fa fa-search"></span>
            <span id="nav-search-text">Search</span>
          </a>
        </li></ul>
  </div>

  

  

</nav>



<div id="beautifuljekyll-search-overlay">

  <div id="nav-search-exit" title="Exit search">✕</div>
  <input type="text" id="nav-search-input" placeholder="Search">
  <ul id="search-results-container"></ul>
  
  <script src="https://unpkg.com/simple-jekyll-search@latest/dest/simple-jekyll-search.min.js"></script>
  <script>
    var searchjson = '[ \
       \
        { \
          "title"    : "2. Constants and Literals in C.", \
          "category" : "C", \
          "url"      : "/2024-12-10-1.ConstantsinC-copy/", \
          "date"     : "December 10, 2024" \
        }, \
       \
        { \
          "title"    : "1. Basics of C", \
          "category" : "C", \
          "url"      : "/2024-12-02-1.BasicsOfC/", \
          "date"     : "December  2, 2024" \
        }, \
       \
        { \
          "title"    : "Gramáticas en Dharma", \
          "category" : "DHA", \
          "url"      : "/2024-09-24-Dharma_Tutorial/", \
          "date"     : "September 24, 2024" \
        }, \
       \
        { \
          "title"    : "Gramáticas en Dharma", \
          "category" : "fuzz", \
          "url"      : "/2024-03-22-Dharma_Tutorial-copy/", \
          "date"     : "March 22, 2024" \
        }, \
       \
        { \
          "title"    : "Mi experiencia con el OSCP", \
          "category" : "pen", \
          "url"      : "/2023-11-19-PEN200_Experience/", \
          "date"     : "November 19, 2023" \
        }, \
       \
        { \
          "title"    : "Client Side", \
          "category" : "pen", \
          "url"      : "/2023-11-17-17.Client_Side_Attacks/", \
          "date"     : "November 17, 2023" \
        }, \
       \
        { \
          "title"    : "Deep Packet Tunneling", \
          "category" : "pen", \
          "url"      : "/2023-11-16-16.Tunneling_Through_Deep_Packet_Inspection/", \
          "date"     : "November 16, 2023" \
        }, \
       \
        { \
          "title"    : "Report", \
          "category" : "pen", \
          "url"      : "/2023-11-15-15.Making_Reports/", \
          "date"     : "November 15, 2023" \
        }, \
       \
        { \
          "title"    : "Metasploit", \
          "category" : "pen", \
          "url"      : "/2023-11-14-14.Metasploit/", \
          "date"     : "November 14, 2023" \
        }, \
       \
        { \
          "title"    : "Password Attacks", \
          "category" : "pen", \
          "url"      : "/2023-11-13-13.Password_Attacks/", \
          "date"     : "November 13, 2023" \
        }, \
       \
        { \
          "title"    : "Active Directory Attacks", \
          "category" : "pen", \
          "url"      : "/2023-11-12-12.Active_Directory_Attacks/", \
          "date"     : "November 12, 2023" \
        }, \
       \
        { \
          "title"    : "Port Forwarding", \
          "category" : "pen", \
          "url"      : "/2023-11-11-11.Port_Forwarding/", \
          "date"     : "November 11, 2023" \
        }, \
       \
        { \
          "title"    : "Privilege Escalation", \
          "category" : "pen", \
          "url"      : "/2023-11-10-10.Privilege_Escalation/", \
          "date"     : "November 10, 2023" \
        }, \
       \
        { \
          "title"    : "File Transfers", \
          "category" : "pen", \
          "url"      : "/2023-11-09-9.File_Tranfers/", \
          "date"     : "November  9, 2023" \
        }, \
       \
        { \
          "title"    : "Buffer Overflows", \
          "category" : "pen", \
          "url"      : "/2023-11-08-8.Buffer_Overflows/", \
          "date"     : "November  8, 2023" \
        }, \
       \
        { \
          "title"    : "Vulnerability Scanning.", \
          "category" : "pen", \
          "url"      : "/2023-11-07-7.Vulnerability_Scanning/", \
          "date"     : "November  7, 2023" \
        }, \
       \
        { \
          "title"    : "Information Gathering", \
          "category" : "pen", \
          "url"      : "/2023-11-06-6.Active_Information_Gathering/", \
          "date"     : "November  6, 2023" \
        }, \
       \
        { \
          "title"    : "Windows", \
          "category" : "pen", \
          "url"      : "/2023-11-05-5.Windows/", \
          "date"     : "November  5, 2023" \
        }, \
       \
        { \
          "title"    : "Networking", \
          "category" : "pen", \
          "url"      : "/2023-11-04-4.Networking/", \
          "date"     : "November  4, 2023" \
        }, \
       \
        { \
          "title"    : "Scripting", \
          "category" : "pen", \
          "url"      : "/2023-11-03-3.Scripting/", \
          "date"     : "November  3, 2023" \
        }, \
       \
        { \
          "title"    : "Practical Tools", \
          "category" : "pen", \
          "url"      : "/2023-11-02-2.PracticalTools/", \
          "date"     : "November  2, 2023" \
        }, \
       \
        { \
          "title"    : "Linux", \
          "category" : "pen", \
          "url"      : "/2023-11-01-1.Linux/", \
          "date"     : "November  1, 2023" \
        }, \
       \
        { \
          "title"    : "Easy", \
          "category" : "hack", \
          "url"      : "/2022-12-01-Easy/", \
          "date"     : "December  1, 2022" \
        }, \
       \
        { \
          "title"    : "Git Basics", \
          "category" : "", \
          "url"      : "/2022-11-17-GitBasics/", \
          "date"     : "November 17, 2022" \
        }, \
       \
        { \
          "title"    : "Tier I", \
          "category" : "hack", \
          "url"      : "/2022-11-10-Tier_1/", \
          "date"     : "November 10, 2022" \
        }, \
       \
        { \
          "title"    : "Tier 0", \
          "category" : "hack", \
          "url"      : "/2022-11-09-Tier_0/", \
          "date"     : "November  9, 2022" \
        }, \
       \
        { \
          "title"    : "7.BufferOverflow.", \
          "category" : "thm", \
          "url"      : "/2022-11-02-7.BufferOverflow/", \
          "date"     : "November  2, 2022" \
        }, \
       \
        { \
          "title"    : "6.Offensive Pentesting", \
          "category" : "thm", \
          "url"      : "/2022-11-01-6.OffensivePentesting/", \
          "date"     : "November  1, 2022" \
        }, \
       \
        { \
          "title"    : "5.RedTeam", \
          "category" : "thm", \
          "url"      : "/2022-10-30-5.RedTeam/", \
          "date"     : "October 30, 2022" \
        }, \
       \
        { \
          "title"    : "4.Windows", \
          "category" : "thm", \
          "url"      : "/2022-10-22-4.Windows/", \
          "date"     : "October 22, 2022" \
        }, \
       \
        { \
          "title"    : "3.Junior Penetrationtester path", \
          "category" : "thm", \
          "url"      : "/2022-09-02-3.JRPenetrationTester/", \
          "date"     : "September  2, 2022" \
        }, \
       \
        { \
          "title"    : "2.Complete Begginer path.", \
          "category" : "thm", \
          "url"      : "/2022-08-07-2.CompleteBegginer/", \
          "date"     : "August  7, 2022" \
        }, \
       \
        { \
          "title"    : "1.Pre-Security path.", \
          "category" : "thm", \
          "url"      : "/2022-07-11-1Pre-Security/", \
          "date"     : "July 11, 2022" \
        }, \
       \
        { \
          "title"    : "0.Scripting for pentesters.", \
          "category" : "thm", \
          "url"      : "/2022-07-10-0.Scripting_for_pentesters/", \
          "date"     : "July 10, 2022" \
        }, \
       \
        { \
          "title"    : "Burp Certified Practitioner Practice Exam.", \
          "category" : "burp", \
          "url"      : "/2022-03-30-PracticeExam/", \
          "date"     : "March 30, 2022" \
        }, \
       \
        { \
          "title"    : "22. OAuth Authentication.", \
          "category" : "burp", \
          "url"      : "/2022-03-27-22.OAuth_authentication/", \
          "date"     : "March 27, 2022" \
        }, \
       \
        { \
          "title"    : "21. HTTP Request Smuggling.", \
          "category" : "burp", \
          "url"      : "/2022-03-26-21.HTTP_request_smuggling/", \
          "date"     : "March 26, 2022" \
        }, \
       \
        { \
          "title"    : "20. HTTP Host Header Attacks.", \
          "category" : "burp", \
          "url"      : "/2022-03-25-20.HTTP_Host_header_attacks/", \
          "date"     : "March 25, 2022" \
        }, \
       \
        { \
          "title"    : "19. Web Cache Poisoning.", \
          "category" : "burp", \
          "url"      : "/2022-03-24-19.Web_cache_poisoning/", \
          "date"     : "March 24, 2022" \
        }, \
       \
        { \
          "title"    : "18. Server-Side Template Injection.", \
          "category" : "burp", \
          "url"      : "/2022-03-23-18.Serve-side_template_injection/", \
          "date"     : "March 23, 2022" \
        }, \
       \
        { \
          "title"    : "17. Insecure Deserialization.", \
          "category" : "burp", \
          "url"      : "/2022-03-22-17.Insecure_deserialization/", \
          "date"     : "March 22, 2022" \
        }, \
       \
        { \
          "title"    : "16. WebSockets.", \
          "category" : "burp", \
          "url"      : "/2022-03-21-16.WebSockets/", \
          "date"     : "March 21, 2022" \
        }, \
       \
        { \
          "title"    : "15.DOM-based XSS vulnerabilities.", \
          "category" : "burp", \
          "url"      : "/2022-03-20-15-DOM-based_vulnerabilities/", \
          "date"     : "March 20, 2022" \
        }, \
       \
        { \
          "title"    : "14. Clickjacking.", \
          "category" : "burp", \
          "url"      : "/2022-03-19-14.Clickjacking/", \
          "date"     : "March 19, 2022" \
        }, \
       \
        { \
          "title"    : "13. Cross-Origin Resource Sharing.", \
          "category" : "burp", \
          "url"      : "/2022-03-18-13.Cross-origin_resource_sharing_(CORS)/", \
          "date"     : "March 18, 2022" \
        }, \
       \
        { \
          "title"    : "12. Cross-Site Request Forgery.", \
          "category" : "burp", \
          "url"      : "/2022-03-17-12.Cross-site_request_forgery_(CSRF)/", \
          "date"     : "March 17, 2022" \
        }, \
       \
        { \
          "title"    : "11. Cross-Site Scripting.", \
          "category" : "burp", \
          "url"      : "/2022-03-16-11.Cross-site_scripting_(XSS)/", \
          "date"     : "March 16, 2022" \
        }, \
       \
        { \
          "title"    : "10. XXE Injection.", \
          "category" : "burp", \
          "url"      : "/2022-03-15-10.XXE_injection/", \
          "date"     : "March 15, 2022" \
        }, \
       \
        { \
          "title"    : "9. Server-Side Request Forgery.", \
          "category" : "burp", \
          "url"      : "/2022-03-14-9.Server-side_request_forgery/", \
          "date"     : "March 14, 2022" \
        }, \
       \
        { \
          "title"    : "8. File Upload.", \
          "category" : "burp", \
          "url"      : "/2022-03-13-8.File_upload_vulnerabilities/", \
          "date"     : "March 13, 2022" \
        }, \
       \
        { \
          "title"    : "7. Access Control.", \
          "category" : "burp", \
          "url"      : "/2022-03-12-7.Access_control/", \
          "date"     : "March 12, 2022" \
        }, \
       \
        { \
          "title"    : "6. Information Disclosure.", \
          "category" : "burp", \
          "url"      : "/2022-03-11-6.Information_disclosure/", \
          "date"     : "March 11, 2022" \
        }, \
       \
        { \
          "title"    : "5. Bussiness Logic Vulnerabilities.", \
          "category" : "burp", \
          "url"      : "/2022-03-10-5.Business_logic_vulnerabilities/", \
          "date"     : "March 10, 2022" \
        }, \
       \
        { \
          "title"    : "4. Command Injection.", \
          "category" : "burp", \
          "url"      : "/2022-03-09-4.Command_Injection/", \
          "date"     : "March  9, 2022" \
        }, \
       \
        { \
          "title"    : "3. Directory Traversal.", \
          "category" : "burp", \
          "url"      : "/2022-03-08-3.Directory_Traversal/", \
          "date"     : "March  8, 2022" \
        }, \
       \
        { \
          "title"    : "2. Authentication.", \
          "category" : "burp", \
          "url"      : "/2022-03-07-2.Authentication/", \
          "date"     : "March  7, 2022" \
        }, \
       \
        { \
          "title"    : "1. SQLInjection", \
          "category" : "burp", \
          "url"      : "/2022-03-06-1.SQLInjection/", \
          "date"     : "March  6, 2022" \
        }, \
       \
        { \
          "title"    : "Seguridad Perimetral", \
          "category" : "blueteam", \
          "url"      : "/2022-02-09-Seguridad_Perimetral/", \
          "date"     : "February  9, 2022" \
        }, \
       \
        { \
          "title"    : "Hardening de sistemas", \
          "category" : "blueteam", \
          "url"      : "/2022-02-09-Hardening_de_sistemas/", \
          "date"     : "February  9, 2022" \
        }, \
       \
        { \
          "title"    : "Bandit", \
          "category" : "otw", \
          "url"      : "/2022-02-08-Bandit/", \
          "date"     : "February  8, 2022" \
        }, \
       \
        { \
          "title"    : "Proxy", \
          "category" : "redes", \
          "url"      : "/2022-02-07-Proxys/", \
          "date"     : "February  7, 2022" \
        }, \
       \
        { \
          "title"    : "Protocolos Relevantes", \
          "category" : "redes", \
          "url"      : "/2022-02-07-Protocolos_Importantes/", \
          "date"     : "February  7, 2022" \
        }, \
       \
        { \
          "title"    : "Curso Básico Redes", \
          "category" : "redes", \
          "url"      : "/2022-02-07-Precurso_Redes/", \
          "date"     : "February  7, 2022" \
        }, \
       \
        { \
          "title"    : "IPs", \
          "category" : "redes", \
          "url"      : "/2022-02-07-IPs/", \
          "date"     : "February  7, 2022" \
        }, \
       \
        { \
          "title"    : "Movimientos Laterales", \
          "category" : "redteam", \
          "url"      : "/2022-02-06-Introducci%C3%B3n_a_movimientos_laterales/", \
          "date"     : "February  6, 2022" \
        }, \
       \
        { \
          "title"    : "Evasión de Defensas", \
          "category" : "redteam", \
          "url"      : "/2022-02-05-Evasi%C3%B3n_de_Defensas/", \
          "date"     : "February  5, 2022" \
        }, \
       \
        { \
          "title"    : "Escalada de privilegios", \
          "category" : "redteam", \
          "url"      : "/2022-02-05-Escalada_de_privilegios/", \
          "date"     : "February  5, 2022" \
        }, \
       \
        { \
          "title"    : "Metasploit", \
          "category" : "redteam", \
          "url"      : "/2022-02-04-Metasploit_B%C3%A1sico/", \
          "date"     : "February  4, 2022" \
        }, \
       \
        { \
          "title"    : "Ataques a aplicaciones Android", \
          "category" : "redteam", \
          "url"      : "/2022-02-03-Ataques_aplicaciones_android/", \
          "date"     : "February  3, 2022" \
        }, \
       \
        { \
          "title"    : "Ataque a aplicaciones web.", \
          "category" : "redteam", \
          "url"      : "/2022-02-02-Ataques_a_aplicaciones_web/", \
          "date"     : "February  2, 2022" \
        }, \
       \
        { \
          "title"    : "Ataques a Infraestructuras y Redes", \
          "category" : "redteam", \
          "url"      : "/2022-02-01-Ataques_a_Infraestructuras_y_Redes/", \
          "date"     : "February  1, 2022" \
        }, \
       \
        { \
          "title"    : "Análisis de Objetivos", \
          "category" : "redteam", \
          "url"      : "/2022-01-28-An%C3%A1lisis_de_Objetivos/", \
          "date"     : "January 28, 2022" \
        }, \
       \
       \
        { \
          "title"    : "Blueteam Basics", \
          "category" : "page", \
          "url"      : "/BLUETEAMBASICSpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "PortSwigger BurpSuite Course", \
          "category" : "page", \
          "url"      : "/BURPSUITEpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "C programming subjects.", \
          "category" : "page", \
          "url"      : "/Cpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Dharma Fuzzer language", \
          "category" : "page", \
          "url"      : "/DHARMApage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Exploiting &amp; Reversing", \
          "category" : "page", \
          "url"      : "/EXPREVpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Fuzzing JavaScript Engine", \
          "category" : "page", \
          "url"      : "/Fuzzpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "HackTheBox", \
          "category" : "page", \
          "url"      : "/HackTheBoxpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "PEN200 notes", \
          "category" : "page", \
          "url"      : "/PEN200page/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Proyectos", \
          "category" : "page", \
          "url"      : "/PROJECTSpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Networking Basics", \
          "category" : "page", \
          "url"      : "/REDESpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "RedTeam Basics", \
          "category" : "page", \
          "url"      : "/REDTEAMBASICSpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Retired Machines", \
          "category" : "page", \
          "url"      : "/RetiredMachinespage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "TryHackMe", \
          "category" : "page", \
          "url"      : "/THMpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "About me", \
          "category" : "page", \
          "url"      : "/aboutme/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "THM", \
          "category" : "page", \
          "url"      : "/preOSCPpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Tag Index", \
          "category" : "page", \
          "url"      : "/tags/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page2/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page3/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page4/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page5/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page6/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page7/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page8/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page9/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page10/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page11/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page12/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page13/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page14/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Germán Sanmillán", \
          "category" : "page", \
          "url"      : "/page15/", \
          "date"     : "January 1, 1970" \
        } \
       \
    ]';
    searchjson = JSON.parse(searchjson);

    var sjs = SimpleJekyllSearch({
      searchInput: document.getElementById('nav-search-input'),
      resultsContainer: document.getElementById('search-results-container'),
      json: searchjson
    });
  </script>
</div>





  <!-- TODO this file has become a mess, refactor it -->







<header class="header-section ">

<div class="intro-header no-img">
  <div class="container-md">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
        <div class="post-heading">
          <h1>Scripting</h1>
          
            
              <h2 class="post-subheading">Scripting Basics.</h2>
            
          

          
            <span class="post-meta">Posted on November 3, 2023</span>
            
            
          
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class=" container-md ">
  <div class="row">
    <div class=" col-xl-8 offset-xl-2 col-lg-10 offset-lg-1 ">

      

      

      <article role="main" class="blog-post">
        <h3 id="1-bash-scripting-basics">1. Bash Scripting Basics.</h3>

<h4 id="11-intro-to-bash-scripting">1.1. Intro to Bash Scripting.</h4>

<p>GNU Bourne-Again Shell (Bash) es un potente entorno de trabajo y un motor de secuencias de comandos.</p>

<p>Un script de Bash es un archivo de texto sin formato que tiene una serie de comandos que se ejecutan como si se hubieran escrito en un indicador de terminal (línea a línea). En términos generales,</p>

<ul>
  <li>
    <p>Los scripts de Bash tienen una extensión opcional de .sh (para facilitar la identificación).</p>
  </li>
  <li>
    <p>Comienzan con ’#!/bin/bash’ que es una línea que indica qué binario es el intérpetre del script (de otra manera en lugar de ejecutarse como un binario normal; ./script.sh se deben de ejecutar con la utilidad sh; ‘sh script.sh’).</p>
  </li>
  <li>
    <p>Deben tener permisos de ejecución establecidos antes de que puedan ejecutarse.</p>
  </li>
</ul>

<p>Comencemos con un simple script Bash que despliege “Hello World”. Vamos a crear un archivo llamado hello-world.sh y poner los siguientes comandos en él. Este script simplemente imprimirá “Hello World”:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat</span> ./hello-world.sh
<span class="c">#!/bin/bash</span>
<span class="c"># Hello World Bash Scrip</span>
<span class="nb">echo</span> <span class="s2">"Hello World!"</span>
</code></pre></div></div>

<ul>
  <li>La primera línea indica el intérprete ‘#!/bin/bash’.</li>
  <li>La segunda línea es un comentario, este se indica mediante el ‘#’, todo aquello que preceda a este símbolo.</li>
  <li>La tercera es el comando echo que despliega el “Hello World!” mencionado.</li>
</ul>

<p><br /></p>

<h4 id="12-ejecutar-el-primer-script">1.2. Ejecutar el primer script.</h4>

<p>Hay varias formas de ejecutar bash. Vamos a explorarlos a continuación.</p>

<p>Primero, revisemos los permisos del fichero con la finalidad de ver si tiene permisos de ejecución:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> hello-world.sh 
<span class="nt">-rw-r--r--</span>  1 kali kali 59 Jan 16 14:20 hello-world.sh  
</code></pre></div></div>

<p>Como ningún usuario tiene permisos de ejecución, el script no puede ejecutarse:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span> ./hello-world.sh
bash: ./hello-world.sh: Permission denied
</code></pre></div></div>

<p>Antes de ejecutarlo, debemos asegurarnos de que el script tiene permisos de ejecución:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ chmod +x hello-world.sh

kali@kali:~$ ls hello-world.sh -l 
-rwxr-xr-x  1 kali kali 59 Jan 16 14:29 hello-world.sh 

kali@kali:~$ ./hello-world.sh 
Hello World!
</code></pre></div></div>

<p>Otra forma de ejecutar el script sería llamar al binario que ahce de intérprete del script como por ejemplo bash o sh:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span>bash hello-world.sh
Hello World!
</code></pre></div></div>

<p>Esto nos recuerda que Bash/Sh/Zsh es un intérprete y una shell al mismo tiempo.</p>

<p><br /></p>

<h4 id="13-variables">1.3. Variables.</h4>

<p><strong>Definición y declaración de variables.</strong></p>

<p>Las variables son contenedores de datos definidos mediante un nombre, pueden estar en mayúsculas, minúsculas o una combinación de ambas. Sin embargo, Bash es case-sensitive, distingue entre mayúsculas y minúsculas, por lo que debemos ser coherentes al declarar y usar variables. Eso significa que la variable <em>apellido</em> no es lo mismo que Apellido.</p>

<p>Es una buena práctica usar nombres de variables descriptivos, ya que estos hacen que nuestros scripts sean mucho más fáciles de leer y mantener. Si bien eso puede no ser tan obvio el día que escribimos el guión, ciertamente lo es dos años después cuando lo tomamos y tratamos de entenderlo.</p>

<p>Podemos declarar valores de variables de varias maneras. El método más sencillo es establecer el valor directamente con una simple declaración <em>nombre=valor .</em> Comencemos configurando una variable y notemos que no hay espacios antes o después del signo “=”:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>firstname=Good
surname=Hacker
</code></pre></div></div>

<p><br /></p>

<p><strong>Exponiendo el contenido de una variable.</strong></p>

<p>Ahora que hemos establecido una variable, necesitamos hacer referencia a ella. Hacemos esto colocando el carácter “$” delante de la variable. Cuando Bash encuentra esta sintaxis en un comando, reemplaza el nombre de la variable con su valor (“expande” la variable) antes de la ejecución.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ echo $firstname $surname
Good Hacker

kali@kali:~/Documents/test$ greeting='Hello World'
kali@kali:~/Documents/test$ echo $greeting
Hello World
</code></pre></div></div>

<p>Si queremos usar más de una palabra, aplicamos comillas para declarar varias palabras como el mismo string:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ greeting=Hello World
bash: World: command not found

kali@kali:~$ greeting="Hello World"; echo $greeting
Hello World

</code></pre></div></div>

<p>Observemos que aunque parece las comillas simples y dobles son iguales, no lo son. Las comillas dobles admiten que ciertos caracteres especiales como el dolar; $, lleven a cabo su función como procesadores de funciones especiales (en este caso, como el sustitor de valores de una variable) mientras que las simples lo procesan como un caracter más:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~/Documents/test$ greeting1='New $greeting'
kali@kali:~/Documents/test$ echo $greeting1
New $greeting

kali@kali:~/Documents/test$ greeting2="New $greeting"
kali@kali:~/Documents/test$ echo $greeting2
New Hello World
</code></pre></div></div>

<p>Además podemos combinar el contenido de varias variables en una sóla:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ greet1="Hello, my name is "
kali@kali:~$ greet2="Jolinda"
kali@kali:~$ greeting=$greet1$greet2
kali@kali:~$ echo $greeting
Hello, my name is Jolinda
</code></pre></div></div>

<p><br /></p>

<p><strong>Guardando el valor de comandos.</strong></p>

<p>También podemos guardar en una variable el output de un comando haciendo uso de dos caracteres especiales, el acento ‘`’ y  el dolar ‘$()’. De nuevo, para que estos caracteres funcionen, se deben utilizar o sólos o dentro de las comillas dobles nunca dentro de las comillas simples por lo anteriormente mencionado:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ user1</span><span class="o">=</span><span class="sb">`</span><span class="nb">whoami</span><span class="sb">`</span>
kali@kali:~<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$user1</span>
kali

kali@kali:~<span class="nv">$ user1</span><span class="o">=</span><span class="s2">"</span><span class="sb">`</span><span class="nb">whoami</span><span class="sb">`</span><span class="s2">"</span>
kali@kali:~<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$user1</span>
kali

kali@kali:~<span class="nv">$ user2</span><span class="o">=</span><span class="s1">'`whoami`'</span>
kali@kali:~<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$user2</span>
<span class="sb">`</span><span class="nb">whoami</span><span class="sb">`</span>
</code></pre></div></div>

<p>La nomenclatura del acento ‘`’ se desaconseja por ser más antigua.</p>

<p>Queremos ahora destacar una característica importante de Bash. Dado que los scripts escritos en bash se interpretan línea a línea y no se compilan, el alcance de una variable llega hasta que esta se setea, no cuando esta se resuelve al final del código. Veámos un ejemplo:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ part</span><span class="o">=</span><span class="s2">"To be"</span>
kali@kali:~<span class="nv">$ quote</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$part</span><span class="si">)</span>
kali@kali:~<span class="nv">$ part</span><span class="o">=</span><span class="s2">"Or not to be"</span>
kali@kali:~<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$quote</span>
To be
</code></pre></div></div>

<p>Lo que ocurre en este ejemplo es muy sencillo. Dado que el código se ejecuta línea a línea, la variable ‘quote’ no se ve alterada por el cambio de la variable ‘part’ pues el valor de ‘quote’ se asienta en el momento de su declaración en el código, no al final del mismo pues este no se compila.</p>

<p><br /></p>

<p><strong>Variables numéricas</strong></p>

<p>Como hemos señalado, Bash mantiene sus variables como strings. Sin embargo, podemos usar variables de Bash como valores numéricos y podemos manipularlas con operadores matemáticos. Bash trata con números solo con enteros y no maneja valores de coma flotante.</p>

<p>Para demostrar esto, usaremos una convención especial en Bash para realizar operaciones matemáticas que es el uso de paréntesis dobles.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ firstNumber</span><span class="o">=</span><span class="s2">"7"</span>
kali@kali:~<span class="nv">$ secondNumber</span><span class="o">=</span>3
kali@kali:~<span class="nv">$ </span><span class="nb">echo</span> <span class="k">$((</span>firstNumber+secondNumber<span class="k">))</span>
10
</code></pre></div></div>

<p>Aquí, usamos los paréntesis dobles para indicar el uso de operaciones aritméticas. La variable <em>primerNúmero</em> contiene la cadena “7” mientras que la variable <em>segundoNúmero</em> contiene la cadena “3”. Tenga en cuenta que, desde la perspectiva del intérprete bash, las variables se tratan como cadenas de forma predeterminada. En este caso, no importa si ponemos comillas dobles, simples o sin comillas alrededor de los números. Bash solo los interpretará como strings.</p>

<p>Como las variables están entre paréntesis dobles y los valores se parecen a números, bash los convierte en números. El signo de dólar ($) representa el valor devuelto y, por lo tanto, se imprime 10 en la terminal.</p>

<p>Si intentamos hacer una operación y uno de los valores no es numérico, bash lo define como el valor numérico de cero.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ firstNumber</span><span class="o">=</span><span class="s2">"seven"</span>
kali@kali:~<span class="nv">$ secondNumber</span><span class="o">=</span>3
kali@kali:~<span class="nv">$ </span><span class="nb">echo</span> <span class="k">$((</span>firstNumber+secondNumber<span class="k">))</span>
3
kali@kali:~<span class="nv">$ </span><span class="nb">echo</span> <span class="k">$((</span>firstNumber<span class="o">*</span>secondNumber<span class="k">))</span>
0
</code></pre></div></div>

<p>En este caso, la cadena “seven” no representa un valor numérico. Bash definirá ese valor como el número 0 cuando se usa dentro de una operación aritmética.</p>

<p>Debemos tener cuidado, porque si le damos a bash la oportunidad de tratar estas variables como cadenas, lo hará felizmente, como en el siguiente ejemplo.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ firstNumber</span><span class="o">=</span>7
kali@kali:~<span class="nv">$ firstNumber</span><span class="o">=</span><span class="nv">$firstNumber</span>+1
kali@kali:~<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$firstNumber</span>
7+1
</code></pre></div></div>

<p><br /></p>

<h4 id="14-usando-argumentos">1.4. Usando argumentos.</h4>

<p>En programación los argumentos son valores que se lanzan concomitantemente junto con una función o un binario, un ejemplo de argumentos o parámetros de la línea de comandos sería los modificadores:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-l</span>
</code></pre></div></div>

<p>En el ejemplo anterio, el ‘-l’ es un modificador pasado como parámetro.</p>

<p>En el caso de Bash scripting, los argumentos o parámetros son valores que se emiten en la misma línea que se utiliza para lanzar un script y que generalmente tienen una función dentro del código del mismo script.</p>

<p>Dentro del código, el valor de estos se referencian mediante el término ‘$n’ donde ‘n’ es un número natural de forma que ‘$0’ referencia el nombre del script ‘$1’ referencia el primero argumento, ‘$2’ el segundo y así sucesivamente.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat </span>arg.sh
<span class="c">#!/bin/bash</span>
<span class="nb">echo</span> <span class="s2">"There are </span><span class="nv">$# </span><span class="s2">arguments"</span>
<span class="nb">echo</span> <span class="s2">"The first two arguments are </span><span class="nv">$1</span><span class="s2"> and </span><span class="nv">$2</span><span class="s2">"</span>

kali@kali:~<span class="nv">$ </span>./arg.sh <span class="nb">who </span>goes there?
There are 3 arguments
The first two arguments are <span class="nb">who </span>and goes
</code></pre></div></div>

<p>Evidentemente como vemos en el ejemplo anterior, mientras que el código guarde la coherencia podemos pasar tantos argumentos como queramos.</p>

<p>Conviene recordar que si empleamos comillas dobles sobre dos strings separados por un espacio, ambos strings se tomarán como un sólo parámetro:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat </span>arg.sh
<span class="c">#!/bin/bash</span>
<span class="nb">echo</span> <span class="s2">"There are </span><span class="nv">$# </span><span class="s2">arguments"</span>
<span class="nb">echo</span> <span class="s2">"The first two arguments are </span><span class="nv">$1</span><span class="s2"> and </span><span class="nv">$2</span><span class="s2">"</span>

kali@kali:~<span class="nv">$ </span>./arg.sh <span class="s2">"who goes"</span> there?
There are 2 arguments
The first two arguments are <span class="nb">who </span>goes and there?
</code></pre></div></div>

<p><br /></p>

<p><strong>Variables especiales.</strong></p>

<p>Las variables especiales son caracteres o cadenas de caracteres que guardan un valor por defecto e inalterable:</p>

<table>
  <thead>
    <tr>
      <th>VAR</th>
      <th>DESCRIPTION</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>$0</td>
      <td>El nombre del archivo del script.</td>
    </tr>
    <tr>
      <td>$1-$9</td>
      <td>Los primeros nueve argumentos del script.</td>
    </tr>
    <tr>
      <td>$#</td>
      <td>Número de argumentos pasados al script.</td>
    </tr>
    <tr>
      <td>$@</td>
      <td>Todos los argumentos pasados al script.</td>
    </tr>
    <tr>
      <td>$?</td>
      <td>El status de salida del proceso más reciente.</td>
    </tr>
    <tr>
      <td>$$</td>
      <td>El PID del script en ejecución.</td>
    </tr>
    <tr>
      <td>$USER</td>
      <td>El nombre del usuario que es dueño del proceso que ejecuta el script.</td>
    </tr>
    <tr>
      <td>$UID</td>
      <td>El UID del usuario que es dueño del proceso que ejecuta el script.</td>
    </tr>
    <tr>
      <td>$HOSTNAME</td>
      <td>El hostname de la máquina.</td>
    </tr>
    <tr>
      <td>$LINENO</td>
      <td>La línea actual en el script.</td>
    </tr>
    <tr>
      <td>$RANDOM</td>
      <td>Un número aleatorio.</td>
    </tr>
  </tbody>
</table>

<p>Sobre el $? esto determina el status con el que sale un proceso este puede salir de forma normal y despliegar código 0 o puede salir con un error en cuyo caso el $? tendrá un valor distinto de 0.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">ls</span> /home
kali
kali@kali:~<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$?</span>
0
kali@kali:~<span class="nv">$ </span><span class="nb">ls</span> /home/sweet/home
<span class="nb">ls</span>: cannot access <span class="s1">'/home/sweet/home'</span>: No such file or directory
kali@kali:~<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$?</span>
2
</code></pre></div></div>

<p>Además, en el script podemos elegir arbitrariamente el código de salida del script en función del camino que tome el código con ‘exit’.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat </span>arg.sh
<span class="c">#!/bin/bash</span>
<span class="nb">echo</span> <span class="s2">"There are </span><span class="nv">$# </span><span class="s2">arguments"</span>
<span class="nb">echo</span> <span class="s2">"The first two arguments are </span><span class="nv">$1</span><span class="s2"> and </span><span class="nv">$2</span><span class="s2">"</span>
<span class="nb">exit </span>1

kali@kali:~<span class="nv">$ </span>./arg.sh <span class="nb">who </span>goes there?
There are 3 arguments
The first two arguments are <span class="nb">who </span>and goes

kali@kali:~<span class="nv">$ </span> <span class="nb">echo</span> <span class="nv">$?</span>
1
</code></pre></div></div>

<p><br /></p>

<h4 id="15-leyendo-input">1.5. Leyendo Input.</h4>

<p><strong>Intro a read.</strong></p>

<p>Podemos leer el input del teclado del usuario a través de la built-in function ‘read’:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat</span> ./input1.sh
<span class="c">#!/bin/bash</span>
<span class="nb">echo</span> <span class="s2">"Hello there, would you like to learn how to hack: Y/N?"</span>
<span class="nb">read </span>answer
<span class="nb">echo</span> <span class="s2">"Your answer was </span><span class="nv">$answer</span><span class="s2">"</span>

kali@kali:~<span class="nv">$ </span>./input1.sh
Hello there, would you like to learn how to hack: Y/N?
Y
Your answer was Y
</code></pre></div></div>

<p>Dos de los modificadores más utilizados incluyen -p, que nos permite especificar un mensaje, y -s, que hace que la entrada del usuario sea silenciosa. Este último es ideal para ingresar las credenciales de usuario.</p>

<p>En el siguiente ejemplo, le pedimos al usuario que ingrese las credenciales y use la opción <em>-p</em> con el texto “Nombre de usuario:”, que mostrará lo que se escribe. Luego le pedimos al usuario que ingrese su contraseña, con la opción <em>-sp</em> . Esta opción ocultará el texto que escribe el usuario.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat input2.sh
#!/bin/bash
# Prompt the user for credentials
read -p 'Username: ' username
read -sp 'Password: ' password
echo "Thanks, your creds are as follows: " $username " and " $password

kali@kali:~$ ./input2.sh
Username: kali
Password: 
Thanks, your creds are as follows:  kali  and  nothing2see!
</code></pre></div></div>

<p><strong>Redireccionando Input</strong></p>

<p>Cuando emitimos el comando ‘read’, Bash espera a que escribamos algo a modo de input. Cuando ejecutamos el comando ‘echo’, muestra lo escrito en la terminal.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat </span>input3.sh
<span class="c">#!/bin/bash</span>
<span class="nb">read </span>line
<span class="nb">echo</span> <span class="nv">$line</span>

kali@kali:~<span class="nv">$ </span>./input3.sh
This is my inpu
This is my inpu
</code></pre></div></div>

<p>Sin embargo, esta no es la única forma en que podemos administrar el input/output. Hay dos operadores especiales que podemos usar en Bash que nos permitirán proporcionar entrada desde un archivo en lugar del teclado, y salida a un archivo en lugar de la terminal. Los operadores de redirección son ’<em>&lt;</em>‘ y ’<em>&gt;</em>’.
También veremos una variación del operador de redirección de salida <em>»</em>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span>./input3.sh &lt; heidi.txt
The secrets of wealth and the love of the muse,
</code></pre></div></div>

<p>El script no esperó ningún input. En su lugar, tomó la primera línea del archivo que habíamos redirigido y la envió a la terminal. Ejecutemos eso de nuevo y leamos dos líneas. Podemos ajustar el código agregando una segunda lectura y eco y llamándolo input4.sh.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat </span>input4.sh
<span class="c">#!/bin/bash</span>
<span class="nb">read </span>line
<span class="nb">echo</span> <span class="nv">$line</span>
<span class="nb">read </span>line
<span class="nb">echo</span> <span class="nv">$line</span>

kali@kali:~<span class="nv">$ </span>./input4.sh &lt; heidi.txt
The secrets of wealth and the love of the muse,
But gladness is predictable by universal laws<span class="p">;</span>
</code></pre></div></div>

<p>También podemos guardar la salida de un comando en un archivo usando la redirección de salida.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Shall I compare thee to a summer's day?"</span> <span class="o">&gt;</span> sonnet.txt
kali@kali:~<span class="nv">$ </span><span class="nb">cat </span>sonnext.txt
Shall I compare thee to a summer<span class="s1">'s day?
</span></code></pre></div></div>

<p>Esta redirección sobreescriborá el archivo si ya existe o lo creará si no existe.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Shall I compare thee to a summer's day?"</span> <span class="o">&gt;</span> sonnet.txt
kali@kali:~<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Thou art more lovely and more temperate:"</span> <span class="o">&gt;</span> sonnet.txt
kali@kali:~<span class="nv">$ </span><span class="nb">cat </span>sonnext.txt
Thou art more lovely and more temperate:
</code></pre></div></div>

<p>Aquí es donde entra en juego el operador de redireccionamiento de doble salida <em>»</em> ; agrega la salida al archivo, en lugar de sobrescribirlo.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">rm </span>sonnet.txt
kali@kali:~<span class="nv">$ </span><span class="nb">touch </span>sonnet.txt
kali@kali:~<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Shall I compare thee to a summer's day?"</span> <span class="o">&gt;&gt;</span> sonnet.txt
kali@kali:~<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Thou art more lovely and more temperate:"</span> <span class="o">&gt;&gt;</span> sonnet.txt
kali@kali:~<span class="nv">$ </span><span class="nb">cat </span>sonnext.txt
Shall I compare thee to a summer<span class="s1">'s day?
Thou art more lovely and more temperate:
</span></code></pre></div></div>

<p><br /></p>

<h4 id="16-conditional-statements">1.6. Conditional Statements.</h4>

<p>Los conditionals statements sirven para orientar el flujo de código en función de los eventos que en el mismo ocurren. Distinguimos 3 statements que actúan conjuntamente: If, Else y Elif.</p>

<p><br /></p>

<p><strong>If Statement</strong></p>

<p>El statement If hace al código decididir entre dos caminos, tiene la siguiente sintaxis:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">[</span> &lt;condition&gt; <span class="o">]</span>
<span class="k">then</span>
  &lt;code&gt;
<span class="k">fi</span>
</code></pre></div></div>

<p>For example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat</span> ./if.sh
<span class="c">#!/bin/bash</span>
<span class="c"># if statement example</span>

<span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"What is your age: "</span> age

<span class="k">if</span> <span class="o">[</span> <span class="nv">$age</span> <span class="nt">-lt</span> 18 <span class="o">]</span>
<span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"You might need parental permission to take this course!"</span>
<span class="k">fi

</span>kali@kali:~<span class="nv">$ </span>./if.sh 
What is your age: 17
You might need parental permission to take this course!
</code></pre></div></div>

<p>Los corchetes (“[” y “]”) en la instrucción <em>if</em> anterior son una referencia al comando <em>test</em>. Es decir, que utilizar dichos corchetes y utilizar el comando es equivalente. </p>

<p>Por otra parte es importante, es importante entender la diferencia entre operadores “aritméticos” y “comparadores”.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>x <span class="o">=</span> 4 <span class="c">#En este caso, se está asignando el valor '4' a una variable de nombre 'x'.</span>

y <span class="o">==</span> 4 <span class="c">#En este caso se está haciendo una comparación entre 'y' y '4'. Notemos que se trata de una comparación mal escrita, debido a que no se está referenciando el valor de 'y' como variable pues falta el antecedente '$' según hemos visto en partes anteriores ni tampoco se está evaluando como una cadena de caracteres pues faltan las comillas.</span>
</code></pre></div></div>

<p>Dentro de los corchetes podemos utilizar una gran variedad de operadores comparadadores, algunos de ellso son:</p>

<table>
  <thead>
    <tr>
      <th>OPERATOR</th>
      <th>DESCRIPTION</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>!EXPRESSION</td>
      <td>La EXPRESSION tiene valor booleano falso.</td>
    </tr>
    <tr>
      <td>-n STRING</td>
      <td>La longitud de STRING es mayor que cero.</td>
    </tr>
    <tr>
      <td>-z STRING</td>
      <td>La longitud de STRING es cero (vacío).</td>
    </tr>
    <tr>
      <td>STRING1 != STRING2</td>
      <td>STRING1 no es igual a STRING2.</td>
    </tr>
    <tr>
      <td>STRING1 = STRING2</td>
      <td>STRING1 es igual a STRING2.</td>
    </tr>
    <tr>
      <td>INTEGER1 -eq INTEGER2</td>
      <td>INTEGER1 es igual a INTEGER2.</td>
    </tr>
    <tr>
      <td>INTEGER1 -ne INTEGER2</td>
      <td>INTEGER1 no es igual a INTEGER2.</td>
    </tr>
    <tr>
      <td>INTEGER1 -gt INTEGER2</td>
      <td>INTEGER1 es mayor que INTEGER2.</td>
    </tr>
    <tr>
      <td>INTEGER1 -lt INTEGER2</td>
      <td>INTEGER1 es menor que INTEGER2.</td>
    </tr>
    <tr>
      <td>INTEGER1 -ge INTEGER2</td>
      <td>INTEGER1 es mayor o igual que INTEGER 2.</td>
    </tr>
    <tr>
      <td>INTEGER1 -le INTEGER2</td>
      <td>INTEGER1 es menor o igual que INTEGER 2.</td>
    </tr>
    <tr>
      <td>-d FILE</td>
      <td>FILE existe y es un directorio.</td>
    </tr>
    <tr>
      <td>-e FILE</td>
      <td>El archivo FILE existe.</td>
    </tr>
    <tr>
      <td>-r FILE</td>
      <td>El archivo FILE existe y tiene permiso de lectura.</td>
    </tr>
    <tr>
      <td>-s FILE</td>
      <td>El archivo FILE existe y no está vacío.</td>
    </tr>
    <tr>
      <td>-w FILE</td>
      <td>El archivo FILE existe y tiene permiso de escritura.</td>
    </tr>
    <tr>
      <td>-x FILE</td>
      <td>El archivo FILE existe y tiene permiso de ejecución.</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<p><strong>If Else</strong></p>

<p>En el contexto anterior si se cumplia una condición se reproducía una cierta parte de código mientras que sino esta simplemente se ignoraba. Ahora con ELSE podemos especificar qué ocurre:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">[</span> &lt;condition&gt; <span class="o">]</span>
<span class="k">then</span>
  &lt;code&gt;
<span class="k">else</span>
  &lt;code&gt;
<span class="k">fi</span>
</code></pre></div></div>

<p><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat</span> ./else.sh
<span class="c">#!/bin/bash</span>
<span class="c"># else statement example</span>

<span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"What is your age: "</span> age

<span class="k">if</span> <span class="o">[</span> <span class="nv">$age</span> <span class="nt">-lt</span> 18 <span class="o">]</span>
<span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"You might need parental permission to take this course!"</span>
<span class="k">else
  </span><span class="nb">echo</span> <span class="s2">"Welcome to the course!"</span>
<span class="k">fi

</span>kali@kali:~<span class="nv">$ </span>./else.sh 
What is your age: 21
Welcome to the course!
</code></pre></div></div>

<p><br /></p>

<p><strong>If Elif</strong></p>

<p>Si queremos extender el concepto anterior para evaluar más condiciones podríamos incluir más if, pero esto dificultaría un hipotético trabajo de debuggin en caso de error (pues cada if dobla el código a ser testeado). Para ello obtenemos el ‘elif’:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">[</span> &lt;condition&gt; <span class="o">]</span>
<span class="k">then</span>
  &lt;code&gt;
<span class="k">elif</span> <span class="o">[</span> &lt;condition&gt; <span class="o">]</span>
<span class="k">then</span>
  &lt;code&gt;
<span class="k">else</span>
  &lt;perform yet another different action&gt;
<span class="k">fi</span>
</code></pre></div></div>

<p><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat</span> ./elif.sh
<span class="c">#!/bin/bash</span>
<span class="c"># elif example</span>

<span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"What is your age: "</span> age

<span class="k">if</span> <span class="o">[</span> <span class="nv">$age</span> <span class="nt">-lt</span> 18 <span class="o">]</span>
<span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"You might need parental permission to take this course!"</span>
<span class="k">elif</span> <span class="o">[</span> <span class="nv">$age</span> <span class="nt">-gt</span> 60 <span class="o">]</span>
<span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"Hats off to you, respect!"</span>
<span class="k">else
  </span><span class="nb">echo</span> <span class="s2">"Welcome to the course!"</span>
<span class="k">fi

</span>kali@kali:~<span class="nv">$ </span>./elif.sh
What is your age: 65
Hats off to you, respect!
</code></pre></div></div>

<p><br /></p>

<h4 id="17-operadores-booleanos">1.7. Operadores Booleanos.</h4>

<p>También tenemos a modo de combinadores de sentencias, operadores booleanos entre los cuales destacamos el AND y el OR.</p>

<p><strong>Operador booleano conjuntor AND.</strong></p>

<p>Este lo que hace es ligar la ejecución de dos sentencias, de forma que si se ejecuta una se ejecuta la otra mientras que si una de las dos no puede ejecutarse la instrucción combinada no se ejecuta:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ user2</span><span class="o">=</span>kali
kali@kali:~<span class="nv">$ </span><span class="nb">grep</span> <span class="nv">$user2</span> /etc/passwd <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$user2</span><span class="s2"> found!"</span>
kali:x:1000:1000:,,,:/home/kali:/bin/bash
kali found!

kali@kali:~<span class="nv">$ user2</span><span class="o">=</span>bob
kali@kali:~<span class="nv">$ </span><span class="nb">grep</span> <span class="nv">$user2</span> /etc/passwd <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$user2</span><span class="s2"> found!"</span>
kali@kali:~<span class="err">$</span>
</code></pre></div></div>

<p>En este ejemplo podemos ver que como kali existe en /etc/passwd la primera parte de la sentencia se ejecuta la segunda parte que es un mensaje con ‘echo’. En la segunda parte del código enunciamos un usuario que no existe en la máquina. Como la primera parte tiene valor falso, la segunda parte no se ejecuta.</p>

<p><br /></p>

<p><strong>Operador booleano disyuntor OR.</strong></p>

<table>
  <tbody>
    <tr>
      <td>El operador disyuntor OR (</td>
      <td> </td>
      <td>) evalua toma el papel complementario al AND de forma que si el anterior ejecutaba una segunda sentencia si y sólo si la primera tenía un valor de verdad TRUE, el OR ejecutará la sentencia si la primera sentencia tiene valor de verdad FALSE.</td>
    </tr>
  </tbody>
</table>

<p>En un sentido conceptual podríamos tomar el conjuntor como aquel operador que ejecuta la ‘instrucción A Y la instrucción B’ el operador disyuntor se puede entender como aquel operador que ejecuta ‘O la instrucción A O la instrucción B’</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$user2</span>
bob

kali@kali:~<span class="nv">$ </span><span class="nb">grep</span> <span class="nv">$user2</span> /etc/passwd <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$user2</span><span class="s2"> found</span><span class="se">\!</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$user2</span><span class="s2"> not found</span><span class="se">\!</span><span class="s2">"</span>
bob not found!
</code></pre></div></div>

<p><br /></p>

<h4 id="18-looping-in-scripting">1.8. Looping in Scripting.</h4>

<p>Los bucles nos permiten repetir un fragmento de código un número arbitrario de veces mediado a través de una condición que se puede describir de múltiples formas.</p>

<p><br /></p>

<p><strong>Loop For</strong></p>

<p>El bucle for es un bucle orientado a la agrupación de un conjunto de elementos y la realización, para cada uno de los elementos, una acción determinada. La sintaxis de este bucle:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for </span>var-name <span class="k">in</span> &lt;<span class="nb">set</span><span class="o">&gt;</span>
<span class="k">do</span>
  &lt;code&gt;
<span class="k">done</span>
</code></pre></div></div>

<p>Un ejemplo sería el siguiente:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="k">for </span>ip <span class="k">in</span> <span class="si">$(</span><span class="nb">seq </span>1 10<span class="si">)</span><span class="p">;</span> <span class="k">do </span><span class="nb">echo </span>10.11.1.<span class="nv">$ip</span><span class="p">;</span> <span class="k">done
</span>10.11.1.1
10.11.1.2
10.11.1.3
10.11.1.4
10.11.1.5
10.11.1.6
10.11.1.7
10.11.1.8
10.11.1.9
10.11.1.10
</code></pre></div></div>

<p>Un ejemplo más complicado sería el siguiente:</p>

<pre><code class="language-BASH">for file in $(ls); do cat file 2&gt;/dev/null; done
</code></pre>

<p>Para cada fichero del directorio en el que se ejecute el script obtendrá sus contenidos.</p>

<p><br /></p>

<p><strong>Loop While</strong></p>

<p>El bucle While es un bucle orientado a la repitición de un fragmento de código mientras una determinada condición tenga valor de verdad:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="o">[</span> &lt;some <span class="nb">test</span><span class="o">&gt;</span> <span class="o">]</span>
<span class="k">do</span>
  &lt;perform an action&gt;
<span class="k">done</span>
</code></pre></div></div>

<p>Por ejemplo:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat</span> ./while.sh
<span class="c">#!/bin/bash</span>
<span class="c"># while loop example</span>

<span class="nv">counter</span><span class="o">=</span>1

<span class="k">while</span> <span class="o">[</span> <span class="nv">$counter</span> <span class="nt">-lt</span> 10 <span class="o">]</span>
<span class="k">do
  </span><span class="nb">echo</span> <span class="s2">"10.11.1.</span><span class="nv">$counter</span><span class="s2">"</span>
  <span class="o">((</span>counter++<span class="o">))</span>
<span class="k">done</span>
</code></pre></div></div>

<p><br /></p>

<h4 id="19-functions">1.9. Functions.</h4>

<p><strong>Definición</strong></p>

<p>Las funciones son estructuras presentes en todos los lenguajes de programación orientadas al reciclaje de código.</p>

<p>Las funciones son esencialmente bloques de código que se invocan mediante un nombre. Tienen la siguiente sintaxis:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>function_name <span class="o">{</span>
&lt;code&gt;
<span class="o">}</span>

function_name <span class="o">()</span> <span class="o">{</span>
&lt;code&gt;
<span class="o">}</span>
</code></pre></div></div>

<p>Generalmente, estas se definen y seguidamente la presencia del nombre en el código basta para ejecutar todo el codigo dentro de la función. Por ejemplo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat func.sh
#!/bin/bash
# function example

print_me () {
  echo "You have been printed!"
}

print_me


kali@kali:~$ ./func.sh
You have been printed!
</code></pre></div></div>

<p><br /></p>

<p><strong>Parámetros</strong></p>

<p>Las funciones pueden ser invocadas junto con parámetros al igual que ocurre con los propios scripts:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat </span>funcarg.sh
<span class="c">#!/bin/bash</span>
<span class="c"># passing arguments to functions</span>

pass_arg<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"Today's random number is: </span><span class="nv">$1</span><span class="s2">"</span>
<span class="o">}</span>

pass_arg <span class="nv">$RANDOM</span>

kali@kali:~<span class="nv">$ </span>./funcarg.sh 
Today<span class="s1">'s random number is: 25207
</span></code></pre></div></div>

<p><br /></p>

<p><strong>Return</strong></p>

<p>Un statement importante asociado a las funciones es el statement ‘return’ que devuelve un valor que queda almacenado en la variable ‘$?’.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat </span>funcrvalue.sh
<span class="c">#!/bin/bash</span>
<span class="c"># function return value example</span>

return_me<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"Oh hello there, I'm returning a random value!"</span>
  <span class="k">return</span> <span class="nv">$RANDOM</span>
<span class="o">}</span>

return_me

<span class="nb">echo</span> <span class="s2">"The previous function returned a value of </span><span class="nv">$?</span><span class="s2">"</span>

kali@kali:~<span class="nv">$ </span><span class="nb">chmod</span> +x ./funcrvalue.sh 

kali@kali:~<span class="nv">$ </span>./funcrvalue.sh 
Oh hello there, I<span class="s1">'m returning a random value!
The previous function returned a value of 198
</span></code></pre></div></div>

<p>Notemos que el valor de $? es distinto de 0 poerque en ella se almacena el valor $RANDOM, sin embargo, si la función se ejecutase correctamente y no almacenásemo en $? ningún valor, este tendría por defecto el valor 0.</p>

<p><br /></p>

<p><strong>Variable Scope</strong></p>

<p>Las variables que se definen o modifican dentro de una función no tienen efecto fuera de la función. Sin embargo, todo aquello que se defina fuera de la función si tiene efecto dentro de la función.</p>

<p><br /></p>

<h3 id="2-bash-scripting-challenge">2. Bash Scripting Challenge.</h3>

<p>A continuación vamos a hacer una serie de ejercicios para poner en práctica lo anterior.</p>

<p><strong>A script that prints only the name of the file.</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nb">echo</span> <span class="nv">$0</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>Un script que muestre el número de argumentos pasados al script.</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nb">echo</span> <span class="nv">$#</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>Un script que determine si un fichero existe o no.</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="nb">read</span> <span class="nt">-p</span> <span class="s1">'Introduzca el nombre de un fichero: '</span> file

<span class="k">if</span> <span class="o">[</span> <span class="nt">-e</span> <span class="nv">$file</span> <span class="o">]</span>
<span class="k">then
	</span><span class="nb">echo</span> <span class="s2">"File exists"</span>
<span class="k">else
	</span><span class="nb">echo</span> <span class="s2">"File does not exist"</span>
<span class="k">fi</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>Script que muestre ficheros javascript de un log.</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash </span>
<span class="nb">cat</span> <span class="nv">$1</span> | <span class="nb">grep</span> <span class="nt">-hoE</span> <span class="s2">"[^/]+</span><span class="se">\.</span><span class="s2">js"</span> | <span class="nb">sort</span> <span class="nt">-u</span>
</code></pre></div></div>

<p>El script anterior funciona pasándole el nombre de un fichero cuyo contenido despliega. Seguidamente de ese contenido a través de una expresión regular “REGEX” coge todo lo que hay entre ‘.js’ y el primer ‘/’ antes del ‘.js’. y los ordena.</p>

<p><br /></p>

<p><strong>Cree un script Bash corto que validará la membresía de un usuario en un grupo específico. Este script no aceptará ningún argumento y, en su lugar, solicitará al usuario que ingrese un nombre de usuario y un grupo. Este script primero verificará si el nombre de usuario y el grupo se encuentran en este sistema (simplemente existen en sus respectivos archivos <em>/etc/ ).</em> Si NO SE ENCUENTRAN AMBOS, el script responderá <em>No se encuentran ambos. ¿Por qué me preguntas esto?</em> . Si SOLO SE ENCUENTRA UNO, responderá <em>Uno existe, uno no. Tú averiguas cuál</em> . Si SE ENCUENTRAN AMBOS, también verificará si el usuario es parte del grupo. Si el USUARIO ES MIEMBRO DEL GRUPO, el script responderá <em>Membresía válida!</em> ; de lo contrario, responderá_Membresía inválida pero disponible para unirse_ . Para ser claros, la secuencia de comandos inicialmente solicitará dos veces la entrada del usuario (la solicitud no importa) y luego solo responderá una vez con una de las cuatro respuestas especificadas. Una vez completado, cargue su secuencia de comandos en la carpeta de inicio del estudiante Kali VM #7 y ejecute <em>/challenge/group-membership</em> con la ubicación de su secuencia de comandos como el primer argumento para obtener la bandera.</strong></p>

<p>En este caso, nos podemos aprovechar el “error status” de un comando en función de si este ha logrado o no su objetivo. Cuando un comando se ejecuta satisfactoriamente despliega un ‘error status’ de 0, de lo contrario, en función del error, será distinto de 0.</p>

<p>Concratemente, cuando buscamos el id de un usuario que no existe se genera un error:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">id </span>Nonexistentuser &amp;&gt;/dev/null<span class="p">;</span> <span class="nb">echo</span> <span class="nv">$?</span>

1
</code></pre></div></div>

<p>Es importante observar que el fragmento ‘&amp;&gt;/dev/null’ sólo redirige el stdout y el stderr sobre /dev/null pero no afecta en lo más mínimo al error status del comando.</p>

<p>Así, podemos emplear</p>

<p>Por otra parte, si grep busca un patrón en un fichero y no encuentra ningún match devuelve un error:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">grep </span>nonmatch file.txt &amp;&gt;/dev/null<span class="p">;</span> <span class="nb">echo</span> <span class="nv">$?</span>

1
</code></pre></div></div>

<p>De esta forma, podemos probar la existencia de un grupo si al introducir su nombre en un filtrado con grep en el fichero /etc/group no se despliega ningún error.</p>

<p>De esta forma, empleamos el siguiente script:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="nb">read</span> <span class="nt">-p</span> <span class="s1">'Introduzca un usuario: '</span> User
<span class="nb">read</span> <span class="nt">-p</span> <span class="s1">'Introduzca un grupo: '</span> Group

<span class="nb">id</span> <span class="nv">$User</span> &amp;&gt; /dev/null
<span class="nv">ue</span><span class="o">=</span><span class="nv">$?</span>

<span class="nb">grep</span> <span class="nt">-hoE</span> <span class="s2">"^</span><span class="nv">$Group</span><span class="s2">+:"</span> /etc/group &amp;&gt;/dev/null
<span class="nv">ge</span><span class="o">=</span><span class="nv">$?</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$ge</span> <span class="nt">-eq</span> 0 <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="nv">$ue</span> <span class="nt">-eq</span> 0 <span class="o">]</span>
<span class="k">then
        </span><span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"^</span><span class="nv">$Group</span><span class="s2">+:"</span> /etc/group | <span class="nb">grep</span> <span class="nv">$User</span> &amp;&gt;/dev/null
        <span class="nv">me</span><span class="o">=</span><span class="nv">$?</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nv">$me</span> <span class="nt">-eq</span> 0 <span class="o">]</span> 
        <span class="k">then
                </span><span class="nb">echo</span> <span class="s2">"Membership valid!"</span>
        <span class="k">else
                </span><span class="nb">echo</span> <span class="s2">"Membership invalid but available to join."</span>
        <span class="k">fi
elif</span> <span class="o">[</span> <span class="nv">$ge</span> <span class="nt">-eq</span> 0 <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="nv">$ue</span> <span class="nt">-eq</span> 0 <span class="o">]</span>
<span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"One exists, one does not. You figure out which."</span>

<span class="k">else
        </span><span class="nb">echo</span> <span class="s2">"Both are not found - why are you even asking me this?"</span>
<span class="k">fi</span>
</code></pre></div></div>

<p>Este realiza las operaciones anteriormente mencionadas y guarda en sendas variables los errores realizando posteriormente una serie de operaciones lógicas para concretar si existen ambos, uno o ninguno de ellos.</p>

<p><br /></p>

<p><strong>Escriba un script Bash corto para realizar un barrido de ping de un rango de direcciones IP de destino. Este script solo imprimirá las direcciones IP de cualquier respuesta válida (una dirección IP por línea) y nada más. Para que esta secuencia de comandos sea más aplicable, no codificará el rango de direcciones IP. En cambio, esta secuencia de comandos requerirá tres argumentos: los primeros tres octetos de la dirección IP, el valor inicial del último octeto y el valor final del último octeto (consulte los ejemplos a continuación). NO necesita realizar ninguna comprobación de errores (pero siéntase libre de hacerlo). Cargue su secuencia de comandos en la carpeta de inicio del estudiante Kali VM #8 y ejecute <em>/challenge/ping-sweep</em> con la ubicación de su secuencia de comandos como el primer argumento para obtener la bandera.</strong></p>

<p>De nuevo, empleamos la misma estrategia que en el caso anterior. Realizamos un ping y si no hay devuelta un paquete se crea un error deforma que lo registramos y si no hay tal error desplegamos la IP.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="k">for </span>i <span class="k">in</span> <span class="si">$(</span><span class="nb">seq</span> <span class="nv">$2</span> <span class="nv">$3</span><span class="si">)</span>
<span class="k">do	
	</span>ping <span class="nt">-c1</span> <span class="nv">$1</span>.<span class="nv">$i</span> &amp;&gt;/dev/null 
	<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span>
	<span class="k">then
		</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">.</span><span class="nv">$i</span><span class="s2">"</span>
	<span class="k">fi
done</span>

</code></pre></div></div>

<p><br /></p>

<p><strong>Vuelva a escribir Ping Sweep en Python3. No utilice bibliotecas no estándar en su código, ya que no se garantiza que se instalen en el servidor de shell (no las necesita para este problema). Igual que antes, escriba un script corto para realizar un barrido de ping de un rango de direcciones IP de destino. Este script solo imprimirá las direcciones IP de cualquier respuesta válida (una dirección IP por línea) y nada más. Para que esta secuencia de comandos sea más aplicable, no codificará el rango de direcciones IP. En cambio, esta secuencia de comandos requerirá tres argumentos: los primeros tres octetos de la dirección IP, el valor inicial del último octeto y el valor final del último octeto (consulte los ejemplos a continuación). NO necesita realizar ninguna comprobación de errores (pero siéntase libre de hacerlo). Cargue su secuencia de comandos en la máquina virtual de destino n.° 9 y ejecútela. /challenge/ping-sweep-2  con la ubicación de su script como primer argumento para obtener la bandera.</strong></p>

<pre><code class="language-python3">#!/usr/bin/python3
import os
import sys
for ip in range(int(sys.argv[2]), int(sys.argv[3])+1):
	cmd = "ping -c 1 "+sys.argv[1]+"."+str(ip)+"" 
	output = os.popen(cmd).read() 
	if ", 0% packet loss" in output:
	print(str(sys.argv[1])+"."+str(ip))
</code></pre>

<p><br /></p>

<h3 id="3-powershell-scripting-basics">3. PowerShell Scripting Basics.</h3>

<p>Windows PowerShell es un lenguaje de automatización de tareas y administración de servicios que Windows presentó para ampliar la limitada funcionalidad de los ficheros <a href="https://en.wikipedia.org/wiki/Batch_file">batch</a> los cuales son ficheros orientado a la creación de scripts de comandos de CMDs.</p>

<p>En este apéndice vamos a tener un mejor entendimiento de la fuerza de PowerShell, de sus posibles usos y de sus limitaciones.</p>

<p><br /></p>

<h4 id="31-introduction-to-powershell">3.1. Introduction to PowerShell.</h4>

<p><strong>Definición</strong></p>

<p>Técnicamente, Windows PowerShell se define como un <a href="https://openwebinars.net/blog/que-es-la-programacion-orientada-objetos/#:~:text=Lenguajes%20de%20Programaci%C3%B3n%20Orientada%20a%20Objetos,-Para%20considerar%20un&amp;text=Actualmente%20existen%20una%20gran%20variedad,%2C%20Smalltalk%2C%20PHP%20o%20Python.">lenguaje de programación orientado a objetos</a> (tal y como lo es Java por ejemplo) basado en el <a href="https://en.wikipedia.org/wiki/.NET_Framework">.NET Framework</a> (un framework de programación creado por Microsoft).</p>

<p>En contraste con Bash que se trata de un lenguaje orientado a lectura y escritura de ficheros, PowerShell trabaja con objetos .NET que son instancias de clases que tienen métodos y atributos. De esta forma, la acción del código está basada sobre objetos, la acción de estos objetos es la que produce la acción del código de una manera mucha más conceptual dejando atrás la programación procedural.</p>

<p><br /></p>

<p><strong>Desplegar una shell de PowerShell</strong></p>

<p>La forma que más interesa a un pentester de desplegar una shell de powershell es a través de una CMD (más adelante veremos de que PowerShell tiene su propio IDE que puede ser más interesante para un administrador o a un programador, pero rara vez un pentester tendrá acceso de forma inicial a un IDE).</p>

<p>Una vez tenemos acceso a un entorno de ejecución de comandos en una máquina Windows 7 os superior podemos hacer uso del comando ‘powershell’ para o bien entrar en un entorno de powershell o ejecutar un comando de powershell con ‘powershell -c’:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">C:\Users\offsec</span><span class="err">&gt;</span><span class="nx">powershell</span><span class="w">
</span><span class="n">Windows</span><span class="w"> </span><span class="nx">PowerShell</span><span class="w">
</span><span class="n">Copyright</span><span class="w"> </span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="w"> </span><span class="n">Microsoft</span><span class="w"> </span><span class="nx">Corporation.</span><span class="w"> </span><span class="nx">All</span><span class="w"> </span><span class="nx">rights</span><span class="w"> </span><span class="nx">reserved.</span><span class="w">

</span><span class="kr">Try</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="nx">cross-platform</span><span class="w"> </span><span class="nx">Powershell</span><span class="w"> </span><span class="nx">http://aka.ms/pscore6</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Users\offsec</span><span class="err">&gt;</span><span class="nx">Get-Service</span><span class="w">

</span><span class="n">Status</span><span class="w">   </span><span class="nx">Name</span><span class="w">               </span><span class="nx">DisplayName</span><span class="w">
</span><span class="o">------</span><span class="w">   </span><span class="o">----</span><span class="w">               </span><span class="o">-----------</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">AarSvc_49d30</span><span class="w">       </span><span class="nx">Agent</span><span class="w"> </span><span class="nx">Activation</span><span class="w"> </span><span class="nx">Runtime_49d30</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">AJRouter</span><span class="w">           </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">enrutador</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">AllJoyn</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">ALG</span><span class="w">                </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">puerta</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">enlace</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">niv...</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">AppIDSvc</span><span class="w">           </span><span class="nx">Identidad</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">aplicaci</span><span class="err">ó</span><span class="nx">n</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">Appinfo</span><span class="w">            </span><span class="nx">Informaci</span><span class="err">ó</span><span class="nx">n</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">la</span><span class="w"> </span><span class="nx">aplicaci</span><span class="err">ó</span><span class="nx">n</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">AppReadiness</span><span class="w">       </span><span class="nx">Preparaci</span><span class="err">ó</span><span class="nx">n</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">aplicaciones</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">AppXSvc</span><span class="w">            </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">implementaci</span><span class="err">ó</span><span class="nx">n</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">AppX</span><span class="w"> </span><span class="o">...</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">AudioEndpointBu...</span><span class="w"> </span><span class="nx">Compilador</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">extremo</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">audio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">W...</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">Audiosrv</span><span class="w">           </span><span class="nx">Audio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">Windows</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">autotimesvc</span><span class="w">        </span><span class="nx">Hora</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">la</span><span class="w"> </span><span class="nx">red</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">telefon</span><span class="err">í</span><span class="nx">a</span><span class="w"> </span><span class="nx">m</span><span class="err">ó</span><span class="nx">vil</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">AxInstSV</span><span class="w">           </span><span class="nx">Instalador</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">ActiveX</span><span class="w"> </span><span class="p">(</span><span class="n">AxInstSV</span><span class="p">)</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">BcastDVRUserSer...</span><span class="w"> </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">usuario</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">difusi</span><span class="err">ó</span><span class="nx">n</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="nx">G...</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">BDESVC</span><span class="w">             </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">Cifrado</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">unidad</span><span class="w"> </span><span class="nx">BitLocker</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">BFE</span><span class="w">                </span><span class="nx">Motor</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">filtrado</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">base</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">BITS</span><span class="w">               </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">transferencia</span><span class="w"> </span><span class="nx">inteligen...</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">BluetoothUserSe...</span><span class="w"> </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">soporte</span><span class="w"> </span><span class="nx">t</span><span class="err">é</span><span class="nx">cnico</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">usua...</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">BrokerInfrastru...</span><span class="w"> </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">infraestructura</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">tare...</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">Browser</span><span class="w">            </span><span class="nx">Examinador</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">equipos</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">BTAGService</span><span class="w">        </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">puerta</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">enlace</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">aud...</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">BthAvctpSvc</span><span class="w">        </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">AVCTP</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">bthserv</span><span class="w">            </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">compatibilidad</span><span class="w"> </span><span class="nx">con</span><span class="w"> </span><span class="nx">Blue...</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">camsvc</span><span class="w">             </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">Administrador</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">funcional...</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">CaptureService_...</span><span class="w"> </span><span class="nx">CaptureService_49d30</span><span class="w">
</span><span class="o">...</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">C:\Users\offsec</span><span class="err">&gt;</span><span class="nx">powershell</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="nx">Get-Service</span><span class="w">

</span><span class="n">Status</span><span class="w">   </span><span class="nx">Name</span><span class="w">               </span><span class="nx">DisplayName</span><span class="w">
</span><span class="o">------</span><span class="w">   </span><span class="o">----</span><span class="w">               </span><span class="o">-----------</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">AarSvc_49d30</span><span class="w">       </span><span class="nx">Agent</span><span class="w"> </span><span class="nx">Activation</span><span class="w"> </span><span class="nx">Runtime_49d30</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">AJRouter</span><span class="w">           </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">enrutador</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">AllJoyn</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">ALG</span><span class="w">                </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">puerta</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">enlace</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">niv...</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">AppIDSvc</span><span class="w">           </span><span class="nx">Identidad</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">aplicaci</span><span class="err">ó</span><span class="nx">n</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">Appinfo</span><span class="w">            </span><span class="nx">Informaci</span><span class="err">ó</span><span class="nx">n</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">la</span><span class="w"> </span><span class="nx">aplicaci</span><span class="err">ó</span><span class="nx">n</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">AppReadiness</span><span class="w">       </span><span class="nx">Preparaci</span><span class="err">ó</span><span class="nx">n</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">aplicaciones</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">AppXSvc</span><span class="w">            </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">implementaci</span><span class="err">ó</span><span class="nx">n</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">AppX</span><span class="w"> </span><span class="o">...</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">AudioEndpointBu...</span><span class="w"> </span><span class="nx">Compilador</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">extremo</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">audio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">W...</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">Audiosrv</span><span class="w">           </span><span class="nx">Audio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">Windows</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">autotimesvc</span><span class="w">        </span><span class="nx">Hora</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">la</span><span class="w"> </span><span class="nx">red</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">telefon</span><span class="err">í</span><span class="nx">a</span><span class="w"> </span><span class="nx">m</span><span class="err">ó</span><span class="nx">vil</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">AxInstSV</span><span class="w">           </span><span class="nx">Instalador</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">ActiveX</span><span class="w"> </span><span class="p">(</span><span class="n">AxInstSV</span><span class="p">)</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">BcastDVRUserSer...</span><span class="w"> </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">usuario</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">difusi</span><span class="err">ó</span><span class="nx">n</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="nx">G...</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">BDESVC</span><span class="w">             </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">Cifrado</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">unidad</span><span class="w"> </span><span class="nx">BitLocker</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">BFE</span><span class="w">                </span><span class="nx">Motor</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">filtrado</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">base</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">BITS</span><span class="w">               </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">transferencia</span><span class="w"> </span><span class="nx">inteligen...</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">BluetoothUserSe...</span><span class="w"> </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">soporte</span><span class="w"> </span><span class="nx">t</span><span class="err">é</span><span class="nx">cnico</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">usua...</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">BrokerInfrastru...</span><span class="w"> </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">infraestructura</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">tare...</span><span class="w">
</span><span class="n">Stopped</span><span class="w">  </span><span class="nx">Browser</span><span class="w">            </span><span class="nx">Examinador</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">equipos</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">BTAGService</span><span class="w">        </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">puerta</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">enlace</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">aud...</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">BthAvctpSvc</span><span class="w">        </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">AVCTP</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">bthserv</span><span class="w">            </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">compatibilidad</span><span class="w"> </span><span class="nx">con</span><span class="w"> </span><span class="nx">Blue...</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">camsvc</span><span class="w">             </span><span class="nx">Servicio</span><span class="w"> </span><span class="nx">Administrador</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">funcional...</span><span class="w">
</span><span class="n">Running</span><span class="w">  </span><span class="nx">CaptureService_...</span><span class="w"> </span><span class="nx">CaptureService_49d30</span><span class="w">
</span><span class="o">...</span><span class="w">
</span></code></pre></div></div>

<p>Para concer la versión de powershell que estamos utilizando podemos desplegar los contenidos de la variable ‘‘$PSVersionTable’:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Users\offsec</span><span class="err">&gt;</span><span class="w"> </span><span class="bp">$PSVersionTable</span><span class="w">
</span><span class="n">Name</span><span class="w">                           </span><span class="nx">Value</span><span class="w">
</span><span class="o">----</span><span class="w">                           </span><span class="o">-----</span><span class="w">
</span><span class="n">PSVersion</span><span class="w">                      </span><span class="nx">5.1.19041.1320</span><span class="w">
</span><span class="o">...</span><span class="w">
</span></code></pre></div></div>

<p>Por otra parte, si tenemos acceso a un entorno GUI (Interfaz Gráfica) podemos tener acceso al IDE de PowerShell. IDE atiende a (Integrated Development Enviroment) y es un entorno de desarrollo del lenguaje de un lenguaje de programación específico. Podemos acceder escribiendo ‘PowerShell’ sobre la barra de búsqueda y seleccionando la opción Windows PowerShell ISE:</p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020221208184106.png" text-align="center" />
</div>

<p>Esto nos dara acceso a una interfaz en la que existe una consola de comandos además de otras características especificas del IDE:</p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020221208184224.png" text-align="center" />
</div>

<p>Los ejercicios estarán resueltos en el IDE.</p>

<p><br /></p>

<h4 id="32-cmdlets">3.2. CmdLets.</h4>

<p><strong>Definición. Cmdlet vs Command.</strong></p>

<p>PowerShell está basado en un tipo particular de programas denominados como CmdLets. Estos son algo así como los comandos de PowerShell, en el sentido de que son nombres que tienen asociado una funcionalidad dentro del lenguaje. Sin embargo, no pueden ser denominados ‘comandos’ como tal porque no lo son.</p>

<p>Esencialmente, un comando es un programa que ha sido compilado y que puede ejecutarse de forma independiente, en sí mismo (o si acaso, con la dependencia de algunas librerías pero que podrían estar incluidas en el propio código del comando). Por ejemplo, los comandos de Bash son programas autocontenidos que trabajan sobre ficheros.</p>

<p>Un CmdLet técnicamente es una clase de objeto del marco .NET que trabaja sobre otros objetos. Esto implica por otra parte que un CmdLet está pensado para formar parte siempre de un proceso modular (invocando métodos de objetos y concatenando varios CmdLets) y por tanto, como programa, es más liviano que un comando convencional, en el sentido de que como no está pensado para ejecutarse y ofrecer un resultado en sí mismo no tiene asociado un manejo de errores otras funcionalidades que si se requieren dentro de un comando.</p>

<p><br /></p>

<p><strong>Ejemplos y cmdlets comúnes</strong></p>

<p>La estructura de los CmdLets es siempre la combinación de un verbo y un nombre separados por un guión. Por ejemplo: ‘Get-Help’, ‘Set-ADAccount’, etc. Estos nombres hacen que la funcionalidad del cmdlet sea más intuitiva.</p>

<p>Podemos obtener una lista de verbos con el cmdlet <em>Get-Verb</em>:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-Verb</span><span class="w">

</span><span class="n">Verb</span><span class="w">        </span><span class="nx">Group</span><span class="w">
</span><span class="o">----</span><span class="w">        </span><span class="o">-----</span><span class="w">
</span><span class="n">Add</span><span class="w">         </span><span class="nx">Common</span><span class="w">
</span><span class="n">Clear</span><span class="w">       </span><span class="nx">Common</span><span class="w">
</span><span class="o">...</span><span class="w">
</span><span class="n">Trace</span><span class="w">       </span><span class="nx">Diagnostic</span><span class="w">
</span><span class="n">Connect</span><span class="w">     </span><span class="nx">Communications</span><span class="w">
</span><span class="n">Disconnect</span><span class="w">  </span><span class="nx">Communications</span><span class="w">
</span><span class="n">Read</span><span class="w">        </span><span class="nx">Communications</span><span class="w">
</span><span class="n">Receive</span><span class="w">     </span><span class="nx">Communications</span><span class="w">
</span><span class="n">Send</span><span class="w">        </span><span class="nx">Communications</span><span class="w">
</span><span class="n">Write</span><span class="w">       </span><span class="nx">Communications</span><span class="w">
</span><span class="n">Block</span><span class="w">       </span><span class="nx">Security</span><span class="w">
</span><span class="n">Grant</span><span class="w">       </span><span class="nx">Security</span><span class="w">
</span><span class="n">Protect</span><span class="w">     </span><span class="nx">Security</span><span class="w">
</span><span class="o">...</span><span class="w">
</span></code></pre></div></div>

<p>Otro de los cmdlets más útiles sería Get-Help, este, como el propio nombre indica, despliega ayuda sobre otros cmdlets o elementos de PowerShell:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-Help</span><span class="w"> </span><span class="nx">Get-Help</span><span class="w">

</span><span class="n">NAME</span><span class="w">
    </span><span class="nx">Get-Help</span><span class="w">

</span><span class="n">SYNOPSIS</span><span class="w">
    </span><span class="nx">Displays</span><span class="w"> </span><span class="nx">information</span><span class="w"> </span><span class="nx">about</span><span class="w"> </span><span class="nx">PowerShell</span><span class="w"> </span><span class="nx">commands</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">concepts.</span><span class="w">
    
</span><span class="n">SYNTAX</span><span class="w">
</span><span class="o">...</span><span class="w">
</span><span class="n">DESCRIPTION</span><span class="w">
</span><span class="o">...</span><span class="w">
</span></code></pre></div></div>

<p>Es importante mantener la ayuda actualizada con Update-Help como administrador, es especialmente importante de cara a la Importanción de Modulos de powershell para tener accesible ayuda sobre nuevos cmdlets.</p>

<p><br /></p>

<p><strong>Parámetros</strong></p>

<p>Los parámetros son términos que siguien a un guión y que expanden la funcionalidad de un cmdlet. Fijándonos en la ayuda de Get-Help podemos ver un parámetro:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">...</span><span class="w">
</span><span class="n">SYNTAX</span><span class="w">
    </span><span class="nx">Get-Help</span><span class="w"> </span><span class="p">[[</span><span class="nt">-Name</span><span class="p">]</span><span class="w"> </span><span class="err">&lt;</span><span class="n">System.String</span><span class="err">&gt;</span><span class="p">]</span><span class="w">
</span><span class="o">...</span><span class="w">
</span></code></pre></div></div>

<p>De esta forma, también podríamos invocar al comando a través de:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:\WINDOWS\system32&gt; Get-Help -Name "Get-Help"

NAME
    Get-Help
...
</code></pre></div></div>

<p>Cualquier parámetro de PowerShell viene precedido por un guión (-) y está compuesto por un nombre y un valor asociado que algunas veces hay que especificar y otras veces no. Como hemos visto en el ejemplo anterior, -Name sería el nombre del parámtero y Get-Help sería el valor asociado entre comillas indicando que se trata de un String.</p>

<p>En el acaso de la ayuda, a través de parámetros podemos pedir una información más detallada del comando o bien pedir ejemplo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
SYNTAX
    Get-Help [[-Name] &lt;System.String&gt;] [-Category {Alias | Cmdlet | Provider | General | FAQ | Glossary | HelpFile | ScriptCommand | Function | Filter | ExternalScript | All | DefaultHelp | DscResource | Class | Configuration}] [-Component &lt;System.String[]&gt;] -DETAILED [-Functionality &lt;System.String[]&gt;] [-Path &lt;System.String&gt;] [-Role &lt;System.String[]&gt;] [&lt;CommonParameters&gt;]
    Get-Help [[-Name] &lt;System.String&gt;] [-Category {Alias | Cmdlet | Provider | General | FAQ | Glossary | HelpFile | ScriptCommand | Function | Filter | ExternalScript | All | DefaultHelp | DscResource | Class | Configuration}] [-Component &lt;System.String[]&gt;] -EXAMPLES [-Functionality &lt;System.String[]&gt;] [-Path &lt;System.String&gt;] [-Role &lt;System.String[]&gt;] [&lt;CommonParameters&gt;]
...
</code></pre></div></div>

<p><br /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:\WINDOWS\system32&gt; Get-Help -Name "Get-Help" -Examples

NAME
    Get-Help
    
SYNOPSIS
    Displays information about PowerShell commands and concepts.
    
    --- Example 1: Display basic help information about a cmdlet ---
...
</code></pre></div></div>

<p><br /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:\WINDOWS\system32&gt; Get-Help -Name "Get-Help" -Detailed

NAME
    Get-Help

...    
PARAMETERS
...
   -Detailed &lt;Sytem.Management.Automatic.SwitchParameter&gt;
       Adds parameter descriptions and examples to the basic help display...
</code></pre></div></div>

<p><br /></p>

<p><strong>Alias</strong></p>

<p>Como sabemos de Bash en el apartado anterior, un alias es un nombre que sirve como shortcut para un comando de nombre más amplio. Así, ‘help’ es un alias de ‘Get-Help’:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">help</span><span class="w"> </span><span class="nx">Get-Help</span><span class="w">

</span><span class="n">NAME</span><span class="w">
    </span><span class="nx">Get-Help</span><span class="w">

</span><span class="n">SYNOPSIS</span><span class="w">
    </span><span class="nx">Displays</span><span class="w"> </span><span class="nx">information</span><span class="w"> </span><span class="nx">about</span><span class="w"> </span><span class="nx">PowerShell</span><span class="w"> </span><span class="nx">commands</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">concepts.</span><span class="w">
</span><span class="o">...</span><span class="w">
</span></code></pre></div></div>

<p>Podemos tener una lista de alias mediante y además especificar si un determinado término está asociado a un comando:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:\WINDOWS\system32&gt; Get-Alias -Definition "help"

CommandType    Name                Version    Source
___________    ____                _______    ______
Alias          man -&gt; help
...
</code></pre></div></div>

<p>Y podemos setear Alias con:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:\WINDOWS\system32&gt; Set-Alias -Name gh -Value Get-Help

PS C:\WINDOWS\system32&gt; Get-Alias -Name gh

CommandType    Name                Version    Source
___________    ____                _______    ______
Alias          gh -&gt; Get-Help
...
</code></pre></div></div>

<p><br /></p>

<p><strong>Ejercicios</strong></p>

<p>¿Qué cmdlet nos presenta información detallada sobre los comandos de PowerShell?: Get-Help.</p>

<p>¿Cuántos alias existen para el cmdlet Get-ChildItem?: Get-Alias -Definition Get-ChildItem</p>

<p>¿Cuántos cmdlets hay con el verbo “Save”?: Get-Command -Verb Save</p>

<p>¿Qué parámetro de Get-Verb no está disponible en PowerShell 5.1. pero sí en versiones anteriores?: Group</p>

<p>¿Cuál es el título del décimo ejemplo de Get-Command?: Get-Help -Examples Get-Command y bajar hasta el décimo ejemplo &gt; Get an alias.</p>

<p><br /></p>

<h5 id="323-variables">3.2.3. Variables.</h5>

<p><strong>Definición de Variable.</strong></p>

<p>Una variable es un contenedor que almacena datos. En PowerShell se utiliza el operador ‘=’ para declarar y asignar un valor a una variable al mismo tiempo:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$myString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ABC123!@#"</span><span class="w">
</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$myString</span><span class="w">
</span><span class="n">ABC123</span><span class="o">!</span><span class="err">@</span><span class="c">#</span><span class="w">
</span></code></pre></div></div>

<p>Toda variable debe empezar por ‘$’.</p>

<p><br /></p>

<p><strong>Data Types</strong></p>

<p>Los datos se distinguen por tipos en función del tipo de dato que sean (String, Int, Float, etc). Una forma de saber qué tipo de dato contiene una variable es utilizar el método “.GetType()” sobre dicha variable:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$myString</span><span class="o">.</span><span class="nf">GetType</span><span class="p">()</span><span class="w">

</span><span class="n">IsPublic</span><span class="w"> </span><span class="nx">IsSerial</span><span class="w"> </span><span class="nx">Name</span><span class="w">                                     </span><span class="nx">BaseType</span><span class="w">
</span><span class="o">--------</span><span class="w"> </span><span class="o">--------</span><span class="w"> </span><span class="o">----</span><span class="w">                                     </span><span class="o">--------</span><span class="w">
</span><span class="n">True</span><span class="w">     </span><span class="nx">True</span><span class="w">     </span><span class="nx">String</span><span class="w">                          </span><span class="nx">System.Object</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$myInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1903</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$myInt</span><span class="w">
</span><span class="mi">1903</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$myInt</span><span class="o">.</span><span class="nf">GetType</span><span class="p">()</span><span class="w">

</span><span class="n">IsPublic</span><span class="w"> </span><span class="nx">IsSerial</span><span class="w"> </span><span class="nx">Name</span><span class="w">                                     </span><span class="nx">BaseType</span><span class="w">
</span><span class="o">--------</span><span class="w"> </span><span class="o">--------</span><span class="w"> </span><span class="o">----</span><span class="w">                                     </span><span class="o">--------</span><span class="w">
</span><span class="n">True</span><span class="w">     </span><span class="nx">True</span><span class="w">     </span><span class="nx">Int32</span><span class="w">                           </span><span class="nx">System.ValueType</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100.5</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$a</span><span class="o">.</span><span class="nf">GetType</span><span class="p">()</span><span class="w">

</span><span class="n">IsPublic</span><span class="w"> </span><span class="nx">IsSerial</span><span class="w"> </span><span class="nx">Name</span><span class="w">                                     </span><span class="nx">BaseType</span><span class="w">
</span><span class="o">--------</span><span class="w"> </span><span class="o">--------</span><span class="w"> </span><span class="o">----</span><span class="w">                                     </span><span class="o">--------</span><span class="w">
</span><span class="n">True</span><span class="w">     </span><span class="nx">True</span><span class="w">     </span><span class="nx">Double</span><span class="w">                          </span><span class="nx">System.ValueType</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5000000000</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$b</span><span class="o">.</span><span class="nf">GetType</span><span class="p">()</span><span class="w">

</span><span class="n">IsPublic</span><span class="w"> </span><span class="nx">IsSerial</span><span class="w"> </span><span class="nx">Name</span><span class="w">                                     </span><span class="nx">BaseType</span><span class="w">
</span><span class="o">--------</span><span class="w"> </span><span class="o">--------</span><span class="w"> </span><span class="o">----</span><span class="w">                                     </span><span class="o">--------</span><span class="w">
</span><span class="n">True</span><span class="w">     </span><span class="nx">True</span><span class="w">     </span><span class="nx">Int64</span><span class="w">                           </span><span class="nx">System.ValueType</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$False</span><span class="o">.</span><span class="nf">GetType</span><span class="p">()</span><span class="w">

</span><span class="n">IsPublic</span><span class="w"> </span><span class="nx">IsSerial</span><span class="w"> </span><span class="nx">Name</span><span class="w">                                     </span><span class="nx">BaseType</span><span class="w">
</span><span class="o">--------</span><span class="w"> </span><span class="o">--------</span><span class="w"> </span><span class="o">----</span><span class="w">                                     </span><span class="o">--------</span><span class="w">
</span><span class="n">True</span><span class="w">     </span><span class="nx">True</span><span class="w">     </span><span class="nx">Boolean</span><span class="w">   

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$True</span><span class="o">.</span><span class="nf">GetType</span><span class="p">()</span><span class="w">

</span><span class="n">IsPublic</span><span class="w"> </span><span class="nx">IsSerial</span><span class="w"> </span><span class="nx">Name</span><span class="w">                                     </span><span class="nx">BaseType</span><span class="w">
</span><span class="o">--------</span><span class="w"> </span><span class="o">--------</span><span class="w"> </span><span class="o">----</span><span class="w">                                     </span><span class="o">--------</span><span class="w">
</span><span class="n">True</span><span class="w">     </span><span class="nx">True</span><span class="w">     </span><span class="nx">Boolean</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$array1</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="s2">"black"</span><span class="p">,</span><span class="s2">"yellow"</span><span class="p">,</span><span class="s2">"white"</span><span class="p">,</span><span class="s2">"orange"</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$array1</span><span class="o">.</span><span class="nf">GetType</span><span class="p">()</span><span class="w">

</span><span class="n">IsPublic</span><span class="w"> </span><span class="nx">IsSerial</span><span class="w"> </span><span class="nx">Name</span><span class="w">                                     </span><span class="nx">BaseType</span><span class="w">
</span><span class="o">--------</span><span class="w"> </span><span class="o">--------</span><span class="w"> </span><span class="o">----</span><span class="w">                                     </span><span class="o">--------</span><span class="w">
</span><span class="n">True</span><span class="w">     </span><span class="nx">True</span><span class="w">     </span><span class="nx">Object</span><span class="p">[]</span><span class="w">                        </span><span class="nx">System.Array</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<p><strong>Arrays</strong></p>

<p>Especialmente interesante es el último objeto. Este objeto es un tipo array que consiste en una colección de objetos. Como podemos ver es una variable que contiene diversos datos separados por comas. Cada uno de estos datos se identifican por un índice desde el 0 y son accesibles de la siguiente forma:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$array1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w">
</span><span class="n">blue</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$array1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w">
</span><span class="n">white</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<p><strong>Operaciones entre variables</strong></p>

<p>Las variables, al ser contenedores de datos, pueden ser utilizadas para operar de la misma forma que lo haríamos con los mismos datos. En este sentido podemos realizar operaciones matemáticas o concatenar cadenas de caracteres:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">123</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">456</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$b</span><span class="w">
</span><span class="mi">579</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$a</span><span class="w">
</span><span class="mi">456123</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$String1</span><span class="o">=</span><span class="s2">"Hola"</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$String1</span><span class="o">=</span><span class="s2">"Adios"</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$String1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$String2</span><span class="w">
</span><span class="n">HolaAdios</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$String1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">" "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$String2</span><span class="w">
</span><span class="n">Hola</span><span class="w"> </span><span class="nx">Adios</span><span class="w">
</span></code></pre></div></div>

<p>Pero sin ninguna duda, la operación más interesante que podemos hacer es el casting, que consiste en pasar datos de un tipo a otro tipo.</p>

<p>Consideremos el siguiente ejemplo:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"456"</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">123</span><span class="w">
</span></code></pre></div></div>

<p>La variable anterior, ‘b’, aun siendo un número es de hecho un tipo ‘String’ tal y como podemos ver utilizando el método en cuestión:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$a</span><span class="o">.</span><span class="nf">GetType</span><span class="p">()</span><span class="w">

</span><span class="n">IsPublic</span><span class="w"> </span><span class="nx">IsSerial</span><span class="w"> </span><span class="nx">Name</span><span class="w">                                     </span><span class="nx">BaseType</span><span class="w">
</span><span class="o">--------</span><span class="w"> </span><span class="o">--------</span><span class="w"> </span><span class="o">----</span><span class="w">                                     </span><span class="o">--------</span><span class="w">
</span><span class="n">True</span><span class="w">     </span><span class="nx">True</span><span class="w">     </span><span class="nx">Int32</span><span class="w">                           </span><span class="nx">System.ValueType</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$b</span><span class="o">.</span><span class="nf">GetType</span><span class="p">()</span><span class="w">

</span><span class="n">IsPublic</span><span class="w"> </span><span class="nx">IsSerial</span><span class="w"> </span><span class="nx">Name</span><span class="w">                                     </span><span class="nx">BaseType</span><span class="w">
</span><span class="o">--------</span><span class="w"> </span><span class="o">--------</span><span class="w"> </span><span class="o">----</span><span class="w">                                     </span><span class="o">--------</span><span class="w">
</span><span class="n">True</span><span class="w">     </span><span class="nx">True</span><span class="w">     </span><span class="nx">String</span><span class="w">                          </span><span class="nx">System.Object</span><span class="w">
</span></code></pre></div></div>

<p>Sin embargo, podemos realizar un casteo de esta variable como sigue:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="p">([</span><span class="n">int</span><span class="p">]</span><span class="nv">$b</span><span class="p">)</span><span class="o">.</span><span class="nf">GetType</span><span class="p">()</span><span class="w">

</span><span class="n">IsPublic</span><span class="w"> </span><span class="nx">IsSerial</span><span class="w"> </span><span class="nx">Name</span><span class="w">                                     </span><span class="nx">BaseType</span><span class="w">
</span><span class="o">--------</span><span class="w"> </span><span class="o">--------</span><span class="w"> </span><span class="o">----</span><span class="w">                                     </span><span class="o">--------</span><span class="w">
</span><span class="n">True</span><span class="w">     </span><span class="nx">True</span><span class="w">     </span><span class="nx">Int32</span><span class="w">                           </span><span class="nx">System.ValueType</span><span class="w">
</span></code></pre></div></div>

<p>Podemos observar que [int]$b ya no es una cadena de caracteres sino un valor entero. Lo mismo es aplicable a otra serie de datos, para mas información se tiene el siguiente <a href="https://www.aulafacil.com/cursos/programacion/en-c/casting-de-datos-l17890#:~:text=Los%20casting%20en%20programaci%C3%B3n%20se,sistema%20de%20conversi%C3%B3n%20como%20tal.">link</a></p>

<p><br /></p>

<p><strong>Variables conocidas</strong></p>

<p>Algunas variables que powershell contiene por defecto son:</p>

<ul>
  <li>
    <p><strong>$Error</strong> contiene una matriz de objetos de error.</p>
  </li>
  <li>
    <p><strong>$Host</strong> contiene información sobre la aplicación de alojamiento actual.</p>
  </li>
  <li>
    <p><strong>$Profile</strong> contiene la ruta al perfil de usuario actual para PowerShell.</p>
  </li>
  <li>
    <p><strong>$PID</strong> contiene el ID de proceso de la sesión actual de PowerShell.</p>
  </li>
  <li>
    <p><strong>$PSUICulture</strong> contiene la referencia cultural de la interfaz de usuario o el idioma regional de la interfaz de usuario.</p>
  </li>
  <li>
    <p><strong>$NULL</strong> contiene el valor de NULL.</p>
  </li>
  <li>
    <p><strong>$False</strong> contiene el valor de False.</p>
  </li>
  <li>
    <p><strong>$True</strong> contiene el valor de True.</p>
  </li>
</ul>

<p><br /></p>

<p><strong>Ejercicios</strong></p>

<p>¿Cuál es el valor del <em>total</em> en el siguiente bloque de código de PowerShell?</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$x = "123.5"
$y = 456
$z = .25
$total = $x + $y + $z
</code></pre></div></div>

<p>Copiar el código en el ISE y ver el valor de la variable $total.</p>

<p><br /></p>

<p>Si quisiéramos convertir la variable <em>x</em> de cadena a doble para sumar los tres números, ¿qué sintaxis necesitaríamos agregar delante de <em>x</em> en la última línea del programa?: [double]</p>

<p><br /></p>

<p>¿Cuál es el resultado de la ecuación “fija” de la pregunta 2?:</p>

<p>Copiar el código</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>double]<span class="nv">$x</span> <span class="o">=</span> <span class="s2">"123.5"</span>
<span class="nv">$y</span> <span class="o">=</span> 456
<span class="nv">$z</span> <span class="o">=</span> .25
<span class="nv">$total</span> <span class="o">=</span> <span class="nv">$x</span> + <span class="nv">$y</span> + <span class="nv">$z</span>
</code></pre></div></div>

<p>Y mostrar el resultado de la variabl $total.</p>

<p><br /></p>

<p>¿Cuál es el resultado de la última instrucción?</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:\WINDOWS\system32&gt; $myArray=1,2,3,4,5

PS C:\WINDOWS\system32&gt; $myArray[3]
</code></pre></div></div>

<p><br /></p>

<h5 id="324-operadores">3.2.4. Operadores.</h5>

<p>Un operador es un caracter que se utiliza dentro de una expresión para obtener un resultado a partir de uno o varios objetos. Distinguimos esencialmente entre:</p>

<ul>
  <li><em>Asignador</em>, ‘=’: Se utiliza para asignar o manipular valores de variables.</li>
  <li><em>Arithemtic</em>: Sirven para realizar operaciones matemáticas como ‘+’ o ‘-‘. Especial mencion merece el operador monádico incremento (++) o decremento (–) o el operador módulo (%).</li>
  <li><em>Comparison</em>: Comparan objetos para ver si son iguales en algún aspecto, ‘-eq’.</li>
</ul>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020221209124831.png" text-align="center" />
</div>

<ul>
  <li><em>Logical</em>: Operador usado para conectar dos o más expresiones ‘-and’ y ‘-or’.</li>
</ul>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">$num1</span><span class="w"> </span><span class="o">-le</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="p">(</span><span class="nv">$num2</span><span class="w"> </span><span class="o">-le</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w">
</span><span class="n">True</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">$num1</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">-or</span><span class="w"> </span><span class="p">(</span><span class="nv">$num2</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w">
</span><span class="n">True</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<h5 id="325-conditional-statements-and-loops">3.2.5. Conditional Statements and Loops.</h5>

<p>Hasta ahora hemos visto elementos básicos como variable y formas de interactuar y sacar conclusiones con esta variable. Ahora vamos a ver herramientas que nos van a ayudar a gestionar el control del flujo del código; estamos hablando de los bucles y las sentencias condicionales, que nos permitirán dirigir el curso del código en base a respuesta automatizadas.</p>

<p><br /></p>

<p><strong>If/Else conditional statement</strong></p>

<p>El statement If/Else permite al código elaborar decisiones en base al valor booleano de una condición. Si este valor es verdadero se ejecutará un bloque de código y si es faldo se ejecutará el bloque de código perteneciente al término ‘Else’. La sintaxis específica de este statement es como sigue:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">if</span><span class="w"> </span><span class="p">(</span><span class="err">&lt;</span><span class="n">condition</span><span class="err">&gt;</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="err">&lt;</span><span class="n">code1</span><span class="err">&gt;</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="kr">else</span><span class="w">
</span><span class="p">{</span><span class="w">
 </span><span class="err">&lt;</span><span class="n">code2</span><span class="err">&gt;</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Por ejemplo:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">if</span><span class="p">(</span><span class="mi">80</span><span class="w"> </span><span class="o">-ge</span><span class="w"> </span><span class="mi">70</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"Passed"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="kr">else</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"Failed"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">Passed</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<p><strong>Switch</strong></p>

<p>Conceptualmente este statemente es una extensión del If/Else a más de dos casos. El statement <em>Switch</em> compara un valor dado con un conjunto de posibles casos comtemplados para el valor de dicho dato y en función de cada caso ejecuta un bloque de código.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:\WINDOWS\system32&gt; switch ($var)
{
  &lt;case1&gt;{&lt;code&gt;}
  &lt;case2&gt;{&lt;code&gt;}
  ...
}
OUTPUT
</code></pre></div></div>

<p>Un ejemplo sería:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$number1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">switch</span><span class="w"> </span><span class="p">(</span><span class="nv">$number1</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="mi">1</span><span class="p">{</span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"Number is 1"</span><span class="p">}</span><span class="w">
  </span><span class="mi">2</span><span class="p">{</span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"Number is 2"</span><span class="p">}</span><span class="w">
  </span><span class="mi">3</span><span class="p">{</span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"Number is 3"</span><span class="p">}</span><span class="w">
  </span><span class="mi">4</span><span class="p">{</span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"Number is 4"</span><span class="p">}</span><span class="w">
  </span><span class="mi">5</span><span class="p">{</span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"Number is 5"</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">Number</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">4</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<p><strong>For and While Loops</strong></p>

<p>Los bucles for y while son un statements que nos permiten repetir un bloque de código hasta que se cumple una determinada condición.</p>

<p>Concretamente, el bucle for está orientado a repetir el bloque un número concreto de veces variando una o varias partes concretas del código en cada iteración.</p>

<p>Por ejemplo:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">for</span><span class="w"> </span><span class="p">(</span><span class="nv">$myVar</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nv">$myVar</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="nv">$myVar</span><span class="o">++</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="n">Write-Output</span><span class="w"> </span><span class="nv">$myVar</span><span class="p">;</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="mi">0</span><span class="w">
</span><span class="mi">1</span><span class="w">
</span><span class="mi">2</span><span class="w">
</span><span class="mi">3</span><span class="w">
</span><span class="mi">4</span><span class="w">
</span></code></pre></div></div>

<p>El ejemplo anterior repite desde 0 hasta 4 escalando una cada vez un bloque de código mostrando que además, en cada iteración la variable $myVar cambia cada vez. El bucle termina cuando la condición que ocupa el puesto de 2º parámetro se cumple, es decir, cuando $myVar es igual o mayor que 5.</p>

<p>Una variación que tiene más flexibilidad y usos más prácticos del bucle for sería el ‘foreach’, que selecciona un objeto de un conjunto de objetos y realiza algo con él para todos los elementos del conjunto:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$myWord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"powershell"</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$myArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$myWord</span><span class="o">.</span><span class="nf">ToCharArray</span><span class="p">()</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$myLetter</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$myArray</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nv">$myLetter</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">p</span><span class="w">
</span><span class="nx">o</span><span class="w">
</span><span class="n">w</span><span class="w">
</span><span class="nx">e</span><span class="w">
</span><span class="n">r</span><span class="w">
</span><span class="nx">s</span><span class="w">
</span><span class="n">h</span><span class="w">
</span><span class="nx">e</span><span class="w">
</span><span class="n">l</span><span class="w">
</span><span class="nx">l</span><span class="w">
</span></code></pre></div></div>

<p>Para entender este ejemplo es conveniente saber que el método <em>.ToCharArray()</em> convierte un String (técnicamente cadena de caracteres) en un objeto array cuyas casillas son los caracteres que componen el string.</p>

<p>El bucle While, como comentábamos al principio sigue el mismo principio del bucle For, sin embargo está orientado a la repetición de un bucle de código hasta que se cumple una condición sin la necesidad de saber exactamente cuántas repeticiones de código serán.</p>

<p>La sintaxis es:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">while</span><span class="w"> </span><span class="p">(</span><span class="err">&lt;</span><span class="n">condition</span><span class="err">&gt;</span><span class="p">)</span><span class="w">
  </span><span class="p">{</span><span class="w">
	  </span><span class="err">&lt;</span><span class="n">code</span><span class="err">&gt;</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Por ejemplo:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="nv">$count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="mi">1</span><span class="w">  </span><span class="kr">while</span><span class="w"> </span><span class="p">(</span><span class="nv">$count</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w">
</span><span class="mi">2</span><span class="w">  </span><span class="p">{</span><span class="w">
</span><span class="mi">3</span><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$count</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">
</span><span class="mi">4</span><span class="w">    </span><span class="p">{</span><span class="w">
</span><span class="mi">5</span><span class="w">      </span><span class="kr">break</span><span class="p">;</span><span class="w">
</span><span class="mi">6</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="mi">7</span><span class="w">    </span><span class="nv">$count</span><span class="p">;</span><span class="w">
</span><span class="mi">8</span><span class="w">    </span><span class="nv">$count</span><span class="o">++</span><span class="p">;</span><span class="w">
</span><span class="mi">9</span><span class="w">  </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Observemos que el incremento de ‘count’ (al contrario de lo que ocurría en el bucle for) está especificado dentro del código pero su presencia  no es una condición necesaria y eso convertiría al bucle en un bucle sin fin.</p>

<p>Una forma más concreta del bucle while infinito es el siguiente:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">while</span><span class="w"> </span><span class="p">(</span><span class="nv">$True</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="err">&lt;</span><span class="n">code</span><span class="err">&gt;</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Este tipo de bucle es muy útil en diversas situaciones y conviene tenerlo en mente.</p>

<p>A veces la condición puede ser una señal para parar el bucle:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$words</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"powershell"</span><span class="p">,</span><span class="s2">"offensive"</span><span class="p">,</span><span class="s2">"security"</span><span class="p">,</span><span class="s2">"hacker"</span><span class="p">,</span><span class="s2">"scripting"</span><span class="p">,</span><span class="s2">"forensics"</span><span class="p">,</span><span class="s2">"pentest"</span><span class="w">
</span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$word</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$words</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$word</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"hacker"</span><span class="p">)</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="kr">break</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">Write-Output</span><span class="w"> </span><span class="nv">$word</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<h4 id="33-powershell-propierties-and-methods">3.3. PowerShell Propierties and Methods.</h4>

<p><strong>Definición de propiedades y métodos.</strong></p>

<p>Como hemos comentado al principio, la funcionalidad de PowerShell reside en CmdLets que trabajan sobre objetos, instancias de clases. Asociados al manejo de las clases podemos encontrar las <em>Propiedades</em> y los <em>Métodos</em>.</p>

<p>Una propiedad es una característica o atributo de una clase que toma un valor concreto en un objeto caracterizándolo. Por otra parte, un método es una acción de código asociada a dicho objeto.</p>

<p><br /></p>

<p><strong>Accediendo a las propiedades y métodos de un objeto.</strong></p>

<p>Podemos acceder a ambos elementos mediante el CmdLet ‘Get-Member’ en conjunción con un operador ‘pipe’.</p>

<p>Como ejemplo, podemos designar una variable. Una variable es efectivamente una instancia de la clase Variable, un objeto, que tiene propiedades y métodos, veámoslos. Supongámos que tenemos la variable $Var = “Christina”, entonces:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:\WINDOWS\system32&gt; $Var | Get-Member

    TypeName: Sytem.String

Name                MemberType      Definition
----                ----------      ----------
Clone               Method          System.Object Clone(), System.Object ICloneable.Clone()
... 
GetType             Method          type GetType()
...
ToCharArray         Method          char IConvertible.ToChar(System.IFormatProvider provider)
...
Length              Property        int Length {get;}
</code></pre></div></div>

<p>Aquí podemos observar unos pocos pero la realidad es que esta es una variable tipo String y tiene muchos métodos y propiedades disponibiles.</p>

<p>Para usar un método o ver una propiedad sobre una acción siempre utilizamos un punto (.) después del nombre del objeto. Por ejemplo:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$Var</span><span class="w">
</span><span class="n">Christina</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$Var</span><span class="o">.</span><span class="nf">ToLower</span><span class="p">()</span><span class="w">
</span><span class="n">christina</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$Var</span><span class="o">.</span><span class="nf">Length</span><span class="w">
</span><span class="nx">9</span><span class="w">
</span></code></pre></div></div>

<p>Observamos que ambos son funciones que se aplican sobre el objeto, ya sea para obtener una característica suya o para utilizar su contenido con algún propósito. La diferencia sintactica entre un método y una propiedad es que el método tiene paréntesis.</p>

<p><br /></p>

<p><strong>Ejercicios</strong></p>

<p>¿Cuántos métodos tiene el cmdlet Get-ScheduledTask?</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-ScheduledTask</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Get-Member</span><span class="w"> </span><span class="nt">-MemberType</span><span class="w"> </span><span class="nx">Method</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Measure-Object</span><span class="w"> </span><span class="nt">-Line</span><span class="w">
</span></code></pre></div></div>

<p>9</p>

<p><br /></p>

<p>En orden alfabético, lista las dos propiedades que contienen la palabra “Write” en el nombre del cmdlet Get-ChildItem.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-ChildItem</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Get-Member</span><span class="w"> </span><span class="nt">-MemberType</span><span class="w"> </span><span class="nx">Property</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"*write*"</span><span class="w">
</span></code></pre></div></div>

<p>LastWriteTime, LastWriteTimeUtc</p>

<p><br /></p>

<h4 id="34-filtering-and-fromatting">3.4. Filtering and Fromatting.</h4>

<p>Antes hemos visto que PowerShell consta de objetos que tienen asociada una gran multitud de información asociada. Ahora vamos a aprender a cómo desplegar exactamente la información que necesitamos de una entidad concreta.</p>

<p><br /></p>

<p><strong>Select-Object</strong></p>

<p>Select-Object es un CmdLet que nos permite seleccionar una propiedad de uno o más objetos. Continuando con los ejemplos anteriores:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$Var</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">Length</span><span class="w">

</span><span class="n">Length</span><span class="w">
</span><span class="o">------</span><span class="w">
</span><span class="mi">9</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$Var</span><span class="o">.</span><span class="nf">Length</span><span class="w">

</span><span class="mi">9</span><span class="w">
</span></code></pre></div></div>

<p>Debemos saber que, aunque en principio el output esa igual, la forma en la trabajan ambos comandos es distinta y muchas veces no proporcionarán los mismos resultados.</p>

<p>Otro ejemplo de uso sería con Get-Service. Get-Service es un CmdLet que lista los servicios instalados en el sistema Windows, es un cmdlet especialmente importante debido a que puede conducir a un pentester a potenciales vectores de ataque de distinta índole:</p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020221210135959.png" text-align="center" />
</div>

<p>Para listar servicios debemos ser administrador. Si cruzamos el display anterior con Get-Member obtendríamos el siguiente resultado:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-Service</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Get-Member</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020221210140122.png" text-align="center" />
</div>

<p>Podemos observar que se despliegan múltiples métodos y propiedades asociados al objeto Get-Service en formato de tabla. Pero otra forma de obtener esta información es cruzando Get-Services y obteniendo sólo una serie de proppiedades deseadas:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-Service</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="s2">"DisplayName"</span><span class="p">,</span><span class="s2">"MachineName"</span><span class="p">,</span><span class="s2">"ServiceType"</span><span class="p">,</span><span class="s2">"StartType"</span><span class="p">,</span><span class="s2">"Status"</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020221210140812.png" text-align="center" />
</div>

<p>Aquí podemos ver que se muestra en formato de Lista que es más manejablen y además sólo muestra la información pedida que es en esencia la que queremos saber.</p>

<p><br /></p>

<p><strong>Sort-Object</strong></p>

<p>Sort-Object es un cmdlet que nos permite ordenar la información mostrada en base a una propiedad u objeto. Por ejemplo, supongámos que queremos mostrar los servicios en función de su status en orden descendente, esto es; running, stop, etc:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-Service</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">DisplayName</span><span class="p">,</span><span class="nx">ServiceType</span><span class="p">,</span><span class="nx">StartType</span><span class="p">,</span><span class="nx">Status</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sort-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">Status</span><span class="w"> </span><span class="nt">-Descending</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020221210142245.png" text-align="center" />
</div>

<p><br /></p>

<p><strong>Where-Object</strong></p>

<p>Where-Object nos permite filtrar por un parámetro que tiene un valor dado. Por ejemplo, supongámos que de los servicios listados anteriormente sólo nos interesan aquellos que que empiezan al ejecutarse la máquina o que empiezan ‘automáticamente’:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-Service</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">DisplayName</span><span class="p">,</span><span class="nx">ServiceType</span><span class="p">,</span><span class="nx">StartType</span><span class="p">,</span><span class="nx">Status</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sort-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">Status</span><span class="w"> </span><span class="nt">-Descending</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="nx">StartType</span><span class="w"> </span><span class="o">-EQ</span><span class="w"> </span><span class="nx">Automatic</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020221210143629.png" text-align="center" />
</div>

<p><br /></p>

<p><strong>Format-Table/List</strong></p>

<p>Format-Table o Format-List son comandos que formatean el output o bien en tabla o bien en forma de lista, por ejemplo:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-Service</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">ServiceName</span><span class="p">,</span><span class="nx">DisplayName</span><span class="p">,</span><span class="nx">ServiceType</span><span class="p">,</span><span class="nx">StartType</span><span class="p">,</span><span class="nx">Status</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sort-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">Status</span><span class="w"> </span><span class="nt">-Descending</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="bp">$_</span><span class="o">.</span><span class="nf">StartType</span><span class="w"> </span><span class="o">-EQ</span><span class="w"> </span><span class="s2">"Automatic"</span><span class="w"> </span><span class="o">-And</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">ServiceName</span><span class="w"> </span><span class="o">-Match</span><span class="w"> </span><span class="s2">"^s"</span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Format-Table</span><span class="w">
</span></code></pre></div></div>

<p>Este comando, además de filtrar el nombre del servicio de acuerdo a una expresión regular para que sólo presente aquellos servicios que empiecen por ‘s’ despliega el output en forma de Tabla, es decir, filas y columnas:</p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020221210181440.png" text-align="center" />
</div>

<p>Existen más formatos aunque sólo estemos presentando estos dos.</p>

<p><br /></p>

<p><strong>Get-PSProvider, Get/Set/New-Item, Get/Set/New-ItemProperty</strong></p>

<p>Los <em>providers</em> son contenedores del marco .NET que facilitan el acceso a ciertos tipos de datos. Podemos ver una lista del providers actuales ejecutando Get-PSProvider:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-PSProvider</span><span class="w">

</span><span class="n">Name</span><span class="w">          </span><span class="nx">Capabilities</span><span class="w">                          </span><span class="nx">Drives</span><span class="w">
</span><span class="o">----</span><span class="w">          </span><span class="o">------------</span><span class="w">                          </span><span class="o">------</span><span class="w">
</span><span class="n">Registry</span><span class="w">      </span><span class="nx">ShouldProcess</span><span class="p">,</span><span class="w"> </span><span class="nx">Transactions</span><span class="w">           </span><span class="p">{</span><span class="n">HKLM</span><span class="p">,</span><span class="w"> </span><span class="nx">HKCU</span><span class="p">}</span><span class="w">
</span><span class="n">Alias</span><span class="w">         </span><span class="nx">ShouldProcess</span><span class="w">                         </span><span class="p">{</span><span class="n">Alias</span><span class="p">}</span><span class="w">
</span><span class="n">Environment</span><span class="w">   </span><span class="nx">ShouldProcess</span><span class="w">                         </span><span class="p">{</span><span class="n">Env</span><span class="p">}</span><span class="w">
</span><span class="n">FileSystem</span><span class="w">    </span><span class="nx">Filter</span><span class="p">,</span><span class="w"> </span><span class="nx">ShouldProcess</span><span class="p">,</span><span class="w"> </span><span class="nx">Credentials</span><span class="w">    </span><span class="p">{</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="nx">A</span><span class="p">,</span><span class="w"> </span><span class="nx">D</span><span class="p">}</span><span class="w">
</span><span class="kr">Function</span><span class="w">      </span><span class="nf">ShouldProcess</span><span class="w">                         </span><span class="p">{</span><span class="kr">Function</span><span class="p">}</span><span class="w">
</span><span class="n">Variable</span><span class="w">      </span><span class="nx">ShouldProcess</span><span class="w">                         </span><span class="p">{</span><span class="n">Variable</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Podemos ver los objetos asociados a cada clase con Get-Item o directamente navegando al contenender con cd:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-Item</span><span class="w"> </span><span class="nx">alias:</span><span class="w">

</span><span class="n">CommandType</span><span class="w">     </span><span class="nx">Name</span><span class="w">                             </span><span class="nx">Version</span><span class="w">    </span><span class="nx">Source</span><span class="w">
</span><span class="o">-----------</span><span class="w">     </span><span class="o">----</span><span class="w">                             </span><span class="o">-------</span><span class="w">    </span><span class="o">------</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">foreach</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">ForEach-Objec</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">ForEach-Objec</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">where</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Where-Objec</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nf">?</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Where-Objec</span><span class="w">
</span><span class="nx">Alias</span><span class="w">           </span><span class="nx">ac</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Add-Content</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">clc</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Clear-Content</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">cli</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Clear-Item</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">clp</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Clear-ItemProperty</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">clv</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Clear-Variable</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">compare</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Compare-Objec</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">cpi</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Copy-Item</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">cpp</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Copy-ItemProperty</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">cvpa</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Convert-Path</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">dbp</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Disable-PSBreakpoin</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">diff</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Compare-Objec</span><span class="w">
</span><span class="o">...</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\WINDOWS\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">cd</span><span class="w"> </span><span class="nx">Alias:</span><span class="p">;</span><span class="w"> </span><span class="n">ls</span><span class="w">

</span><span class="n">CommandType</span><span class="w">     </span><span class="nx">Name</span><span class="w">                             </span><span class="nx">Version</span><span class="w">    </span><span class="nx">Source</span><span class="w">
</span><span class="o">-----------</span><span class="w">     </span><span class="o">----</span><span class="w">                             </span><span class="o">-------</span><span class="w">    </span><span class="o">------</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">foreach</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">ForEach-Objec</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">ForEach-Objec</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">where</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Where-Objec</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nf">?</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Where-Objec</span><span class="w">
</span><span class="nx">Alias</span><span class="w">           </span><span class="nx">ac</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Add-Content</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">clc</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Clear-Content</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">cli</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Clear-Item</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">clp</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Clear-ItemProperty</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">clv</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Clear-Variable</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">compare</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Compare-Objec</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">cpi</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Copy-Item</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">cpp</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Copy-ItemProperty</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">cvpa</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Convert-Path</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">dbp</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Disable-PSBreakpoin</span><span class="w">
</span><span class="n">Alias</span><span class="w">           </span><span class="nx">diff</span><span class="w"> </span><span class="o">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Compare-Objec</span><span class="w">
</span><span class="o">...</span><span class="w">
</span></code></pre></div></div>

<p>Y vemos todos los alias y a qué comando sustituyen. Así por ejemplo, ‘ls’, ‘dir’ son ambos alias de Get-ChildItem que lista los contenidos del directorio actual. Observemos que el propio directorio C es un provider.</p>

<p><br /></p>

<h5 id="342-powershell-functions">3.4.2. PowerShell Functions.</h5>

<p><strong>Definición y creación de funciones</strong></p>

<p>Las funciones son piezas de código que podemos invocar. Están pensadas para reciclar bloques de código.</p>

<p>Para poder definir una función hay que escribilar la siguiente sintaxis:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">function</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">functionname</span><span class="err">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
 
  </span><span class="err">&lt;</span><span class="n">code</span><span class="err">&gt;</span><span class="w">

</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">function</span><span class="w"> </span><span class="nx">Get-MajMinorVersion</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="bp">$PSVersionTable</span><span class="o">.</span><span class="nf">PSVersion</span><span class="o">.</span><span class="nf">Major</span><span class="o">.</span><span class="nf">ToString</span><span class="p">()</span><span class="o">+</span><span class="s2">"."</span><span class="o">+</span><span class="bp">$PSVersionTable</span><span class="o">.</span><span class="nf">PSVersion</span><span class="o">.</span><span class="nf">Minor</span><span class="o">.</span><span class="nf">ToString</span><span class="p">()</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-MajMinorVersion</span><span class="w">
</span><span class="mf">5.1</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<p><strong>Scope modifiers</strong></p>

<p>El scope o alcance de una variable determina hasta qué punto existe una variable en un código. Existen variables que sólo tienen valor o existencia dentro de un bloque de código y tienen alcance local y existen variables que existen en todo el código y que tienen por tanto un alcance global.</p>

<p>Así por ejemplo podemos usar los términos Global o Local para determinar el alcance de una variable que creemos:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$</span><span class="nn">Global</span><span class="p">:</span><span class="nv">outsideVariable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"outside"</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">function</span><span class="w"> </span><span class="nx">Set-PSInsideVar</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nv">$</span><span class="nn">Local</span><span class="p">:</span><span class="nv">insideVariable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"inside"</span><span class="w">
  </span><span class="n">Write-Output</span><span class="w"> </span><span class="nv">$insideVariable</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>La sintaxis por tanto es:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$&lt;</span><span class="n">scope-modifier</span><span class="err">&gt;</span><span class="p">:</span><span class="err">&lt;</span><span class="nx">name</span><span class="err">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">&lt;</span><span class="n">value</span><span class="err">&gt;</span><span class="w">
</span></code></pre></div></div>

<p>Así, observamos que la variable local no existe fuera del bloque de código de la función.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Write-Output</span><span class="w"> </span><span class="nv">$outsideVariable</span><span class="w">
</span><span class="n">outside</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Set-PSInsideVar</span><span class="w">
</span><span class="n">inside</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Write-Output</span><span class="w"> </span><span class="nv">$insideVariable</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<p><strong>Get-Variable</strong></p>

<p>Podemos identificar todas las variables, locales o globales con Get-Variable:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-Variable</span><span class="w"> </span><span class="nt">-Scope</span><span class="w"> </span><span class="nx">Global</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">outsideVariable</span><span class="w">

</span><span class="n">Name</span><span class="w">                                </span><span class="nx">Value</span><span class="w">
</span><span class="o">----</span><span class="w">                                </span><span class="err">_____</span><span class="w">
</span><span class="n">outsideVariable</span><span class="w">                      </span><span class="nx">outside</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-Variable</span><span class="w"> </span><span class="nt">-Scope</span><span class="w"> </span><span class="nx">Global</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">insideVariable</span><span class="w">
</span><span class="n">Get-Variable</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">Cannot</span><span class="w"> </span><span class="nx">find</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">variable</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="s1">'insideVariable'</span><span class="o">.</span><span class="w">
</span><span class="n">At</span><span class="w"> </span><span class="nx">line:1</span><span class="w"> </span><span class="nx">char:1</span><span class="w">
</span><span class="o">+</span><span class="w"> </span><span class="n">Get-Variable</span><span class="w"> </span><span class="nt">-Scope</span><span class="w"> </span><span class="nx">Global</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">insideVariable</span><span class="w">
</span><span class="o">+</span><span class="w"> </span><span class="n">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span class="w">
    </span><span class="o">+</span><span class="w"> </span><span class="nx">CategoryInfo</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="nx">ObjectNotFound:</span><span class="w"> </span><span class="p">(</span><span class="n">insideVariable:string</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="n">Get</span><span class="nt">-Variable</span><span class="p">],</span><span class="w"> </span><span class="n">ItemNotFoundExepction</span><span class="w">
    </span><span class="o">+</span><span class="w"> </span><span class="nx">FullyQualifiedErrorID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">VariableNotFound</span><span class="p">,</span><span class="nx">Microsoft.PowerShell.Commands.GetVariableCommand</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-Variable</span><span class="w"> </span><span class="nt">-Scope</span><span class="w"> </span><span class="nx">Local</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">insideVariable</span><span class="w">
</span><span class="n">Get-Variable</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">Cannot</span><span class="w"> </span><span class="nx">find</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">variable</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="s1">'insideVariable'</span><span class="o">.</span><span class="w">
</span><span class="n">At</span><span class="w"> </span><span class="nx">line:1</span><span class="w"> </span><span class="nx">char:1</span><span class="w">
</span><span class="o">+</span><span class="w"> </span><span class="n">Get-Variable</span><span class="w"> </span><span class="nt">-Scope</span><span class="w"> </span><span class="nx">Local</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">insideVariable</span><span class="w">
</span><span class="o">+</span><span class="w"> </span><span class="n">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span class="w">
    </span><span class="o">+</span><span class="w"> </span><span class="nx">CategoryInfo</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="nx">ObjectNotFound:</span><span class="w"> </span><span class="p">(</span><span class="n">insideVariable:string</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="n">Get</span><span class="nt">-Variable</span><span class="p">],</span><span class="w"> </span><span class="n">ItemNotFoundExepction</span><span class="w">
    </span><span class="o">+</span><span class="w"> </span><span class="nx">FullyQualifiedErrorID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">VariableNotFound</span><span class="p">,</span><span class="nx">Microsoft.PowerShell.Commands.GetVariableCommand</span><span class="w">

</span></code></pre></div></div>

<p>Observamos que, aunque intentamos buscar una variable local, esta no existe y por tanto no puede ser encontrada a noser que se busque desde el bloque de código en el que fue creada:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">function</span><span class="w"> </span><span class="nx">Set-PSInsideVar</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nv">$</span><span class="nn">Local</span><span class="p">:</span><span class="nv">insideVariable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"inside"</span><span class="w">
  </span><span class="n">Write-Output</span><span class="w"> </span><span class="nv">$insideVariable</span><span class="w">
  </span><span class="n">Get-Variable</span><span class="w"> </span><span class="nt">-Scope</span><span class="w"> </span><span class="nx">Local</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">insideVariable</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Set-PSInsideVar</span><span class="w">
</span><span class="n">inside</span><span class="w">

</span><span class="n">Name</span><span class="w">                                </span><span class="nx">Value</span><span class="w">
</span><span class="o">----</span><span class="w">                                </span><span class="err">_____</span><span class="w">
</span><span class="n">insideVariable</span><span class="w">                       </span><span class="nx">inside</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<p><strong>Parámetros de las funciones</strong></p>

<p>Las funciones pueden ser llamadas juntos con parámetros, estos son valores que se añaden al código de la función de forma externa y que generalmente varian el comportamiento y resultado de la función.</p>

<p>Hay dos formas de definir los parámetros de una función:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">function</span><span class="w"> </span><span class="err">&lt;</span><span class="n">name</span><span class="err">&gt;</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="kr">param</span><span class="w"> </span><span class="p">([</span><span class="n">type</span><span class="p">]</span><span class="nv">$parameter1</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">type</span><span class="p">]</span><span class="nv">$parameter2</span><span class="p">)</span><span class="w">
  </span><span class="err">&lt;</span><span class="n">actions</span><span class="err">&gt;</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="kr">function</span><span class="w"> </span><span class="err">&lt;</span><span class="n">name</span><span class="err">&gt;</span><span class="w"> </span><span class="p">([</span><span class="n">type</span><span class="p">]</span><span class="nv">$parameter1</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">type</span><span class="p">]</span><span class="nv">$parameter2</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="err">&lt;</span><span class="n">actions</span><span class="err">&gt;</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Por ejemplo:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">function</span><span class="w"> </span><span class="nx">Get-PSMultiplication</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="kr">param</span><span class="w"> </span><span class="p">([</span><span class="n">int</span><span class="p">]</span><span class="nv">$num1</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">int</span><span class="p">]</span><span class="nv">$num2</span><span class="p">)</span><span class="w">
  </span><span class="kr">return</span><span class="w"> </span><span class="nv">$num1</span><span class="o">*</span><span class="nv">$num2</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-PSMultiplication</span><span class="w"> </span><span class="nx">2</span><span class="w"> </span><span class="nx">10</span><span class="w">
</span><span class="mi">20</span><span class="w">
</span></code></pre></div></div>

<p>En cualquier caso, a la hora de llamar a una función, los parámetros siempre se introducen como argumentos a la hora de llamarla.</p>

<p><br /></p>

<p><strong>Ejercicios</strong></p>

<p>Sobre el siguente bloque de código:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Get-PSMath
{
  param ([int]$num1, [int]$num2, [string]$str1)
  if($str1 -eq "*")
  {
    return $num1*$num2
  }
  else if($str1 -eq "+")
  {
    return $num1+$num2
  }
  else if($str1 -eq "/")
  {
    return $num1/$num2
  }
  else if($str1 -eq "-")
  {
    return $num1-$num2
  }
  else
  {
    break
  }
}
</code></pre></div></div>

<p>¿Cuántos parámetros contiene la función anterior?: 3
¿Qué generará el siguiente comando, Get-PSMath 2 10 +, Get-PSMath 10 5 !?: 12, una línea en blanco.</p>

<p><br /></p>

<h5 id="343-scripts-modulos">3.4.3. Scripts, Modulos.</h5>

<p><strong>Definición y política de restricción.</strong></p>

<p>Los scripts en powershell son ficheros <em>.ps1</em>. PowerShell mantiene una política de restricción en contra de la ejecución de scripts como medida de seguridad.</p>

<p>Podemos ver el status de esta medida con el siguiente comando:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Users\User</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-ExecutionPolicy</span><span class="w">
</span><span class="n">Restricted</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Users\User</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">C:\Users\User\Desktop\computerInfo.ps1</span><span class="w">
</span><span class="n">C:\Users\User\Desktop\computerInfo.ps1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">File</span><span class="w"> </span><span class="nx">C:\Users\User\Desktop\computerInfo.ps1</span><span class="w"> </span><span class="nx">cannot</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">loaded</span><span class="w">
</span><span class="n">because</span><span class="w"> </span><span class="nx">running</span><span class="w"> </span><span class="nx">scripts</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">disabled</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">this</span><span class="w"> </span><span class="nx">system.</span><span class="w"> </span><span class="nx">For</span><span class="w"> </span><span class="nx">more</span><span class="w"> </span><span class="nx">information</span><span class="p">,</span><span class="w"> </span><span class="nx">see</span><span class="w"> </span><span class="nx">about_Execution_Policies</span><span class="w"> </span><span class="nx">at</span><span class="w">
</span><span class="n">https:/go.microsoft.com/fwlink/</span><span class="nf">?</span><span class="nx">LinkID</span><span class="o">=</span><span class="nx">135170.</span><span class="w">
</span></code></pre></div></div>

<p>Generalmente esta configuración no se puede cambiar a no ser que seamos administradores. Sin embargo, existen otras configuraciones y comandos que nos pueden introducir:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Users\vandelay</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">powershell.exe</span><span class="w"> </span><span class="nt">-exec</span><span class="w"> </span><span class="nx">bypass</span><span class="w"> </span><span class="nx">C:\Users\vandelay\Desktop\computerInfo.ps1</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<p><strong>Comentarios</strong></p>

<p>Los comentarios se indican con un hastag ‘#’.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># This is a single line comment. The interpreter will ignore this comment.</span><span class="w">

</span><span class="cm">&lt;#
  This is a multi-line comment or a comment code block.
  Every line within this section will be ignored by the interpreter
#&gt;</span><span class="w">

</span><span class="c"># The following function takes in two integers (num1 and num2) as input, multiplies them together, and outputs the total.</span><span class="w">

</span><span class="kr">function</span><span class="w"> </span><span class="nf">Get-PSMultiplication</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="kr">param</span><span class="w"> </span><span class="p">([</span><span class="n">int</span><span class="p">]</span><span class="nv">$num1</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">int</span><span class="p">]</span><span class="nv">$num2</span><span class="p">)</span><span class="w">
  </span><span class="kr">return</span><span class="w"> </span><span class="nv">$num1</span><span class="o">*</span><span class="n">num2</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<p><strong>Modulos</strong></p>

<p>Los módulos de PowerShell son esencialmente paquetes que contienes cmdlets adicionales, funciones, providers, etc. Estos son generalmente importados a una sesión concreta de PowerShell dando acceso al usuario a nueva funcionalidad.</p>

<p>Una forma de listar los modulos es con <em>Get-Module</em>:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-Module</span><span class="w"> </span><span class="nt">-ListAvailable</span><span class="w">

    </span><span class="n">Directory:</span><span class="w"> </span><span class="nx">C:\Program</span><span class="w"> </span><span class="nx">Files\WindowsPowerShell\Modules</span><span class="w">

</span><span class="n">ModuleType</span><span class="w"> </span><span class="nx">Version</span><span class="w">    </span><span class="nx">Name</span><span class="w">                                </span><span class="nx">ExportedCommands</span><span class="w">
</span><span class="o">----------</span><span class="w"> </span><span class="o">-------</span><span class="w">    </span><span class="o">----</span><span class="w">                                </span><span class="o">----------------</span><span class="w">
</span><span class="n">Script</span><span class="w">     </span><span class="nx">1.0.1</span><span class="w">      </span><span class="nx">Microsoft.PowerShell.Operation.V...</span><span class="w"> </span><span class="p">{</span><span class="n">Get-OperationValidation</span><span class="p">,</span><span class="w"> </span><span class="nx">Invoke-OperationValidation</span><span class="p">}</span><span class="w">
</span><span class="n">Binary</span><span class="w">     </span><span class="nx">1.0.0.1</span><span class="w">    </span><span class="nx">PackageManagement</span><span class="w">                   </span><span class="p">{</span><span class="n">Find-Package</span><span class="p">,</span><span class="w"> </span><span class="nx">Get-Package</span><span class="p">,</span><span class="w"> </span><span class="nx">Get-PackageProvider</span><span class="p">,</span><span class="w"> </span><span class="nx">Get-Packa...</span><span class="w">
</span><span class="n">Script</span><span class="w">     </span><span class="nx">3.4.0</span><span class="w">      </span><span class="nx">Pester</span><span class="w">                              </span><span class="p">{</span><span class="n">Describe</span><span class="p">,</span><span class="w"> </span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">It</span><span class="p">,</span><span class="w"> </span><span class="nx">Should...</span><span class="p">}</span><span class="w">
</span><span class="n">Script</span><span class="w">     </span><span class="nx">1.0.0.1</span><span class="w">    </span><span class="nx">PowerShellGet</span><span class="w">                       </span><span class="p">{</span><span class="n">Install-Module</span><span class="p">,</span><span class="w"> </span><span class="nx">Find-Module</span><span class="p">,</span><span class="w"> </span><span class="nx">Save-Module</span><span class="p">,</span><span class="w"> </span><span class="nx">Update-Module...</span><span class="p">}</span><span class="w">
</span><span class="n">Script</span><span class="w">     </span><span class="nx">2.0.0</span><span class="w">      </span><span class="nx">PSReadline</span><span class="w">                          </span><span class="p">{</span><span class="n">Get-PSReadLineKeyHandler</span><span class="p">,</span><span class="w"> </span><span class="nx">Set-PSReadLineKeyHandler</span><span class="p">,</span><span class="w"> </span><span class="nx">Remov...</span><span class="w">

    </span><span class="n">Directory:</span><span class="w"> </span><span class="nx">C:\Windows\system32\WindowsPowerShell\v1.0\Modules</span><span class="w">

</span><span class="n">ModuleType</span><span class="w"> </span><span class="nx">Version</span><span class="w">    </span><span class="nx">Name</span><span class="w">                                </span><span class="nx">ExportedCommands</span><span class="w">
</span><span class="o">----------</span><span class="w"> </span><span class="o">-------</span><span class="w">    </span><span class="o">----</span><span class="w">                                </span><span class="o">----------------</span><span class="w">
</span><span class="n">Manifest</span><span class="w">   </span><span class="nx">1.0.0.0</span><span class="w">    </span><span class="nx">AppBackgroundTask</span><span class="w">                   </span><span class="p">{</span><span class="n">Disable-AppBackgroundTaskDiagnosticLog</span><span class="p">,</span><span class="w"> </span><span class="nx">Enable-AppBackgro...</span><span class="w">
</span><span class="n">Manifest</span><span class="w">   </span><span class="nx">2.0.0.0</span><span class="w">    </span><span class="nx">AppLocker</span><span class="w">                           </span><span class="p">{</span><span class="n">Get-AppLockerFileInformation</span><span class="p">,</span><span class="w"> </span><span class="nx">Get-AppLockerPolicy</span><span class="p">,</span><span class="w"> </span><span class="nx">New-Ap...</span><span class="w">
</span><span class="n">Manifest</span><span class="w">   </span><span class="nx">1.0.0.0</span><span class="w">    </span><span class="nx">AppvClient</span><span class="w">                          </span><span class="p">{</span><span class="n">Add-AppvClientConnectionGroup</span><span class="p">,</span><span class="w"> </span><span class="nx">Add-AppvClientPackage</span><span class="p">,</span><span class="w"> </span><span class="nx">Add...</span><span class="w">
</span><span class="n">Manifest</span><span class="w">   </span><span class="nx">2.0.1.0</span><span class="w">    </span><span class="nx">Appx</span><span class="w">                                </span><span class="p">{</span><span class="n">Add-AppxPackage</span><span class="p">,</span><span class="w"> </span><span class="nx">Get-AppxPackage</span><span class="p">,</span><span class="w"> </span><span class="nx">Get-AppxPackageManifest...</span><span class="w">
</span><span class="n">Script</span><span class="w">     </span><span class="nx">1.0.0.0</span><span class="w">    </span><span class="nx">AssignedAccess</span><span class="w">                      </span><span class="p">{</span><span class="n">Clear-AssignedAccess</span><span class="p">,</span><span class="w"> </span><span class="nx">Get-AssignedAccess</span><span class="p">,</span><span class="w"> </span><span class="nx">Set-AssignedAcc...</span><span class="w">
</span><span class="o">...</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<p><strong>Get-Command</strong></p>

<p>Una vez hemos importado un modulo, hemos adquirido nuevas funcionalidades como comandos, etc. Podemos ver estas nuevas funcionalidades con <em>Get-Command</em></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-Command</span><span class="w"> </span><span class="nt">-Module</span><span class="w"> </span><span class="nx">Defender</span><span class="w">

</span><span class="n">CommandType</span><span class="w">     </span><span class="nx">Name</span><span class="w">                          </span><span class="nx">Version</span><span class="w">    </span><span class="nx">Source</span><span class="w">
</span><span class="o">-----------</span><span class="w">     </span><span class="o">----</span><span class="w">                          </span><span class="o">-------</span><span class="w">    </span><span class="o">------</span><span class="w">
</span><span class="kr">Function</span><span class="w">        </span><span class="nf">Add-MpPreference</span><span class="w">              </span><span class="mf">1.0</span><span class="w">        </span><span class="n">defender</span><span class="w">
</span><span class="nx">Function</span><span class="w">        </span><span class="nx">Get-MpComputerStatus</span><span class="w">          </span><span class="nx">1.0</span><span class="w">        </span><span class="nx">defender</span><span class="w">
</span><span class="kr">Function</span><span class="w">        </span><span class="nf">Get-MpPreference</span><span class="w">              </span><span class="mf">1.0</span><span class="w">        </span><span class="n">defender</span><span class="w">
</span><span class="nx">Function</span><span class="w">        </span><span class="nx">Get-MpThreat</span><span class="w">                  </span><span class="nx">1.0</span><span class="w">        </span><span class="nx">defender</span><span class="w">
</span><span class="kr">Function</span><span class="w">        </span><span class="nf">Get-MpThreatCatalog</span><span class="w">           </span><span class="mf">1.0</span><span class="w">        </span><span class="n">defender</span><span class="w">
</span><span class="nx">Function</span><span class="w">        </span><span class="nx">Get-MpThreatDetection</span><span class="w">         </span><span class="nx">1.0</span><span class="w">        </span><span class="nx">defender</span><span class="w">
</span><span class="kr">Function</span><span class="w">        </span><span class="nf">Remove-MpPreference</span><span class="w">           </span><span class="mf">1.0</span><span class="w">        </span><span class="n">defender</span><span class="w">
</span><span class="nx">Function</span><span class="w">        </span><span class="nx">Remove-MpThreat</span><span class="w">               </span><span class="nx">1.0</span><span class="w">        </span><span class="nx">defender</span><span class="w">
</span><span class="kr">Function</span><span class="w">        </span><span class="nf">Set-MpPreference</span><span class="w">              </span><span class="mf">1.0</span><span class="w">        </span><span class="n">defender</span><span class="w">
</span><span class="nx">Function</span><span class="w">        </span><span class="nx">Start-MpScan</span><span class="w">                  </span><span class="nx">1.0</span><span class="w">        </span><span class="nx">defender</span><span class="w">
</span><span class="kr">Function</span><span class="w">        </span><span class="nf">Start-MpWDOScan</span><span class="w">               </span><span class="mf">1.0</span><span class="w">        </span><span class="n">defender</span><span class="w">
</span><span class="nx">Function</span><span class="w">        </span><span class="nx">Update-MpSignature</span><span class="w">            </span><span class="nx">1.0</span><span class="w">        </span><span class="nx">defender</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<p><strong>Exercises</strong></p>

<p>¿Cuál es la primera función listada alfabéticamente disponible a través del módulo BitLocker?:</p>

<p>Import-Module BitLocker; Get-Command -Module BitLocker</p>

<p>Add-BitLockerKeyProtector</p>

<p><br /></p>

<p>¿Cuál es la primera entrada después de ejecutar Get-ChildItem en el proveedor de certificados en LocalMachine?</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cd</span><span class="w"> </span><span class="nx">Cert:\LocalMachine\</span><span class="p">;</span><span class="w"> </span><span class="n">Get-ChildItem</span><span class="w">
</span></code></pre></div></div>

<p>TestSignRoot</p>

<p><br /></p>

<p>¿Qué cmdlet podríamos usar para que PowerShell lea en un archivo CSV (valores separados por comas)?</p>

<p>Import-CSV</p>

<p><br /></p>

<h4 id="35-challenge-exercises">3.5. Challenge Exercises.</h4>

<p><strong>1. Las credenciales de inicio de sesión automático a veces se pueden almacenar en ciertos lugares dentro del disco duro. Como operador ofensivo, esta es una excelente manera de obtener persistencia. Encuentre todas las credenciales de inicio de sesión automático obteniendo la propiedad del elemento de “HKLM:\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon” y mostrando los valores “DefaultDomainName” y “DefaultUserName”.</strong></p>

<p>Como vemos en el enunciado, existen credenciales de autologeo, estas credenciales permiten al usuario que tiene propiedad sobre ellas logearse en el equipo sin necesidad de autenticarse.</p>

<p>Tal y como comenta el enunciado, podemos tener acceso a todas estas claves utilizando el cmdlet Get-ItemProperty sobre Winlogon en el registro clave de la máquina local o HKLM:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-ItemProperty</span><span class="w"> </span><span class="nt">-path</span><span class="w"> </span><span class="s2">"HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">DefaultDomainName</span><span class="p">,</span><span class="nx">DefaultUserName</span><span class="p">,</span><span class="nx">PSDrive</span><span class="w">
</span></code></pre></div></div>

<p>Como el output no despliega ningún usuario en ningún dominio, asumimos que esta máquina no tiene claves de autologeo.</p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020221211012345.png" text-align="center" />
</div>

<p><br /></p>

<p><strong>2. Encontrar los SID del usuario puede ser una buena información por varias razones. Utilice PowerShell para encontrar el SID del administrador. Asegúrate de incluir toda la cadena.</strong></p>

<p>El SID es un identificador de seguridad, un número que se asigna a cada usuario en la máquina windows. Se trata por tanto de una propiedad de un usuario local y para acceder a ella vamos a utilizar el cmdlet <em>Get-LocalUser</em>; este es un cmdlet que permite acceder a los objetos usuarios locales de la máquina:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-LocalUser</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"Administrator"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">Name</span><span class="p">,</span><span class="nx">SID</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020221211013102.png" text-align="center" />
</div>

<p><br /></p>

<p><strong>3. Identificar si un antivirus está instalado y qué versiones son es una habilidad crucial como operador ofensivo. Desde el lado defensivo o administrativo, es una buena información que ayuda a identificar brechas de seguridad. ¿Cuál es el estado del producto del antivirus instalado?</strong></p>

<p>Para este ejercicio vamos a utilizar el cmdlet Get-CIMInstance. Este es un cmdlet que extrae información sobre un servidor CIM (Common Information Model), este último es un modelo de datos orientado a objetos que con frecuencia contiene información de distintas partes de un sistema o una empresa como por ejemplo un antivirus, que puede ser software interno o de terceros.</p>

<p>El CIM se organiza por su parte en ‘namespace’, los cuales son directorios lógicos organizados en un sistema de ficheros.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-CimInstance</span><span class="w"> </span><span class="nt">-Namespace</span><span class="w"> </span><span class="nx">root/SecurityCenter2</span><span class="w"> </span><span class="nt">-ClassName</span><span class="w"> </span><span class="nx">AntivirusProduct</span><span class="w">
</span></code></pre></div></div>

<p>En el comando anterior podemos ver por tanto que estamos buscando en root/SecurityCenter2 la clase AntivirusProduct:</p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020221211015927.png" text-align="center" />
</div>

<p><br /></p>

<p><strong>4. En formato de tabla, muestre los procesos e incluya CommandLine, ProcessName y SessionID. Filtre para mostrar SessionID de 2 y ProcessName de “svchost.exe” solamente. Ordene los resultados alfabéticamente por CommandLine. La primera fila tendrá un comando “SvcGroup” diferente. Envíe el valor completo de la propiedad CommandLine de ese proceso.</strong></p>

<p>En primer lugar, podemos intentar utilizar el cmdlet Get-Process, a la vista de que este lista los procesos del sistema</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-Process</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nx">CommandLine</span><span class="p">,</span><span class="nx">SessionID</span><span class="p">,</span><span class="nx">ProcessName</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="bp">$_</span><span class="o">.</span><span class="nf">SessionID</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-And</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">ProcessName</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"svchost"</span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sort-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">CommandLine</span><span class="w"> </span><span class="nt">-Descending</span><span class="w">
</span></code></pre></div></div>

<p>Esta, en teoría lista todos los procesos, segudamente selecciona las propiedades CommandLine, SessionID y ProcessName, seguidamente, se queda con aquellas lineas donde Session ID coincida con 2 y ProcessName coincida con “svchost” y ordena por orden alfabéticamente descendente las líneas a partir de la propiedad CommandLine.</p>

<p>Sin embargo, esta línea no despliega un output que contenga CommandLine:</p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020221211121243.png" text-align="center" />
</div>

<p>Así, tenemos que buscar otra forma de listar los procesos. Buscando en internet podemos encontrar que el CmdLet, Get-CimInstance Win32_Process lista todos los procesos del sistema:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-CimInstance</span><span class="w"> </span><span class="nx">Win32_Process</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nx">CommandLine</span><span class="p">,</span><span class="nx">SessionID</span><span class="p">,</span><span class="nx">ProcessName</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="bp">$_</span><span class="o">.</span><span class="nf">SessionId</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">ProcessName</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"svchost.exe"</span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sort-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">CommandLine</span><span class="w"> </span><span class="nt">-Descending</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020221211122437.png" text-align="center" />
</div>

<p>Como está organizado de forma descendente, el comando pedido es el último.</p>

<p><br /></p>

<p><strong>5. Cuente la cantidad de tareas programadas con la ruta del directorio “\Microsoft” (para incluir todos los subdirectorios) y en el state “Ready”.</strong></p>

<p>Para este ejercicio vamos a utillizar Get-ScheduledTask que muestra todas las tareas automatizadas que hay en el registro. Para ello empleamos el siguente comando:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-ScheduledTask</span><span class="w"> </span><span class="nt">-TaskPath</span><span class="w"> </span><span class="s2">"\Microsoft*"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">State</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"Ready"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Measure-Object</span><span class="w"> </span><span class="nt">-Line</span><span class="w">
</span></code></pre></div></div>

<p>Este lista todos los ScheduledTask que empiezen por \Microsoft (el asterisco es un término que se utiliza para designar que después puede ir cualquier cosa) y después se queda con todos aquellos que tengan el status “Ready” y por último cuenta las líneas.</p>

<p>Es importante ejecutar el comando como adminstrador ya que como el cmdlet trabaja con los permisos del usuario que lo lanza, es probable que haya secciones del registro al que un usuario normal no pueda acceder y que por tanto queden tareas sin listar.</p>

<p><br /></p>

<p><strong>Los servicios con rutas ejecutables sin comillas que se inician automáticamente pueden dar lugar a una escalada de privilegios. ¿Cuántos servicios se ajustan a esa descripción en esta máquina?</strong></p>

<p>En principio intentamos listar servicios con Get-Service pero este no muestra ninguna propiedad relacionada con un binario ejecutable o algo parecido.</p>

<p>Así , probamos a utilizar el cmdlet Get-WmiObject el cual nos permite listar objetos pertenicientes a una determinada clase, entre las clases listables se encuentra Win32_Service. Primero, listamos todas las propiedades de los objetos con:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-WmiObject</span><span class="w"> </span><span class="nx">Win32-Service</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></code></pre></div></div>

<p>Observamos que entre las propiedades que se listan hay una que se denomina “PathName” y que tiene elpath al ejecutable del servicio. Despúes de realizar diversas pruebas el comando a emplear es:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-WmiObject</span><span class="w"> </span><span class="nx">Win32_Service</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nx">Name</span><span class="p">,</span><span class="nx">StartMode</span><span class="p">,</span><span class="nx">PathName</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="bp">$_</span><span class="o">.</span><span class="nf">StartMode</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"Auto"</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">PathName</span><span class="w"> </span><span class="o">-NotMatch</span><span class="w"> </span><span class="s1">'"'</span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Measure-Object</span><span class="w"> 
</span></code></pre></div></div>

<p>Este comando lista los servicios de windows, muestra las propiedaes Name, StartMode, PathName pero filtra todo lo que no coincida con StartMode = Auto y todo aquello que tenga comillas.</p>

<p><br /></p>

<p><strong>Con los resultados de la pregunta 6 (antes de contar los objetos), ajuste su solución agregando las propiedades Name y DisplayName, y ordene los resultados alfabéticamente en orden descendente según la propiedad “Name”. La respuesta son los valores de las propiedades First Name y DisplayName del servicio que comienzan con la letra “p”.</strong></p>

<p>Ajustamos el comando anterior para que quede como sigue:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-WmiObject</span><span class="w"> </span><span class="nx">Win32_Service</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nx">Name</span><span class="p">,</span><span class="nx">DisplayName</span><span class="p">,</span><span class="nx">StartMode</span><span class="p">,</span><span class="nx">PathName</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="bp">$_</span><span class="o">.</span><span class="nf">StartMode</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"Auto"</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">PathName</span><span class="w"> </span><span class="o">-NotMatch</span><span class="w"> </span><span class="s1">'"'</span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sort-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">Name</span><span class="w"> </span><span class="nt">-Descending</span><span class="w">
</span></code></pre></div></div>

<p>Este comando es similar al anterior salvo que muestra también la propiedad DisplayName y ordena los elementos alfábéticamente descendiente, el primer servicio que tiene en común que Name y Display Name empieza por ‘p’ es Power. Por tanto la respuesta es Power,Power.</p>

<p><br /></p>

<p><strong>Hay un usuario que inició sesión. Use PowerShell para encontrar el valor de PrimaryOwnerName del usuario.</strong></p>

<p>Podemos listar la clase Win32_ComputerSystem que lista los ordenadores que están conectados al sistema, al lista todas las propiedades obtenemos:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-CimInstance</span><span class="w"> </span><span class="nt">-ClassName</span><span class="w"> </span><span class="nx">Win32_ComputerSystem</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020221211181026.png" text-align="center" />
</div>

<p><br /></p>

<p><strong>Obtener hashes de archivos es extremadamente importante para defensores y analistas forenses. Hay un archivo ubicado en C:\Windows\System32 (no subdirectorios) con un hash MD5 de “6CECC33A62E935F5E8665B9597479A36”. ¿Cuál es el nombre del archivo (incluya la extensión)?</strong></p>

<p>Para desarrollar esta tarea vamos a utilizar el siguiente script:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$Files</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">PSIsContainer</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">Name</span><span class="p">)</span><span class="w"> 

</span><span class="nv">$Flaghash</span><span class="o">=</span><span class="s2">"6CECC33A62E935F5E8665B9597479A36"</span><span class="w">

</span><span class="kr">for</span><span class="w"> </span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span><span class="o">-le</span><span class="w"> </span><span class="nv">$Files</span><span class="o">.</span><span class="nf">Length</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="o">++</span><span class="p">){</span><span class="w">
    </span><span class="nv">$File</span><span class="o">=</span><span class="nv">$files</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w">
    </span><span class="nv">$Path</span><span class="o">=</span><span class="s2">"C:\WINDOWS\system32\"</span><span class="o">+</span><span class="nv">$File</span><span class="w">
    </span><span class="nv">$Hash</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">Get-FileHash</span><span class="w"> </span><span class="nv">$Path</span><span class="w"> </span><span class="nt">-Algorithm</span><span class="w"> </span><span class="nx">MD5</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">Hash</span><span class="w"> </span><span class="p">)</span><span class="w">	
	</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$Hash</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="nv">$Flaghash</span><span class="p">){</span><span class="w">
		</span><span class="nv">$Files</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w"> 
	</span><span class="p">}</span><span class="w">
	</span><span class="kr">else</span><span class="w">
	</span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Veámos línea a línea lo que hace el script.</p>

<ul>
  <li>
    <p>La primera línea guarda en una variable el resultado de un comando que lista los contenidos del directorio actual, desecha los subdirectorios, y se queda con el string asociado al valor de la propiedad Name del fichero (es decir, crea una variable array que contiene los nombres de los ficheros del directorio actual). Especialemente relevante es el término -ExpandProperty que nos permite quedarnos sólo con el string, en lugar de quedarnos con la propiedad Name solamente como ocurriría con -Property solamente. Esto imposibilitaria la construcción del path que vamos a hacer acontinuación.</p>
  </li>
  <li>
    <p>La segunda línea guarda en una variable el contenido del fichero cuyo nombre queremos.</p>
  </li>
  <li>
    <p>La tercera implementa el inicio de un bucle for que esencialmente construye un path para cada nombre del fichero contenido en el array anterior y extrae el hash del contenido de dicho fichero y compara este hash con nuestra flag. Si hay un match despliega el nombre del fichero que es lo que pide el ejercicio. Observemos que para comprar los hashes hemos vuelto a utilizar -ExpandProperty y que para formar el path hemos utilizado el operador ‘+’ con dos strings.</p>
  </li>
</ul>

<p><br /></p>

<p><strong>Consultar archivos en busca de cadenas o caracteres es una habilidad invaluable que se puede aplicar en una variedad de campos dentro de la seguridad de la información y la informática en general. Hay un archivo .txt ubicado en C:\Windows\System32 (incluye subdirectorios) que contiene la cadena “contraseña”. Encuentre el archivo y recupere el contenido del archivo para obtener la bandera. Según el comando, puede tardar uno o dos minutos. Si lleva más de tres minutos, deberíamos considerar volver a evaluar nuestra solución.</strong></p>

<p>Para realizar esta tarea vamos a utilizar el siguiente script:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$Files</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Name</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s2">"txt"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">Name</span><span class="p">)</span><span class="w"> 

</span><span class="kr">for</span><span class="w"> </span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="nv">$files</span><span class="o">.</span><span class="nf">Length</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="o">++</span><span class="p">){</span><span class="w">
    </span><span class="nv">$File</span><span class="o">=</span><span class="nv">$Files</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w">
    </span><span class="nv">$Path</span><span class="o">=</span><span class="s2">"C:\WINDOWS\system32\"</span><span class="o">+</span><span class="nv">$File</span><span class="w">
    </span><span class="nv">$Pattern</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">Get-Content</span><span class="w"> </span><span class="nv">$Path</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-String</span><span class="w"> </span><span class="nt">-Pattern</span><span class="w"> </span><span class="s2">"password"</span><span class="w"> </span><span class="p">)</span><span class="w">	
	</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$Pattern</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="bp">$null</span><span class="p">){</span><span class="w">
		</span><span class="s2">"[+] "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$Path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">": "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="kr">type</span><span class="w"> </span><span class="nv">$Path</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-String</span><span class="w"> </span><span class="nt">-Pattern</span><span class="w"> </span><span class="s2">"password"</span><span class="p">)</span><span class="w">
	</span><span class="p">}</span><span class="w">
	</span><span class="kr">else</span><span class="w">
	</span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Este es producto de una reutilización del código del ejercicio anterior. De nuevo, vamos a desgranar el script línea a línea.</p>

<ul>
  <li>
    <p>La primera línea crea un array con los nombres de los ficheros que contienen el término ‘txt’ en el nombre. De nuevo, utilizamos el -ExpandProperty para quedarnos con el string del nombre en lugar de con la propiedad Name.</p>
  </li>
  <li>
    <p>La siguiente línea forma un bucle for que, para cada nombre, forma la ruta hasta el fichero y seguidamente busca entre sus contenidos el patrón ‘password’ y lo almacena en una variable. Si encuentra un match, la variable no estará vacía y nos dará la línea en la que a encontrado el match.</p>
  </li>
</ul>

<p><br /></p>

<h3 id="4-python-scripting-basics">4. Python Scripting Basics.</h3>

<p>Python es un lenguaje de programación orientado a la construcción de scripts (pequeños fragmentos de código).</p>

<p>Este es un tutorial realizado gracias a la guía de la web W3Schools cuyos scripts están ejecutados desde el sistema operativo Linux gracias al intérprete que viene por defecto. Si se quisiera repetir estos scripts en Windows haría falta descargarse el instalador del intérprete para Windows desde la página oficial de python.</p>

<p>(La diferencia entre un intérprete y un compilador es que un <strong>intérprete</strong> “interpreta” un programa para el procesador y por tanto se interpreta mientras se ejecuta y por otro lado un <strong>compilador</strong> genera un binario ejecutable a partir del código de un lenguaje de programación)</p>

<p>Para ejecutar un script de python se necesita pasar como argumento el fichero que contiene el código al comando que llama al intérprete de python.</p>

<p>En Linux casi siempre tenemos una utilidad de línea de comandos para utilizar Python, encontramos el intérprete de Python, Python2, Python2.7 y Python3.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span>python <span class="nt">-V</span>
Python 3.9.10
</code></pre></div></div>

<p>Recordamos que las distintas versiones de Python tienen asociada una sintaxis distinta.</p>

<p><br /></p>

<h4 id="41-variables-slicing-and-type-casting">4.1. Variables, Slicing, and Type Casting.</h4>

<p><strong>Primer script en Python.</strong></p>

<p>Un script de python debe de ser indicado el intérprete que va a utilizar ( a esta línea se la denomina shebang), ya sea Python, Python2 o Python3.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat </span>pythonsample.py
<span class="c">#!/usr/bin/python</span>
print<span class="o">(</span><span class="s2">"Scripting is fun!"</span><span class="o">)</span>
</code></pre></div></div>

<p>Seguidamente, le damos permisos de ejeución y lo ejecutamos, o bien como un binario normal, o bien a través de la utilidad de línea de comandos de Python:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span>./pythonsample.py
Scripting is fun!

kali@kali:~<span class="nv">$ </span>python pythonsample.py
Scripting is fun!
</code></pre></div></div>

<p><br /></p>

<p><strong>Setting Variables.</strong></p>

<p>Para setear una variable emplearemos el operador asignador (=)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat </span>variables.py
<span class="c">#!/usr/bin/python</span>

companyName <span class="o">=</span> <span class="s2">"Offensive Security"</span>

currentYear <span class="o">=</span> 2022

print<span class="o">(</span>companyName<span class="o">)</span>
print<span class="o">(</span>currentYear<span class="o">)</span>

kali@kali:~<span class="nv">$ </span>./variables.py
Offensive Security
2022
</code></pre></div></div>

<p>En el ejemplo anterior vemos como seteamos una variable ‘String’ y una variable ‘numérica’.</p>

<p><br /></p>

<p><strong>Data Types.</strong></p>

<p>Python es bastante indulgente cuando se trata de tipos de datos, especialmente cuando se compara con lenguajes de programación de nivel inferior. Las variables de Python se pueden convertir de un tipo de datos a otro en un proceso que llamamos <em>casting</em> que trataremos más adelante. Habiendo mencionado esto, sigue siendo importante tener una comprensión básica de los diferentes tipos de datos al crear scripts con Python.</p>

<p>Podemos investigar qué tipo de variable es una con la función <em>type()</em>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat </span>typeexample.py
<span class="c">#!/usr/bin/python</span>

a <span class="o">=</span> <span class="s2">"banana"</span>
print<span class="o">(</span>a<span class="o">)</span>
print<span class="o">(</span><span class="nb">type</span><span class="o">(</span>a<span class="o">))</span>

b <span class="o">=</span> 100

print<span class="o">(</span>b<span class="o">)</span>
print<span class="o">(</span><span class="nb">type</span><span class="o">(</span>b<span class="o">))</span>

kali@kali:~<span class="nv">$ </span>python typeexample.py
banana
&lt;class <span class="s1">'str'</span><span class="o">&gt;</span>
1337
&lt;class <span class="s1">'int'</span><span class="o">&gt;</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>Strings and Slicing</strong></p>

<p>Un string se puede convertir a un tipo de datos llamado <em>lista</em>. Las listas y las cadenas se pueden manipular y <em>dividir</em> utilizando algunos métodos diferentes. Cortar en Python es cuando cortamos una cadena o lista en secciones. Esto se hace para cortar solo las partes de una cadena que nos interesan.</p>

<p>Digamos que estamos escribiendo un script de Python para raspar un sitio web en busca de enlaces a otras páginas. Esta es una técnica muy útil para un pentester que espera obtener más información sobre un objetivo. Dentro del código HTML de la página que estamos raspando, cada etiqueta de anclaje HTML aparecerá así.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"https://www.offensive-security.com/blog"</span><span class="o">&gt;</span>Blog&lt;/a&gt;
</code></pre></div></div>

<p>Para poder trabajar con esto en nuestro script, solo querremos la parte de la URL de la etiqueta</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://www.offensive-security.com/blog
</code></pre></div></div>

<p>por lo que usaremos el corte de cadenas para extraer la URL. .</p>

<p>Como nota al margen, debido a que esta cadena contiene comillas (“), nos encontraremos con problemas si usamos la misma sintaxis que usamos anteriormente. En su lugar, usaremos comillas simples (‘) alrededor de la cadena. Contenido entre comillas simples no será interpretado.</p>

<p>Para entender el proceso descrito a continuación debemos antes entender que en Python, los strings son entendidos como ‘arrays’ de caracteres y dichos caracteres son accesibles como tal a través de un índice.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
string <span class="o">=</span> <span class="s2">"Hello, this is a string!"</span>

<span class="k">for </span>i <span class="k">in </span>range<span class="o">(</span>0,len<span class="o">(</span>string<span class="o">))</span>:
	print<span class="o">(</span>str<span class="o">(</span>string[i]<span class="o">))</span>
	<span class="nv">i</span><span class="o">=</span>i+1

root@kali:~# python3 script.py 
H
e
l
l
o
,
 

h
i
s
 
i
s
 
a
 
s

r
i
n
g
<span class="o">!</span>

</code></pre></div></div>

<p>De esta forma, una vez que hemos creado nuestra variable, podemos recortar los extremos de la cadena. Para hacer esto, necesitamos encontrar el índice de donde comienza la URL y el índice de donde termina.</p>

<p>Hay formas de encontrarlos automáticamente, pero para este ejemplo, solo contaremos. Necesitamos contar cada carácter hasta nuestra URL, siendo el primer carácter 0. La letra “h” en “https” está en el índice 9, así que ese es nuestro punto de partida. Si seguimos contando hasta el final de la URL, encontramos que la letra “g” en “Blog” al final de la URL está en el índice 47. Por lo tanto, queremos dividir la cadena desde el índice 9 hasta el índice 48 (índice 47 + 1), inclusive.</p>

<p>Con el índice del inicio y el final de nuestra URL, podemos separarlo de la cadena completa y almacenarlo en una variable llamada <em>url</em> usando la siguiente sintaxis.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat </span>tagslice.py
<span class="c">#!/usr/bin/python</span>

tag <span class="o">=</span> <span class="s1">'&lt;a href="https://www.offensive-security.com/blog"&gt;Blog&lt;/a&gt;'</span>
url <span class="o">=</span> tag[9:48]

print<span class="o">(</span>url<span class="o">)</span>

kali@kali:~<span class="nv">$ </span>python tagslice.py
https://www.offensive-security.com/blog
</code></pre></div></div>

<p>También podemos separar la URL de la etiqueta de anclaje HTML completa usando la función <em>index()</em> . Primero, averiguamos qué está siempre al comienzo de la cadena que queremos cortar. En este caso, sería “https”. Luego, necesitamos lo que vendrá después de la cadena que queremos cortar. En este caso, son las comillas dobles finales de la URL y un símbolo mayor que. Establezcámoslos como variables de cadena individuales.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat tagslice2.py
#!/usr/bin/python

tag = '&lt;a href="https://www.offensive-security.com/blog"&gt;Blog&lt;/a&gt;'
start = "http"
end = "\"&gt;"

print(tag.index(start))
print(tag.index(end))

kali@kali:~$ python tagslice2.py
9
48
</code></pre></div></div>

<p><br /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat tagslice3.py
#!/usr/bin/python

tag = '&lt;a href="https://www.offensive-security.com/blog"&gt;Blog&lt;/a&gt;'
start = "http"
end = "\"&gt;"
url = tag[tag.index(start):tag.index(end)]

print(url)

kali@kali:~$ python tagslice3.py
https://www.offensive-security.com/blog
</code></pre></div></div>

<p><br /></p>

<p><strong>Integers.</strong></p>

<p>Las variables Integer (o <em>int</em>) son las formas básicas de almacenar números enteros con un valor comparable. Las variables int generalmente se establecen asignando un número entero sin comillas a un nombre de variable. La diferencia entre un string y un entero es que un entero permite ser manejado mediante operaciones matemáticas mientras que el otro no, Python es muy exigente con el manejo y las operaciones que se hace con cada variable en función de</p>

<p>En el siguiente script, asignamos el valor de “750” a una variable llamada <em>myInt</em> , luego lo imprimimos en la terminal.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat intTest.py
#!/usr/bin/python
myInt = 750

print(myInt)

kali@kali:~$ python intTest.py
750
</code></pre></div></div>

<p>Como era de esperar, cuando ejecutamos el script, el resultado es “750”.</p>

<p>Si usa comillas para establecer un número en una variable, lo está configurando como un string en lugar de un integer. Esto puede dar lugar a fallos o errores si se realizan comparaciones. En el siguiente ejemplo, el uso de comillas cambia la forma en que Python interpreta el valor de la variable.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat intTest2.py
#!/usr/bin/python

myString = "750"
myInt = 750

print(myString)
print(myInt)
print(myInt + 1)
print(myString + 1)

kali@kali:~$ python intTest2.py
750
750
751
Traceback (most recent call last):
  File "/home/kali/intTest2.py", line 7, in &lt;module&gt;
    print(myString + 1)
TypeError: can only concatenate str (not "int") to str
</code></pre></div></div>

<p>Es interesante notar que la salida de dos de las cuatro funciones <em>print()</em> fue la misma, pero Python no pudo agregar una a “750” cuando ese valor era una cadena.</p>

<p>Es una excelente idea familiarizarse con la lectura de errores de salida, investigarlos y pensar en cómo podemos solucionarlos.</p>

<p><br /></p>

<p><strong>Float</strong></p>

<p>Si queremos que una variable contenga un número con un decimal, no podemos usar un número entero. En su lugar, necesitaremos usar un <em>Float</em> Lo bueno es que Python generalmente manejará esto por nosotros, y normalmente podemos tratar los flotantes de la misma manera que las variables enteras. </p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat floatTest.py
#!/usr/bin/python
a = 100

print(a)
print(type(a))

a = a + .5

print(a)
print(type(a))

kali@kali:~$ python floatTest.py
100
&lt;class 'int'&gt;
100.5
&lt;class 'float'&gt;
</code></pre></div></div>

<p>Python ha cambiado el entero a un flotante sin que el usuario tenga que interceder.</p>

<p><br /></p>

<p><strong>Boolean.</strong></p>

<p>Las variables booleanas almacenan un valor de objeto de “True” o “False”. Estos tipos de variables son útiles cuando se usan sentencias condicionales, pero lo abordaremos un poco más adelante. Por ahora, es importante comprender que estos no son valores de cadena de “Verdadero” o “Falso”. Examinemos un fragmento de código.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># this may be set from a user database or after authentication</span>
adminBool <span class="o">=</span> False

<span class="k">if</span> <span class="o">(</span>adminBool<span class="o">)</span>
   print<span class="o">(</span><span class="s2">"You are an admin!"</span><span class="o">)</span>
<span class="k">else
   </span>print<span class="o">(</span><span class="s2">"You are NOT an admin!"</span><span class="o">)</span>
</code></pre></div></div>

<p>Este fragmento incluye una declaración condicional, que trataremos más adelante en este tema. Por ahora, solo notaremos que dado que la variable <em>adminBool</em> es False, este script imprimiría “You are NOT admin!”.</p>

<p>Hasta ahora, hemos cubierto cadenas, variables numéricas y booleanos. Ahora examinemos una forma de cambiar los tipos de variables de uno a otro con un proceso llamado <em>casting</em>.</p>

<p>Notemos que mientras que ‘adminBool = False’ es una variable booleana, ‘adminBool = false’ no lo es, las mayúsculas importan.</p>

<p><br /></p>

<p><strong>Casting</strong></p>

<p>El <em>Casting</em> es una forma de convertir un tipo de variable en otro tipo en Python. Esto se puede hacer usando la función de conversión adecuada para modificar el tipo de variable a otro. Una razón para usar esto es al leer la entrada del usuario o los datos de una fuente externa, como un documento de texto o una página web.</p>

<p>Por ejemplo, digamos que tenemos dos cadenas que contienen números que queremos sumar. Esto ocurriría en un escenario donde estos números fueran parte de una cadena más larga que cortamos.</p>

<p>Si intentamos sumar estas variables, no recibiremos ningún error, pero el resultado también es inesperado.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat castTest.py
#!/usr/bin/python

numA = "86"
numB = "20"

print(type(numA))
print(type(numB))

print(numA + numB)

kali@kali:~$ python castTest.py
&lt;class 'str'&gt;
&lt;class 'str'&gt;
8620
</code></pre></div></div>

<p>El resultado muestra que concatenamos las cadenas en lugar de sumar los números, hemos sumado dos strings. Tendremos que convertir las cadenas en enteros antes de poder agregarlas, usando la función int(). Para simplificar, podemos hacer esto directamente en la función print() .</p>

<p>Cambiemos una línea en nuestro script y luego volvamos a ejecutarlo.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat castTest.py
#!/usr/bin/python

numA = "86"
numB = "20"

print(type(numA))
print(type(numB))

print(int(numA) + int(numB))

kali@kali:~$ python castTest.py
&lt;class 'str'&gt;
&lt;class 'str'&gt;
106
</code></pre></div></div>

<p>Esto también se puede hacer con la función str() para convertir un número entero o flotante en un tipo de datos de cadena. Modifiquemos el código ligeramente para demostrar esto.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat castTest.py
#!/usr/bin/python

numA = "86"
numB = "20"

print(type(numA))
print(type(numB))

newValue = int(numA) + int(numB)
print(newValue)
print(type(newValue))
print(type(str(newValue)))

kali@kali:~$ python castTest.py
&lt;class 'str'&gt;
&lt;class 'str'&gt;
106
&lt;class 'int'&gt;
&lt;class 'str'&gt;
</code></pre></div></div>

<p>Como se muestra en el resultado, la variable entera se transformó en una cadena con la función str().</p>

<p><br /></p>

<h4 id="42-list--dictionaries">4.2. List &amp; Dictionaries.</h4>

<p><strong>Python List.</strong></p>

<p>Una <em>lista</em> es un tipo de datos que contiene una o más variables en orden indexado que pueden ser del mismo tipo o de diferente tipo. Los diferentes tipos de variables pueden estar contenidos dentro de una lista o una lista puede incluso contener otras listas.</p>

<p>Podemos especificar una lista en Python usando corchetes.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat listTest.py
fruitList = ["apple", "banana", "orange"]

print(type(fruitList))

kali@kali:~$ python listTest.py
&lt;class 'list'&gt;
</code></pre></div></div>

<p>Como era de esperar, cuando verificamos el tipo de datos de la variable fruitList, mostramos que es una <em>lista</em>.</p>

<p>Cada elemento de la lista tiene un valor de índice correspondiente que representa su ubicación. En nuestro ejemplo anterior, “apple” tiene un índice de 0 y “banana” tendría un índice de 1. Si sabemos que un valor está contenido en la lista pero no sabemos el índice, podemos encontrarlo usando el lista <em>índice()</em> método.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat listTest2.py
#!/usr/bin/python

fruitList = ["apple", "banana", "orange"]

print(fruitList.index("orange"))

kali@kali:~$ python listTest2.py
2
</code></pre></div></div>

<p>Arriba, buscamos el índice que contenía el valor “naranja”. En este caso, el valor “naranja” tenía un índice de 2.</p>

<p>El método <em>index()</em> también es muy útil al dividir cadenas, que mencionamos anteriormente.</p>

<p>Si deseamos agregar un elemento a nuestra lista, podemos usar el método append().</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat listTest3.py
#!/usr/bin/python

fruitList = ["apple", "banana", "orange"]
fruitList.append("mango")

print(fruitList)

kali@kali:~$ python listTest3.py
["apple", "banana", "orange", "mango"]
</code></pre></div></div>

<p>En la lista anterior, agregamos el valor “mango” al final de la lista.</p>

<p>A la inversa, podemos eliminar elementos de una lista, de la misma manera, usando <em>remove()</em>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat listTest4.py
#!/usr/bin/python

fruitList = ["apple", "banana", "orange", "mango"]
fruitList.remove("mango")

print(fruitList)

kali@kali:~$ python listTest4.py
["apple", "banana", "orange"]
</code></pre></div></div>

<p>El ejemplo anterior muestra el valor “mango” que se elimina de la lista.</p>

<p>Si quisiéramos saber la cantidad de elementos en nuestra lista, podemos usar la función <em>len()</em> , que devolverá la cantidad de elementos que contiene nuestra lista.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat listTest5.py
#!/usr/bin/python

fruitList = ["apple", "banana", "orange"]

print(len(fruitList))

kali@kali:~$ python listTest5.py
3
</code></pre></div></div>

<p>La longitud de la lista en el Listado 27 es 3, porque hay 3 elementos en total en la lista.</p>

<p><br /></p>

<p><strong>Python Dictionaries.</strong></p>

<p>En Python, un <em>diccionario</em> es una estructura de datos que contiene uno o más pares del tipo: <em>clave-valor</em>.</p>

<p>Podemos usar corchetes para definir un nuevo diccionario y proporcionarle cualquier par clave-valor inicial.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>theOne = { 
    "firstName":"Thomas", 
    "lastName":"Anderson", 
    "occupation":"Programmer"
    }
</code></pre></div></div>

<p>Tenemos tres pares clave-valor dentro del diccionario <em>theOne</em>.</p>

<p>Para agregar una entrada a nuestro diccionario, simplemente podemos hacer referencia al diccionario con un índice de la clave que queremos agregar y definirlo como el valor que queremos establecer.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat dictTest.py
#!/usr/bin/python

theOne = { 
    "firstName":"Thomas", 
    "lastName":"Anderson", 
    "occupation":"Programmer"
    }
    
theOne["company"] = "MetaCortex"

print(theOne)

kali@kali:~$ python dictTest.py
{'firstName': 'Thomas', 'lastName': 'Anderson',  'occupation': 'Programmer', 'company': 'MetaCortex'}
</code></pre></div></div>

<p>En el bloque de código anterior, agregamos el par clave-valor de <em>company:MetaCortex</em> al final del diccionario <em>theOne</em>.</p>

<p>Hacemos referencia a un valor en nuestro diccionario por su clave.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat dictTest.py
#!/usr/bin/python

theOne = { 
    "firstName":"Thomas", 
    "lastName":"Anderson", 
    "occupation":"Programmer"
    "salary":2000
    }
    
theOne["company"] = "MetaCortex"

print(theOne["firstName"])

kali@kali:~$ python dictTest.py
Thomas
</code></pre></div></div>

<p>En el Listado 30, imprimimos el valor “Thomas” haciendo referencia a su clave de “firstName”.</p>

<p>Si queremos cambiar el valor de una clave existente, podemos especificar el nombre de la clave y el nuevo valor. La única diferencia entre agregar un nuevo par clave-valor y modificar uno es el hecho de que el par clave-valor ya existe en el diccionario.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat dictTest.py 
#!/usr/bin/python

theOne = {
        "firstName":"Thomas",
        "lastName":"Anderson",
        "occupation":"Programmer"
        }

theOne["company"] = "MetaCortex"

print(theOne)

theOne["occupation"] = "Superhero"

print(theOne)

kali@kali:~$ ./dictTest.py 
{'firstName': 'Thomas', 'lastName': 'Anderson', 'occupation': 'Programmer', 'company': 'MetaCortex'}
{'firstName': 'Thomas', 'lastName': 'Anderson', 'occupation': 'Superhero', 'company': 'MetaCortex'}
</code></pre></div></div>

<p>El valor de la clave etiquetada como “ocupación” se cambió de “Programador” a “Superhéroe”.</p>

<p>También podemos recuperar una lista de claves almacenadas en un diccionario usando el método <em>keys()</em> .</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat dictTest.py
#!/usr/bin/python

theOne = { 
    "firstName":"Thomas", 
    "lastName":"Anderson", 
    "occupation":"Programmer"
    }
    
theOne["company"] = "MetaCortex"

print(theOne.keys())

kali@kali:~$ python dictTest.py
dict_keys(['firstName', 'lastName', 'occupation', 'company'])
</code></pre></div></div>

<p><br /></p>

<h4 id="43-loops-logic--user-input">4.3. Loops, Logic &amp; User Input.</h4>

<p>La programación en bucle es una forma de iterar en un estado condicional o estructura de datos. Python tiene dos tipos de métodos de bucle: <em>for</em> y <em>while</em>.</p>

<p><strong>Loop While</strong></p>

<p>Un bucle <em>while</em> repetirá un bloque de código siempre que una declaración condicional se evalúe como ‘True’ (valor booleano). En el siguiente ejemplo, establecemos una variable <em>i</em> en 0. Luego comenzamos nuestro bucle <em>while</em> con la condición de que <em>i</em> sea menor que 10. Cada ejecución del bloque de código imprime el valor actual de <em>i</em> y luego incrementa i en 1. Esto es evidente con el enunciado <em>i += 1</em>, que es lo mismo que <em>i = i + 1</em>. El símbolo <em>+=</em> es un operador de asignación. Si olvidamos incrementar nuestra variable de contador, esto se ejecutará hasta que el script se elimine manualmente.</p>

<p>La sintaxis de los bucles es importante en Python. Tenga en cuenta que la declaración de bucle tiene dos puntos (:) al final de la línea. Luego, esto es seguido por instrucciones ‘sangradas’ para completar en el ciclo debajo de esa instrucción de ciclo. Cuando una instrucción no está correctamente sangrada (desplazada verticalmente de forma que quede dentro de la instrucción superior que define el bucle), Python lo interpreta como una instrucción fuera del ciclo. Examinemos el siguiente código:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>i = 0
while i &lt; 10:
    print(i)
    i += 1
</code></pre></div></div>

<p>Ahora usemos un bucle while con las listas de Python. Consideremos el siguiente guión.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat whileList.py
#!/usr/bin/python

nameList = ["Sleepy", "Sneezy", "Happy", "Grumpy", "Bashful", "Dopey", "Doc"]

print(nameList)

kali@kali:~$ ./whileList.py
['Sleepy', 'Sneezy', 'Happy', 'Grumpy', 'Bashful', 'Dopey', 'Doc']
</code></pre></div></div>

<p>Puede que esto no parezca un ejercicio que valga la pena, pero vincular una declaración de bucle con listas puede tener un gran impacto en lo que se puede lograr con nuestros scripts. Tal como está, esta salida solo imprime los valores de la lista y no tenemos control sobre ninguno de esos valores.</p>

<p>Aunque aprendimos sobre la indexación en la sección de listas de Python, adoptemos un enfoque diferente sobre cómo podríamos iterar a través de la lista con índices en un bucle while. Obtengamos el número de valores en la lista nameList y luego iteremos a través de los valores para mostrar cada nombre en su propia línea.</p>

<p>El siguiente código se agrega al final del script mostrado anteriormente. Los comentarios se agregan usando el símbolo de libra o almohadilla (#) para proporcionar alguna aclaración sobre lo que hace cada línea.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Get the number of items in the list and store the value in a variable
nameListCount = len(nameList)
# Print a message with how many items are in the list
print("There are " + str(nameListCount) + " names in the name list.")

nameIndex = 0
while nameIndex &lt; nameListCount:
    # Print the index number
    print(nameIndex)
    # Print the name at the current index
    print(nameList[nameIndex])
    # Add 1 to the index value before the loop starts over
    nameIndex = nameIndex + 1 
</code></pre></div></div>

<p>Ahora que esto se agregó al final del script, ejecútelo para analizar lo que hace.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ ./whileList.py
['Sleepy', 'Sneezy', 'Happy', 'Grumpy', 'Bashful', 'Dopey', 'Doc']
There are 7 names in the name list.
0
Sleepy
1
Sneezy
2
Happy
3
Grumpy
4
Bashful
5
Dopey
6
Doc
</code></pre></div></div>

<p>En el resultado anterior, se muestra en el terminal la lista y un mensaje con el número de nombres. Luego, la lista se repite para mostrar el índice y el nombre respectivos.</p>

<p>Por supuesto, en la implementación, nos gustaría eliminar los índices, la lista y posiblemente incluso el mensaje que indica cuántos nombres hay en la lista. Hicimos esto para mostrar cómo se puede usar el bucle while para separar valores en la lista y profundizaremos en este concepto más adelante en este tema. Ahora que cubrimos un ciclo <em>while</em> , pasemos a un ciclo <em>for</em>.</p>

<p><br /></p>

<p><strong>Bucle For</strong></p>

<p>Un bucle <em>for</em> repetirá un bloque de código tantas veces como se especifique. Cada iteración almacenará el valor actual de la secuencia en una variable temporal y ejecutará el bloque de código en consecuencia. En el siguiente ejemplo, usamos el comando <em>range</em>. </p>

<p>Para crear una lista que contiene los números del 0 al 9. La primera iteración de este bucle establecerá la variable temporal <em>i</em> en 0 y luego ejecutará el bloque de código. Luego establecerá <em>i</em> en 1 y ejecutará el bloque de código nuevamente. Esto se repetirá hasta que se agote el rango. Observe que no hay necesidad de incrementar el contador. Esta es una característica de un bucle <em>for .</em> Como se muestra arriba, con el while loop ‘i’ incrementa por una instrucción dentro del propio código (nameIndex = nameIndex + 1). Con el bucle <em>for</em>, este proceso de incrementación está</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat forLoop.py
#!/usr/bin/python

for i in range(10):
   print(i)

kali@kali:~$ ./forLoop.py
0
1
2
3
4
5
6
7
8
9
</code></pre></div></div>

<p>Tenga en cuenta que hay 10 iteraciones en el bucle. Tenga en cuenta que el índice comienza en 0 y la función de <em>rango</em> también comienza en el índice 0 de forma predeterminada. Podemos modificar la forma en que esto funciona modificando también los valores de inicio, parada y paso del rango. La sintaxis para esto es <em>range(start, stop, step)** . El parámetro de </em>start<em> se usa para especificar en qué posición queremos que comience el conteo de bucles. El parámetro de </em>stop<em> se utiliza para especificar la posición final de las iteraciones. El parámetro de </em>step* se usa para designar cuántos se agregarán en cada iteración. El valor predeterminado para esto es 1. Cambiemos el programa para que comience en 10, finalice en 20 y use el conteo de pasos de 2.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat forLoop.py
#!/usr/bin/python

for i in range(10,20,2):
   print(i)

kali@kali:~$ ./forLoop.py
10
12
14
16
18
</code></pre></div></div>

<p>Como se muestra en el ejemplo anterior, los valores se contaron de 2 en 2. Este fue el impacto del parámetro de paso. El rango comenzaba en 10 pero no mostraba el valor de 20. Este es el mismo concepto que se muestra en el ejemplo del guión original, donde no se alcanza la posición final.</p>

<p>También podemos hacer más con bucles. Sigamos trabajando con el bucle <em>for</em> para demostrar cómo podemos hacer referencia a los elementos del diccionario en un bucle.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat forDictionary.py
#!/usr/bin/python

guts = {
	"Name":"Guts",
	"Personality":"gruff",
	"Weapon":"Dragon Slayer",
	"Armor":"Berserker Armor"
	}

print(guts)

kali@kali:~$ ./forDictionary.py
{'Name': 'Guts', 'Personality': 'gruff', 'Weapon': 'Dragon Slayer', 'Armor': 'Berserker Armor'}
</code></pre></div></div>

<p>Anteriormente, cubrimos mostrar cada una de las calves con la función <em>keys()</em>. Repitamos con un bucle ’for’ para enumerar cada uno de los pares clave-valor en líneas separadas (en lugar de mostrar el diccionario completo como se muestra en la lista anterior). Para hacer esto, agregaremos el siguiente código en la parte inferior del script <strong>forDictionary.py</strong> .</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for key in guts.keys():
    print(key + ": " + guts[key])
</code></pre></div></div>

<p>Con el código anterior agregado, ejecutemos el script.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ ./forDictionary.py
{'Name': 'Guts', 'Personality': 'gruff', 'Weapon': 'Dragon Slayer', 'Armor': 'Berserker Armor'}
Name: Guts
Personality: gruff
Weapon: Dragon Slayer
Armor: Berserker Armor
</code></pre></div></div>

<p>Como era de esperar, iteramos a través de cada par clave-valor e imprimimos la clave, seguida de dos puntos (:) y un espacio, y finalmente el valor asociado de la clave. Esto ocurrió para cada par en una nueva línea hasta el final del diccionario.</p>

<p><br /></p>

<p><strong>Conditional Statements</strong></p>

<p>Al crear secuencias de comandos, puede haber secciones de código que queramos ejecutar en situaciones específicas. Para hacer esto más fácil, podemos usar <em>sentencias condicionales</em> como <em>if</em>,<em>elif</em> y <em>else</em> logic.</p>

<p>En las declaraciones <em>if</em> de Python , el uso de saltos de línea y tabulaciones cambia la forma en que se interpreta la lógica. Si una declaración <em>if</em> se evalúa como Verdadera, entonces el código que ejecutará se sangra debajo de la declaración condicional. Al igual que las declaraciones en bucle, se requieren dos puntos y una nueva línea después de la declaración condicional.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if numApples &gt; 100:
    print("That's a lot of apples!")
</code></pre></div></div>

<p>Siempre que el valor de <em>numApples</em> sea mayor que 100, el programa ejecutará la función de <em>print</em> ubicada dentro de la instrucción <em>if</em>.</p>

<p>Cuando la instrucción <em>if</em> se evalúa como ‘False’, se omite el bloque de código sangrado. Si tenemos una declaración condicional relacionada, podemos usar la declaración <em>elif</em> (abreviatura de “else if”). Se pueden agregar muchas declaraciones <em>elif</em> siempre que exista una declaración if inicial .</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if numApples &gt; 100:
    print("That's a lot of apples!")
elif numApples &gt; 50:
    print("That's a very good amount of apples")
elif numApples &gt; 30:
    print("That's a good amount of apples")
</code></pre></div></div>

<p>Si deseamos agregar un controlador para ejecutar si todas las declaraciones <em>if</em> y <em>elif</em> se evalúan como falsas, podemos usar la declaración <em>else</em>. Si todas las declaraciones <em>if</em> y <em>elif</em> anteriores se resuelven en falso, se ejecutará el código debajo de la declaración <em>else</em>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if numApples &gt; 100:
    print("That's a lot of apples!")
elif numApples &gt; 50:
    print("That's a very good amount of apples")
elif numApples &gt; 30:
    print("That's a moderate amount of apples")
else:
    print("Running low on apples!")
</code></pre></div></div>

<p>Establezcamos la variable <em>numApples</em> en varios números y revisemos los efectos al ejecutar el programa. La variable debe establecerse antes de las declaraciones condicionales.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>numApples = 150
</code></pre></div></div>

<p>Ahora vamos a ejecutar el script.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ ./appleStock.py
That's a lot of apples!
</code></pre></div></div>

<p>Cambiemos el valor una vez más. Esta vez, lo haremos en 15, que es menos que la última condición verificada de 30 manzanas.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>numApples = 15
</code></pre></div></div>

<p>Ejecutemos nuestro script nuevamente para verificar si la salida ha cambiado.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ ./appleStock.py
Running low on apples!
</code></pre></div></div>

<p>Ahora que hemos experimentado algunas declaraciones condicionales, practiquemos lo que hemos aprendido con algunos ejercicios.</p>

<p><br /></p>

<p><strong>User Input</strong></p>

<p>Si bien la configuración de nuestras variables dentro de nuestro script funcionó para lo que hemos cubierto hasta ahora, no hace que nuestro programa sea muy interactivo para el usuario. Solicitar al usuario que ingrese puede mejorar en gran medida la flexibilidad del programa y permitir que se ingresen diferentes variaciones como la variable bajo prueba. Consideremos el siguiente código.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat nameAge.py
#!/usr/bin/python

name = "Griffith"
age = 24

print("Hi " + name + "!")

if age &gt;= 100:
    print("You are over 100 years old? What's your secret?")
elif age &gt;= 70:
    print("You are over 70 years old? Are you retired or still working?")
elif age &gt;= 60:
    print("You are over 60 years old? Will you be retiring soon?")
elif age &gt;= 40:
    print("You are over 40 years old? What do you do for a living?")
elif age &gt;= 20:
    print("You are over 20 years old? What do you want to do for your career?")
elif age &gt;= 18:
    print("You are over 18 years old? That makes you a legal adult!")
else:
    print("It looks like you are under 18 years old.")
</code></pre></div></div>

<p>En el ejemplo anterior, creamos dos variables, ejecutamos una función <em>print()</em> y ejecutamos algunas declaraciones condicionales basadas en la variable <em>edad</em>.</p>

<p>Ejecutemos el script, tal como está, para examinar el comportamiento esperado.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ ./nameAge.py
Hi Griffith!
You are over 20 years old? What do you want to do for your career?
</code></pre></div></div>

<p>El script es funcional tal como está escrito, pero esto no permite que nadie lo ejecute y agregue su propio nombre y edad. En cambio, para cada cambio de nombre y edad, el script deberá modificarse y guardarse antes de la próxima ejecución. Esta puede ser una tarea engorrosa, así que hagamos que este script sea más fácil de usar.</p>

<p>Para mantener las cosas breves, solo nos centraremos en las líneas variables. Usemos la función <em>input()</em> para solicitar al usuario que ingrese los valores para almacenarlos como variables. La sintaxis de la función <em>input()</em> es *input(“prompt”)**.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>name = input("Please enter your name: ")
age = input("Please enter your age: ")
</code></pre></div></div>

<p>Ejecutemos el script con los cambios anteriores en las líneas variables.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ ./nameAge.py
Please enter your name: Griffith
Please enter your age: 24
Hi Griffith!
Traceback (most recent call last):
  File "/home/kali/./nameAge.py", line 9, in &lt;module&gt;
    if age &gt;= 100:
TypeError: '&gt;=' not supported between instances of 'str' and 'int'
</code></pre></div></div>

<p>El script no se pudo ejecutar. En la lista anterior, el mensaje de error indica que algo anda mal con una variable que intenta mezclar un <em>‘str’</em> y un <em>‘int’</em> en la línea de comparación. Aquí es donde podemos usar la conversión de tipos, como se mencionó anteriormente, para establecer que la entrada de la variable de edad sea un número entero.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>name = input("Please enter your name: ")
age = int(input("Please enter your age: "))
</code></pre></div></div>

<p>Ahora que la variable <em>age</em> se escribe como un número entero, ejecutemos el script nuevamente.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ ./nameAge.py
Please enter your name: Griffith
Please enter your age: 24
Hi Griffith!
You are over 20 years old? What do you want to do for your career?
</code></pre></div></div>

<p>Una nota sobre la entrada del usuario, debemos tener cuidado con lo que el usuario puede hacer cuando usa nuestro programa. Aunque configuramos la variable de <em>age</em> para que sea un número entero a través de la conversión de tipos, el usuario aún puede ingresar valores inesperados. Intentemos simular un usuario que ingresa una cadena cuando se le solicita su edad.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ ./nameAge.py
Please enter your name: Griffith
Please enter your age: Femto
Traceback (most recent call last):
  File "/home/kali/./nameAge.py", line 4, in &lt;module&gt;
    age = int(input("Please enter your age: "))
ValueError: invalid literal for int() with base 10: 'Femto'
</code></pre></div></div>

<h4 id="44-files--functions">4.4. Files &amp; Functions.</h4>

<p>Leer y escribir en archivos es una función importante para extraer y guardar datos después de que finalice el script. Para abrir un archivo, podemos usar el comando <em>open</em>, establecido en una variable. Necesitamos especificar el nombre del archivo y el modo de apertura, entre los distintos modos podemos encontrar:</p>

<ul>
  <li>Lectura (<em>r</em>).</li>
  <li>Escritura (<em>w</em>).</li>
  <li>Anexar (<em>a</em>).</li>
  <li>Lectura + Escritura (<em>r+</em>).</li>
  <li>Si queremos leer o escribir datos binarios, podemos agregar una <em>b</em> al modo. La lectura de un archivo binario requeriría un modo de lectura binaria ( <em>rb</em> ), y la escritura binaria en un archivo requeriría la escritura binaria ( <em>wb</em> ). </li>
</ul>

<p>Para nuestros ejemplos, trabajaremos con texto.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>f = open("data.txt", "r")
</code></pre></div></div>

<p>Con el archivo abierto y definido como variable <em>f</em> , ahora podemos leer el contenido con el método <em>read()</em> del objeto construido con <em>open()</em>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>data = f.read()
</code></pre></div></div>

<p>Esto almacenará todo el contenido del archivo abierto como una cadena en una variable llamada <em>data</em>. Puede que esta no sea la mejor opción si estamos trabajando con archivos de gran tamaño como los archivos de registro. Para archivos más grandes, podemos limitar cuánto estamos almacenando leyendo solo una línea del archivo a la vez usando <em>readlines()</em> en lugar de <em>read()</em>. </p>

<p>Usar <em>readlines()</em> como una secuencia en un bucle <em>for lo hace muy fácil.</em> Cada iteración del bucle <em>for</em> almacenará la línea actual del archivo que estamos leyendo como una variable temporal con la que podemos trabajar.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>f = open("data.txt", "r")

for line in f:
    print(line)
</code></pre></div></div>

<p>Si quisiéramos escribir algunos datos en un archivo, podemos abrir el archivo como antes pero en modo escribir (<em>w</em>) o agregar (<em>a</em>) dependiendo de lo que estemos tratando de lograr. Abrir un archivo en modo de escritura sobrescribirá el archivo si ya existe. Usando el modo de agregar, mantenemos el contenido existente del archivo y escribiremos cualquier dato nuevo hasta el final. De cualquier manera, escribimos datos en el archivo usando <em>write()</em> con los datos para escribir pasados ​​como argumento.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>myData = "I'm sample data to be written to a file"

f = open("data.txt", "a")

f.write(myData)
</code></pre></div></div>

<p>Después de leer o escribir datos en un archivo, debemos cerrarlo. Esto se puede hacer usando <em>close()</em> . No es necesario cerrar un archivo abierto, pero es una buena práctica. Dependiendo de la situación, puede tener muchos beneficios, como permitir que otros programas accedan al archivo. Hay mucha más teoría y explicación técnica detrás de esto, pero está fuera del alcance. A los efectos de este tema, recuerde que debemos cerrar un archivo abierto debido a las mejores prácticas.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>f.close()
</code></pre></div></div>

<p><strong>Exercise</strong></p>

<p><strong>How would we open an existing file named log.txt</strong> referenced by the variable name <em>out</em> with the intention to add to the end of the file?**</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>out <span class="o">=</span> open<span class="o">(</span><span class="s2">"log.txt"</span>, <span class="s2">"a"</span><span class="o">)</span>
</code></pre></div></div>

<p><strong>How would we write the contents of a string variable named <em>logOutput</em> to the file opened in Question 1?</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>out.write<span class="o">(</span>logOutput<span class="o">)</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>Python Functions</strong></p>

<p>Una <em>función</em> es un bloque de código al que se puede hacer referencia más adelante en nuestro script o en otro script o programa externo y que como herramienta está orientado al reciclaje de código. Las funciones deben definirse en el script antes de poder llamarlas. Para definir una función, usamos el término <em>def</em> seguido del nombre de nuestra función. La línea de definición de función termina con paréntesis y dos puntos.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat </span><span class="k">function</span>.py
<span class="c">#!/usr/bin/python</span>

def hello<span class="o">()</span>:
    print<span class="o">(</span><span class="s2">"Hi there!"</span><span class="o">)</span>
</code></pre></div></div>

<p>Con la función escrita, ejecutemos el script.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ ./function.py
</code></pre></div></div>

<p>No se muestra nada en la terminal, a pesar de que la función tiene la función <em>print()</em>. <strong>La razón de esto es que no llamamos a la función en el script</strong>. Para llamar y ejecutar la función, necesitamos especificar el nombre de la función después de la función. Si intentamos llamar a la función antes de que se defina, el programa dará como resultado un error. Esto sucederá porque, hasta donde sabe el programa, la función (todavía) no existe.</p>

<p>Agreguemos la llamada de función ahora.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat function.py
#!/usr/bin/python

def hello():
    print("Hi there!")

hello()
</code></pre></div></div>

<p>Ahora que tenemos una llamada de función en el script, ejecútela y analicemos el resultado.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ ./function.py
Hi there!
</code></pre></div></div>

<p>Cuando ejecutamos nuestro script, el programa sabía que existía una función llamada <em>hello()</em> porque la definimos. Luego, cuando lo llamamos, el programa ejecutó las instrucciones dentro de la función. Esto resultó en la impresión de texto en la terminal.</p>

<p>Esta era una función muy simple que puede no ser útil para nuestras necesidades. A pesar de este ejemplo, revisaremos cómo estas funciones simples, sin argumentos, se vuelven increíblemente útiles más adelante en este tema.</p>

<p>Para ampliar el uso de la función, podemos proporcionar argumentos para usar en la función. Los argumentos también se conocen como parámetros, operandos y variables. Estos son intercambiables en Python. Se pasan a una función dentro de los paréntesis. Se utiliza una declaración de <em>return</em> para proporcionar la salida de la función a nuestro script en curso. Vamos a crear una función de demostración para sumar dos números y <em>devolver</em> el valor.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def addNums(numA, numB):
    answer = numA + numB
    return answer
</code></pre></div></div>

<p>En el Listado 65, creamos una función llamada <em>addNums</em>, que toma dos argumentos: <em>numA</em> y <em>numB</em> . Dentro de la función, ambas variables se suman y el resultado se asigna a la variable de <em>answer</em> que seguidamente la función devuelve.</p>

<p>Ahora podemos llamar a <em>addNums()</em> más adelante en nuestro script usando el nombre de la función y cualquier argumento pasado entre paréntesis.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat functTest.py
#!/usr/bin/python

def addNums(numA, numB):
    answer = numA + numB
    return answer
    
x = addNums(5, 7)

print(x)

kali@kali:~$ python functTest.py
12
</code></pre></div></div>

<p>En el Listado 66, tomamos la función que creamos previamente y agregamos una función <em>print()</em> para imprimirla en la terminal. Es importante tener en cuenta que la declaración de <em>devolución</em> no imprime el resultado en la terminal. Luego podemos tomar el valor devuelto y hacer algo con él, como manipularlo más o imprimirlo en la terminal. Como era de esperar, se imprimió 12 porque 5 + 7 = 12.</p>

<p><br /></p>

<p><strong>Combining File Operations with functions</strong></p>

<p>Cubrimos cómo trabajar con archivos y trabajar con funciones. Combinemos estos dos temas y realicemos las operaciones de archivo para almacenar rápidamente el contenido del archivo en una variable para que funcione dentro de nuestro script. Consideremos el siguiente guión.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat fileManipulation.py
#!/usr/bin/python

def storeFile(file):
    f = open(file, 'r')
    contents = f.read()
    f.close()
    return contents

# Variable to store the filename
fileVar = "notes.txt"

contents = storeFile(fileVar)
print(contents)
</code></pre></div></div>

<p>Este script abre, lee, almacena el contenido en una variable y cierra el archivo dentro de una llamada de función. Con esto, podemos llamar a la función y pasar el parámetro con la variable <em>fileVar</em>, que se estableció arriba de la llamada a la función. Para que esto funcione, el archivo ya debe existir. En este ejemplo, el archivo existe con el texto que se muestra en la ejecución del script.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ ./fileManipulation.py
These are my amazing notes
</code></pre></div></div>

<p>Con esta función, podemos modificar el valor almacenado en la variable <em>f</em> , en lugar de modificar el archivo de ninguna manera. Esto puede ayudar a evitar errores que pueden ocurrir cuando se trabaja directamente con el archivo. La conveniencia de la función es que el archivo también se cierra tan pronto como ya no se necesita.</p>

<p><strong>Exercises</strong></p>

<p><strong>1.  Si quisiéramos abrir un archivo para escribir, ¿qué pondríamos en lugar del espacio vacío entre las comillas simples en la siguiente línea?</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>f = open(file, ' ')
</code></pre></div></div>

<p>w</p>

<p>**2.  Si quisiéramos crear un archivo que no existe y obtener un error si ya existe, ¿qué pondríamos en lugar del espacio vacío entre las comillas simples en la siguiente línea?</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>f = open(file, ' ')
</code></pre></div></div>

<p>x</p>

<p>**3.  Si quisiéramos agregar a un archivo, ¿qué pondríamos en lugar del espacio vacío entre las comillas simples en la siguiente línea?</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>f = open(file, ' ')
</code></pre></div></div>

<p>a</p>

<p><br /></p>

<h4 id="45-modules--web-requests">4.5. Modules &amp; Web Requests.</h4>

<p><strong>Importación de módulos</strong></p>

<p>Los módulos de Python hacen la vez de librerias de C pero en Python contiendo funciones y métodos que permiten resolver fácilmente tareas que de otra forma habría que programar manualmente. Ejemplos de estos son los módulos <em>JSON</em>, <em>Requests</em>, y <em>NumPy</em> .</p>

<p>Empecemos por importar nuestro propio código. Primero, creemos un nuevo archivo llamado <strong>myData.py</strong> e inicialicemos un par de listas con algunos valores de muestra y una función que imprima los elementos en una lista que se le pasa.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python

fruit = ["apple", "banana", "orange", "mango"]

veg = ["carrot", "broccoli", "peas", "artichoke"]

def printItems(myList):
    for x in myList:
        print(x)
</code></pre></div></div>

<p>Ahora, configuraremos un nuevo archivo de Python en el mismo directorio llamado <strong>myMain.py</strong> . Queremos poder ejecutar <strong>myMain.py</strong> y hacer que importe las listas y funciones desde <strong>myData.py</strong>. Para hacer esto, usamos la instrucción <em>import</em>. Esto generalmente se hace en la parte superior del archivo debajo del shebang. Hay un par de formas diferentes de importar un módulo. Podemos importar solo las partes que queramos, o podemos importar el módulo completo. Para importar el módulo completo, podemos usar la declaración de <em>import</em> seguida del archivo que queremos importar (sin la extensión de archivo).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python

import myData
</code></pre></div></div>

<p>Con nuestro módulo importado, podemos hacer referencia a las listas y funciones incluidas en él llamando al nombre del módulo y al nombre de la variable separados por un punto. Esta importación primero buscará módulos locales con este nombre (en el mismo directorio) y luego buscará módulos con el mismo nombre en <em>PYTHONPATH</em> , que depende de nuestro sistema operativo y de cómo se instaló Python.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python

import myData

print(myData.fruit)

print(myData.veg)

myData.printItems(myData.fruit)
</code></pre></div></div>

<p>Esto es muy útil, pero escribir “myData” cada vez que hacemos referencia a algo del módulo puede ser ineficiente. En cambio, podemos simplemente importar lo que queramos y eliminar la necesidad de hacer referencia al módulo cada vez usando la instrucción <em>from</em> junto con nuestra importación.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat myMain.py
#!/usr/bin/python

from myData import fruit, printItems

print(fruit)

printItems(fruit)

print(veg)

kali@kali:~$ python myMain.py
['apple', 'banana', 'orange', 'mango']
apple
banana
orange
mango
Traceback (most recent call last):
 File "/home/kali/myMain.py", line 9, in &lt;module&gt;
   print(veg)
NameError: name 'veg' is not defined
</code></pre></div></div>

<p>Aquí, estamos eligiendo qué partes importar desde nuestro módulo myData. Importamos la lista de <em>fruit</em> y la función <em>printItems()</em> directamente para que podamos trabajar con ellos en <em>myMain.py</em> sin tener que hacer referencia al módulo del que provienen.</p>

<p>No importamos la lista de veg, por lo que Python produjo un error cuando intentamos usarla. Usando este método, también podemos importar todo desde myData reemplazando la declaración de importación con “from myData import *”.</p>

<p><br /></p>

<p><strong>WebRequests</strong></p>

<p>Hay muchos módulos que podemos aprovechar en Python. Nos centraremos en el módulo Requests para realizar solicitudes web.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat webRequest.py
#!/usr/bin/python

import requests
</code></pre></div></div>

<p>El módulo de requests contiene múltiples funciones dentro de él. Algunas funciones comunes son: <em>get</em>, <em>status_code</em>, <em>headers</em>, <em>encoding</em>, <em>text</em> y <em>json</em>. Trabajemos con <em>get</em> , <em>status_code</em> y <em>text</em> para mantener esta sección más fácil por el bien del aprendizaje.</p>

<p>Modifiquemos nuestro script para solicitar la página web en:</p>

<pre><code class="language-defaul">https://www.offensive-security.com/offsec/game-hacking-intro/
</code></pre>

<p><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat </span>webRequest.py
<span class="c">#!/usr/bin/python</span>

import requests

page <span class="o">=</span> requests.get<span class="o">(</span><span class="s1">'https://www.offensive-security.com/offsec/game-hacking-intro/'</span><span class="o">)</span>
print<span class="o">(</span>page.status_code<span class="o">)</span>
</code></pre></div></div>

<p>El contenido de la página web se almacenará en la variable de <em>page</em>. Usando esa variable, podemos verificar el estado de la respuesta web con la función <em>status_code</em>. </p>

<p>Al ejecutar el script obtenemos:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ ./webRequest.py
200
</code></pre></div></div>

<p>El código de respuesta HTTP es <em>200</em>, lo que significa que se llegó a la página correctamente. Conocer el código de respuesta HTTP puede ser útil al realizar solicitudes a recursos web. Si el recurso está bloqueado o no se puede acceder a él, esa solicitud podría tener un mensaje de error, ignorarse o incluso detener la ejecución del programa.</p>

<p>Aunque la respuesta HTTP es útil, esto no es lo que realmente queríamos de la solicitud. Agreguemos otra función bajo la llamada <em>status_code</em> , <em>text</em> .</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat webRequest.py
#!/usr/bin/python

import requests

r = requests.get('https://www.offensive-security.com/offsec/game-hacking-intro/')
print(r.status_code)
print(r.text)
</code></pre></div></div>

<p>Ahora que tenemos la llamada a la función de <em>text</em> en nuestro script lo ejecutamos:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ ./webRequest.py
200

&lt;!doctype html&gt;

  &lt;html class="no-js"  lang="en-US"&gt;

        &lt;head&gt;
                &lt;meta charset="utf-8"&gt;

                &lt;!-- Force IE to use the latest rendering engine available --&gt;
                &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;

                &lt;!-- Mobile Meta --&gt;
                &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
                &lt;meta class="foundation-mq"&gt;
...
</code></pre></div></div>

<p>El código fuente de la página web se muestra en el terminal. El resultado de la lista anterior está recortado para ahorrar espacio, pero el contenido de la página web podría manipularse en nuestro script.</p>

<p><br /></p>

<h4 id="46-python-network-sockets">4.6. Python Network Sockets.</h4>

<p>Para comenzar con nuestro script de cliente de red de Python, primero debemos importar el módulo de socket. Los sockets son canales a través de los cuales se maneja la información en forma de bytes que se envía a otra máquina.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span><span class="nb">cat </span>networkClient.py
<span class="c">#!/usr/bin/python</span>

import socket
</code></pre></div></div>

<p>A partir de aquí, necesitamos establecer una variable de socket. </p>

<p>En nuestro caso, llamaremos al nuestro ’<em>s</em>‘ .</p>

<pre><code class="language-defaul">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
</code></pre>

<p>La variable puede parecer complicada, así que analicemos qué es cada parte de la declaración del socket. </p>

<p>Hay una función <em>socket()</em> que tiene dos parámetros: <em>AF_INET</em> y <em>SOCK_STREAM</em>:</p>

<ul>
  <li>El parámetro <em>AF_INET</em> especifica que la dirección IP será una dirección IPv4. </li>
  <li>El parámetro <em>SOCK_STREAM</em> especifica que el socket utilizará una conexión TCP. Ahora que la variable de socket está configurada, podemos conectarnos a un servidor remoto. Agreguemos el código de conexión ahora. Para esta demostración, usaremos la dirección IP 192.168.50.101 y el puerto 9999.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>s.connect(("192.168.50.101", 9999))
</code></pre></div></div>

<p><strong>Es importante tener en cuenta que la IP y el puerto se proporcionan como un único parámetro en la función <em>connect()</em>. </strong></p>

<p>Ahora que agregamos el código de conexión, verifiquemos si el servidor envía algo al cliente. Podemos hacer esto con la función <em>recv()</em>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>print<span class="o">(</span>s.recv<span class="o">(</span>1024<span class="o">))</span>
</code></pre></div></div>

<p>El valor de recepción de 1024 en la lista anterior es el tamaño del búfer para la recepción de datos. Este valor establece el número de bytes que se pueden recibir del servidor. Se puede cambiar para que sea menor o mayor, hasta cerca de 64.000 bytes. Aumentar nuestro búfer a ese tamaño no sería práctico, y 1024 bytes es una cantidad justa para especificar para un uso típico.</p>

<p>Después de recibir los datos del servidor, cerraremos nuestra conexión de socket con la función <em>close()</em>. Agreguemos esto y revisemos nuestro script.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat networkClient.py
#!/usr/bin/python

import socket

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

s.connect(("192.168.50.101", 9999))

print(s.recv(1024))
s.close()
</code></pre></div></div>

<p>Ejecutemos nuestro script contra el servidor remoto para analizar el resultado.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ ./networkClient.py
b'You are connected.\nGoodbye'
</code></pre></div></div>

<p>Curiosamente, hay una <em>b</em> antes de la cadena de datos. La cadena también tiene un carácter de nueva línea y no lo interpretó como una nueva línea. La <em>b</em> significa que los datos están en formato binario (a no ser que se configure de otra manera la información se envía y recibe en <strong>streams de bytes</strong>). En el servidor, los datos que se envían están codificados. Podemos decodificar estos datos en nuestro cliente con la función <em>decode()</em>. Modifiquemos la función <em>print()</em> para decodificar los datos que se reciben.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>print(s.recv(1024).decode())
</code></pre></div></div>

<p>Ahora que hemos agregado <em>decode()</em> a nuestra función <em>print()</em>, ejecutemos el script nuevamente.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~<span class="nv">$ </span>./networkClient.py
You are connected.
Goodbye
</code></pre></div></div>

<p>El servidor solo envió algunos datos. Por supuesto, la mayoría de las aplicaciones de servicio son mucho más complejas y pueden tomar datos como entrada del cliente.</p>

<p>Dado que se cambió el servicio, enviemos nuestro script al servicio recién modificado para analizar qué puede haber en él.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ ./networkClient.py
Please send a number to be squared
</code></pre></div></div>

<p>Ahora, el servidor solicita que se envíe un número al socket para que se cuadre y se devuelva. Enviemos un número al servidor con la función <em>enviar()</em> .</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat networkClient.py
#!/usr/bin/python

import socket

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

s.connect(("192.168.50.101", 9999))

print(s.recv(1024).decode())
s.send("5".encode())
s.close()
</code></pre></div></div>

<p>El número <em>5</em> se envía como una cadena y se codifica para que el servidor comprenda el valor. Ejecutemos el script de nuevo.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ ./networkClient.py
Please send a number to be squared
</code></pre></div></div>

<p>El mensaje devuelto por el servidor es el mismo que antes. Esto se debe a que no leemos ningún dato nuevo que pueda haber sido enviado como resultado de nuestro número. Agreguemos otra línea <em>recv()</em> a nuestro script antes de que se cierre la conexión.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ cat networkClient.py
#!/usr/bin/python

import socket

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

s.connect(("192.168.50.101", 9999))

print(s.recv(1024).decode())
s.send("5".encode())
print(s.recv(1024).decode())
s.close()
</code></pre></div></div>

<p>Ejecutemos el script nuevamente para probar si el servidor envía algo después de que enviamos el número 5.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ ./networkClient.py
Please send a number to be squared
25
</code></pre></div></div>

<p>En nuestra última ejecución, el servidor aceptó nuestro número 5 y devolvió su cuadrado, 25.</p>

<p><br /></p>

<p><strong>Exercises</strong></p>

<p><strong>7. Conéctese al host del ejercicio en el puerto 6666. El servidor proporcionará la bandera.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python
</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="s">"192.168.57.101"</span><span class="p">,</span><span class="mi">6666</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">s</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>8. Conéctese al host de ejercicio en el puerto 7777 y cumpla con las demandas esperadas del servidor.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python
</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="s">"192.168.57.101"</span><span class="p">,</span><span class="mi">7777</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"5"</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">s</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>9.  Conéctese al host del ejercicio en el puerto 7777 y envíe datos inesperados.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python
</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="s">"192.168.57.101"</span><span class="p">,</span><span class="mi">7777</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"qwerty"</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">s</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>10. Conéctese al host de ejercicio en el puerto 8888 y cumpla con las demandas esperadas del servidor.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python
</span><span class="kn">import</span> <span class="nn">socket</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="s">"192.168.57.101"</span><span class="p">,</span><span class="mi">8888</span><span class="p">))</span>
<span class="n">String</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">).</span><span class="n">decode</span><span class="p">()</span>

<span class="n">a</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">2</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">b</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">3</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">c</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">4</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1">#En la parte anterior recibimos los datos del servidor y los decodificamos guardándolos en una variable 'String'. Seguidamente, introducimos en variables numéricas los números primero dividiendo el contenido total de 'String' en líneas y de ahí dividiendo el contenido de cada línea en 2 a partir de ':' quedándonos con el segundo campo.
</span>
<span class="n">result</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">c</span>

<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">s</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>Web Spyder</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">URL</span> <span class="o">=</span> <span class="s">"http://192.168.57.101/"</span>
<span class="n">urlList</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">isFollowed</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">checkUrlList</span><span class="p">(</span><span class="n">URL</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">URL</span> <span class="ow">in</span> <span class="n">urlList</span><span class="p">:</span>
       <span class="k">return</span> <span class="bp">True</span>
   <span class="k">else</span><span class="p">:</span>
       <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">isFollowedCheck</span><span class="p">(</span><span class="n">URL</span><span class="p">):</span>
   <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">isFollowed</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
       <span class="k">if</span> <span class="n">URL</span> <span class="o">!=</span> <span class="n">entry</span><span class="p">:</span>
           <span class="k">return</span> <span class="bp">False</span>
       <span class="k">else</span><span class="p">:</span>
           <span class="k">if</span> <span class="n">isFollowed</span><span class="p">[</span><span class="n">URL</span><span class="p">]</span> <span class="o">==</span> <span class="s">"yes"</span><span class="p">:</span>
               <span class="k">return</span> <span class="bp">True</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="k">return</span> <span class="bp">False</span>
                               
<span class="n">urlList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>

<span class="k">for</span> <span class="n">URL</span> <span class="ow">in</span> <span class="n">urlList</span><span class="p">:</span>
   <span class="k">if</span> <span class="n">isFollowedCheck</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">True</span><span class="p">:</span>
       <span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
       <span class="n">isFollowed</span><span class="p">[</span><span class="n">URL</span><span class="p">]</span> <span class="o">=</span> <span class="s">"yes"</span>
       
       <span class="n">start</span> <span class="o">=</span> <span class="s">"http"</span>
       <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">page</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">):</span>
           <span class="k">if</span> <span class="s">"http"</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="k">if</span> <span class="s">"192.168.57.101"</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                   <span class="k">if</span> <span class="s">"</span><span class="se">\"</span><span class="s">&gt;"</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                       <span class="n">end</span> <span class="o">=</span> <span class="s">"</span><span class="se">\"</span><span class="s">&gt;"</span>
                   <span class="k">else</span><span class="p">:</span>
                       <span class="n">end</span> <span class="o">=</span> <span class="s">"</span><span class="se">\"</span><span class="s"> "</span>
                   <span class="n">sliced</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">line</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">start</span><span class="p">):</span><span class="n">line</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span>
                   <span class="k">if</span> <span class="s">"</span><span class="se">\"</span><span class="s">"</span> <span class="ow">in</span> <span class="n">sliced</span><span class="p">:</span>
                       <span class="n">end</span> <span class="o">=</span> <span class="s">"</span><span class="se">\"</span><span class="s">"</span>
                       <span class="n">parsedURL</span> <span class="o">=</span> <span class="n">sliced</span><span class="p">[</span><span class="n">sliced</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">start</span><span class="p">):</span><span class="n">sliced</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span>
                   <span class="k">else</span><span class="p">:</span>
                       <span class="n">parsedURL</span> <span class="o">=</span> <span class="n">sliced</span>
                   <span class="k">if</span> <span class="n">checkUrlList</span><span class="p">(</span><span class="n">parsedURL</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
                       <span class="n">urlList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">parsedURL</span><span class="p">)</span>
                       <span class="n">isFollowed</span><span class="p">[</span><span class="n">parsedURL</span><span class="p">]</span> <span class="o">=</span> <span class="s">"no"</span>

<span class="k">for</span> <span class="n">URL</span> <span class="ow">in</span> <span class="n">urlList</span><span class="p">:</span>
   <span class="k">print</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<h4 id="47-data-manipulation-in-python">4.7. Data Manipulation in Python.</h4>

<h5 id="471-python-data-basics">4.7.1. Python Data Basics.</h5>

<p>En cualquier sistema, las formas básicas de datos, bits y bytes, son constructos de bajo nivel, en un lenguaje de programación. Python nos permite programar al alto nivel gracias a constructos como strings, integers, booleans, etc.</p>

<p><strong>Working with Strings</strong></p>

<p>En Python un string es 0 o más caracteres concatenados. Una variable string se define asignando con un igual ‘=’ un contenido entre comillas (simples o dobles) a un nombre:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>astring = "The world is not "
bstring = "flat."
astring = astring+bstring

</code></pre></div></div>

<p>En python el string es un objeto que tiene asociado una serie de métodos y funcionados asociados:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>print(astring.upper()) &lt;-- Convierte los caracteres a mayúsculas o a minúsculas respectivamente.
print(astring.lower())
print(len(astring)) &lt;-- Número de caracteres.
print(astring[0]) &lt;-- Primer caracter del string.
print(string[21]) &lt;-- Vigésimosegun caracter del string.
print(astring[17:21]) &lt;-- Devuelve los caracteres comprendidos entre el 17 y el 20, no incluido el 21. Se denominan substring.
</code></pre></div></div>

<p>Los caracteres pueden ser separados por espacios, tabs ‘\t’ o nueva línea ‘\n’:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; pstring = "Mercury\tVenus\tEarth\nMars\tJupiter\tSaturn\n"

&gt;&gt;&gt; print(astring)
Mercury Venus   Earth
Mars    Jupiter Saturn
</code></pre></div></div>

<p><br /></p>

<p>Un tipo integer (número entero) puede ser transformado a string con la función str():</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; inum = int(input("Enter a number: "))
Enter a number: 12

&gt;&gt;&gt; print(inum)
12

&gt;&gt;&gt; type(inum)
&lt;class 'int'&gt;

&gt;&gt;&gt; astring = str(inum+1)+" green bottles"
&gt;&gt;&gt; print(astring)
13 green bottles
</code></pre></div></div>

<p><br /></p>

<p><strong>Working with Booleans</strong></p>

<p>Las variables booleanas toman dos valores, True o False. Estos se crean por asignación directa de los nombres predefinidos, verdadero y falso, o como resultado de una operación de comparación. Demostremos algunos de estos.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; bval1 = True
&gt;&gt;&gt; print(bval1)
True

&gt;&gt;&gt; if bval1:
...   print("It's true!")
...
It's true!

&gt;&gt;&gt; if inum1 &gt; inum2:
...    print(inum1,"is greater than",inum2) 
...
164 is greater than 37
</code></pre></div></div>

<table>
  <tbody>
    <tr>
      <td>Los operadores booleanos son <em>and</em> , <em>or</em> y <em>not</em>. Podemos usar los operadores <em>bit a bit</em> ”&amp;” y “</td>
      <td>“ como abreviatura de <em>and</em> y <em>or</em> , respectivamente.</td>
    </tr>
  </tbody>
</table>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; bval1 = True
&gt;&gt;&gt; bval2 = False
&gt;&gt;&gt; print(bval1 and bval2)
False

&gt;&gt;&gt; print(bval1 &amp; bval2)
False

&gt;&gt;&gt; print(bval1 or bval2)
True

&gt;&gt;&gt; print(bval1 | bval2)
True

&gt;&gt;&gt; print(not bval2)
True
</code></pre></div></div>

<p>Eso completa la actualización del tipo de datos principal, así que terminemos revisando las estructuras más grandes que podemos construir con estos tipos de datos.</p>

<p><br /></p>

<p><strong>Working with bytes in Python</strong></p>

<p>Existe un tipo de clase de datos bastante utilizada y particularmente importante para ciberseguridad denominada Bytes. Un byte es una cadena de 8 bits que en Python se declara con una ‘b’ delante del contenido o con la función ‘.encode()’:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; b1 = b'A'
&gt;&gt;&gt; type(b1)
&lt;class 'bytes'&gt;

&gt;&gt;&gt; b2 = "A".encode()
&gt;&gt;&gt; type(b2)
&lt;class 'bytes'&gt;

&gt;&gt;&gt; print(b2)
b'A'
</code></pre></div></div>

<p>Algunos caracteres pueden ser declarados utilizando caracteres ASCII, sin embargo para otros muchos valores habrá que recurrir a constantes hexadecimales:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; b1 = b'\x7F'
&gt;&gt;&gt; type(b1)
&lt;class 'bytes'&gt;

&gt;&gt;&gt; print(b1)
b'7f
</code></pre></div></div>

<p>Cuando imprimimos un valor de bytes que no es ASCII, se muestra en forma hexadecimal. Los bytes son de particular importancia ya que algunas funciones del sistema de Python requieren una entrada en forma de bytes.</p>

<p>Python proporciona una función <em>bytes()</em>, pero tiene algunas características interesantes y debemos tener cuidado al usarla. Averigüemos por qué al usarlo para crear un carácter de byte y luego intentar crear un número de byte.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; b1 = bytes('A')
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
TypeError: string argument without an encoding

&gt;&gt;&gt; b1 = bytes('A'.encode())
&gt;&gt;&gt; print(b1)
b'A'

&gt;&gt;&gt; b2 = bytes(123)
&gt;&gt;&gt; print(b2)
b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'

&gt;&gt;&gt; b1 = bytes([127])
&gt;&gt;&gt; print(b1)
b'\x7f'
</code></pre></div></div>

<p>En este ejemplo, usamos la función <em>bytes()</em> junto con la función <em>encode()</em> para entregar un objeto byte. Sin embargo, cuando usamos la función de bytes con un número, no devuelve la representación de bytes de ese número. Devuelve una matriz de bytes de tantos ceros. Para obtener el valor de 127, debemos pasarle el valor entre corchetes; en otras palabras, como una lista de un solo valor.</p>

<p>Cubriremos las matrices de bytes con más detalle cuando hablemos de las listas.</p>

<p>A continuación, hagamos algunos ejercicios antes de aprender cómo se manipulan los diferentes números basados ​​en Python.</p>

<p><br /></p>

<h3 id="5-network-scripting-with-python">5. Network Scripting with Python.</h3>
<h4 id="51-escribir-un-cliente-de-python">5.1. Escribir un Cliente de Python.</h4>

<p><strong>Building a Basic Client. Sockets Basics, Exception Handling</strong></p>

<p>Aunque hay muchos lenguajes de programación que podemos usar para completar nuestras tareas, Python es un lenguaje muy popular que usan los pentesters para crear sus scripts de red. Esto se debe a su facilidad de uso y a la gran cantidad de librerías disponibles para ello.</p>

<p>Para que los programas y sistemas se comuniquen entre sí en una red, utilizan los <em>sockets</em> y la <em>API de socket</em> para enviar mensajes de ida y vuelta. Un socket es esencialmente un punto final que permite que la comunicación de red fluya entre dos programas que se ejecutan en una red. Podemos implementar sockets de red en varios tipos de canales diferentes.</p>

<p>Usemos el siguiente código de Python para comenzar a crear un script que use el módulo <em>socket</em>. Importaremos la biblioteca de sockets para nuestro script de Python y luego llamaremos al método <em>socket.socket</em>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
#client.py
</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="o">&lt;</span><span class="n">socket_family</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">socket_type</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">protocol</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div></div>

<p>Arriba, configuramos el método <em>socket.socket</em> en la variable <em>s</em>. El método <em>socket.socket</em> en sí contiene tres variables (actualmente no configuradas): <em>socket_family</em>, <em>socket_type</em> y <em>protocol</em>. Examinemos estos marcadores de posición de variables.</p>

<ul>
  <li>
    <p><em>socket_family</em>: nos permite especificar un dominio de protocolo que actuará como mecanismo de transporte. El más común, AF_INET, se usa para el direccionamiento de Internet IPv4 y AF_INET6 se usa para el direccionamiento de Internet IPv6. AF_UNIX es la familia de direcciones para <em>Unix Domain Sockets</em> (UDS). Esta familia de sockets permite que el sistema operativo pase datos directamente de un proceso a otro, sin pasar por la pila de red.</p>
  </li>
  <li>
    <p><em>socket_type</em>: permite la comunicación entre dos puntos finales. El tipo de socket suele ser SOCK_DGRAM para el UDP o SOCK_STREAM para el (TCP).</p>
  </li>
  <li>
    <p><em>protocolo</em>: se puede utilizar para especificar el número de protocolo. Por lo general, se establece en 0, que es el valor predeterminado que se establecerá si no se especifica.</p>
  </li>
</ul>

<p>Para proporcionar valores a estas variables, crearemos un socket que se comunicará con una dirección IPv4 para transmitir nuestra comunicación a través de TCP.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
#client.py
</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</code></pre></div></div>

<p>Tenga en cuenta que no hemos especificado un protocolo, por lo que tendrá un valor predeterminado de 0 como se mencionó anteriormente.</p>

<p><br /></p>

<p><strong>Socket Methods</strong></p>

<p>Antes de continuar, debemos comprender algunos de los métodos integrados en el módulo de socket (recordamos que un método es una función asociada a lo que podríamos considerar no propioamente un objeto o un tipo de dato de python). Construiremos lentamente a nuestro cliente aplicando cada método relevante. Al final de este proceso, tendremos un cliente de red completamente funcional que puede manejar errores y recibir datos de longitud arbitraria.</p>

<p>El tipo más común de aplicaciones de socket son las aplicaciones <em>cliente-servidor</em>, como la que estamos construyendo actualmente. Esto implica que un cliente realice una <em>solicitud</em> al servidor. El cliente entonces recibe una <em>respuesta</em> del servidor.</p>

<p>El módulo de socket viene con varios métodos para facilitar las diversas acciones que un cliente (o un servidor) realizará durante dicha comunicación. Hay tres conjuntos de métodos de socket que debemos tener en cuenta:</p>

<ul>
  <li>métodos de socket de cliente.</li>
  <li>métodos de socket de servidor.</li>
  <li>métodos de socket generales. </li>
</ul>

<p>Por lo general, aunque no siempre, un cliente invocará métodos de socket de cliente, un servidor invocará métodos de socket de servidor y ambos programas pueden hacer uso de los métodos generales.</p>

<ul>
  <li>El método <em>socket.gethostname()</em> devuelve el nombre del sistema local. Lo usaremos en nuestros scripts para probar la ejecución en nuestra máquina local. Esto significa que si queremos ejecutar nuestros scripts contra un servidor externo, necesitaremos especificar la dirección IP del objetivo remoto. En el siguiente ejemplo, especificamos nuestro propio localhost con el método <em>socket.gethostname()</em> , y luego especificamos el puerto al que queremos conectarnos con un número entero.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#client.py

import socket

client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
host = socket.gethostname()
port = 8080
</code></pre></div></div>

<p><br /></p>

<ul>
  <li>El método <em>socket.connect(dirección)</em> se utiliza para iniciar una conexión con el servidor. El método requiere que especifiquemos un solo host y puerto (que se interpretan como un único parámetro) para conectarse, que definimos en las variables de <em>host</em> y <em>puerto</em>.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#client.py

import socket

client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
host = socket.gethostname()
port = 8080

client.connect((host, port)) # Connect to our client
</code></pre></div></div>

<p>Observe los paréntesis dobles dentro de la sintaxis ‘s.connect((host, port))’. La razón de esto es que el módulo de socket trata <em>(host, puerto)</em> como un solo argumento. Si solo incluyéramos un par de paréntesis, Python interpretaría nuestra sintaxis como un intento de proporcionar dos argumentos a un método que solo acepta uno.</p>

<p>Ahora que entendemos cómo usar el método <em>socket.connect</em>, hay algunos métodos generales de socket con los que debemos familiarizarnos para usarlos con nuestro cliente para que pueda recibir datos y terminar.</p>

<p><br /></p>

<ul>
  <li>El método <em>socket.recv(buffsize)</em> permite que el cliente reciba un mensaje TCP del socket. El argumento <em>buffsize</em> (tamaño de búfer) define la cantidad máxima de datos que el método puede recibir en cualquier momento.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#client.py

import socket

client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
host = socket.gethostname()
port = 8080

client.connect((host, port)) # Connect to our client
msg = client.recv(1024)

print (msg.decode('ascii'))
</code></pre></div></div>

<p>En la lista anterior, un cliente se conectaría a un servidor y luego imprimiría cualquier dato que reciba del servidor a través del método <em>socket.recv()</em>.</p>

<p>Ahora tenemos suficiente código para conectarnos a un servidor.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ python3 client.py
Connection Established
</code></pre></div></div>

<p>En la lista anterior, ejecutamos nuestro cliente contra un servidor que se ejecuta en nuestro propio servidor local y recibimos un mensaje del servidor de que se ha establecido la conexión.</p>

<p><br /></p>

<ul>
  <li>El método <em>socket.close()</em> es bastante sencillo ya que solo cerrará el socket. Esto se puede invocar desde cualquier extremo y terminará la conexión entre el cliente y el servidor.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
#client.py
</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">host</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">gethostname</span><span class="p">()</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">8080</span>

<span class="n">client</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span> <span class="c1"># Connect to our client
</span><span class="n">msg</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">client</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">print</span> <span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'ascii'</span><span class="p">))</span>
</code></pre></div></div>

<p>Ahora hemos creado un programa de cliente completamente funcional en Python. Repasemos lo que hemos aprendido hasta ahora. Nuestro script está diseñado para conectarse a un servidor local que se ejecuta en el puerto 8080. El método <em>socket.connect()</em> establecerá la conexión. Si la conexión es exitosa, el cliente recibirá un mensaje del servidor con <em>socket.recv()</em>. El método <em>socket.close()</em> cerrará el cliente y luego la función <em>print</em> decodificará y mostrará el mensaje del servidor.</p>

<p><br /></p>

<p><strong>Exercises</strong></p>

<p><strong>1. ¿Qué familia de sockets nos permitirá conectarnos a un sistema que tenga una dirección IPv4?</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AF_INET
</code></pre></div></div>

<p><br /></p>

<p><strong>2. Eche un vistazo a la siguiente sintaxis: s.connect((“127.0.0.1”,9090)) . ¿Qué tipo de método de socket se invoca aquí?</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A. Clien
B. Server
C. Socke
D. General
</code></pre></div></div>

<p>A</p>

<p><br /></p>

<p><strong>3. Este es un ejercicio de secuencias de comandos. Use Python para conectarse al servidor en el puerto 2000 de la máquina virtual proporcionada. Cuando un cliente se conecta al servidor, recibirá una determinada respuesta. Con su secuencia de comandos de Python, envíe esta respuesta exacta al servidor y recibirá una segunda respuesta. Su tarea es enviar y recibir 10 conexiones desde y hacia el servidor en 15 segundos para obtener la bandera.</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/python</span>
import socket

s <span class="o">=</span> socket.socket<span class="o">(</span>socket.AF_INET, socket.SOCK_STREAM<span class="o">)</span>
s.connect<span class="o">((</span><span class="s1">'192.168.57.68'</span>, 2000<span class="o">))</span>
<span class="k">for </span>i <span class="k">in </span>range<span class="o">(</span>0,14<span class="o">)</span>:
    msg <span class="o">=</span> s.recv<span class="o">(</span>2048<span class="o">)</span>.decode<span class="o">()</span>
    print<span class="o">(</span>msg<span class="o">)</span>
    s.send<span class="o">(</span>msg.encode<span class="o">())</span>
s.close<span class="o">()</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>Exception Handling: Try y Except</strong></p>

<p>A veces, nuestro código de cliente puede no funcionar como se desea, porque el servidor responde de una manera que no esperamos, o porque no funciona correctamente. Para hacer que nuestro programa sea más robusto, podemos introducir el ‘Exception Handling’ que le dirá al cliente qué hacer si encuentra un error o un comportamiento inesperado.</p>

<p>Python utiliza los statements de <em>try</em> y <em>except</em> para manejar errores. Aquí hay un ejemplo de cómo se vería un par <em>try-except</em> en pseudocódigo.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>try:
    do something
    break
except &lt;exception type&gt;:
    print an error statement
</code></pre></div></div>

<p>Una declaración de try intenta ejecutar cualquier código dentro del bloque de try. Si el código dentro del bloque de try se ejecuta con éxito, el programa omitirá el bloque de try y continuará su flujo de ejecución.</p>

<p>Sin embargo, si encuentra un error (también conocido como excepción), el flujo de ejecución saltará inmediatamente al bloque exception correspondiente con el <em>tipo de excepción</em> correspondiente. Luego, el código dentro del bloque <em>exception</em> se ejecuta para manejar el comportamiento inesperado. Una vez que el bloque de <em>excepción</em> termine de ejecutarse, el programa continuará con su flujo de ejecución.</p>

<p>Finalmente, si no hay un tipo de excepción correspondiente al error encontrado dentro del bloque <em>try</em>, el programa detendrá su ejecución porque no sabrá cómo continuar. Esto se llama una <em>excepción no controlada</em>.</p>

<p>Avancemos y agreguemos declaraciones de <em>try</em> y <em>exception</em> a nuestro cliente de Python.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#client.py

import socket

client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

host = socket.gethostname()
port = 8080

try:
    client.connect((host, port))
    msg = client.recv(1024)
    client.close()
    print (msg.decode('ascii'))
    
except ConnectionRefusedError:
    print ("The server is not accepting our connection request!")
    exit(1)
   
print ("This sentence will only print if the except block was not executed.")
</code></pre></div></div>

<p>El código anterior busca la excepción específica llamada <em>ConnectionRefusedError</em> , que indica si un servidor no quiere o no puede aceptar la conexión del cliente. Podemos ejecutar nuestro código de cliente contra un servidor inexistente para validar los bloques de <em>prueba</em> y <em>excepción</em>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$  python3 client.py
The server is not accepting our connection request!
</code></pre></div></div>

<p>Observe cómo la última línea de nuestro programa no se ejecuta. Esto se debe a que el bloque de <em>excepción</em> imprime una declaración y luego sale del programa antes de que se pueda ejecutar la última línea.</p>

<p>Aquí, solo estamos usando el bloque <em>excepto</em> para imprimir una declaración y salir. Sin embargo, podríamos crear instrucciones mucho más complejas, lo que permitiría que nuestro programa realice diagnósticos, se conecte a otro servidor o haga algo no relacionado. En el siguiente ejercicio, usará las sentencias <em>try</em> y <em>except</em> para permitir que el programa se vuelva a conectar a un servidor un número arbitrario de veces.</p>

<p><br /></p>

<p><strong>Exercises</strong></p>

<p><strong>El servidor que se ejecuta en el puerto 2001 de la máquina virtual proporcionada tiene errores; solo responde a veces. Asegúrese de que su programa cliente tenga un medio para manejar errores y reconectarse. Como en el ejercicio anterior, conecta 10 veces exitosas en 15 segundos para obtener la bandera.</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/python3</span>
import socket 

host <span class="o">=</span> <span class="s1">'&lt;IP&gt;'</span> p
ort <span class="o">=</span> 2001 

client <span class="o">=</span> socket.socket<span class="o">(</span>socket.AF_INET, socket.SOCK_STREAM<span class="o">)</span>
client.connect<span class="o">((</span>host, port<span class="o">))</span> 

<span class="k">for </span>i <span class="k">in </span>range<span class="o">(</span>0, 15<span class="o">)</span>: 

	try: 
		msg <span class="o">=</span> client.recv<span class="o">(</span>1024<span class="o">)</span> 
		client.send<span class="o">(</span>msg<span class="o">)</span> 
		print<span class="o">(</span>msg.decode<span class="o">(</span><span class="s1">'ascii'</span><span class="o">))</span> 
		
	except ConnectionRefusedError: 
		print <span class="o">(</span><span class="s2">"The server is not accepting our connection request!"</span><span class="o">)</span> 
		<span class="nb">exit</span><span class="o">(</span>1<span class="o">)</span> 

client.close<span class="o">()</span>
</code></pre></div></div>

<p>El enunciado del ejercicio está mal escrito, nos conectamos 1 vez y recibimos información 15 veces.</p>

<p><br /></p>

<p><strong>Exercises</strong></p>

<p><strong>1. Connect to the server on port 2002 of the provided VM. The response you receive will be of unknown length, so build in some provisions in your client script to handle the responses using loops. You will need to connect to the server several times to receive the flag.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="c1">#2002.py
</span> 
<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">sock</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="s">'192.168.66.68'</span><span class="p">,</span><span class="mi">2002</span><span class="p">))</span> <span class="c1">#En primer lugar iniciamos la conexión con el servidor.
</span>
<span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s">''</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">sock</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span> <span class="c1">#Si data no está vacío, entonces adherimos los datos recibidos a una variable llamada payload y aumentamos en uno un marcador que indica el número de trozos de datos recibidos.
</span>                <span class="n">payload</span> <span class="o">+=</span> <span class="n">data</span>
                <span class="c1">#print("Chunk %d recived" % i)
</span>                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1">#Si data no ha recogido nada del servidor, entonces este ha finalizado el envío de datos y salimos del bucle.
</span>                <span class="k">print</span><span class="p">(</span><span class="s">"No data received"</span><span class="p">)</span>
                <span class="k">break</span>

<span class="n">imageArray</span> <span class="o">=</span> <span class="n">payload</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s">'</span><span class="se">\r\n\r\n</span><span class="s">'</span><span class="p">)</span> <span class="c1">#Después de mirar todo el contenido sabemos que se nos están enviando varios ficheros, con el objetivo de separarlos utilizamos el método .split de forma que se construye una lista de trozos que conforman cada fichero. Es decir, imageArray es una lista de ficheros en binario.
</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">imageArray</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">imageArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s">'</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>
        <span class="n">fileName</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'fetched'</span> <span class="o">+</span> <span class="n">imageArray</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">pos</span><span class="p">]</span>
        <span class="n">fileContent</span> <span class="o">=</span> <span class="n">imageArray</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span><span class="s">'wb+'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">fileContent</span><span class="p">)</span>

</code></pre></div></div>

<p><br /></p>

<p><strong>Interactive Sockets</strong></p>

<p>En ocasiones podemos querer establecer una conexión con un servidor, y luego enviarle datos en base a la información que nos proporciona. Para ello, podemos crear un <em>Socket Interactivo</em> con la librería Telnet. Comencemos con nuestro código de cliente original e importemos <em>telnetlib</em>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#interactive-client.py

import socket
import telnetlib

client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
host = socket.gethostname()
port = 8080

client.connect((host, port)) # Connect to our client
msg = client.recv(1024)
client.close()

print (msg.decode('ascii'))
</code></pre></div></div>

<p>El <em>telnetlib</em> permite una implementación del protocolo Telnet. Modificaremos nuestro script para hacer uso del método <em>telnetlib.interact()</em>, que nos permitirá interactuar con el servidor dinámicamente. </p>

<p>Para implementar este método, crearemos una función a la que llamaremos después de que nuestro cliente se haya conectado al servidor:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#interactive-client.py

import socket
import telnetlib

def interact(socket):
    t = telnetlib.Telnet()
    t.sock = s
    t.interact() #Notemos que aunque este método se llama igual que la función que estamos creando, no hay conflicto porque esta variable tiene alcance dentro de la función pero no fuera de ella por lo que en el resto del código la única función 'interact' que existe es la que acabamos de definir.

client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
host = socket.gethostname()
port = 8080

client.connect((host, port)) # Connect to our client
msg = client.recv(1024)
print (msg.decode('ascii'))

client.close()
</code></pre></div></div>

<p>El mecanismo que permite a este cliente mantener la interactividad con el servidor se realiza a través de la propia función de <em>interacción</em> de Telnet. Esta función configura un ciclo <em>while true</em> que sigue leyendo y escribiendo datos. Dado que, <em>aunque verdadero</em> siempre es verdadero, continúa leyendo y escribiendo datos desde y hacia el servidor hasta que se corta la conexión.</p>

<p>A continuación, llamaremos a nuestra nueva función después de conectarnos al servidor.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#interactive-client.py

import socket
import telnetlib

def interact(socket):
    t = telnetlib.Telnet()
    t.sock = s
    t.interact()

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("192.168.66.68", 2003)) 
msg = s.recv(1024)
print (msg.decode('ascii'))
interact(s) #La función interact se genera sobre un socket abierto.
</code></pre></div></div>

<p>En la lista anterior, nuestro código de cliente ahora es capaz de interactuar dinámicamente con el servidor al que se conecta. Tenga en cuenta que esta funcionalidad depende de dos cosas:</p>

<ol>
  <li>
    <p>El servidor debe permitir que la conexión permanezca abierta. Si cierra la conexión, nuestro cliente no podrá enviar más datos.</p>
  </li>
  <li>
    <p>El servidor debe estar configurado para recibir los datos que le enviamos.</p>
  </li>
</ol>

<p><br /></p>

<p><strong>Emplea el codigo anterior para conectarte a un servidor y contestar a ciertas preguntas</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">What</span> <span class="ow">is</span> <span class="n">each</span> <span class="n">period</span> <span class="n">separated</span> <span class="n">value</span> <span class="n">of</span> <span class="n">an</span> <span class="n">IP</span> <span class="n">address</span> <span class="n">called</span><span class="err">?</span>

<span class="n">Enter</span> <span class="n">your</span> <span class="n">answer</span><span class="p">:</span> <span class="n">octet</span>
<span class="n">What</span> <span class="n">Linux</span> <span class="n">commmand</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">display</span> <span class="n">a</span> <span class="n">routing</span> <span class="n">table</span><span class="err">?</span>
<span class="n">Enter</span> <span class="n">your</span> <span class="n">answer</span><span class="p">:</span> <span class="n">route</span>
<span class="n">What</span> <span class="n">Windows</span> <span class="n">command</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">to</span> <span class="nb">list</span> <span class="n">directory</span> <span class="n">contents</span><span class="err">?</span>
<span class="n">Enter</span> <span class="n">your</span> <span class="n">answer</span><span class="p">:</span> <span class="nb">dir</span>
<span class="n">OS</span><span class="p">{</span><span class="n">You</span><span class="o">-</span><span class="n">are</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">trivia</span><span class="o">-</span><span class="n">guru</span><span class="err">!</span><span class="p">}</span>
<span class="o">***</span> <span class="n">Connection</span> <span class="n">closed</span> <span class="n">by</span> <span class="n">remote</span> <span class="n">host</span> <span class="o">***</span>
</code></pre></div></div>

<p><br /></p>

<h4 id="52-escribir-un-servidor-en-python">5.2. Escribir un Servidor en Python.</h4>

<p><strong>Builiding a Basic Server</strong></p>

<p>Comenzaremos a construir nuestro servidor importando el módulo de socket, inicializando un socket y definiendo un host y un puerto:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#server.py

import socket

server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
host = socket.gethostname()
port = 8080
</code></pre></div></div>

<p>Tenga en cuenta que este código es casi idéntico al comienzo de nuestro código del lado del cliente. Ahora presentaremos algunos métodos de socket más que nuestro servidor deberá utilizar.</p>

<ul>
  <li>El método <em>socket.bind(address)</em> vincula, o asigna, un puerto específico a nuestro programa. En este caso, queremos vincular nuestro servidor al puerto que definimos en la variable de <em>puerto .</em></li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#server.py

import socket

server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
host = socket.gethostname()
port = 8080

server.bind((host, port))
</code></pre></div></div>

<p>Al igual que el método <em>socket.connect</em> , <em>socket.bind</em> espera como input una address completo como en el formato de (host, puerto). Es por eso que hay paréntesis dobles en la llamada al método.</p>

<ul>
  <li>El método <em>socket.listen(int)</em> le dice al servidor que escuche las conexiones entrantes y espera un número entero.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#server.py

import socket

server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server = socket.gethostname()
port = 8080

server.bind((host, port))
server.listen(2) # Wait for a client connection. Only 2 clients can connect to the server
print('Server is listening for incoming connections')
</code></pre></div></div>

<p>El entero especificado en <em>socket.listen()</em> representa el número de clientes que el servidor permitirá conectarse a sí mismo simultáneamente. Una vez que el servidor está escuchando, informa su estado a través de la función de <em>print</em> .</p>

<ul>
  <li>El método <em>socket.accept()</em> devuelve un par de valores ( <em>conn, address</em> ) donde <em>conn</em> representa un nuevo socket que enviará y recibirá mensajes, y <em>address</em> representa la dirección del cliente vinculada al socket.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#server.py

import socket

server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server = socket.gethostname()
port = 8080

server.bind((host, port))
server.listen(2) # Wait for a client connection. Only 2 clients can connect to the server
print('Server is listening for incoming connections')

while True:
    conn, address = server.accept() # Establish the connection with the client
    print("Connection Received from %s" % str(addr))
</code></pre></div></div>

<p>En la lista anterior, comenzamos un ciclo <em>while True</em> que permite las conexiones entrantes a través del par de <em>direcciones</em> <em>conn</em> recién creado. Una vez que se haya establecido una conexión, nuestro servidor informará que se ha producido la conexión.</p>

<ul>
  <li>El método de socket general <em>socket.send\/recv(bytes)</em> permite que un cliente o servidor envíe datos al socket. Estos datos se pueden recibir a través del método <em>socket.recv(buffsize)</em>. El argumento <em>bytes</em> proporcionará varios bytes que se enviarán al socket. Especificar estos bytes puede cambiar la forma en que el método interactúa con la máquina receptora.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#server.py

import socket

server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server = socket.gethostname()
port = 8080

server.bind((host, port))
server.listen(2) # Wait for a client connection. Only 2 clients can connect to the server
print('Server is listening for incoming connections')

while True:
    conn, address = server.accept() # Establish the connection with the client
    print("Connection Received from %s" % str(addr))
    msg = 'Connection Established'+ "\r\n"
    conn.send(msg.encode('ascii'))
</code></pre></div></div>

<p>En la lista anterior, usamos el nuevo socket <em>conn</em> de conexión para enviar el texto “Conexión establecida” al cliente una vez que se conecta al servidor.</p>

<p>Ya casi hemos completado nuestro servidor. La última funcionalidad que agregaremos es la capacidad de cerrar el socket desde el lado del servidor con <em>socket.close()</em>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#server.py

import socket 

host = socket.gethostname()
port = 8080
     
server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server.bind((host,port))
server.listen(2)
print('Server is listening for incoming connections')
     
while True:
    conn,addr = server.accept()
    print("Connection Received from %s" % str(addr))
    msg = 'Connection Established'+ "\r\n"
    conn.send(msg.encode('ascii'))
    conn.close()
</code></pre></div></div>

<p>Observe cómo cerramos el conector de conexión y no el conector del <em>servidor</em> original, para permitir que nuestro servidor siga funcionando y acepte más conexiones.</p>

<p>Resumamos lo que hemos aprendido. Después de crear un nuevo socket, usamos el método <em>socket.bind()</em>, que vincula el programa a una dirección IP y un puerto específicos. Esto permite que el servidor escuche las solicitudes entrantes. Para asegurarnos de que el servidor esté escuchando estas solicitudes, usamos el método <em>socket.listen()</em> . Una vez que el cliente ha solicitado conectarse, usamos el método <em>socket.accept()</em> para aceptar la conexión y el método <em>socket.send()</em> para enviar un mensaje al cliente. Finalmente, invocamos <em>socket.close()</em> para terminar la conexión.</p>

<p>Una vez escrito el script, guardaremos el programa de Python como server.py .</p>

<p><br /></p>

<p><strong>Exercises</strong></p>

<p><strong>3. Este es un desafío de secuencias de comandos. Primero, asegúrese de que su servidor pueda aceptar al menos cuatro conexiones a la vez. Luego, use SSH para iniciar sesión en el contenedor que se ejecuta en el puerto 2004 de la máquina virtual de destino con las credenciales root:root. Ejecute el binario ubicado en /root para volver a conectarse a su servidor y recibir la bandera.</strong></p>

<p>El código emepleado es:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
#server.py
</span>
<span class="kn">import</span> <span class="nn">socket</span> 
     
<span class="n">server</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">server</span><span class="p">.</span><span class="n">bind</span><span class="p">((</span><span class="s">"192.168.49.66"</span><span class="p">,</span> <span class="mi">8080</span><span class="p">))</span>
<span class="n">server</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Server is listening for incoming connections'</span><span class="p">)</span>
     
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">conn</span><span class="p">,</span><span class="n">addr</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="n">accept</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Connection Received from %s"</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">addr</span><span class="p">))</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">'Connection Established'</span><span class="o">+</span> <span class="s">"</span><span class="se">\r\n</span><span class="s">"</span>
    <span class="n">conn</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'ascii'</span><span class="p">))</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">conn</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">conn</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<h4 id="53-escribir-un-portscanner-en-python">5.3. Escribir un PortScanner en Python.</h4>

<p>En esta unidad de aprendizaje, vamos a construir un escáner de puerto simple utilizando las librerias de <em>socket</em> y <em>time</em>. El escaneo de puertos nos permite ubicar puertos abiertos que están disponibles en un host en particular. Como pentesters, podemos configurar nuestro escáner de puertos para recuperar información sobre los puertos, evaluar qué servicios se están ejecutando en cada puerto e incluso adivinar qué sistema operativo se está ejecutando en el host.</p>

<p>Comenzaremos nuestro script importando los módulos relevantes e invocando el método <em>time.time()</em>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#scanner.py

import socket
import time

startTime = time.time()
</code></pre></div></div>

<p>El método <em>time.time()</em> devuelve la hora a la que el intérprete de Python ejecuta la línea de código en la que se encuentra. Usamos este método para almacenar el tiempo inicial de ejecución del programa en la variable <em>startTime</em>.</p>

<p>Al final del script, usaremos <em>time.time()</em> una vez más para almacenar el tiempo futuro en otra variable (<em>endTime</em>). Al restar el valor de <em>endTime</em> de <em>startTime</em>, podemos calcular cuánto tarda el programa en completar su ejecución total.</p>

<p>A continuación, permitiremos que el usuario especifique qué objetivo desea escanear a través del input. Luego usamos <em>socket.gethostbyname()</em> para convertir el nombre de host proporcionado en una dirección IP.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#scanner.py

import socket
import time

startTime = time.time()

target = input('Please specify the host that you want to scan: ')
target_IP = socket.gethostbyname(target)
print ('Initiating Scan for host: ', target_IP)
</code></pre></div></div>

<p>Alternativamente, podríamos omitir la línea que comienza con “target_IP” y simplemente permitir que el usuario proporcione una dirección IP como entrada en lugar de un nombre de host.</p>

<p>Cuando ejecuta su escaneo contra la máquina de ejercicios, es posible que desee ajustar esta parte del guión.</p>

<p>A continuación, emplearemos un ciclo <em>for</em> para determinar qué puertos queremos escanear en nuestro objetivo. En lugar del método familiar <em>socket.connect()</em>, usaremos <em>socket.connect_ex()</em> para iniciar la conexión. <em>socket.connect_ex()</em> hace lo mismo que <em>socket.connect()</em> , pero devuelve un indicador de error en caso de éxito o fracaso. En particular, devolverá 0 cuando se ejecute con éxito. Esto significa que cuando este método devuelve 0, sabemos que el puerto específico que estábamos escaneando en ese momento estaba abierto.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#scanner.py

import socket
import time

startTime = time.time()

target = input('Please specify the host that you want to scan: ')
target_IP = socket.gethostbyname(target)
print ('Initiating Scan for host: ', target_IP)
     
for i in range(1, 1000):
    scanner = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    conn = scanner.connect_ex((target_IP, i))
    if(conn == 0):
        print ('Port %d: OPEN' %(i))
    scanner.close()
</code></pre></div></div>

<p>En el ciclo <em>for</em>, estamos iterando sobre los puertos 1 a 1000. Podemos cambiar fácilmente estos valores, o mejor aún, permitir que el usuario especifique qué puertos desea escanear a través de argumentos de línea de comando. Dejaremos más mejoras al guión como ejercicio para el lector.</p>

<p>Finalmente, simplemente necesitamos ejecutar <em>time.time()</em> nuevamente y calcular cuánto tiempo lleva el escaneo, como se describe anteriormente.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#scanner.py

import socket
import time

startTime = time.time()

target = input('Please specify the host that you want to scan: ')
target_IP = socket.gethostbyname(target)
print ('Initiating Scan for host: ', target_IP)
     
for i in range(1, 1000):
    scanner = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    conn = scanner.connect_ex((target_IP, i))
    if(conn == 0):
        print ('Port %d: OPEN' %(i))#El %d expone la variable indicada con posterioridad en decimal.
    scanner.close()

endTime = time.time()
totalTime = endTime - startTime
print('Total Time: %s' %(totalTime))
</code></pre></div></div>

<p>Ejecutar el script nos pedirá que ingresemos un nombre de host y realizará el escaneo de puertos. El script debería generar un resultado similar al siguiente.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ python3 scanner.py                             
Please specify the host that you want to scan: localhost
Initiating Scan for host:  127.0.0.1
Port 22: OPEN
Port 80: OPEN
Port 8080: OPEN
Total Time: 3.3422038555145264
</code></pre></div></div>

<p>En el ejemplo anterior, especificamos <em>localhost</em> como el objetivo para escanear. Dado que el script usa el método <em>socket.gethostbyname()</em>, nos permite especificar el nombre de host IPv4 de una máquina y recuperar su dirección IP. Como actualización, localhost generalmente se resuelve en la dirección IP de loopback, 127.0.0.1.</p>

<p>Descubrimos que tenemos tres puertos escuchando en nuestra máquina virtual local y que el script tardó aproximadamente 3,34 segundos en ejecutarse de principio a fin. Podemos expandir este script brindándole un medio para recorrer una lista de hosts mediante la creación de bucles <em>for</em> anidados , o haciendo que envíe diferentes tipos de paquetes a los hosts a los que se conecta.</p>

<p><br /></p>

<p><strong>Exercises</strong></p>

<p><strong>1. Vuelva a crear el escáner de puertos en esta sección. Luego, apunte a los puertos 3000 a 3999 de la máquina virtual de destino. En orden numérico, ¿qué puertos están abiertos? Ingrese su respuesta en el siguiente formato: WWWW, XXXX, YYYY, ZZZZ</strong></p>

<p>El script empleado es:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
#scanner.py
</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"[!] This script works with the IP, starting port and end port respectively as parameters."</span><span class="p">)</span>
    <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">startTime</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="c1">#Este parámetro recoge el tiempo actual.
</span><span class="n">target</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#Este parámetro asocia a la variable target el primer parámtero con el que se pasa el stream.
</span><span class="n">target_IP</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'[+] Initiating Scan for host: '</span><span class="p">,</span> <span class="n">target_IP</span><span class="p">)</span>
     
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">])):</span> <span class="c1">#Se toma para el escaneo los números pasados como segundo y tercer parámetros del script.
</span>    <span class="n">scanner</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">scanner</span><span class="p">.</span><span class="n">connect_ex</span><span class="p">((</span><span class="n">target_IP</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span> <span class="c1">#Empleamos el connext_ex() method para interpretar a partir del código de error del mismo el estado del puerto escaneado.
</span>    <span class="k">if</span><span class="p">(</span><span class="n">conn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">'[+] -&gt; Port %d: OPEN'</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="c1">#El %d expone la variable indicada con posterioridad en decimal.
</span>    <span class="n">scanner</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">endTime</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span><span class="c1">#Guardamos en la variable endtime el tiempo transcurrido y lo restamos al startTime para obtener el tiempo de duración del scaner.
</span><span class="n">totalTime</span> <span class="o">=</span> <span class="n">endTime</span> <span class="o">-</span> <span class="n">startTime</span>
<span class="k">print</span><span class="p">(</span><span class="s">'[+] Total Time: %s'</span> <span class="o">%</span><span class="p">(</span><span class="n">totalTime</span><span class="p">))</span>

</code></pre></div></div>

<p><br /></p>

<p><strong>Port Knoking</strong></p>

<p><em>Port Knocking</em> es un medio por el cual los usuarios externos pueden abrir un puerto cerrado en una máquina conectándose primero a una lista predeterminada de otros puertos en un orden específico. Piense en ello como ingresar un PIN en un dispositivo móvil: si ingresa los números correctos en el orden correcto, el teléfono se desbloqueará. De manera similar, suponiendo que el firewall de la máquina se haya configurado de tal manera, “tocar” los puertos correctos en el orden correcto abrirá el puerto cerrado.</p>

<p>Una implementación de <em>Port Knocking</em> puede agregar una capa de seguridad pequeña pero no despreciable a un sistema, porque evita escaneos de puertos como el que hemos ejecutado anteriormente. Dado que el escaneo de puertos iterará a través de un bucle, es muy poco probable que el firewall esté configurado para abrir el puerto cerrado según las reglas exactas que sigue nuestro escaneo. Un usuario externo primero deberá tener un conocimiento profundo del sistema, antes de poder conectarse al servicio cerrado.</p>

<p>Las reglas del port knocking se pueden hacer arbitrariamente complejas, lo que aumenta el requesito del conocimiento del sistema requerido por el usuario externo. Tenga en cuenta, sin embargo, que la activación de puertos por sí sola no es un sistema de seguridad suficiente, ya que se basa en la seguridad por oscuridad. Se puede comparar con la autenticación de un solo factor, que representa algo que el usuario conoce como el único medio de autenticación. En este caso, lo que el usuario sabe es el orden de los puertos para golpear.</p>

<p><br /></p>

<p><strong>Exercise</strong></p>

<p><strong>1. Modifique su escáner de puertos para que golpee con precisión y en orden numérico los ocho puertos que tienen números Pronic en el rango de 4000 a 4999. Es posible que deba buscar la definición de “número Pronic” para determinar qué puertos escanear. Una vez que haya realizado la secuencia de activación del puerto, use las credenciales Aristotle:Lyceum para SSH al puerto recién abierto 2222. ¿Cuál es la bandera en el escritorio del usuario?</strong></p>

<p>En primer lugar debemos saber que los números prónicos son aquellos que forman parte de la serie definida por la operación ‘n(n+1)’ donde n es un número natural.</p>

<p>De esta forma, con un sencillo script podemos ver que los números prónicos comprendidos entre el 4000 y el 5000 son aquellos que se corresponden con una n en el rango [63 - 70]</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cat</span> <span class="n">portknocking</span><span class="p">.</span><span class="n">py</span> 
<span class="c1">#!/usr/bin/python3
</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
</code></pre></div></div>

<p><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./portknocking.py 100 | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s1">' 4'</span>
<span class="c">#6 42</span>
<span class="c">#20 420</span>
<span class="c">#21 462</span>
63 4032
64 4160
65 4290
66 4422
67 4556
68 4692
69 4830
70 4970
</code></pre></div></div>

<p>De esta forma reutilizamos el escaner de puertos y añadimos una pequeña variación para escane puertos identificados por números prónicos:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
#scanner.py
</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"[!] This script works with the IP, starting port and end port respectively as parameters."</span><span class="p">)</span>
    <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">startTime</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">target_IP</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'[+] Initiating Scan for host: '</span><span class="p">,</span> <span class="n">target_IP</span><span class="p">)</span>
     
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">])):</span>
    <span class="n">scanner</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># MODIFICACIÓN
</span>    <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">scanner</span><span class="p">.</span><span class="n">connect_ex</span><span class="p">((</span><span class="n">target_IP</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span> <span class="c1"># MODIFICACIÓN
</span>    <span class="k">if</span><span class="p">(</span><span class="n">conn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">'[+] -&gt; Port %d: OPEN'</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="c1">#El %d expone la variable indicada con posterioridad en decimal.
</span>    <span class="n">scanner</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">endTime</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">totalTime</span> <span class="o">=</span> <span class="n">endTime</span> <span class="o">-</span> <span class="n">startTime</span>
<span class="k">print</span><span class="p">(</span><span class="s">'[+] Total Time: %s'</span> <span class="o">%</span><span class="p">(</span><span class="n">totalTime</span><span class="p">))</span>
</code></pre></div></div>

<p><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./scanner.py 192.168.66.68 63 71   
<span class="o">[</span>+] Initiating Scan <span class="k">for </span>host:  192.168.66.68
4032
4160
4290
4422
4556
4692
4830
4970
<span class="o">[</span>+] Total Time: 0.905632495880127
</code></pre></div></div>

<p><br /></p>

<h4 id="54-interacción-web-con-python">5.4. Interacción Web con Python.</h4>

<p><strong>Sockets con HTTP</strong></p>

<p>Imagine que hemos identificado un servidor web como nuestro objetivo y necesitamos aprender más sobre el servicio. En esta situación, podemos crear un script con Python que enviará solicitudes HTTP a nuestro servidor web para analizar cómo responde. Esta técnica es muy útil porque podemos aprender más sobre el servidor web y cómo se comunica con nuestro cliente, y evaluar si es vulnerable a algún exploit del que tengamos conocimiento.</p>

<p>En esta sección, usaremos el módulo de <em>socket</em> nuevamente para crear una conexión TCP sin procesar a un servidor web que se ejecuta en el puerto 80. Dado que estamos usando una conexión de socket sin procesar, debemos proporcionar la solicitud HTTP específica que se enviará al servidor.</p>

<p>El módulo de socket opera en el equivalente de la capa de transporte de los modelos de referencia de red OSI o TCP/IP. Por lo tanto, debemos encapsular los datos del protocolo de la capa de aplicación (es decir, HTTP) que queremos enviar a través de la capa de transporte.</p>

<p>Comenzaremos nuestro script importando el módulo de socket y definiendo un host y un puerto remotos.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#http-sockets.py

import socket

remote_host = "www.offensive-security.com"
remote_port = 80
</code></pre></div></div>

<p>Llamamos a nuestro script http-sockets.py. Tenga en cuenta que no podemos llamar al script http.py porque Python tiene un módulo integrado con el mismo nombre.</p>

<p>A continuación, almacenemos la solicitud HTTP que queremos hacer al servidor dentro de una variable, a la que llamaremos acertadamente <em>request</em>. Para obtener más detalles sobre el formato de una solicitud HTTP, consulte el tema Conceptos básicos de aplicaciones web.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#http-sockets.py

import socket

remote_host = "www.offensive-security.com"
remote_port = 80

request = "GET / HTTP/1.1\r\nHost: www.offensive-security.com\r\n\r\n"
</code></pre></div></div>

<p>Necesitamos especificar la solicitud exacta que queremos que nuestro servidor envíe al servidor, por lo que debemos incluir la sintaxis precisa y las nuevas líneas (“\r\n”) que espera HTTP.</p>

<p>La siguiente parte del script es similar a la creación de un cliente de Python. Inicializaremos un socket y luego lo usaremos para conectarnos al servidor. Una vez que estemos conectados, usaremos <em>socket.send()</em> para realizar nuestra solicitud, usando nuestra variable de <em>request</em>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#http-sockets.py

import socket

remote_host = "www.offensive-security.com"
remote_port = 80

request = "GET / HTTP/1.1\r\nHost: www.offensive-security.com\r\n\r\n"

client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client.connect((remote_host,remote_port))
client.send(request.encode())
</code></pre></div></div>

<p>Finalmente, queremos captar la respuesta que nos envía el servidor, así que usaremos el método <em>socket.recv(bytes)</em> y luego la decodificaremos e imprimiremos.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#http-sockets.py

import socket

remote_host = "www.offensive-security.com"
remote_port = 80

request = "GET / HTTP/1.1\r\nHost: www.offensive-security.com\r\n\r\n"

client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client.connect((remote_host,remote_port))
client.send(request.encode())

response = client.recv(4096)
print(response.decode())
</code></pre></div></div>

<p>Es importante tener en cuenta que el método <em>send()</em> requiere un argumento de objeto similar a un byte, no una cadena. Podemos usar el método <em>encode()</em> en una variable para convertir su contenido en bytes y usar el método <em>decode()</em> para convertir bytes en una cadena.</p>

<p>Como se mencionó anteriormente, el método <em>recv()</em> se usa para recibir la respuesta del servidor. Este método requiere un argumento, que es el número máximo de datos en bytes que se recibirán.</p>

<p><br /></p>

<p><strong>GET Requests with Python</strong></p>

<p>Python nos permite comunicarnos directamente a través de HTTP en lugar de abrir sockets de red sin procesar. En esta sección, importaremos la librería <em>requests</em> para crear una solicitud HTTP GET y mostrar la respuesta.</p>

<p>Comencemos nuestro script importando el módulo de <em>requests</em> y definiendo una URL de destino a la que queremos enviar una solicitud.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#web-client.py

import requests

url = "http://www.offensive-security.com"
</code></pre></div></div>

<p>A continuación, emplearemos nuestro primer método de solicitudes, <em>request.get()</em>. Este método realizará una solicitud HTTP a la URL proporcionada como argumento y devolverá un objeto <em>response</em>. El objeto de <em>response</em> se puede analizar y formatear de varias maneras.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#web-client.py

import requests

url = "http://www.offensive-security.com"

response = requests.get(url)
print(response.content.decode())
</code></pre></div></div>

<p>En la lista anterior, usamos el método <em>Requests.content()</em> para leer el contenido del objeto <em>response</em> en bytes. Pasamos la salida al método <em>decode()</em> y la imprimimos, para que podamos verla en texto sin formato.</p>

<p>Este script básico se puede modificar en una variedad de formas que nos permiten extraer la información precisa que estamos buscando de un servidor web.</p>

<p>Durante una fase de reconocimiento de una prueba de penetración (por ejemplo), es posible que solo nos interese determinar el código de estado de las distintas páginas. El método <em>Requests.status_code()</em> extrae el código de estado de la respuesta del objeto <em>Response</em>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#web-client.py

import requests

url = "http://www.offensive-security.com/doesnotexist.html"

response = requests.get(url)
print(response.status_code)
</code></pre></div></div>

<p>Como repaso, los códigos de estado se agrupan en las siguientes clases:</p>

<ul>
  <li>Código 100-199: Respuestas informativas</li>
  <li>Código 200-299: Respuestas exitosas</li>
  <li>Código 300-399: redirecciones</li>
  <li>Código 400-499: errores del cliente</li>
  <li>Código 500-599: Errores del servidor</li>
</ul>

<p>Cuando se ejecute el script, obtendremos el código de estado de la URL que hemos especificado. La URL que solicitamos es www.offensive-security.com/doesnotexist.html . Dado que esta página no existe, el servidor responderá con un código de estado de error del cliente (404).</p>

<p>A continuación, modifiquemos el script para devolver solo los encabezados de respuesta del servidor. Podemos hacer esto con el método <em>Requests.headers()</em>. Podemos analizar los encabezados para comprender mejor el servidor web y cómo interactúa con los clientes.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#web-client.py

import requests

url = "http://www.offensive-security.com"

response = requests.get(url)
print(response.headers)
</code></pre></div></div>

<p>En esta iteración del script, enviamos una solicitud a http://www.offensive-security.com e imprimimos los encabezados de respuesta que recibimos del servidor.</p>

<p>Finalmente, el método <em>Requests.text()</em> nos permite imprimir la respuesta completa en Unicode.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#web-client.py

import requests

url = "http://www.offensive-security.com"

response = requests.get(url)
print(response.text)
</code></pre></div></div>

<p>Este script realiza una solicitud simple a http://www.offensive-security.com e imprime la respuesta. Recuerde que las requests.content() deben usarse cuando el servidor entrega datos en formato binario y requests.text() cuando entrega datos textuales.</p>

<p><br /></p>

<p><strong>Parsing HTML. Web Scraping.</strong></p>

<p>Si ha utilizado los métodos <em>requests.content()</em> o <em>requests.text()</em> anteriores, es probable que haya descubierto que la respuesta puede contener una cantidad significativa de datos HTML. A veces, es posible que deseemos obtener información específica de un sitio sin todo el desorden que implica una respuesta completa. </p>

<p>El <em>Web Scraping</em> es un proceso de barrido de la información contenida en una página web y la extracción de la información que nos interesa. Como pentester, a veces es más fácil recuperar los datos que estamos buscando escribiendo un script que tratando de buscar el datos manualmente desde el sitio web.</p>

<p>Comencemos usando el módulo <em>urllib3</em> para enviar una solicitud HTTP que obtendrá los datos de la página web. La biblioteca de <em>requests</em> utiliza la librería <em>urllib3</em> pero en este caso, lo importaremos explícitamente solo para que podamos familiarizarnos con la sintaxis diferente.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#parse.py

import urllib3

http = urllib3.PoolManager()

url = 'http://www.megacorpone.com'

response = http.request('GET', url)
print(response.data.decode('utf-8'))
</code></pre></div></div>

<p>Aquí, creamos una variable llamada <em>http</em> que llama al módulo <em>urllib3</em> y usamos el método <em>PoolManager</em> para ordenar los resultados desordenados. Luego, la variable <em>url</em> se usa para llamar al sitio web al que estamos enviando una solicitud HTTP. Podemos cambiar la variable <em>url</em> para especificar otros dominios o direcciones IP.</p>

<p>La secuencia de comandos anterior imprimirá la salida del sitio web de destino en el terminal, pero se mostrará como código HTML sin formato. Avancemos y ejecutemos el script, y pasemos el resultado al comando head para cortarlo.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali:~$ python3 parse.py | head -n 20
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
    &lt;meta name="description" content=""&gt;
    &lt;meta name="author" content=""&gt;
    &lt;link rel="shortcut icon" href="assets/ico/favicon.ico"&gt;

    &lt;title&gt;MegaCorp One - Nanotechnology Is the Future&lt;/title&gt;

    &lt;!-- Bootstrap core CSS --&gt;
    &lt;link href="assets/css/bootstrap.css" rel="stylesheet"&gt;

    &lt;!-- Custom styles for this template --&gt;
    &lt;link href="assets/css/style.css" rel="stylesheet"&gt;
    &lt;link href="assets/css/font-awesome.min.css" rel="stylesheet"&gt;
</code></pre></div></div>

<p>Para que los datos sean más fáciles de leer, podemos usar otro módulo llamado <em>BeautifulSoup</em>. Este módulo toma los archivos HTML y XML sin procesar de la librería urlopen y extrae los datos para ayudar a analizar la información que hemos recuperado de la página web.</p>

<p>Podemos incluir nuestro nuevo módulo modificando nuestro script de la siguiente manera.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#parse.py

import urllib3
from urllib.request import urlopen
from bs4 import BeautifulSoup

url = urlopen("http://www.megacorpone.com")

page = url.read()
soup = BeautifulSoup(page, features="html.parser")

print(soup)
</code></pre></div></div>

<p>En la lista anterior, importamos dos bibliotecas de <em>urllib3</em> y <em>bs4</em>. La libreria <em>urlopen</em> nos permite recuperar los datos sin procesar devueltos por el servidor. La biblioteca <em>beautifulsoup</em> es responsable del análisis real de la salida.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;!DOCTYPE html&gt;

&lt;html lang="en"&gt;
&lt;head&gt;
&lt;meta charset="utf-8"/&gt;
&lt;meta content="IE=edge" http-equiv="X-UA-Compatible"/&gt;
&lt;meta content="width=device-width, initial-scale=1" name="viewport"/&gt;
&lt;meta content="" name="description"/&gt;
&lt;meta content="" name="author"/&gt;
&lt;link href="assets/ico/favicon.ico" rel="shortcut icon"/&gt;
&lt;title&gt;MegaCorp One - Nanotechnology Is the Future&lt;/title&gt;
&lt;!-- Bootstrap core CSS --&gt;
&lt;link href="assets/css/bootstrap.css" rel="stylesheet"/&gt;
&lt;!-- Custom styles for this template --&gt;
&lt;link href="assets/css/style.css" rel="stylesheet"/&gt;
&lt;link href="assets/css/font-awesome.min.css" rel="stylesheet"/&gt;
&lt;!-- Just for debugging purposes. Don't actually copy this line! --&gt;
&lt;div style="text-align:center"&gt;
	&lt;img src="/assets/img/pen/Pasted%20image%20IE.png" text-align="center"/&gt;
&lt;/div&gt;
&lt;!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries --&gt;
&lt;!--[if lt IE 9]&gt;
</code></pre></div></div>

<p>Si bien el resultado de la lista anterior no es más legible que el resultado proporcionado por el script original, BeautifulSoup tiene muchos métodos que podemos usar para reducir, clasificar y mostrar el texto deseado. Por ejemplo, el método de <em>text</em> imprimirá solo el contenido textual de la página web. Los siguientes ejercicios le permiten flexibilizar su capacidad para recopilar datos específicos de un servidor web.</p>

<p><br /></p>

<p><strong>Exercises</strong></p>

<p><strong>1. El sitio web en el puerto 8080 de la máquina virtual de destino tiene varias páginas en el directorio /crawling. Usa tus habilidades de Python para GET el contenido en todas las páginas y encuentra la bandera.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"http://192.168.66.68:8080/crawling/"</span><span class="p">)</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="s">'lxml'</span><span class="p">)</span> <span class="c1">#En este caso, cargamos la respuesta en texto sobre el parseador de HTML; lxml.
</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">pre</span><span class="p">.</span><span class="n">contents</span><span class="p">)):</span> <span class="c1">#Seguidamente formamos el objeto 'soup.pre.contents', el cual nos ofrece los contenidos del elemento HTML &lt;pre&gt; enlistados. 
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span><span class="c1"># Por cuestion de estructuración de la lista, trabajamos con aquellos elementos impares.
</span>        
        <span class="n">tag</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">pre</span><span class="p">.</span><span class="n">contents</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="c1"># Lo transformamos a tipo string para poder filtrar el fragmento que nos interesa.
</span>        <span class="n">start</span> <span class="o">=</span> <span class="n">tag</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="s">"/crawling"</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">tag</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s"> "</span><span class="p">)</span><span class="c1">#Una vez hemos filtrado el fragmento que nos interesa que consiste en el nombre de la página dentro de /crawling, realizmaos las requests a esas páginas y parseamos el contenido hasta dar con la flag.
</span>
        <span class="n">responseFlag</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"http://192.168.66.68:8080"</span><span class="o">+</span><span class="n">tag</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
        <span class="n">soupFlag</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">responseFlag</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="s">'lxml'</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">soupFlag</span><span class="p">.</span><span class="n">pre</span><span class="p">)</span> <span class="o">!=</span> <span class="s">"None"</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">soupFlag</span><span class="p">.</span><span class="n">pre</span><span class="p">.</span><span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>2. Visite el sitio web en el puerto 8080 de la máquina virtual de destino en el directorio /table. La tabla que se encuentra en la página contiene la bandera, pero cada fila contiene una letra diferente. Use Python para realizar una solicitud a esta página y analizar la respuesta.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"http://192.168.66.68:8080/table"</span><span class="p">)</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="s">'lxml'</span><span class="p">)</span>

<span class="n">Chunk</span> <span class="o">=</span> <span class="s">""</span>
<span class="n">Flag</span> <span class="o">=</span> <span class="s">""</span>
<span class="n">String</span> <span class="o">=</span> <span class="s">""</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">tbody</span><span class="p">.</span><span class="n">contents</span><span class="p">)):</span><span class="c1">#Desplegamos todo el contenido de la Flag y lo agrupamos en un string.
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Chunk</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">tbody</span><span class="p">.</span><span class="n">contents</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">Chunk1</span> <span class="o">=</span> <span class="n">Chunk</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'&lt;td&gt;'</span><span class="p">,</span><span class="s">''</span><span class="p">)</span>
<span class="n">Chunk2</span> <span class="o">=</span> <span class="n">Chunk1</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'&lt;/td&gt;'</span><span class="p">,</span><span class="s">''</span><span class="p">)</span>
<span class="n">Chunk3</span> <span class="o">=</span> <span class="n">Chunk2</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'&lt;tr&gt;'</span><span class="p">,</span><span class="s">''</span><span class="p">)</span>
<span class="n">Chunk4</span> <span class="o">=</span> <span class="n">Chunk3</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'&lt;/tr&gt;'</span><span class="p">,</span><span class="s">''</span><span class="p">)</span>
<span class="n">Flag</span> <span class="o">=</span> <span class="n">Chunk4</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span><span class="s">''</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">Flag</span><span class="p">)</span> <span class="c1">#Quitamos los elementos ajenos a los caracteres de la flag e imprimos el resto.
</span></code></pre></div></div>

<p><br /></p>

<p><strong>POST Requests and Parameters with Python</strong></p>

<p>El módulo <em>requests</em> también nos permite enviar datos a un servidor a través de una <em>POST-request</em>. En una solicitud POST, los datos que se envían al servidor se almacenan en el cuerpo de la solicitud de una solicitud HTTP. Esto contrasta con una solicitud GET, donde los datos se envían directamente a través de una URL (esto hace además que dichos datos sean fácilmente visibles, así la POST request es preferible a la GET request cuando por ejemplo se está realizando una petición de logeo o cosas similares). Un caso de uso común para las solicitudes POST empleadas por muchos sitios web son los formularios web, como los que se usan al suscribirse a un sitio.</p>

<p>Examinemos un script que hará una solicitud POST y luego devolverá la respuesta del servidor.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
#web-client2.py
</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">'http://www.offensive-security.com'</span>

<span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s">'check-key'</span><span class="p">:</span> <span class="s">'check-value'</span><span class="p">}</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">info</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">post</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>

<p>El script en la lista anterior envía una solicitud a www.offensive-security.com y envía los datos contenidos en la variable de <em>información</em>. Una vez enviados los datos, se imprimirá la respuesta en forma de texto.</p>

<p>Hay otros métodos HTTP que podemos usar en nuestros scripts de Python como <em>PUT</em>, <em>DELETE</em>, <em>HEAD</em>, y <em>OPTIONS</em> para interactuar con el servidor web. Lo alentamos a que experimente escribiendo guiones para cada uno de estos.</p>

<p><br /></p>

<p><strong>Exercises</strong></p>

<p><strong>1. La página en el puerto 8080 del servidor de destino llamada /basic-post solo acepta solicitudes POST. Realice cualquier solicitud POST a la página para recibir la bandera.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">post</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'http://192.168.66.68:8080/basic-post/'</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'offsec'</span><span class="p">:</span> <span class="s">'hello'</span><span class="p">})</span><span class="c1">#Observemos la barra final en basic-post/, sin esta la URL no sería interpretada correctamente como POST.
</span>
<span class="k">print</span><span class="p">(</span><span class="n">post</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>2. You can authenticate to page at port 8080 of the target server called /login-1 with the username ‘thobbes’ and the password ‘leviathan’. Make a POST request to the page with the above credentials to get the flag.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">post</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'http://192.168.66.68:8080/login-1/'</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'username'</span><span class="p">:</span> <span class="s">'thobbes'</span><span class="p">,</span> <span class="s">'password'</span><span class="p">:</span> <span class="s">'leviathan'</span><span class="p">})</span>

<span class="k">print</span><span class="p">(</span><span class="n">post</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>3. Puede autenticarse en la página del puerto 8080 del servidor de destino llamado /login-2 con el nombre de usuario ‘rdescartes’ y la contraseña ‘discourse’… sin embargo, ¡la contraseña va seguida de cinco caracteres! @ # % &amp; en algún orden desconocido. Por ejemplo, la contraseña podría ser discurso#!@&amp;%, o podría ser discurso%&amp;@!#. Use Python para recorrer todas las solicitudes POST posibles para determinar la contraseña e inicie sesión para obtener el indicador.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">myList</span> <span class="o">=</span> <span class="p">[</span><span class="s">"!"</span><span class="p">,</span><span class="s">"@"</span><span class="p">,</span><span class="s">"#"</span><span class="p">,</span><span class="s">"%"</span><span class="p">,</span><span class="s">"&amp;"</span><span class="p">]</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">random</span><span class="p">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">myList</span><span class="p">)</span><span class="c1">#Esto cambia aleatoriamente el orden de la lista anterior premitiéndonos así probar con todas las posibles variaciones.
</span>    <span class="n">password</span> <span class="o">=</span> <span class="s">"discourse"</span><span class="o">+</span><span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">myList</span><span class="p">)</span><span class="c1">#Adherimos todos los elementos de la lista ya variada a 
</span>    <span class="n">post</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'http://192.168.114.68:8080/login-2/'</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'username'</span><span class="p">:</span> <span class="s">'rdescartes'</span><span class="p">,</span> <span class="s">'password'</span><span class="p">:</span> <span class="n">password</span><span class="p">})</span>
    
    <span class="k">if</span> <span class="s">'OS{'</span> <span class="ow">in</span> <span class="n">post</span><span class="p">.</span><span class="n">text</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">post</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[+] Credentials are: "</span><span class="o">+</span><span class="n">password</span><span class="p">)</span>
        <span class="k">break</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[!] "</span><span class="o">+</span><span class="n">password</span><span class="o">+</span><span class="s">" is not valid."</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>4.  La página en el puerto 8080 del servidor de destino llamada /bijection acepta un valor entero que corresponde a la posición de la letra de la bandera. Por ejemplo:</strong></p>

<ul>
  <li>/bijection?index=0 devolverá el carácter ‘O’</li>
  <li>/bijection?index=1 devolverá el carácter ‘S’</li>
  <li>/bijection?index=2 devolverá el carácter ‘{‘</li>
</ul>

<p><strong>Use sus habilidades de Python para crear un script que obtenga la bandera completa. Tenga en cuenta que la página solo aceptará solicitudes POST.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Flag</span> <span class="o">=</span> <span class="s">""</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'http://192.168.114.68:8080/bijection/'</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'index'</span><span class="p">:</span> <span class="n">i</span><span class="p">})</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="s">'lxml'</span><span class="p">)</span><span class="c1">#Realizamos una request y filtramos la respuesta por un parseador HTML.
</span>    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">charFlag</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">div</span><span class="p">.</span><span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span><span class="s">''</span><span class="p">)).</span><span class="n">replace</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span><span class="s">''</span><span class="p">))</span>
<span class="c1">#Aislamos el caracter de la Flag en cada respuesta primero obteniendo un campo de contexto reducido que incluya dicho caracter con body.div y retirando con replace espacios y saltos de línea.
</span>    <span class="k">if</span> <span class="n">charFlag</span> <span class="o">!=</span> <span class="s">"}"</span><span class="p">:</span>
        <span class="n">Flag</span> <span class="o">+=</span> <span class="n">charFlag</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Flag</span> <span class="o">+=</span> <span class="n">charFlag</span>
        <span class="k">break</span>

<span class="k">print</span><span class="p">(</span><span class="n">Flag</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>Encabezados HTTP</strong></p>

<p>Un <em>HTTP header</em> permite que el cliente y el servidor pasen información adicional en la solicitud o la respuesta HTTP que estos intercambian. El encabezado consta de un nombre que no distingue entre mayúsculas y minúsculas seguido de un punto y coma (:) y luego un valor. Un <em>Request Header</em> contiene información detallada sobre el recurso que se está consultando. Un <em>Response Header</em> contiene información adicional sobre la respuesta. Por ejemplo, un encabezado de respuesta podría incluir la ubicación del servidor.</p>

<p>Uno de los encabezados más importantes que debemos conocer es el <em>Content-Type</em>. Este encabezado se utiliza para indicar el tipo de medio original del recurso.</p>

<p>En la respuesta, el Content-Type de contenido le dice al cliente qué tipo de contenido se mostrará.</p>

<p>Para que podamos identificar el tipo de contenido del servidor, debemos enviar una solicitud específica al servidor y hacer que la respuesta muestre la salida de los encabezados HTTP. El siguiente script realiza una solicitud GET a www.offensive-security.com e imprime los encabezados HTTP de la respuesta.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python3
#headers.py

import requests

url = "http://www.offensive-security.com"
response = requests.get(url)
print(response.headers)
</code></pre></div></div>

<p>El servidor responderá con el siguiente resultado.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{'Server': 'Sucuri/Cloudproxy', 'Date': 'Wed, 09 Jun 2021 02:32:42 GMT', 'Content-Type': 'text/html; charset=UTF-8', 'Content-Length': '14838', 'Connection': 'keep-alive', 'X-Sucuri-ID': '17005', 'X-XSS-Protection': '1; mode=block', 'X-Frame-Options': 'SAMEORIGIN', 'X-Content-Type-Options': 'nosniff', 'Strict-Transport-Security': 'max-age=31536000; includeSubdomains; preload', 'Content-Security-Policy': 'upgrade-insecure-requests;', 'Link': '&lt;https://www.offensive-security.com/&gt;; rel=shortlink', 'Vary': 'Accept-Encoding,User-Agent', 'Content-Encoding': 'gzip', 'X-Sucuri-Cache': 'HIT'}
</code></pre></div></div>

<p>En la lista anterior, el <em>‘Tipo de contenido’: ‘text/html; charset=UTF-8’</em> indica que la página mostrará la información en formato de texto/html. Tenga en cuenta que el tipo de contenido siempre cambiará según la solicitud enviada al servidor.</p>

<p><br /></p>

<p><strong>Exercises</strong></p>

<p><strong>1. El directorio en el puerto 8080 del servidor de destino llamado /headers tiene diez subpáginas llamadas /headers/1 a /headers/10. Cada página tiene un encabezado personalizado llamado “Flag” que contiene una parte de la bandera. Usa Python para juntar todos los componentes de la Flag.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">Flag</span> <span class="o">=</span> <span class="s">""</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://192.168.114.68:8080/headers/'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">chunk</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">chunkList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chunk</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">))</span>
    <span class="n">Flag</span> <span class="o">+=</span> <span class="n">chunkList</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\'</span><span class="s">Flag</span><span class="se">\'</span><span class="s">:'</span><span class="p">,</span><span class="s">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\'</span><span class="s">'</span><span class="p">,</span><span class="s">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span><span class="s">''</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">Flag</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>2. La página en el puerto 8080 del servidor de destino llamado /objeto devuelve un binario que, cuando se ejecuta, imprime la bandera. Use python para guardar el binario y luego ejecútelo para obtener la bandera.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="k">print</span><span class="p">(</span><span class="s">'[+] Creating file.'</span><span class="p">)</span>
<span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'code.bin'</span><span class="p">,</span><span class="s">'x'</span><span class="p">)</span><span class="c1">#Creamos un fichero para guardar el binario.
</span><span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"code.bin"</span><span class="p">,</span><span class="s">'wb'</span><span class="p">)</span> <span class="c1"># vamos a escribir en binario (wb).
</span>
<span class="k">print</span><span class="p">(</span><span class="s">"[+] File created and open. Writing Content."</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://192.168.114.68:8080/object'</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">)</span><span class="c1">#Realizamos la request y escribimos el contenido sobre el fichero abierto anteriormente y lo cerramos.
</span>
<span class="k">print</span><span class="p">(</span><span class="s">"[+] File writed with the binary. CLosing file."</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s">"[+] Executing binary."</span><span class="p">)</span><span class="c1">#Seguidamente, utilizamos el modulo 'subprocess'para ejecutar un comando que corra el binario.
</span><span class="n">subprocess</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="s">"chmod +x /home/kali/code.bin; /home/kali/code.bin"</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"[+] Finish. Cleaning enviroment."</span><span class="p">)</span>
<span class="n">subprocess</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="s">"rm /home/kali/code.bin"</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="c1">#Finalmente, con los contenidos desplegados borramos el código del binario pues ya no nos hace falta.
</span></code></pre></div></div>

<p><br /></p>

<p><strong>3. La página en el puerto 8080 del servidor de destino llamada /about.html contiene una lista de 30 empleados, sus direcciones de correo electrónico y sus colores favoritos. Solo uno de estos usuarios puede iniciar sesión en la página en /login-3. Utilice Python para determinar qué usuario tiene una cuenta válida analizando las respuestas a sus solicitudes. ¿Cuál es el nombre del usuario válido?</strong>
En primer lugar acudimos al sitio web y observamos que el logeo se realiza mediante el email. Además, la página contiene una vulnerabilidad de leak-information pues especifica que el usuario no es correcto:</p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020230115174440.png" text-align="center" />
</div>

<p>De esta forma desarrollamos el siguiente código en Python.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">ResponseGet</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://192.168.114.68:8080/about.html'</span><span class="p">)</span>
<span class="c1">#En primer lugar, vamos a intentar organizar los datos de cada usuario en una tabla para luego, de forma organizada intentar utilizar estas credenciales para acceder al área /login-3.
</span>
<span class="n">Soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">ResponseGet</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="s">'lxml'</span><span class="p">)</span>

<span class="n">TrashList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Soup</span><span class="p">.</span><span class="n">table</span><span class="p">).</span><span class="n">split</span><span class="p">(</span><span class="s">'&lt;tr&gt;'</span><span class="p">))</span>

<span class="n">String</span> <span class="o">=</span> <span class="s">""</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">TrashList</span><span class="p">)):</span><span class="c1">#Repasamos todos los elementos de la tabla en busca de aquellas entradas que contienen el email y las preparamos en una lista quitando caracteres innecesarios.
</span>    <span class="k">if</span> <span class="s">'@'</span> <span class="ow">in</span> <span class="n">TrashList</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
        <span class="n">String</span> <span class="o">+=</span> <span class="n">TrashList</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">'&lt;td&gt;'</span><span class="p">)[</span><span class="mi">3</span><span class="p">].</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span><span class="s">''</span><span class="p">)</span>

<span class="n">EmailList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'&lt;/td&gt;'</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">EmailList</span><span class="p">)):</span><span class="c1">#Seguidamente, con la tabla de emails ya preparada realizamos las requests. Previamente deberíamos de haber copiado el mensaje de error que la página despliega cuando un usario no valido se introduce en una petición de logeo. Realizamos la petición y examinamos el contenido de la respuesta, si localizamos el mensaje de error descartamos el email y si no guardamos el email con uno válido.
</span>    <span class="n">ResponsePost</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'http://192.168.114.68:8080/login-3/index.php'</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'username'</span><span class="p">:</span> <span class="n">EmailList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">,</span> <span class="s">'password'</span><span class="p">:</span> <span class="s">'TEST'</span><span class="p">})</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="s">"[ERROR] No Such User"</span> <span class="ow">in</span> <span class="n">ResponsePost</span><span class="p">.</span><span class="n">text</span><span class="p">:</span>
        <span class="n">ValidUser</span> <span class="o">=</span> <span class="n">EmailList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">break</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">TrashList</span><span class="p">)):</span><span class="c1">#Por último, desplegamos el nombre asociado al email quitando algunos caracteres innecesearios.
</span>    <span class="k">if</span> <span class="n">ValidUser</span> <span class="ow">in</span> <span class="n">TrashList</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">TrashList</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">'&lt;td&gt;'</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="n">replace</span><span class="p">(</span><span class="s">'&lt;/td&gt;'</span><span class="p">,</span><span class="s">''</span><span class="p">))</span>

</code></pre></div></div>

<p><br /></p>

<p><strong>4. La contraseña de la cuenta válida es el nombre de pila de su colega favorito y el color favorito de su jefe dos veces seguidas. Por ejemplo, si su mejor amigo es Jacob y su jefe es Carly, entonces la contraseña es JacobOrangeJacobOrange. Utilice este conocimiento para autenticarse en el sitio web para obtener la bandera.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">ResponseGet</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://192.168.114.68:8080/about.html'</span><span class="p">)</span>
<span class="c1">#En primer lugar, vamos a intentar organizar los datos de cada usuario en una tabla para luego, de forma organizada intentar utilizar estas credenciales para acceder al área /login-3.
</span>
<span class="n">Soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">ResponseGet</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="s">'lxml'</span><span class="p">)</span>

<span class="n">TrashList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Soup</span><span class="p">.</span><span class="n">table</span><span class="p">).</span><span class="n">split</span><span class="p">(</span><span class="s">'&lt;tr&gt;'</span><span class="p">))</span>

<span class="n">username</span> <span class="o">=</span> <span class="s">"dvaliant@bedlamdynamics.com"</span>
<span class="c1">#Primero creamos sendas listas para nombres y colores favoritos.
</span><span class="n">users</span> <span class="o">=</span> <span class="s">""</span>
<span class="n">colors</span> <span class="o">=</span> <span class="s">""</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">TrashList</span><span class="p">)):</span>
    <span class="n">users</span> <span class="o">+=</span> <span class="n">TrashList</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">'&lt;td&gt;'</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="n">replace</span><span class="p">(</span><span class="s">'&lt;/td&gt;'</span><span class="p">,</span><span class="s">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span><span class="s">''</span><span class="p">)</span><span class="o">+</span><span class="s">","</span>

<span class="n">users</span> <span class="o">+=</span><span class="s">"Brianne"</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">TrashList</span><span class="p">)):</span>
    <span class="n">colors</span> <span class="o">+=</span> <span class="n">TrashList</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">'&lt;td&gt;'</span><span class="p">)[</span><span class="mi">4</span><span class="p">].</span><span class="n">replace</span><span class="p">(</span><span class="s">'&lt;/td&gt;'</span><span class="p">,</span><span class="s">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span><span class="s">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">'&lt;/tr&gt;'</span><span class="p">,</span><span class="s">''</span><span class="p">)</span><span class="o">+</span><span class="s">","</span>
    
<span class="n">colors</span> <span class="o">+=</span> <span class="s">"cyan"</span>
<span class="n">userList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">users</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">','</span><span class="p">))</span>
<span class="n">colorList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colors</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'&lt;/tbody&gt;&lt;/table&gt;'</span><span class="p">,</span><span class="s">''</span><span class="p">).</span><span class="n">split</span><span class="p">(</span><span class="s">','</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">userList</span><span class="p">)):</span><span class="c1">#Seguidamente realizamos requests con todos las combinaciones posibles de acuerdo a las reglas del enunciado.
</span>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">colorList</span><span class="p">)):</span>
        <span class="n">FirstChar</span> <span class="o">=</span> <span class="n">colorList</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="n">swapcase</span><span class="p">()</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">FirstChar</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">colorList</span><span class="p">[</span><span class="n">j</span><span class="p">])):</span>
            <span class="n">color</span> <span class="o">+=</span> <span class="n">colorList</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>

        <span class="n">password</span> <span class="o">=</span> <span class="n">userList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">color</span><span class="o">+</span><span class="n">userList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">color</span>
        <span class="n">ResponsePost</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'http://192.168.114.68:8080/login-3/index.php'</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'username'</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span><span class="s">'password'</span><span class="p">:</span> <span class="n">password</span><span class="p">})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s">"[ERROR]"</span> <span class="ow">in</span> <span class="n">ResponsePost</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="c1">#Por último comprobamos la respuesta de cada request con el objetivo de verificar si está la Flag.
</span>            <span class="k">print</span><span class="p">(</span><span class="s">"[+] "</span><span class="o">+</span><span class="n">username</span><span class="o">+</span><span class="s">":"</span><span class="o">+</span><span class="n">password</span><span class="p">)</span>
            <span class="n">Soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">ResponsePost</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="s">'lxml'</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">Soup</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">div</span><span class="p">.</span><span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span><span class="s">''</span><span class="p">))</span>
            <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="6-introduction-javascript">6. Introduction JavaScript.</h3>

<h4 id="61-introducción-a-javascript">6.1. Introducción a JavaScript.</h4>

<p><em>JavaScript</em> es un lenguaje de programación de alto nivel que se ha convertido en uno de los componentes fundamentales de las aplicaciones web modernas. Todos los navegadores modernos incluyen un motor JavaScript que ejecuta cualquier código JavaScript del lado del cliente.</p>

<p>Cuando un navegador procesa una respuesta HTTP que contiene HTML, el navegador crea un <em>Document Object Model</em> (DOM) y lo representa. JavaScript puede acceder y modificar el DOM de la página, lo que da como resultado una experiencia más interactiva para los usuarios finales. De esta forma podemos definir JavaScript como un lenguaje de programación orientado a objetos implementado para navegadores.</p>

<p>Un ejemplo común donde JavaScript podría ser útil es con la validación de un formulario del lado del cliente. En lugar de enviar un formulario al servidor y hacer que el servidor responda con un error, una función de JavaScript podría verificar primero el formulario antes de enviarlo al servidor.</p>

<p>Podemos leer archivos JavaScript para tener una idea de lo que hacen y comprobar si alguno contiene valores secretos, como credenciales o claves API.</p>

<p><br /></p>

<p><strong>Exercises</strong></p>

<p><strong>1.  Inicie la máquina virtual Javascript. Acceda al sitio web del ejercicio en /module1.html e inspeccione el JavaScript cargado en la página. Identifica la bandera.</strong></p>

<p>Acudiendo a la página pulsamos ‘Ctrl+U’ para acceder al código fuente y con ‘Ctrl + F’ buscamos la Flag por el término ‘OS’:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="c">&lt;!-- Required meta tags --&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1, shrink-to-fit=no"</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- Bootstrap CSS --&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"css/bootstrap.min.css"</span> <span class="na">integrity=</span><span class="s">"sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;title&gt;</span>Intro to JavaScript<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;script&gt;</span>
        <span class="kd">var</span> <span class="nx">flag1</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">OS{NotSoHiddenAfterAll}</span><span class="dl">"</span><span class="p">;</span>
    <span class="nt">&lt;/script&gt;</span>
        
  <span class="nt">&lt;/head&gt;</span>
  [...]
</code></pre></div></div>

<p><br /></p>

<p><strong>2.  Inicie la máquina virtual <em>Javascript .</em> Acceda al sitio web del ejercicio y examine cualquier archivo JavaScript vinculado en busca de indicadores adicionales.</strong></p>

<p>De nuevo, inspeccionamos todos los scripts de java script que tienen siempre el ‘tag’ html ‘&lt;script&gt;’, de esta forma los localizamos buscando dicho término con Ctrl+F llegando a:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[...]
    <span class="c">&lt;!-- Optional JavaScript --&gt;</span>
    <span class="c">&lt;!-- jQuery first, then Popper.js, then Bootstrap JS --&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"scripts/jquery-3.5.1.slim.min.js"</span> <span class="na">integrity=</span><span class="s">"sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"scripts/popper.min.js"</span> <span class="na">integrity=</span><span class="s">"sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"scripts/bootstrap.min.js"</span> <span class="na">integrity=</span><span class="s">"sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"scripts/flags.js"</span><span class="nt">&gt;&lt;/script&gt;</span> <span class="nt">&lt;--</span>
<span class="err">&lt;/</span><span class="na">body</span><span class="nt">&gt;</span>
[...]
</code></pre></div></div>

<p>De esta forma acudimos al subdirectorio /scripts/flags.js y obtenemos la flag.</p>

<p><br /></p>

<h4 id="62-descripción-general-de-la-sintaxis-de-javascript">6.2. Descripción general de la sintaxis de JavaScript.</h4>

<p>Ahora cubramos algunos términos generales de programación que nos ayudarán a comprender los conceptos básicos de JavaScript. Muchos de los términos pueden resultar familiares del tema de secuencias de comandos.</p>

<p>Una <em>variable</em> almacena un valor. 
Un <em>objeto</em> contiene pares de valores clave denominados <em>propiedades</em>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// define a variable named x with a value of 1
var x = 1;
// define an object named z with a property named foo and a value of bar
var z = { foo: "bar"};
</code></pre></div></div>

<p>Una <em>función</em> es un bloque serie de sentencias. Una función puede tener parámetros que deben incluirse cuando se llama a la función. Después de ejecutar la función, puede devolver un valor al código de llamada.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function addNumbers(x, y) { return x + y; }
</code></pre></div></div>

<p>En el ejemplo anterior, el nombre de la función es <em>addNumbers</em> y recibe dos parámetros. La función suma los dos parámetros y devuelve el resultado.</p>

<p>Un <em>método</em> podría considerarse una función asociada a un objeto. El método puede hacer referencia a los atributos del objeto propietario con la palabra clave <em>this</em>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// define an object with a method
var book = { 
  title: 'Moby-Dick', 
  author: 'Herman Melville', 
  toString: function() { 
    return this.title + " by " + this.author; 
  }
};
// call the book object's toString method
book.toString()
// output
"Moby-Dick by Herman Melville"
</code></pre></div></div>

<p>Hay mucho más en JavaScript de lo que podemos cubrir aquí. Estos conceptos básicos nos ayudarán a leer el código JavaScript y comenzar a comprender cómo funciona en el contexto de la seguridad web.</p>

<p><br /></p>

<h4 id="63-cómo-usar-javascript">6.3. Cómo usar JavaScript.</h4>

<p>Podemos utilizar JavaScript podemos utilizar la consola de comandos que podemos abrir ‘Ctrl+Shift+K’.</p>

<p>El objeto del documento contiene todo lo que conforma la página a medida que nuestro navegador la presenta. Si estamos interactuando con el DOM, la mayor parte de nuestro código comenzará con el objeto del documento. </p>

<p>Por ejemplo, podemos usar el método <em>getElementsByTagName()</em> del documento para obtener una lista de todas las etiquetas HTML que coinciden con un valor específico.</p>

<p>Probemos esto en Firefox. Ingresaremos document.getElementsByTagName(“a”) en la consola para seleccionar todas las etiquetas que son enlaces a otras páginas.</p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020230212161101.png" text-align="center" />
</div>

<p>Obtenemos un objeto <em>HTMLCollection</em> (una lista similar a una matriz) que contiene todas las etiquetas de anclaje en el documento. Podemos ampliar la lista de objetos haciendo clic en el icono de intercalación.</p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020230212161233.png" text-align="center" />
</div>

<p>Podemos examinar rápidamente etiquetas interesantes usando JavaScript como este. Hagamos clic en el ícono de la papelera para borrar la salida de la consola y luego obtengamos todos los campos de entrada con document.getElementsByTagName(“input”) .</p>

<div style="text-align:center">
	<img src="/assets/img/pen/Pasted%20image%2020230212161314.png" text-align="center" />
</div>

<p>La HTMLCollection resultante contiene todos los campos de entrada, incluidos los ocultos. No todos los campos contendrán información importante, pero los campos de entrada ocultos a veces pueden contener información confidencial.</p>

<p>Podemos usar la consola de nuestro navegador para ejecutar cualquier función de JavaScript que haya sido cargada por la página web actual.</p>

<p>Utilice herramientas de desarrollo de navegador web para resolver los siguientes ejercicios. Se pueden encontrar más instrucciones en <em>/module2.html</em> de la máquina virtual de destino.</p>

<p><br /></p>

<p><strong>Exercises</strong></p>

<p><strong>1.  Inicie la máquina virtual Javascript. Acceda al sitio web del ejercicio en /module2.html e inspeccione el JavaScript cargado en la página. Utilice las funciones personalizadas para obtener la primera bandera.</strong></p>

<p>Buscamos en el código de la máquina y encontramos el siguiente script que modificamos y ponemos en la consola que abriremos con Ctrl+
Shift + K para que quedemo como sigue:</p>

<pre><code class="language-javascrip">var encoded_flag = "T1N7ZW5jb2RlZEZsYWdWYWx1ZUdvZXNIZXJlfQ==";
var encoded_flag2 = "%54%31%4e%37%59%57%35%76%64%47%68%6c%63%6b%56%75%59%32%39%6b%5a%57%52%47%62%47%46%6e%56%6d%46%73%64%57%56%48%62%32%56%7a%53%47%56%79%5a%58%30%3d";
function decodeOne(f) {
	return atob(f);
}
function decodeTwo(f) {
	return decodeURIComponent(f);
 }
console.log(decodeOne(encoded_flag));
</code></pre>

<p><br /></p>

<p><strong>2.  Inicie la máquina virtual Javascript. Acceda al sitio web del ejercicio en /module2.html e inspeccione el JavaScript cargado en la página. Consigue la segunda bandera.</strong></p>

<pre><code class="language-javascrip">var encoded_flag = "T1N7ZW5jb2RlZEZsYWdWYWx1ZUdvZXNIZXJlfQ==";
var encoded_flag2 = "%54%31%4e%37%59%57%35%76%64%47%68%6c%63%6b%56%75%59%32%39%6b%5a%57%52%47%62%47%46%6e%56%6d%46%73%64%57%56%48%62%32%56%7a%53%47%56%79%5a%58%30%3d";
function decodeOne(f) {
	return atob(f);
}
function decodeTwo(f) {
	return decodeURIComponent(f);
 }
console.log(decodeOne(decodeTwo(encoded_flag2)));
</code></pre>

<p><br /></p>

<h4 id="64-javascript-minification">6.4. JavaScript Minification.</h4>

<p><em>Minification</em> consiste en comprimir archivos JavaScript al eliminar contenido innecesario, como comentarios y espacios en blanco adicionales. Este proceso no cambia la funcionalidad del archivo que se minifica.</p>

<p>Los usuarios finales pueden examinar cualquier cosa en los archivos fuente de JavaScript enviados por un servidor web. Por esta razón, los archivos JavaScript del lado del cliente no deben contener valores secretos, como contraseñas, claves de cifrado o funcionalidades “ocultas”. Los desarrolladores a veces intentan limitar esta exposición minimizando u ofuscando los archivos JavaScript. Sin embargo, los archivos aún deben ser JavaScript válidos que los navegadores puedan analizar.</p>

<p>Algunas bibliotecas de minificación también cambiarán el nombre de variables, funciones y métodos a nombres más cortos. El resultado final es un archivo más pequeño que los navegadores aún pueden leer, pero que es más difícil de leer para los humanos.</p>

<p>La mayoría de los navegadores tienen herramientas integradas que “embellecerán” el código fuente minimizado. Este proceso reintroduce el espacio en blanco y el formato. Todavía tenemos que lidiar con variables y funciones con nombres extraños, pero el diseño “embellecido” ya no es una obstrucción para analizar el código fuente.</p>

<p><em>La ofuscación de código va un paso más allá de la minificación mediante el uso de técnicas adicionales para dificultar la lectura del código, como la codificación de partes del código o la inyección de código muerto.</em> Si bien estas características pueden dificultar que los humanos lean el código, JavaScript, que está muy ofuscado, se ejecuta más lentamente que el código minimizado.</p>

<p><br /></p>

<p><strong>Exercises</strong></p>

<p><strong>1.  Inicie la máquina virtual <em>Javascript .</em> Acceda al sitio web del ejercicio en <em>/module3.html</em> , inspeccione el JavaScript cargado en esta página y obtenga la clave API válida.</strong></p>

<p>Al inspeccionar el código obtenemos que en la página /scripts/previews.min.js se encuentra el siguiente código javascript que en apariencia genera una API Key.</p>

<pre><code class="language-javascrip">var ke="Invalid api key or identifier.",ct="application/x-www-form-urlencoded;charset=UTF-8",fk="key",fi="id";function downloadPreview(e,t){return k=z(y()),fetch("preview.php",{method:"POST",headers:{"Content-Type":ct},body:fk+"="+k+"&amp;"+fi+"="+e}).then(function(e){if(e.ok)return e.blob();throw new Error(e.text)}).then(function(e){var n=document.createElement("a");n.href=URL.createObjectURL(e),n.setAttribute("download",t),n.click()}).catch(e=&gt;{document.getElementById("message").innerText=ke,document.getElementById("message").classList.remove("d-none")}),!1}var a="YTM0ONWU2NDg0NUNmM=",b="YTM0OTk5ZmNiYzdkNWU2Z",c="5ZmNiY",d="WVjNDg0NjYzM2U2M2VmNmM=",e="0NjYzM2U2";function z(e){return atob(e)}function y(){return b+d}
</code></pre>

<p>De manera que, observamos que en dicho código se llaman a diversas funciones, especialmente llamativa es la función y() de forma que modificamos el código anterior añadiendo la línea:</p>

<pre><code class="language-javascrip">console.log(atob(y()))
</code></pre>

<p>Esto nos devolverá ejecutándo el código en la consola de comandos (Ctrl+Shift+K) el valor de la API key que pide el ejercicio.</p>
<h3 id="7-sql--databases">7. SQL &amp; Databases.</h3>

<p>El propósito de una base de datos es almacenar y recuperar datos de una manera rápida y efectiva. Para usar una base de datos, una aplicación web necesita una conexión activa al servidor de la base de datos. Una vez que un usuario envía una solicitud que requiere información, la aplicación web crea una consulta y la envía a la base de datos. La base de datos ejecuta la consulta y los datos se devuelven a la aplicación web. Usando los datos, la aplicación web crea la respuesta adecuada para enviarla al usuario. Según la consulta, estos pasos suelen sentirse casi instantáneos para el usuario.</p>

<p>En la mayoría de los escenarios, la única interacción que tenemos con una base de datos es a través de la aplicación web. En comparación con la cantidad de aplicaciones web disponibles en Internet, no es común encontrar un servidor de base de datos accesible. De manera similar a cómo un navegador web es un cliente para el servidor de aplicaciones web, una aplicación web es un cliente para el servidor de la base de datos. Sin embargo, a diferencia de un navegador web, el protocolo utilizado para la comunicación no es HTTP (lo más probable). En su lugar, cada servidor de base de datos utiliza su propio estándar de protocolo. Dado que no estamos interactuando directamente con la base de datos, no necesitamos familiarizarnos con el protocolo. Sin embargo, necesitamos familiarizarnos con la forma en que la aplicación web sabe qué datos consultar.</p>

<p>Por lo general, las bases de datos son relacionales o no relacionales. Para este tema, nos concentraremos en las aplicaciones web que utilizan una base de datos relacional.</p>

<p>Algunos servidores de bases de datos relacionales comunes incluyen MySQL, Microsoft SQL Server y PostgreSQL.</p>

<p>En una base de datos relacional, los datos se almacenan en una tabla con una o más columnas. Las columnas representan atributos sobre los datos (es decir, ID, nombre, correo electrónico, etc.). Cada fila, también llamada <em>tupla</em>, representa un registro de datos.</p>

<p><br /></p>

<h4 id="71-select-statement">7.1. SELECT Statement.</h4>

<p>Para que la aplicación web consulte los datos, la aplicación web y la base de datos deben “hablar” un idioma común. Las bases de datos relacionales suelen comprender el <em>lenguaje de consulta estructurado</em> o SQL. Este es un lenguaje de consulta utilizado para interactuar con una base de datos. Le dice a la base de datos qué datos quiere la aplicación web, qué tipo de condiciones deben cumplir los datos, cómo organizar los resultados y mucho más. La base de datos procesa la instrucción SQL y determina qué datos coinciden con las condiciones de la instrucción. La sintaxis SQL está diseñada para ser legible por humanos.</p>

<p>Para obtener datos de la tabla de usuarios en la base de datos, usaríamos la instrucción <em>SELECT</em>. La declaración SELECT espera una lista de columnas de las que nos gustaría leer. Por ejemplo, una base de datos es una tabla de campos relacionados en valores. Si queremos ver solo la columna del mail, la consulta comenzaría con “SELECT mail”. Si queremos todas las columnas, podríamos usar el carácter de asterisco * en lugar del nombre de la columna.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT &lt;column_name&gt;
FROM &lt;table&gt;
</code></pre></div></div>

<p>A continuación, la declaración SELECT necesita una cláusula <em>FROM</em> y un nombre de tabla para declarar de qué tabla obtener los datos. La consulta para seleccionar todos los correos electrónicos de la tabla de usuarios sería:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT email
FROM users
</code></pre></div></div>

<p><br /></p>

<h4 id="73-where-clause">7.3. WHERE Clause.</h4>

<p>También es posible limitar los resultados utilizando la cláusula <em>WHERE</em>. Por ejemplo, si solo quisiéramos seleccionar el correo electrónico donde el nombre es “Orietta” o la ID es 3, podemos hacerlo agregando “WHERE first_name = ‘Orietta’” y “OR id = 3” a la consulta.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT id, email
FROM users
WHERE first_name = 'Orietta' OR id = 3
</code></pre></div></div>

<p>Al comparar valores numéricos en SQL, el número no tiene que estar entre comillas. Sin embargo, un valor de cadena (como ‘Orietta’) debe estar entre comillas. </p>

<p><br /></p>

<p><strong>Exercises</strong></p>

<p><strong>1.  Inicie la máquina virtual <em>Astro</em> . Complete la consulta en http://YOUR_VM_IP/challenges/0 para enumerar todos los usuarios. ¿Cuál es la bandera en esta tabla?</strong></p>

<p>Comenzamos conectándonos enviando la URL propuesta en el enunciado a nuestro navegador y completamos la query que debe quedar como:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT * FROM users
</code></pre></div></div>

<p><br /></p>

<p><strong>2.  Inicie la máquina virtual <em>Astro</em> . Complete la consulta en http://YOUR_VM_IP/challenges/1 para enumerar todos los usuarios cuyo primer nombre sea ‘Orietta’ o la identificación sea 4. ¿Cuál es el valor de la marca detectada?</strong></p>

<p>De nuevo acudimos al sitio web y completamos la query que debe quedar como sigue:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT id, email
	FROM users
	WHERE first_name = "Orietta" OR id=4
</code></pre></div></div>

<p><br /></p>

<h4 id="74-the-join-operator">7.4. The JOIN Operator.</h4>

<p>Los operadores <em>JOIN</em> y <em>UNION</em> nos permiten combinar filas de datos de varias tablas. El operador <em>JOIN</em> combina datos de dos tablas en función de columnas que se identifican como claves. Una <em>clave primaria</em> es un identificador único para una fila de datos en una tabla. Puede ser cualquier tipo de valor siempre que cada fila de la tabla tenga un valor único.</p>

<p>La tabla <em>de usuarios</em> contiene una lista de usuarios habituales. La tabla <em>addresses</em> contiene las direcciones de los usuarios. Si bien en algunas situaciones puede tener más sentido que la dirección esté en la misma tabla de usuarios, en esta aplicación los usuarios pueden tener varias direcciones. Por este motivo, la tabla <em>addresses</em> tiene una columna que corresponde al ID del usuario. Esta columna es una <em>clave externa</em> que hace referencia a la tabla de <em>users</em>. En este ejemplo, el usuario de Orietta tiene dos direcciones.</p>

<p>Si queremos obtener la dirección de cada usuario pero también incluir el nombre del usuario, la consulta sería la que se encuentra a continuación:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT first_name, address
FROM users
JOIN addresses ON users.id=addresses.userid
</code></pre></div></div>

<p>La cláusula JOIN en el ejemplo anterior especifica que la tabla <em>adresses</em> debe combinarse con la tabla <em>users</em> haciendo una referencia cruzada de la columna <em>adresses</em> en la tabla <em>users</em> y la columna de identificación de usuario en la tabla <em>addresses</em>.</p>

<p><br /></p>

<p>El operador <em>UNION</em> nos permite seleccionar filas de varias tablas y combinar los resultados, incluso si no hay relaciones clave entre las tablas. Sin embargo, necesitamos especificar el mismo número de columnas en cada instrucción SELECT. Por el bien de este ejemplo, presentaremos una tabla de <em>administrators</em> de 4 columnas.</p>

<p>Usando el operador UNION, podemos combinar los resultados de las tablas de <em>users</em> y <em>administrators</em> para obtener una lista de cada correo electrónico. El operador UNION combinará dos consultas SELECT siempre que tengan el mismo número de columnas. Puede encontrar un ejemplo en el Listado 15.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT id, email
FROM users
UNION
SELECT id, email
FROM admins
</code></pre></div></div>


      </article>

      
        <div class="blog-tags">
          <span>Tags:</span>
          
            <a href="/tags#pen">pen</a>
          
        </div>
      

      

      
        <!-- Check if any share-links are active -->




<section id = "social-share-section">
  <span class="sr-only">Share: </span>

  
    <a href="https://twitter.com/intent/tweet?text=Scripting&url=http%3A%2F%2Flocalhost%3A4000%2F2023-11-03-3.Scripting%2F"
      class="btn btn-social-icon btn-twitter" title="Share on Twitter">
      <span class="fab fa-fw fa-twitter" aria-hidden="true"></span>
      <span class="sr-only">Twitter</span>
    </a>
  

  
    <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2F2023-11-03-3.Scripting%2F"
      class="btn btn-social-icon btn-facebook" title="Share on Facebook">
      <span class="fab fa-fw fa-facebook" aria-hidden="true"></span>
      <span class="sr-only">Facebook</span>
    </a>
  

  
    <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2F2023-11-03-3.Scripting%2F"
      class="btn btn-social-icon btn-linkedin" title="Share on LinkedIn">
      <span class="fab fa-fw fa-linkedin" aria-hidden="true"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  

  

  

</section>



      

      <ul class="pagination blog-pager">
        
        <li class="page-item previous">
          <a class="page-link" href="/2023-11-02-2.PracticalTools/" data-toggle="tooltip" data-placement="top" title="Practical Tools">&larr; Previous Post</a>
        </li>
        
        
        <li class="page-item next">
          <a class="page-link" href="/2023-11-04-4.Networking/" data-toggle="tooltip" data-placement="top" title="Networking">Next Post &rarr;</a>
        </li>
        
      </ul>
      
  
  
  

  


  



    </div>
  </div>
</div>


  <footer>
  <div class="container-md beautiful-jekyll-footer">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      <ul class="list-inline text-center footer-links"><li class="list-inline-item">
    <a href="/feed.xml" title="RSS">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">RSS</span>
    </a>
  </li><li class="list-inline-item">
    <a href="mailto:sanmillan.german@gmail.com" title="Email me">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Email me</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://github.com/Qv1nTv5" title="GitHub">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">GitHub</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://twitter.com/Qvintvs1" title="Twitter">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Twitter</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://linkedin.com/in/german-sanmillan-68b308229/" title="LinkedIn">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">LinkedIn</span>
   </a>
  </li></ul>

      
      <p class="copyright text-muted">
      
        Qv1nTv5
        &nbsp;&bull;&nbsp;
      
      2024

      

      
      </p>
      <p class="theme-by text-muted">
        Powered by
        <a href="https://beautifuljekyll.com">Beautiful Jekyll</a>
      </p>
      </div>
    </div>
  </div>
</footer>


  
  
    
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>


  
    
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>


  
    
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


  



  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/assets/js/beautifuljekyll.js"></script>
    
  









</body>
</html>
